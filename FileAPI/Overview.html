<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!--
  Overview.html
  Web IDL

  Note: This file is generated from Overview.xml.  Run "make" to regenerate it.
  -->

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>File API</title>
    <meta name="revision" content="$Id: Overview.html,v 1.22 2010-06-26 01:06:30 arangana Exp $" />
    <link rel="stylesheet" href="FileAPI.css" type="text/css" />
    <script src="section-links.js" type="application/ecmascript"></script>
    <script src="dfn.js" type="application/ecmascript"></script>
    <!--[if IE]>
    <style type='text/css'>
      .ignore {
        -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=50)";
        filter: alpha(opacity=50);
      }
    </style>
    <![endif]-->

    
  <link rel="stylesheet" href="http://www.w3.org/StyleSheets/TR/W3C-ED" type="text/css" /></head>

  <body>
    <div class="head"><div><a href="http://www.w3.org/"><img src="http://www.w3.org/Icons/w3c_home" width="72" height="48" alt="W3C" /></a></div><h1>File API</h1><h2>W3C Editor’s Draft <em>26 June 2010</em></h2><dl><dt>Latest Editor’s Draft:</dt><dd><a href="http://dev.w3.org/2006/webapi/FileAPI/">http://dev.w3.org/2006/webapi/FileAPI/</a></dd><dt>Latest Published Version:</dt><dd><a href="http://www.w3.org/TR/FileAPI/">http://www.w3.org/TR/FileAPI/</a></dd><dt>Editor:</dt><dd><a href="http://arunranga.com/">Arun Ranganathan</a>, Mozilla Corporation &lt;arun@mozilla.com&gt;</dd></dl><p class="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> &copy; 2009 <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>&reg;</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.org/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. W3C <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.</p></div><hr />

    <div class="section">
      <h2>Abstract</h2>
     <p>
      This specification provides an <acronym title="Application Programming Interface">API</acronym>
      for representing file objects in web applications, as well as programmatically selecting them and accessing their data.  This includes:

    </p>
	<ul>
	    <li>A <a class="dfnref" href="#dfn-filelist">FileList</a> sequence, which represents an array of individually selected files from the underlying system.
		The user interface for selection can be invoked via <code>&lt;input type="file"&gt;</code>, i.e. when the
		<code>input</code> element is in the <code>File Upload</code> state [<a href="#HTML5">HTML5</a>] .</li>
	    <li>A <a class="dfnref" href="#dfn-Blob">Blob</a> interface, which represents raw binary data, and allows access to ranges of bytes within the Blob object.</li>
            <li>A <a href="#dfn-file" class="dfnref">File</a> interface, which includes readonly informational attributes about a file
	        such as its name, its mediatype, and a URL to access its data.</li>
            <li>A <a href="#dfn-blobreader" class="dfnref">BlobReader</a> interface, which provides methods to read a
            <a href="#dfn-file">File</a> or a <a href="#dfn-Blob">Blob</a>, and an event model to obtain the results of these reads.</li>
            <li>A <a href="#dfn-fileerror" class="dfnref">FileError</a> interface and a <a href="#dfn-FileException" class="dfnref">FileException</a> exception
            which define error conditions used by this specification.</li>


        </ul>
        <p>Additionally, this specification defines objects to be used within threaded web applications for the synchronous reading of files.</p>
  
  <p>The section on Requirements and Use Cases [<a href="#requirements">REQ</a>] covers the motivation behind this specification.</p>
    <p>
      This API is designed to be used in conjunction with other APIs and elements on the web platform,
      notably: <a href="#XHR2" class="dfnref">XMLHttpRequest</a> (e.g.  with an overloaded <code>send()</code>
      method for File or Blob objects), <code>postMessage</code>, <code>DataTransfer</code> (part
      of the <em>drag and drop API</em> defined in [<a href="#HTML5">HTML5</a>,]) and
      <a href="#Workers">Web Workers</a>. Additionally, it should be possible to programmatically obtain a list of files from the
      <code>input</code> element when it is
      in the <code>File Upload state</code>[<a href="#HTML5">HTML5</a>].
      These kinds of behaviors are defined in the appropriate affiliated specifications.
    </p>

      <div class="ednote"><div class="ednoteHeader">Editorial note</div><p>This is revision $Id: Overview.html,v 1.22 2010-06-26 01:06:30 arangana Exp $.</p><p>There are 3 further editorial notes in the document.</p></div>
    </div>

    <div class="section">
      <h2>Status of this Document</h2>
      <p><em>
        This section describes the status of this document at the time of
        its publication.  Other documents may supersede this document. A list
        of current W3C publications and the latest revision of this technical
        report can be found in the <a href="http://www.w3.org/TR/">W3C technical
          reports index</a> at http://www.w3.org/TR/.
      </em></p><p>
        This document is the 26 June 2010 <b>Editor’s Draft</b> of the
        <cite>File API</cite> specification.
      
      Please send comments about this document to
      <a href="mailto:public-webapps@w3.org">public-webapps@w3.org</a>
      (<a href="http://lists.w3.org/Archives/Public/public-webapps/">archived</a>).
    </p>
      <p>
        Previous discussion of this specification has taken place on two other
        mailing lists: <a href="mailto:public-webapps@w3.org">public-webapps@w3.org</a>
        (<a href="http://lists.w3.org/Archives/Public/public-webapps/">archive</a>)
        and <a href="mailto:public-webapi@w3.org">public-webapi@w3.org</a>
        (<a href="http://lists.w3.org/Archives/Public/public-webapi/">archive</a>). Ongoing
        discussion will be on the <a href="mailto:public-webapps@w3.org">public-webapps@w3.org</a>
        mailing list.
      </p>
      
      <p>
      <em>This section describes the status of this document at the time of its publication.
      Other documents may supersede this document, since it is only an editor's draft.
      A list of current <acronym title="World Wide Web Consortium">W3C</acronym>
      publications and the latest revision of this technical report can be found in the 
      <a href="http://www.w3.org/TR/"><acronym title="World Wide Web Consortium">W3C</acronym>
      technical reports index</a> at http://www.w3.org/TR/.</em>
      </p>

    <p>
      This document is produced by the <a href="http://www.w3.org/2008/webapps">Web <acronym title="Application Programming Interface">Applications</acronym>
      <acronym title="Working Group">WG</acronym></a> in the <acronym title="World Wide Web Consortium">W3C</acronym>
      <a href="http://www.w3.org/Interaction/">Interaction Domain</a>.
    </p>
    <p>
      Web content and browser developers are encouraged to review this draft. Please send comments to
      <a href="mailto:public-webapps@w3.org">public-webapps@w3.org</a>, the <acronym title="World Wide Web Consortium">W3C</acronym>'s
      public email list for issues related to Web <acronym title="Application Programming Interface">API</acronym>s.
      <a href="http://lists.w3.org/Archives/Public/public-webapps/">Archives</a> of the
      list are available.
    </p>
    <p>
        This document is produced by the <a href="http://www.w3.org/2008/webapps/">Web Applications Working Group</a>,
	part of the <a href="http://www.w3.org/2006/rwc/Activity">Rich Web Clients Activity</a>
        in the W3C <a href="http://www.w3.org/Interaction/">Interaction Domain</a>.
        Changes made to this document can be found in the
        <a href="http://dev.w3.org/cvsweb/2006/webapi/FileAPI/Overview.xml">W3C public CVS server</a>.
    </p>
      <p>
          Publication as an Editor’s Draft does not imply endorsement by the
          W3C Membership.  This is a draft document and may be updated, replaced
          or obsoleted by other documents at any time. It is inappropriate to cite
          this document as other than work in progress.
        </p><p>
      This document was produced by a group operating under the
      <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February
        2004 W3C Patent Policy</a>. W3C maintains a
      <a href="http://www.w3.org/2004/01/pp-impl/42538/status">public list of
        any patent disclosures</a> made in connection with the deliverables of
      the group; that page also includes instructions for disclosing a patent.
      An individual who has actual knowledge of a patent which the individual
      believes contains
      <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
        Claim(s)</a> must disclose the information in accordance with
      <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
        6 of the W3C Patent Policy</a>.
    </p>
    </div>

    <div id="toc">
      <h2>Table of Contents</h2>
      <div class="toc"><ul><li><a href="#introduction">1. Introduction</a></li><li><a href="#conformance">2. Conformance</a></li><li><a href="#terminology">3. Terminology and Algorithms</a></li><li><a href="#filelist-section">4. The FileList Sequence</a></li><li><a href="#blob">5. The Blob Interface</a><ul><li><a href="#attributes-blob">5.1. Attributes</a></li><li><a href="#methodsandparams-blob">5.2. Methods and Parameters</a></li><li><a href="#file">5.3. The File Interface</a><ul><li><a href="#file-attrs">5.3.1. Attributes</a></li></ul></li><li><a href="#blobreader-interface">5.4. The BlobReader Interface</a><ul><li><a href="#blobreader-task-source">5.4.1. The BlobReader Task Source</a></li><li><a href="#filereaderConstrctr">5.4.2. Constructors</a></li><li><a href="#event-handler-attributes-section">5.4.3. Event Handler Attributes</a></li><li><a href="#blobreader-state">5.4.4. BlobReader States</a></li><li><a href="#reading-a-file">5.4.5. Reading a File or Blob</a><ul><li><a href="#MultipleReads">5.4.5.1. Multiple Reads</a></li><li><a href="#filedata-attr">5.4.5.2. The result attribute</a></li><li><a href="#readAsBinaryString">5.4.5.3. The readAsBinaryString() method</a></li><li><a href="#readAsDataURL">5.4.5.4. The readAsDataURL() method</a></li><li><a href="#readAsDataText">5.4.5.5. The readAsText() method</a></li><li><a href="#readAsArrayBuffer">5.4.5.6. The readAsArrayBuffer() method</a></li><li><a href="#abort">5.4.5.7. The abort() method</a></li><li><a href="#blobAndFileParams">5.4.5.8. Blob Parameters</a></li><li><a href="#enctype">5.4.5.9. Determining Encoding</a></li><li><a href="#events">5.4.5.10. Events</a><ul><li><a href="#event-summary">5.4.5.10.1. Event Summary</a></li></ul></li></ul></li></ul></li><li><a href="#readingOnThreads">5.5. Reading on Threads</a><ul><li><a href="#FileReaderSync">5.5.1. The BlobReaderSync Interface</a><ul><li><a href="#readAsBinaryStringSyncSection">5.5.1.1. The readAsBinaryString method</a></li><li><a href="#readAsTextSync">5.5.1.2. The readAsText method</a></li><li><a href="#readAsDataURLSync-section">5.5.1.3. The readAsDataURL method</a></li><li><a href="#readAsArrayBufferSyncSection">5.5.1.4. The readAsArrayBuffer method</a></li></ul></li></ul></li><li><a href="#ErrorAndException">5.6. Errors and Exceptions</a><ul><li><a href="#FileErrorInterface">5.6.1. The FileError Interface</a></li><li><a href="#FileException">5.6.2. The FileException exception</a></li><li><a href="#ErrorDescriptions">5.6.3. Error Code Descriptions</a></li></ul></li><li><a href="#url">5.7. A URL for Blob and File reference</a><ul><li><a href="#ABNFForBlob">5.7.1. Definition of blob URL Scheme</a></li><li><a href="#originOfBlob">5.7.2. Origin of Blob URLs</a></li><li><a href="#lifeTime">5.7.3. Lifetime of Blob URLs</a></li><li><a href="#processingModel">5.7.4. Processing Model for Blob URLs</a><ul><li><a href="#TwoHundredOK">5.7.4.1. 200 OK</a></li><li><a href="#FourOhThreeNotAllowed">5.7.4.2. 403 Not Allowed</a></li><li><a href="#FourOhFourNotFound">5.7.4.3. 404 Not Found</a></li><li><a href="#FiveHundredInternalServerError">5.7.4.4. 500 Internal Server Error</a></li></ul></li></ul></li><li><a href="#security-discussion">5.8. Security Considerations</a></li><li><a href="#requirements">5.9. Requirements and Use Cases</a></li><li><a href="#acknowledgements-section">5.10. Acknowledgements</a></li><li><a href="#references">5.11. References</a><ul><li><a href="#normative-references">5.11.1. Normative references</a></li><li><a href="#informative-references">5.11.2. Informative References</a></li></ul></li></ul></li></ul></div>
    </div>

    <div id="sections">
    <div id="introduction" class="section">
    <h2>1. Introduction</h2>

      <p class="norm">This section is informative.</p>

      <p>
      Web applications should have the ability to manipulate as wide
      as possible a range of user input, including files that a user may wish to upload 
      to a remote server or manipulate inside a rich web application. This specification 
      defines the basic representations for files, lists of files, errors raised by access to files,
      and programmatic ways to read files.  The interfaces and API defined in this
      specification can be used with other interfaces and APIs exposed to the web platform.
      
    </p>
    <p>
      File or Blob reads should happen asynchronously on the main thread, with an optional synchronous API used
      within threaded web applications.  An asynchronous API for reading files prevents blocking and UI "freezing" on a user
      agent's main thread.  This specification defines an asynchronous API based on an <em>event model</em> to read and access a File or Blob's
      data.  Moreover,
      this specification defines separate interfaces for <em>Files and Blobs</em> and the objects used to <em>read</em> a File or Blob's data.
      While a <code>File</code> object provides a reference to a single
    file that a user has selected from a file picker (typically spawned by the HTML <code>input</code> element), a <code>BlobReader</code>
    object provides asynchronous read methods to
    access that file's data through event handler attributes and the firing of events.  The use of events and event handlers allows separate code blocks the ability
    to monitor the <em>progress of the read</em> (which is useful for remote drives that appear to be local, but behave slower than local drives), error conditions that may arise,
    and successful reading of a file.  An example will be illustrative.</p>
    <div class="example"><div class="exampleHeader">Example</div>
    <p>In the example below, different code blocks handle progress, error, and success conditions.</p>
    <div class="block"><div class="blockTitleDiv"><span class="blockTitle">ECMAScript</span></div><div class="blockContent"><pre class="code"><code class="es-code">
function startRead() {  
  <span class="comment">// obtain input element through DOM</span> 
  
  var file = document.getElementById('file').files[0];
  if(file){
    getAsText(file);
  }
}

function getAsText(readFile) {
        
  var reader = new BlobReader();
  
  <span class="comment">// Read file into memory as UTF-16</span>      
  reader.readAsText(readFile, "UTF-16");
  
  <span class="comment">// Handle progress, success, and errors</span>
  reader.onprogress = updateProgress;
  reader.onload = loaded;
  reader.onerror = errorHandler;
}

function updateProgress(evt) {
  if (evt.lengthComputable) {
    <span class="comment">// evt.loaded and evt.total are ProgressEvent properties</span>
    var loaded = (evt.loaded / evt.total);
    if (loaded &lt; 1) {
      <span class="comment">// Increase the prog bar length</span>
      <span class="comment">// style.width = (loaded * 200) + "px";</span>
    }
  }
}

function loaded(evt) {  
  <span class="comment">// Obtain the read file data</span>    
  var fileString = evt.target.result;
  <span class="comment">// Handle UTF-16 file dump</span>
  if(utils.regexp.isChinese(fileString)) {
    <span class="comment">//Chinese Characters + Name validation</span>
  }
  else {
    <span class="comment">// run other charset test</span>
  }
  <span class="comment">// xhr.send(fileString)</span>     
}

function errorHandler(evt) {
  if(evt.target.error.code == evt.target.error.NOT_READABLE_ERR) {
    <span class="comment">// The file could not be read</span>
  }
}
</code></pre></div></div>
</div>
</div>

      <div id="conformance" class="section">
        <h2>2. Conformance</h2>

        <p>
          Everything in this specification is normative except for
          examples and sections marked as being informative.
        </p>
        <p>
          The keywords “<span class="rfc2119">MUST</span>”,
          “<span class="rfc2119">MUST NOT</span>”,
          “<span class="rfc2119">REQUIRED</span>”,
          “<span class="rfc2119">SHALL</span>”,
          “<span class="rfc2119">SHALL NOT</span>”,
          “<span class="rfc2119">RECOMMENDED</span>”,
          “<span class="rfc2119">MAY</span>” and
          “<span class="rfc2119">OPTIONAL</span>” in this document are to be
          interpreted as described in
          <cite><a href="http://www.ietf.org/rfc/rfc2119">Key words for use in RFCs to
              Indicate Requirement Levels</a></cite>
          <a href="#RFC2119">[RFC2119]</a>.
        </p>
        <p>
          The following conformance classes are defined by this specification:
        </p>
        <dl>
          <dt><dfn id="dfn-conforming-implementation">conforming implementation</dfn></dt>
          <dd>
            <p>
              A user agent is considered to be a
              <a class="dfnref" href="#dfn-conforming-implementation">conforming implementation</a>
              if it satisfies all of the <span class="rfc2119">MUST</span>-,
              <span class="rfc2119">REQUIRED</span>- and <span class="rfc2119">SHALL</span>-level
              criteria in this specification that apply to implementations.
            </p>
          </dd>         
        </dl>
      </div>
      <div id="terminology" class="section">
        <h2>3. Terminology and Algorithms</h2>
        <p>The terms and algorithms <dfn id="fragment">&lt;fragment&gt;</dfn>, <dfn id="scheme">&lt;scheme&gt;</dfn>, <dfn id="document-base-url">document base URL</dfn>,
        <dfn id="event-handler-attributes">event handler attributes</dfn>, <dfn id="event-handler-event-type">event handler event type</dfn>,
        <dfn id="Function"><code>Function</code></dfn>,
        <dfn id="origin">origin</dfn>, <dfn id="resolve-a-URL">resolve a URL</dfn>, <dfn id="same-origin">same origin</dfn>,
        <dfn id="task">task</dfn>, <dfn id="task-source">task source</dfn>, <dfn id="df-URL">URL</dfn>, <dfn id="URL-character-encoding">URL character encoding</dfn>, the
        <dfn id="already-started">"already started" flag</dfn> for script processing, and
        <dfn id="queue-a-task">queue a task</dfn> are defined by the HTML 5 specification [<a href="#HTML5">HTML5</a>]. </p>
       <p>This specification includes algorithms (steps) as part of the definition of methods.  Conforming implementations (referred to as "user agents" from here on) MAY use other algorithms in the
       implementation of these methods, provided
       the end result is the same.</p> 
      </div>

      <div id="filelist-section" class="section">
        <h2>4. The FileList Sequence</h2>
       
       <p>
          This sequence parameterized type exposes the list of files that have been selected.
       </p>
    <div class="block"><div class="blockTitleDiv"><span class="blockTitle">IDL</span></div><div class="blockContent"><pre class="code"><code class="idl-code">
    typedef sequence&lt;File&gt; <dfn id="dfn-filelist">FileList</dfn>;
    </code></pre></div></div>
    <div class="example"><div class="exampleHeader">Example</div>
    <p>
      Sample usage typically involves DOM access to the <code>&lt;input type="file"&gt;</code> element within a form, and then accessing selected files.  
    </p>
    <div class="block"><div class="blockTitleDiv"><span class="blockTitle">ECMAScript</span></div><div class="blockContent"><pre class="code"><code class="es-code">
    <span class="comment">// uploadData is a form element</span>
    <span class="comment">// fileChooser is input element of type 'file'</span>
    var file = document.forms['uploadData']['fileChooser'].files[0];
    
    if(file)
    {
      <span class="comment">// Perform file ops</span>
    }  
    </code></pre></div></div>
    </div>
    <div class="note"><div class="noteHeader">Note</div>
    The <code>HTMLInputElement</code> interface [<a href="#HTML5">HTML5</a>] has a readonly <code>FileList</code> attribute, which is what is
    being accessed in the above example.  Some conforming user agents support multiple file selections within HTML forms, in which case the
    <code>FileList</code> object MUST make available all selected files.
    </div>
    </div>
  <div id="blob" class="section">
    <h2>5. The Blob Interface</h2>
    <p>
      This interface represents raw data.  It provides a method to <a href="#dfn-slice" class="dfnref">slice</a> data objects between ranges of bytes into
      further chunks of raw data.
      It also provides an attribute representing the size of the chunk of data.
      The <a href="#dfn-file" class="dfnref">File</a> interface inherits from this interface.
    </p>
    <div class="block"><div class="blockTitleDiv"><span class="blockTitle">IDL</span></div><div class="blockContent"><pre class="code"><code class="idl-code">
    interface <dfn id="dfn-Blob">Blob</dfn> {
      
      readonly attribute unsigned long long <a href="#dfn-size" title="size">size</a>;
      readonly attribute DOMString <a href="#dfn-type" class="dfnref">type</a>;
      readonly attribute DOMString <a href="#dfn-url" class="dfnref">url</a>;
      <span class="comment">//slice Blob into byte-ranged chunks</span>
      
      Blob <a href="#dfn-slice" title="slice">slice</a>(in long long <a href="#dfn-start" class="dfnref" title="start">start</a>,
                 in long long <a href="#dfn-length" class="dfnref" title="length">length</a>,
                 optional DOMString <a href="#dfn-contentTypeBlob">contentType</a>); 
    
    };
    </code></pre></div></div>
                
    <div id="attributes-blob" class="section">
    <h3>5.1. Attributes</h3>
    <dl><dt id="dfn-size"><code>size</code></dt><dd><p>Represents the size of the Blob object in bytes.</p></dd>
    <dt id="dfn-type"><code>type</code></dt>
    <dd><p>The ASCII-encoded string in lower case representing the media type of the Blob, expressed as an RFC2046 MIME type [<a href="#RFC2046">RFC2046</a>]. User agents SHOULD return the MIME type of the Blob,
    if it is known. If implementations cannot determine the media type of the Blob, they MUST return the empty string.  A string is a valid MIME type if it matches the <code>media-type</code>
    token defined in section 3.7 "Media Types" of RFC 2616 [<a href="#HTTP">HTTP</a>]. </p></dd>
    <dt id="dfn-url"><code>url</code></dt>
    <dd><p>The <a href="#url" class="dfnref">URL</a> representing the <a href="#dfn-Blob" class="dfnref">Blob</a> object.</p></dd>
    
    
    </dl>
    </div>
    <div id="methodsandparams-blob" class="section">
    <h3>5.2. Methods and Parameters</h3>
    <dl><dt id="dfn-slice">The <code>slice</code> method</dt>
    <dd><p>Returns a new <a href="#dfn-Blob" class="dfnref"><code>Blob</code></a> object between the ranges of bytes specified.</p>
    <p>The <dfn id="dfn-start">start</dfn> parameter is a value for the start point of a <a href="#dfn-slice" class="dfnref"><code>slice</code></a> call.</p>
    <p>The <dfn id="dfn-length">length</dfn> parameter is a value for the end point of a
    <a href="#dfn-slice" class="dfnref"><code>slice</code></a> call as byte offsets from <code>start</code>.</p>
    <p>The <dfn id="dfn-contentTypeBlob">contentType</dfn> parameter is optional, and can be used to set a value identical to one that is set with the HTTP/1.1 Content-Type header [<a href="#HTTP">HTTP</a>] on
    the <a href="#dfn-Blob">Blob</a> returned by the <a href="#dfn-slice" class="dfnref"><code>slice</code></a> call.  If this parameter is used, the returned <a href="#dfn-Blob">Blob</a> MUST have a <a href="#dfn-type"><code>type</code></a> attribute that, on getting, returns
    the string used for this parameter.</p>
    <p>The <a href="#dfn-slice"><code>slice</code></a> method MUST <dfn id="clamp">clamp</dfn> on values of <a href="#dfn-size"><code>size</code></a> if index arithmetic exceeds the bounds of <a href="#dfn-size"><code>size</code></a>.
    In particular, this means that for a given slice call:</p>
    <ul>
      <li>If <a href="#dfn-start"><code>start</code></a> + <a href="#dfn-length"><code>length</code></a> &gt; <a href="#dfn-size"><code>size</code></a> then a user agent MUST return a <a href="#dfn-Blob"><code>Blob</code></a> object as if
      <a href="#dfn-slice"><code>slice</code></a>(<a href="#dfn-start"><code>start</code></a>, <a href="#dfn-size"><code>size</code></a>-<a href="#dfn-start"><code>start</code></a>) was called.  </li>
      <li>If <a href="#dfn-start"><code>start</code></a> &gt; <a href="#dfn-size"><code>size</code></a> then a user agent MUST return a <a href="#dfn-Blob"><code>Blob</code></a> object of size 0</li>
    
    </ul>
      
    </dd></dl>
  </div>
  <div id="file" class="section">
  <h2>5.3. The File Interface</h2>
  <p>
    This interface describes a single file in a <a href="#dfn-filelist" class="dfnrefs">FileList</a> and exposes its name. It inherits from <a href="#dfn-Blob" class="dfnrefs">Blob</a>. 
  </p>
  <div class="block"><div class="blockTitleDiv"><span class="blockTitle">IDL</span></div><div class="blockContent"><pre class="code"><code class="idl-code">
  interface <dfn id="dfn-file">File</dfn> : <a href="#dfn-Blob" class="dfnref">Blob</a> {

      readonly attribute DOMString <a href="#dfn-name" class="dfnref">name</a>;
      
};
  </code></pre></div></div>
  <div id="file-attrs" class="section">
  <h3>5.3.1. Attributes</h3>
  <dl>
    <dt id="dfn-name"><code>name</code></dt>
    <dd><p>The name of the file. There are numerous file name variations on different systems; this is merely the name of the file, without path information.</p></dd>
    
    </dl>
    
  </div>
  </div>
  <div id="blobreader-interface" class="section">
  <h2>5.4. The BlobReader Interface</h2>
  <p>
    This interface provides methods to read <a href="#dfn-file">Files</a> or <a href="#dfn-Blob">Blobs</a> into memory, and to access the data from those <a href="#dfn-file">Files</a> or <a href="#dfn-Blob">Blobs</a> using progress events and
    <a href="#event-handler-attributes">event handler attributes</a> [<a href="#DOM3Events">DOM3Events</a>].  It is desirable to read
    data from file systems asynchronously in the main thread of user agents.  This interface provides such an asynchronous API, and is specified to be used
    with the global object (<code>Window</code> [<a href="#HTML5">HTML5</a>]) as well as Web Workers (<code>WorkerUtils</code> [<a href="#Workers">WebWorkers</a>]).
  </p>
  <div class="block"><div class="blockTitleDiv"><span class="blockTitle">IDL</span></div><div class="blockContent"><pre class="code"><code class="idl-code">

[Constructor]
interface <dfn id="dfn-blobreader">BlobReader</dfn> {

  <span class="comment">// async read methods</span>
  void <a href="#dfn-readAsBinaryArrayBuffer" class="dfnref">readAsArrayBuffer</a>(in <a href="#dfn-Blob" class="dfnref">Blob</a> <a href="#dfn-fileBlob" class="dfnref">blob</a>);
  void <a href="#dfn-readAsBinaryStringAsync" class="dfnref">readAsBinaryString</a>(in <a href="#dfn-Blob" class="dfnref">Blob</a> <a href="#dfn-fileBlob" class="dfnref">blob</a>);
  void <a href="#dfn-readAsText" class="dfnref">readAsText</a>(in <a href="#dfn-Blob" class="dfnref">Blob</a> <a href="#dfn-fileBlob" class="dfnref">blob</a>, [Optional] in DOMString <a href="#dfn-encoding" class="dfnref">encoding</a>);
  void <a href="#dfn-readAsDataURL" class="dfnref">readAsDataURL</a>(in <a href="#dfn-Blob" class="dfnref">Blob</a> <a href="#dfn-fileBlob" class="dfnref">blob</a>);

  void <a href="#dfn-abort" class="dfnref">abort</a>();

  <span class="comment">// states</span>
  const unsigned short <a href="#dfn-empty" class="dfnref">EMPTY</a> = 0;
  const unsigned short <a href="#dfn-loading" class="dfnref">LOADING</a> = 1;
  const unsigned short <a href="#dfn-done" class="dfnref">DONE</a> = 2;
  
  
  readonly attribute unsigned short <a class="dfnref" href="#dfn-readystate">readyState</a>;

  <span class="comment">// File or Blob data</span>
  readonly attribute any <a href="#dfn-result" class="dfnref">result</a>;
  
  readonly attribute <a href="#dfn-fileerror" class="dfnref">FileError</a> <a href="#dfn-error" class="dfnref">error</a>;

  <span class="comment">// event handler attributes</span>
  attribute Function <a href="#dfn-onloadstart" class="dfnref">onloadstart</a>;
  attribute Function <a href="#dfn-onprogress" class="dfnref">onprogress</a>;
  attribute Function <a class="dfnref" href="#dfn-onload">onload</a>;
  attribute Function <a class="dfnref" href="#dfn-onabort">onabort</a>;
  attribute Function <a class="dfnref" href="#dfn-onerror">onerror</a>;
  attribute Function <a class="dfnref" href="#dfn-onloadend">onloadend</a>;

};
BlobReader implements EventTarget;
  </code></pre></div></div>
<div id="blobreader-task-source" class="section">
<h3>5.4.1. The BlobReader Task Source</h3>
<p>The <a href="#dfn-blobreader" class="dfnref"><code>BlobReader</code></a> interface enables asynchronous reads on individual blobs by dispatching events to event handler methods.
Unless stated otherwise, the
<a href="#task-source" class="dfnref">task source</a> that is used in this specification is the
<a href="#dfn-blobreader"><code>BlobReader</code></a>.  This task source is used for tasks that are asynchronously dispatched, or for
event <a href="#queue-a-task" class="dfnref">tasks that are queued</a> for dispatching.</p>
</div>
<div id="filereaderConstrctr" class="section">
<h3>5.4.2. Constructors</h3>
<p>When the <code>BlobReader()</code> constructor is invoked, the user agent MUST return a new <a href="#dfn-blobreader"><code>BlobReader</code></a> object. </p>
</div>
<div id="event-handler-attributes-section" class="section">
<h3>5.4.3. Event Handler Attributes</h3>
<p>
The following are the <a href="#event-handler-attributes">event
   handler attributes</a> (and their corresponding <a href="#event-handler-event-type" title="event handler event type">event
   handler event types</a>) that user agents MUST support on
   <code><a href="#dfn-blobreader">BlobReader</a></code> as
   DOM attributes:  
</p>
<table>

   <thead>
    <tr>
     <th><a href="#event-handler-attributes" title="event handler       attributes">event handler attribute</a>

     </th><th><a href="#event-handler-event-type">event handler event type</a>

   </th></tr></thead><tbody>
    <tr>

     <td><dfn id="dfn-onloadstart"><code>onloadstart</code></dfn>

     </td><td><code><a href="#dfn-loadstart-event">loadstart</a></code>

    </td></tr><tr>
     <td><dfn id="dfn-onprogress"><code>onprogress</code></dfn>

     </td><td><code><a href="#dfn-progress-event">progress</a></code>

    </td></tr><tr>
     <td><dfn id="dfn-onabort"><code>onabort</code></dfn>

     </td><td><code title="abort-event"><a href="#dfn-abort-event">abort</a></code>

    </td></tr><tr>
     <td><dfn id="dfn-onerror"><code>onerror</code></dfn>

     </td><td><code><a href="#dfn-error-event">error</a></code>

    </td></tr><tr>
     <td><dfn id="dfn-onload"><code>onload</code></dfn>

     </td><td><code><a href="#dfn-load-event">load</a></code>

    </td></tr><tr>
     <td><dfn id="dfn-onloadend"><code>onloadend</code></dfn>

     </td><td><code><a href="#dfn-loadend-event">loadend</a></code>
  </td></tr></tbody></table>


</div>
<div id="blobreader-state" class="section">
<h3>5.4.4. BlobReader States</h3>
<p>The <a href="#dfn-blobreader" class="dfnref"><code>BlobReader</code></a> object can be in one of 3 states.  The
<dfn id="dfn-readystate"><code>readyState</code></dfn> attribute, on getting,
MUST return the current state, which MUST be one of the following values:</p>
<dl>
 <dt><dfn id="dfn-empty"><code>EMPTY</code> (numeric value 0)</dfn></dt>
 <dd><p>The object has been constructed, and there are no pending reads.</p></dd>
 <dt><dfn id="dfn-loading"><code>LOADING</code> (numeric value 1)</dfn></dt>
 <dd><p>A blob is being read.  One of the <a href="#read-methods">read methods</a> is being processed.</p></dd>
 <dt><dfn id="dfn-done"><code>DONE</code> (numeric value 2)</dfn></dt>
 <dd><p>The entire File or Blob has been read into memory, or a <a href="#file-error-read">file error occurred during read</a>, or the read was
 aborted using <a href="#dfn-abort"><code>abort()</code></a>.
 The <a href="#dfn-blobreader" class="dfnref">BlobReader</a>
is no longer reading a File or Blob.</p></dd>
</dl>
</div>
<div id="reading-a-file" class="section">
<h3>5.4.5. Reading a File or Blob</h3>
<div class="section" id="MultipleReads">
<h4>5.4.5.1. Multiple Reads</h4>
<p>
 The <a href="#dfn-blobreader" class="dfnref">BlobReader</a> interface makes available four asynchronous <dfn id="read-methods">read methods</dfn> --
<a href="#dfn-readAsArrayBuffer"><code>readAsArrayBuffer</code></a>, <a href="#dfn-readAsBinaryStringAsync" class="dfnref"><code>readAsBinaryString</code></a>,
 <a href="#dfn-readAsText" class="dfnref"><code>readAsText</code></a>, and <a href="#dfn-readAsDataURL" class="dfnref"><code>readAsDataURL</code></a>, which
 <em>read files into memory</em>.  If multiple read methods are called on the same <a href="#dfn-blobreader" class="dfnref"><code>BlobReader</code></a> object, user agents
 MUST only process the <dfn id="last-call">last call</dfn>
 to a read method, which is the call that occurs <em>last</em> in a script block that has the <a href="#already-started">"already started" flag</a> set
 [<a href="#HTML5">HTML5</a>].

</p>
</div>
<div id="filedata-attr" class="section">
<h4>5.4.5.2. The <code>result</code> attribute</h4>
<p>On getting, the <dfn id="dfn-result"><code>result</code></dfn> attribute returns a Blob's data as a <code>DOMString</code>, or as an <code>ArrayBuffer</code>
[<a href="#TypedArrays">TypedArrays</a>], or <code>null</code>, depending on the <a href="#read-methods" class="#dfnref">read method</a> that has been called on
the <a href="#dfn-blobreader" class="dfnref"><code>BlobReader</code></a> object, and
any errors that may have occurred.
It can also return <em>partial Blob data</em>.
<dfn id="partial-blob-data">Partial Blob data</dfn> is the part of the File or Blob that has been read into memory <em>currently</em>;
when processing the <a href="#read-methods">read methods</a>
<a href="#dfn-readAsBinaryStringAsync" class="dfnref"><code>readAsBinaryString</code></a> or
<a href="#dfn-readAsText" class="dfnref"><code>readAsText</code></a>, partial Blob data is a <code>DOMString</code> that is incremented as more bytes are <code>loaded</code> (a portion of the <code>total</code>) [<a href="#ProgressEvents">ProgressEvents</a>], and
when processing <a href="#dfn-readAsArrayBuffer"><code>readAsArrayBuffer</code></a> partial Blob data is an <code>ArrayBuffer</code> [<a href="#TypedArrays">TypedArrays</a>] objects consisting of the bytes <code>loaded</code> so far (a portion of the <code>total</code>)[<a href="#ProgressEvents">ProgressEvents</a>].  
The list below is normative for the <code>result</code> attribute:
</p>
<ul>
  <li><p>On getting, if the <a href="#dfn-readystate" class="dfnref"><code>readyState</code></a> is <code>EMPTY</code> (no read method has been called)
  then the <code>result</code> attribute MUST return <code>null</code>.</p></li>
  <li><p>On getting, if an error in reading the File or Blob has occurred (using <em>any</em> <a href="#read-methods"> read method</a>),
  then the <code>result</code> attribute MUST return the <code>null</code>.</p></li>
  <li><p>On getting, if the <a href="#dfn-readAsDataURL" class="#dfnref"><code>readAsDataURL</code></a> <a href="#read-methods">read method</a> is
  used, the <code>result</code> attribute MUST return a <code>DOMString</code> that is a Data URL [<a href="#DataURL">DataURL</a>] encoding of the File or Blob's data.</p></li>
  <li><p>On getting, if the <a href="#dfn-readAsBinaryStringAsync" class="dfnref"><code>readAsBinaryString</code></a> <a href="#read-methods">read method</a> is called
  (and no error in reading the File or Blob has occurred), then the <code>result</code> attribute MUST return a <code>DOMString</code> representing the File or Blob's data as a <dfn id="binary-string">binary string</dfn>, in which
  every byte is represented by an integer in the range [0..255].  On getting, <em>while processing</em> the
  <a href="#dfn-readAsBinaryStringAsync"><code>readAsBinaryString</code></a> <a href="#read-methods">read method</a>, the <code>result</code>
  attribute SHOULD return <a href="#partial-blob-data">partial Blob data</a> in <a href="#binary-string">binary string</a> format as a <code>DOMString</code> that is incremented as more data is read.</p></li>
  <li><p>On getting, if the <a href="#dfn-readAsText" class="dfnref"><code>readAsText</code></a> <a href="#read-methods">read method</a> is called
  (and no error in reading the File or Blob has occurred),
  then the <code>result</code> attribute MUST return a string representing the File or Blob's data as a text string, and SHOULD decode the string into memory in the format specified
  by the <a href="#encoding-determination">encoding determination</a>.  On getting, <em>while processing</em> the
  <a href="#dfn-readAsText" class="dfnref"><code>readAsText</code></a> <a href="#rea  d-methods">read method</a>, this attibute SHOULD return
  <a href="#partial-blob-data">partial Blob data</a> in the format specified by
  the <a href="#encoding-determination">encoding determination</a> as a <code>DOMString</code> that is incremented as more data is read.
  </p></li>
  <li><p>On getting, if the <a href="#dfn-readAsArrayBuffer"><code>readAsArrayBuffer</code></a> <a href="#read-methods">read method</a> is called (and no error in reading the File or Blob has occurred),
  then the <code>result</code> attribute MUST return an <code>ArrayBuffer</code> [<a href="#TypedArrays">TypedArrays</a>] object. On getting, <em>while processing</em> the
  <a href="#dfn-readAsArrayBuffer"><code>readAsArrayBuffer</code></a> <a href="#read-methods">read method</a>, the <code>result</code>
  attribute SHOULD return <a href="#partial-blob-data">partial Blob data</a> as an <code>ArrayBuffer</code> [<a href="#TypedArrays">TypedArrays</a>]; <em>at least one</em> ArrayBuffer object is
  returned till the Blob is fully loaded. </p></li>
</ul>
</div>
<div id="readAsBinaryString" class="section">
<h4>5.4.5.3. The <code>readAsBinaryString()</code> method</h4>
<p>
When the <dfn id="dfn-readAsBinaryStringAsync"><code>readAsBinaryString(blob)</code></dfn> method is called, the user agent MUST run the steps below (unless otherwise indicated).
</p>
<ol>
  <li><p>Set <a href="#dfn-readystate" class="dfnref"><code>readyState</code></a> to <a href="#dfn-empty" class="dfnref"><code>EMPTY</code></a>
  and set
  <a href="#dfn-result"><code>result</code></a> to <code>null</code>.</p></li>
  <li><p>If an <a href="#file-error-read">error occurs during File or Blob read</a>, set <a href="#dfn-readystate"><code>readyState</code></a> to
  <a href="#dfn-done"><code>DONE</code></a> and set <a href="#dfn-result"><code>result</code></a> to <code>null</code>. Proceed to the error steps below.</p>
  <ol>
    <li><p><a href="#dispatch-a-progress-event">Dispatch a progress event</a> called
    <a href="#dfn-error-event"><code>error</code></a>.  <em>Set the <a href="#dfn-error"><code>error</code></a> attribute</em>; on getting, the
    <a href="#dfn-error"><code>error</code></a> attribute MUST be a
    a <a href="#dfn-fileerror"><code>FileError</code></a> object with a valid <a href="#dfn-error-codes">error code</a> that indicates the kind of
    <a href="#file-error-read">file error that has occurred</a>.</p>
    </li>
    <li><p><a href="#dispatch-a-progress-event">Dispatch a progress event</a> called
    <a href="#dfn-loadend-event" class="dfnref"><code>loadend</code></a>. </p></li>
    <li><p>Terminate this overall set of steps.</p></li>    
  </ol>
  </li>
  <li><p>If no error has occurred, set <a href="#dfn-readystate" class="dfnref"><code>readyState</code></a> to <a href="#dfn-loading"><code>LOADING</code></a></p></li>
  <li><p><a href="#queue-a-task">Queue a task</a> to <a href="#dispatch-a-progress-event">dispatch a progress event</a> called <a href="#dfn-loadstart-event"><code>loadstart</code></a>.</p></li>
  <li><p><a href="#make-progress-notifications">Make progress notifications</a>.  As the bytes from the <a href="#dfn-fileBlob"><code>blob</code></a> argument are read,
  user agents SHOULD ensure that on getting,
  the <a href="#dfn-result"><code>result</code></a> attribute returns <a href="#partial-blob-data">partial Blob data</a> representing the number of bytes currently <code>loaded</code>
  (as a fraction of the <code>total</code>) [<a href="#ProgressEvents">ProgressEvents</a>], as a <a href="#binary-string">binary string</a>.
  </p></li>
  <li><p>When the File or Blob has been read into memory fully, set <a href="#dfn-readystate"><code>readyState</code></a> to <a href="#dfn-done"><code>DONE</code></a></p></li>
  <li><p>Set the <a href="#dfn-result" class="dfnref"><code>result</code></a> attribute to be <a href="#dfn-fileBlob"><code>blob</code></a>'s data content
  represented as a <a href="#binary-string">binary string</a>;
  on getting, the <a href="#dfn-result" class="dfnref"><code>result</code></a> attribute returns the (complete) data of <a href="#dfn-fileBlob"><code>blob</code></a>
  as a <a href="#binary-string">binary string</a>.</p></li>
  <li><p>Terminate this overall set of steps.</p></li>
</ol>
</div>
<div id="readAsDataURL" class="section">
<h4>5.4.5.4. The <code>readAsDataURL()</code> method</h4>
<p>When the <dfn id="dfn-readAsDataURL"><code>readAsDataURL(blob)</code></dfn> method is called, the user agent MUST run the steps below (unless otherwise indicated).</p>
<ol>
  <li><p>Set <a href="#dfn-readystate" class="dfnref"><code>readyState</code></a> to <a href="#dfn-empty" class="dfnref"><code>EMPTY</code></a> and set
  <a href="#dfn-result"><code>result</code></a> to <code>null</code>.</p></li>
  <li><p>If an <a href="#file-error-read">error occurs during File or Blob read</a>, OR if a user agent's URL length limitations prevent returning data as a Data URL
  [<a href="#DataURL">DataURL</a>], 
  set <a href="#dfn-readystate"><code>readyState</code></a> to
  <a href="#dfn-done"><code>DONE</code></a> and set <a href="#dfn-result"><code>result</code></a> to <code>null</code>. Proceed to the error steps below.</p>
  <ol>   
    <li><p><a href="#dispatch-a-progress-event">Dispatch a progress event</a> called
    <a href="#dfn-error-event"><code>error</code></a>.  <em>Set the <a href="#dfn-error"><code>error</code></a> attribute</em>; on getting, the
    <a href="#dfn-error"><code>error</code></a> attribute MUST be a
    a <a href="#dfn-fileerror"><code>FileError</code></a> object with a valid <a href="#dfn-error-codes">error code</a> that indicates the kind of
    <a href="#file-error-read">file error that has occurred</a>.</p></li>
    <li><p><a href="#dispatch-a-progress-event">Dispatch a progress event</a> called
    <a href="#dfn-loadend-event" class="dfnref"><code>loadend</code></a>. </p></li>
    <li><p>Terminate this overall set of steps.</p></li>    
  </ol>
  </li>
  <li><p>If no error has occurred, set <a href="#dfn-readystate" class="dfnref"><code>readyState</code></a> to <a href="#dfn-loading"><code>LOADING</code></a></p></li>
  <li><p><a href="#queue-a-task">Queue a task</a> to <a href="#dispatch-a-progress-event">dispatch a progress event</a> called <a href="#dfn-loadstart-event"><code>loadstart</code></a>.</p></li>
  <li><p><a href="#make-progress-notifications">Make progress notifications</a>.  
  </p></li>
  <li><p>When the File or Blob has been read into memory fully, set <a href="#dfn-readystate"><code>readyState</code></a> to <a href="#dfn-done"><code>DONE</code></a></p></li>
  <li><p>Set the <a href="#dfn-result" class="dfnref"><code>result</code></a> attribute to be <a href="#dfn-file-arg"><code>File or Blob</code></a>'s data content
  represented as a Data URL [<a href="#DataURL">DataURL</a>];
  on getting, the <a href="#dfn-result" class="dfnref"><code>result</code></a> attribute returns the (complete) data of <a href="#dfn-file-arg"><code>File or Blob</code></a> as a
  Data URL [<a href="#DataURL">DataURL</a>]</p></li>
  <li><p>Terminate this overall set of steps.</p></li>
</ol>
</div>
<div id="readAsDataText" class="section">
<h4>5.4.5.5. The <code>readAsText()</code> method</h4>
<p>
When the <dfn id="dfn-readAsText"><code>readAsText(blob, encoding)</code></dfn> method is called (the encoding argument is optional),
the user agent MUST run the steps below (unless otherwise indicated).
</p>
<ol>
  <li><p>Set <a href="#dfn-readystate" class="dfnref"><code>readyState</code></a> to <a href="#dfn-empty" class="dfnref"><code>EMPTY</code></a>
  and set
  <a href="#dfn-result"><code>result</code></a> to <code>null</code>.</p></li>
  <li><p>If an <a href="#file-error-read">error occurs during File or Blob read</a>, 
  set <a href="#dfn-readystate"><code>readyState</code></a> to
  <a href="#dfn-done"><code>DONE</code></a> and set <a href="#dfn-result"><code>result</code></a> to <code>null</code>. Proceed to the error steps below.</p>
  <ol>
    <li><p><a href="#dispatch-a-progress-event">Dispatch a progress event</a> called
    <a href="#dfn-error-event"><code>error</code></a>.  <em>Set the <a href="#dfn-error"><code>error</code></a> attribute</em>; on getting, the
    <a href="#dfn-error"><code>error</code></a> attribute MUST be a
    a <a href="#dfn-fileerror"><code>FileError</code></a> object with a valid <a href="#dfn-error-codes">error code</a> that indicates the kind of
    <a href="#file-error-read">file error that has occurred</a>.</p>
    </li>
    <li><p><a href="#dispatch-a-progress-event">Dispatch a progress event</a> called
    <a href="#dfn-loadend-event" class="dfnref"><code>loadend</code></a>. </p></li>
    <li><p>Terminate this overall set of steps.</p></li>    
  </ol>
  </li>
  <li><p>If no error has occurred, set <a href="#dfn-readystate" class="dfnref"><code>readyState</code></a> to <a href="#dfn-loading"><code>LOADING</code></a></p></li>
  <li><p><a href="#queue-a-task">Queue a task</a> to <a href="#dispatch-a-progress-event">dispatch a progress event</a> called <a href="#dfn-loadstart-event"><code>loadstart</code></a>.</p></li>
  <li><p><a href="#make-progress-notifications">Make progress notifications</a>.  As the bytes from the <a href="#dfn-fileBlob"><code>blob</code></a> argument are read,
  user agents SHOULD ensure that on getting,
  the <a href="#dfn-result"><code>result</code></a> attribute returns <a href="#partial-blob-data">partial Blob data</a> representing the number of bytes currently <code>loaded</code>
  (as a fraction of the <code>total</code>) [<a href="#ProgressEvents">ProgressEvents</a>], decoded into memory according to the <a href="#encoding-determination">encoding determination</a>.
  </p></li>
  <li><p>When the File or Blob has been read into memory fully, set <a href="#dfn-readystate"><code>readyState</code></a> to <a href="#dfn-done"><code>DONE</code></a></p></li>
  <li><p>Set the <a href="#dfn-result" class="dfnref"><code>result</code></a> attribute to be <a href="#dfn-fileBlob"><code>blob</code></a>'s data content
  represented as a string in a format determined by the <a href="#encoding-determination">encoding determination</a>;
  on getting, the <a href="#dfn-result" class="dfnref"><code>result</code></a> attribute returns the (complete) data of <a href="#dfn-fileBlob"><code>blob</code></a>
  as a string, decoded into memory according to the <a href="#encoding-determination">encoding determination</a>.</p></li>
  <li><p>Terminate this overall set of steps.
  </p></li>
</ol>
</div>
  <div id="readAsArrayBuffer" class="section">
<h4>5.4.5.6. The <code>readAsArrayBuffer()</code> method</h4>
<p>
When the <dfn id="dfn-readAsArrayBuffer"><code>readAsArrayBuffer(blob)</code></dfn> method is called, the user agent MUST run the steps below (unless otherwise indicated).
</p>
<ol>
  <li><p>Set <a href="#dfn-readystate" class="dfnref"><code>readyState</code></a> to <a href="#dfn-empty" class="dfnref"><code>EMPTY</code></a>
  and set
  <a href="#dfn-result"><code>result</code></a> to <code>null</code>.</p></li>
  <li><p>If an <a href="#file-error-read">error occurs during File or Blob read</a>, set <a href="#dfn-readystate"><code>readyState</code></a> to
  <a href="#dfn-done"><code>DONE</code></a> and set <a href="#dfn-result"><code>result</code></a> to <code>null</code>. Proceed to the error steps below.</p>
  <ol>
    <li><p><a href="#dispatch-a-progress-event">Dispatch a progress event</a> called
    <a href="#dfn-error-event"><code>error</code></a>.  <em>Set the <a href="#dfn-error"><code>error</code></a> attribute</em>; on getting, the
    <a href="#dfn-error"><code>error</code></a> attribute MUST be a
    a <a href="#dfn-fileerror"><code>FileError</code></a> object with a valid <a href="#dfn-error-codes">error code</a> that indicates the kind of
    <a href="#file-error-read">file error that has occurred</a>.</p>
    </li>
    <li><p><a href="#dispatch-a-progress-event">Dispatch a progress event</a> called
    <a href="#dfn-loadend-event" class="dfnref"><code>loadend</code></a>. </p></li>
    <li><p>Terminate this overall set of steps.</p></li>    
  </ol>
  </li>
  <li><p>If no error has occurred, set <a href="#dfn-readystate" class="dfnref"><code>readyState</code></a> to <a href="#dfn-loading"><code>LOADING</code></a></p></li>
  <li><p><a href="#queue-a-task">Queue a task</a> to <a href="#dispatch-a-progress-event">dispatch a progress event</a> called <a href="#dfn-loadstart-event"><code>loadstart</code></a>.</p></li>
  <li><p><a href="#make-progress-notifications">Make progress notifications</a>.  As the bytes from the <a href="#dfn-fileBlob"><code>blob</code></a> argument are read,
  user agents SHOULD ensure that on getting,
  the <a href="#dfn-result"><code>result</code></a> attribute returns <a href="#partial-blob-data">partial Blob data</a> representing the number of bytes currently <code>loaded</code>
  (as a fraction of the <code>total</code>) [<a href="#ProgressEvents">ProgressEvents</a>], as an <code>ArrayBuffer</code> [<a href="#TypedArrays">TypedArrays</a>]; user agents SHOULD return
  at least one such <code>ArrayBuffer</code> [<a href="#TypedArrays">TypedArrays</a>] while processing this read method.
  </p></li>
  <li><p>When the File or Blob has been read into memory fully, set <a href="#dfn-readystate"><code>readyState</code></a> to <a href="#dfn-done"><code>DONE</code></a></p></li>
  <li><p>Set the <a href="#dfn-result" class="dfnref"><code>result</code></a> attribute to be <a href="#dfn-fileBlob"><code>blob</code></a>'s data content
  represented as an <code>ArrayBuffer</code> [<a href="#TypedArrays">TypedArrays</a>];
  on getting, the <a href="#dfn-result" class="dfnref"><code>result</code></a> attribute returns the (complete) data of <a href="#dfn-fileBlob"><code>blob</code></a>
  as an <code>ArrayBuffer</code> [<a href="#TypedArrays">TypedArrays</a>].</p></li>
  <li><p>Terminate this overall set of steps.</p></li>
</ol>
</div>
<div id="abort" class="section">
<h4>5.4.5.7. The abort() method</h4>
<p>
  When the <dfn id="dfn-abort"><code>abort()</code></dfn> method is called, the user agent MUST run the steps below:</p>
  <ol>
  <li><p>Set <a href="#dfn-readystate"><code>readyState</code></a> to <a href="#dfn-done"><code>DONE</code></a> and <a href="#dfn-result"><code>result</code></a>
  to <code>null</code>.</p></li>
  <li><p>Terminate any steps while processing a <a href="#read-methods">read method</a>.   </p></li>
  <li><p><a href="#dispatch-a-progress-event">Dispatch a progress event</a> called <a href="#dfn-error-event"><code>error</code></a>.  Set the <code>
    error</code> attribute to a <a href="#dfn-fileerror"><code>FileError</code></a> object with the appropriate <code>code</code>(in this case, <code>ABORT_ERR</code>;
    see <a href="#file-error-read">error conditions</a>). </p></li>
  <li><p><a href="#dispatch-a-progress-event">Dispatch a progress event</a> called <a href="#dfn-abort-event"><code>abort</code></a></p></li>
  <li><p><a href="#dispatch-a-progress-event">Dispatch a progress event</a> called <a href="#dfn-loadend-event"><code>loadend</code></a></p></li>
  <li><p>Stop dispatching any further progress events.</p></li>
  </ol>
</div>

<div id="blobAndFileParams" class="section">
<h4>5.4.5.8. Blob Parameters</h4>
<p>Each of the <a href="#read-methods">read methods</a> take mandatory
<a href="#dfn-Blob" class="dfnref"><code>Blob</code></a> parameters.
</p>
<dl>
<dt><dfn id="dfn-fileBlob"></dfn></dt>
<dd><p>This is a <a href="#dfn-Blob"><code>Blob</code></a> object used to invoke all four <a href="#read-methods">read methods</a>.
For the purposes of this specification, it will typically be a reference to a single file in a
<a href="#dfn-filelist"><code>FileList</code></a></p></dd>
</dl>
</div>
<div id="enctype" class="section">
<h4>5.4.5.9. Determining Encoding</h4>
<p>When reading files using the <a href="#dfn-readAsText"><code>readAsText()</code></a> <a href="#read-methods">read method</a>, the optional <dfn id="dfn-encoding"><code>
encoding</code></dfn> string parameter MUST be a <em>name</em> or an <em>alias</em> of a character set
used on the Internet [<a href="#IANACHARSET">IANACHARSET</a>], or else is considered invalid.  If the <code>encoding</code> argument supplied is valid, user agents SHOULD
decode the <a href="#dfn-fileBlob"><code>blob</code></a> using that encoding.  If the <code>encoding</code> argument is invalid,
or the optional <code>encoding</code> argument is not supplied,
or the user agent cannot decode the <a href="#dfn-fileBlob"><code>blob</code></a> using <code>encoding</code>, the following
<dfn id="encoding-determination">encoding determination</dfn> algorithm MUST be
followed:</p>
<ol>
<li>User agents SHOULD decode <a href="#dfn-fileBlob"><code>blob</code></a> data using <a href="#dfn-encoding"><code>encoding</code></a>, if it is provided.
If the <code>encoding</code> <a href="#dfn-encoding">argument is invalid</a>, or the optional <code>encoding</code> argument is not supplied,
or the user agent cannot decode the <a href="#dfn-fileBlob"><code>blob</code></a> using <code>encoding</code>, then let <var>charset</var> be null.</li>
<li>

    <p>For each of the rows in the
     following table, starting with the first one and going down, if the
     first bytes of <a href="#dfn-fileBlob"><code>blob</code></a> match the bytes given in the first
     column, then let <var>charset</var> be the encoding given in the cell in
     the second column of that row. If there is no match <var>charset</var>
     remains null.</p>

    <table>
     <thead>
      <tr>
       <th>Bytes in Hexadecimal

       </th><th>Description

     </th></tr></thead><tbody><!-- UTF-32 is dead
      <tr>
       <td>00 00 FE FF
       <td>UTF-32BE BOM
      <tr>
       <td>FF FE 00 00
       <td>UTF-32LE BOM-->

      <tr>
       <td>FE FF

       </td><td>UTF-16BE BOM

      </td></tr><tr>

       <td>FF FE

       </td><td>UTF-16LE BOM

      </td></tr><tr>
       <td>EF BB BF

       </td><td>UTF-8 BOM<!-- nobody uses this
      <tr>
       <td>DD 73 66 73
       <td>UTF-EBCDIC
-->
        
    </td></tr></tbody></table>

   </li><li>
    <p>If <var>charset</var> is null let <var>charset</var> be UTF-8.

   </p></li><li>

    <p>Return the result of decoding the <a href="#dfn-fileBlob"><code>blob</code></a> using
     <var>charset</var>; on getting, the <a href="#dfn-result"><code>result</code></a> attribute of the <a href="#dfn-blobreader"><code>BlobReader</code></a>
     object returns a string in <var>charset</var> format.  The synchronous
     <a href="#dfn-readAsTextSync"><code>readAsText</code></a> method of the <a href="#dfn-FileReaderSync"><code>FileReaderSync</code></a> object returns a string in <var>charset</var> format.
     Replace bytes or sequences of bytes that are not
     valid according to the <var>charset</var> with a single U+FFFD character [<a href="#Unicode">Unicode</a>].
  </p></li>
</ol>
</div>
<div id="events" class="section">
<h4>5.4.5.10. Events</h4>
<p>When this specification says to <dfn id="make-progress-notifications">make progress notifications </dfn> for a <a href="#read-methods">read method</a>,
the following steps MUST be followed:</p>
<ol>
<li><p>
While the read method is processing, <a href="#queue-a-task">queue a task</a> to
<a href="#dispatch-a-progress-event">dispatch a progress event</a> called <a href="#dfn-progress-event"><code>progress</code></a> about every 50ms <em>or</em> for every byte
read into memory, whichever is least frequent.</p></li>
<li><p>When the data from the <a href="#dfn-file-arg"><code>File or Blob</code></a> 
has been completely read into memory, <a href="#queue-a-task">queue a task</a> to <a href="#dispatch-a-progress-event">dispatch a progress event</a> called
<a href="#dfn-load-event"><code>load</code></a></p></li>
<li><p>When the data from the <a href="#dfn-file-arg"><code>File or Blob</code></a> or <a href="#dfn-fileBlob"><code>blob</code></a>
has been completely read into memory, <a href="#queue-a-task">queue a task</a> to <a href="#dispatch-a-progress-event">dispatch a progress event</a> called
<a href="#dfn-loadend-event"><code>loadend</code></a></p></li>
</ol>
<p>
  When this specification says to <dfn id="dispatch-a-progress-event">dispatch a progress event</dfn> <em>called e</em> (for some
  <code>ProgressEvent</code> <code>e</code> [<a href="#DOM3Events">DOM3Events</a>] dispatched on a <a href="#dfn-blobreader"><code>BlobReader</code></a> <code>reader</code>),
  the following list MUST be followed:</p>
  <ul>
  <li><p>The progress event <code>e</code> does not bubble.  <code>e.bubbles</code> MUST be false [<a href="#DOM3Events">DOM3Events</a>]</p></li>
  <li><p>The progress event <code>e</code> is NOT cancelable. <code>e.cancelable</code> MUST be false [<a href="#DOM3Events">DOM3Events</a>]</p></li>
  <li><p>The progress event <code>e</code> is dispatched on the <a href="#dfn-blobreader" class="dfnref"><code>BlobReader</code></a> object
  (which is the <a href="#task-source">task source</a> in this specification, and the <code>EventTarget</code>).  User agents MUST call
  <code>reader.dispatchEvent(e)</code> [<a href="#DOM3Events">DOM3Events</a>]</p></li>
  </ul>
  <div id="event-summary" class="section">
  <h5>5.4.5.10.1. Event Summary</h5>
  <p>The following are the events that are dispatched on <code><a href="#dfn-blobreader">BlobReader</a></code> objects.</p>
  <table>

   <thead>
    <tr>
     <th>Event name

     </th><th>Interface

     </th><th>Dispatched when…

   </th></tr></thead><tbody>
    <tr>
     <td><dfn id="dfn-loadstart-event"><code>loadstart</code></dfn>

     </td><td><code>ProgressEvent</code>

     </td><td>When the read starts.

    </td></tr><tr>

     <td><dfn id="dfn-progress-event"><code>progress</code></dfn>

     </td><td><code>ProgressEvent</code>

     </td><td>While reading (and decoding) <a href="#dfn-file-arg"><code>File or Blob</code></a>, and reporting <a href="#partial-blob-data">partial Blob data</a> (<code>progess.loaded</code>/<code>progress.total</code>)

    </td></tr><tr>
     <td><dfn id="dfn-abort-event" title="abort-event"><code>abort</code></dfn>

     </td><td><code>ProgressEvent</code>

     </td><td>When the read has been aborted. For instance, by invoking the
      <code><a href="#dfn-abort">abort()</a></code> method.

    </td></tr><tr>
     <td><dfn id="dfn-error-event"><code>error</code></dfn>

     </td><td><code>ProgressEvent</code>

     </td><td>When the read has failed (see <a href="#file-error-read">errors</a>).

    </td></tr><tr>

     <td><dfn id="dfn-load-event"><code>load</code></dfn>

     </td><td><code>ProgressEvent</code>

     </td><td>When the read has successfully completed.

    </td></tr><tr>
     <td><dfn id="dfn-loadend-event"><code>loadend</code></dfn>

     </td><td><code>ProgressEvent</code>

     </td><td>When the request has completed (either in success or failure). 
  </td></tr></tbody></table>

  </div>
</div>
</div>
</div>
<div id="readingOnThreads" class="section">
<h2>5.5. Reading on Threads</h2>
<p>Web Workers allow for the use of synchronous File or Blob read APIs, since the effect of such read mechanisms on the main thread is mitigated.
This section defines a synchronous API, which can be used within Workers [<a href="#Workers">Web Workers</a>].  Workers can avail of both the asynchronous API (the
<code><a href="#dfn-blobreader">BlobReader</a></code>
object) <em>and</em> the synchronous API (the <code><a href="#dfn-FileReaderSync">FileReaderSync</a></code> object).</p>
<div id="FileReaderSync" class="section">
<h3>5.5.1. The <code>BlobReaderSync</code> Interface</h3>
<p>This interface  provides methods to read files or Blobs into memory, and to access the data of these files or Blobs.</p>
<div class="block"><div class="blockTitleDiv"><span class="blockTitle">IDL</span></div><div class="blockContent"><pre class="code"><code class="idl-code">

[Constructor]
interface <dfn id="dfn-BlobReaderSync">BlobReaderSync</dfn> {

  <span class="comment">// Synchronously return strings</span>
  <span class="comment">// All three methods raise FileException</span>
  
  ArrayBuffer <a href="#dfn-readAsArrayBufferSync">readAsArrayBuffer</a>(in <a href="#dfn-Blob">Blob</a> <a href="#dfn-fileBlob">blob</a>);
  DOMString <a href="#dfn-readAsBinaryStringSync">readAsBinaryString</a>(in <a href="#dfn-Blob">Blob</a> <a href="#dfn-fileBlob">blob</a>); 
  DOMString <a href="#dfn-readAsTextSync">readAsText</a>(in <a href="#dfn-Blob">Blob</a> <a href="#dfn-fileBlob">blob</a>, [Optional] in DOMString <a href="#dfn-encoding">encoding</a>);                                                       
  DOMString <a href="#dfn-readAsDataURLSync">readAsDataURL</a>(in <a href="#dfn-Blob">Blob</a> <a href="#dfn-fileBlob">blob</a>); 
};
</code></pre></div></div>
<div class="note"><div class="noteHeader">Note</div>
  <p>The <a href="#dfn-BlobReaderSync"><code>BlobReaderSync</code></a> object's <dfn id="read-method-sync">read methods</dfn> -- namely 
  <code><a href="#dfn-readAsBinaryStringSync">readAsBinaryString</a></code>, <code><a href="#dfn-readAsTextSync">readAsText</a></code>, 
  <code><a href="#dfn-readAsDataURLSync">readAsDataURL</a></code> and <code><a href="#dfn-readAsArrayBufferSync">readAsArrayBuffer</a></code> -- have the same <em>method signatures</em> as the <a href="#read-methods">read methods</a> of the
  <a href="#dfn-blobreader"><code>BlobReader</code></a> object, and <em>read files into memory</em>.  The difference is that these are specified to behave <em>synchronously</em>, with string return values.
  These methods raise <a href="#dfn-FileException"><code>FileException</code></a>.</p>
</div>

<div id="readAsBinaryStringSyncSection" class="section">
<h3>5.5.1.1. The <code>readAsBinaryString</code> method</h3>
<p>When the <dfn id="dfn-readAsBinaryStringSync"><code>readAsBinaryString(blob)</code></dfn> method is called, the following steps MUST be followed:</p>
<ol>
<li><p>If an <a href="#file-error-read">error occurs during File or Blob read</a>, throw a
<a href="#dfn-FileException"><code>FileException</code></a> with the <a href="#dfn-error-codes">appropriate error code</a>. Terminate these overall steps.</p></li>
<li><p>If no error has occurred, read <a href="#dfn-fileBlob"><code>blob</code></a> into memory.  Return the data contents of
<a href="#dfn-fileBlob"><code>blob</code></a> as a <a href="#binary-string">binary string</a>.</p></li>
</ol>
</div>
<div id="readAsTextSync" class="section">
<h3>5.5.1.2. The <code>readAsText</code> method</h3>
<p>When the <dfn id="dfn-readAsTextSync"><code>readAsText(blob, encoding)</code></dfn> method is called (the
<a href="#dfn-encoding"><code>encoding</code></a> argument is optional), the following steps MUST be followed:</p>
<ol>
<li><p>If an <a href="#file-error-read">error occurs during File or Blob read</a>, throw a
<a href="#dfn-FileException"><code>FileException</code></a> with the <a href="#dfn-error-codes">appropriate error code</a>. Terminate these overall steps.</p></li>
<li><p>If no error has occurred, read <a href="#dfn-fileBlob"><code>blob</code></a> into memory.  Return the data contents of <a href="#dfn-fileBlob"><code>blob</code></a>
using the <a href="#encoding-determination">encoding determination</a> algorithm.</p></li>
</ol>
</div>
<div id="readAsDataURLSync-section" class="section">
<h3>5.5.1.3. The <code>readAsDataURL</code> method</h3>
<p>
  When the <dfn id="dfn-readAsDataURLSync"><code>readAsDataURL(blob)</code></dfn> method is called, the following steps MUST be followed:</p>
<ol>
<li><p>If an <a href="#file-error-read">error occurs during file read</a>, throw a
<a href="#dfn-FileException"><code>FileException</code></a> with the <a href="#dfn-error-codes">appropriate error code</a>. Terminate these overall steps.</p></li>
<li><p>If no error has occurred, read <a href="#dfn-fileBlob"><code>blob</code></a> into memory. Return the data contents of <a href="#dfn-fileBlob"><code>blob</code></a>
as a Data URL [<a href="#DataURL">DataURL</a>]</p>
<div class="note"><div class="noteHeader">Note</div><p>URL length limitiations for Data URLs limit the usefulness of this call.  A user agent may throw an <a href="#dfn-ENCODING_ERR"><code>ENCODING_ERR</code></a>
for <a href="#dfn-file-arg"><code>File or Blob</code></a>
arguments which, when encoded as Data URLs, exceed URL length limitations for that user agent.[<a href="#DataURL">DataURL</a>] </p></div>
</li>
</ol> 
</div>
<div id="readAsArrayBufferSyncSection" class="section">
<h3>5.5.1.4. The <code>readAsArrayBuffer</code> method</h3>
<p>When the <dfn id="dfn-readAsArrayBufferSync"><code>readAsArrayBuffer(blob)</code></dfn> method is called, the following steps MUST be followed:</p>
<ol>
<li><p>If an <a href="#file-error-read">error occurs during File or Blob read</a>, throw a
<a href="#dfn-FileException"><code>FileException</code></a> with the <a href="#dfn-error-codes">appropriate error code</a>. Terminate these overall steps.</p></li>
<li><p>If no error has occurred, read <a href="#dfn-fileBlob"><code>blob</code></a> into memory.  Return the data contents of
<a href="#dfn-fileBlob"><code>blob</code></a> as an <code>ArrayBuffer</code> [<a href="#TypedArrays">TypedArrays</a>] </p></li>
</ol>
</div>
</div>
<div class="ednote"><div class="ednoteHeader">Editorial note</div><p>TODO: Land sample code here</p></div>  
</div>
<div id="ErrorAndException" class="section">
  <h2>5.6. Errors and Exceptions</h2>
  <p>
    <dfn id="file-error-read">Error conditions</dfn> can occur when reading files from the underlying filesystem.  The list below of potential error conditions is <em>informative</em>,
    with links to <em>normative</em> descriptions of error codes:</p>
    <ul>
    <li><p>The File or Blob being accessed may not exist at the time one of the asynchronous <a href="#read-methods">read methods</a> or synchronous
    <a href="#read-method-sync">read methods</a>
    are called. This may be due to it having been moved or deleted after a reference to it was acquired (e.g. concurrent modification with another application).  See
<a href="#dfn-NOT_FOUND_ERR"><code>NOT_FOUND_ERR</code></a></p></li>
    <li><p>A File or Blob may be unreadable.  This may be due to permission problems that occur after a reference to a File or Blob has been acquired
    (e.g. concurrent lock with another application). See <a href="#dfn-NOT_READABLE_ERR"><code>NOT_READABLE_ERR</code></a></p></li>
    <li><p>User agents MAY determine that some files are unsafe for use within Web applications.  A file may change on disk since the original file selection,
    thus resulting in an invalid read.  Additionally, some file and directory structures may be considered restricted
by the underlying filesystem; attempts to read from them may be considered a security violation.  See the <a href="#security-discussion">security considerations</a>.
See <a href="#dfn-SECURITY_ERR"><code>SECURITY_ERR</code></a></p></li>
    <li><p>Files may be too large to return to the data structures of a Web application.  An example might be that URL length limitations imposed by user agents on Data URLs may
make obtaining large files encoded as Data URLs impossible to return [<a href="#DataURL">DataURL</a>].  See <a href="#dfn-ENCODING_ERR"><code>ENCODING_ERR</code></a></p></li>
<li><p>During the reading of a File or Blob, the Web application may itself wish to abort (see <a href="#dfn-abort"><code>abort()</code></a>) the call to an asynchronous read method. See
<a href="#dfn-ABORT_ERR"><code>ABORT_ERR</code></a>
</p></li>
    
    </ul>
<div id="FileErrorInterface" class="section">
<h3>5.6.1. The <code>FileError</code> Interface</h3>
<p>
  This interface is used to report errors asynchronously.  The <a href="#dfn-blobreader"><code>BlobReader</code></a> object's <dfn id="dfn-error">error</dfn> attribute is a
  <a href="#dfn-fileerror"><code>FileError</code></a> object, and is accessed asynchronously through the <a href="#dfn-onerror"><code>onerror</code></a> event handler when
  <a href="#dfn-error-event">error events</a> are generated.
</p>
<div class="block"><div class="blockTitleDiv"><span class="blockTitle">IDL</span></div><div class="blockContent"><pre class="code"><code class="idl-code">
 interface <dfn id="dfn-fileerror">FileError</dfn> {
   <span class="comment">// File error codes</span>
   <span class="comment">// Found in DOMException</span>
   const unsigned short <a href="#dfn-NOT_FOUND_ERR">NOT_FOUND_ERR</a> = 8;
   const unsigned short <a href="#dfn-SECURITY_ERR">SECURITY_ERR</a> = 18;
   const unsigned short <a href="#dfn-ABORT_ERR">ABORT_ERR</a> = 20;
   
   <span class="comment">// Added by this specification</span>
   const unsigned short <a href="#dfn-NOT_READABLE_ERR">NOT_READABLE_ERR</a> = 24;
   const unsigned short <a href="#dfn-ENCODING_ERR">ENCODING_ERR</a> = 26;
 
   readonly attribute unsigned short <a href="#dfn-code">code</a>;
};
</code></pre></div></div>
<p>The <dfn id="dfn-code"><code>code</code></dfn> attribute MUST return one of the constants of the <a href="#dfn-fileerror"><code>FileError</code></a> error, which MUST be
the most appropriate code from the table below.</p>
</div> 
<div id="FileException" class="section">
<h3>5.6.2. The <code>FileException</code> exception</h3>
<p>
Errors in the synchronous <a href="#read-method-sync">read methods</a> for Web Workers [<a href="#Workers">WebWorkers</a>] are reported using the
<a href="#dfn-FileException"><code>FileException</code></a> exception.
</p>
<div class="block"><div class="blockTitleDiv"><span class="blockTitle">IDL</span></div><div class="blockContent"><pre class="code"><code class="idl-code">
 exception <dfn id="dfn-FileException">FileException</dfn> {
  
  const unsigned short <a href="#dfn-NOT_FOUND_ERR">NOT_FOUND_ERR</a> = 8;
  const unsigned short <a href="#dfn-SECURITY_ERR">SECURITY_ERR</a> = 18;
  const unsigned short <a href="#dfn-ABORT_ERR">ABORT_ERR</a> = 20;
  
  const unsigned short <a href="#dfn-NOT_READABLE_ERR">NOT_READABLE_ERR</a> = 24;
  const unsigned short <a href="#dfn-ENCODING_ERR">ENCODING_ERR</a> = 26;
 
  unsigned short <a href="#dfn-code-exception">code</a>;
};
</code></pre></div></div>
<p>The <dfn id="dfn-code-exception"><code>code</code></dfn> attribute MUST return one of the constants of the <a href="#dfn-FileException"><code>FileException</code></a>
exception, which MUST be
the most appropriate code from the table below.</p>
</div>
<div id="ErrorDescriptions" class="section">
<h3>5.6.3. Error Code Descriptions</h3>
  <table><thead><tr><th>Constant
     </th><th><dfn id="dfn-error-codes">Code</dfn>
     </th><th>Situation
   </th></tr></thead><tbody><tr><td><dfn id="dfn-NOT_FOUND_ERR" title="dfn-NOT_FOUND_ERR"><code>NOT_FOUND_ERR</code></dfn>
     </td><td><dfn id="dfn-fileerror-code-8" title="dfn-fileerror-code-8">8</dfn>
     </td><td>User agents MUST use this code if the File or Blob resource could not be found at the time the read was processed

    </td></tr><tr><td><dfn id="dfn-SECURITY_ERR" title="dfn-SECURITY_ERR"><code>SECURITY_ERR</code></dfn>
     </td><td><dfn id="dfn-filerror-code-18" title="dfn-filerror-code-18">18</dfn>
     </td><td>User agents MAY use this code if: <ul>
     <li>it is determined that certain files are unsafe for access within a Web application</li>
     <li>it is determined that too many read calls are being made on File or Blob resources </li>
     <li>it is determined that the file has changed on disk since the user selected it</li>
     </ul>
     <p>This is a security error code to be used in situations not covered by any other error codes.</p>

    </td></tr><tr><td><dfn id="dfn-ABORT_ERR" title="dfn-ABORT_ERR"><code>ABORT_ERR</code></dfn>

     </td><td><dfn id="dfn-fileerror-code-20" title="dfn-fileerror-code-20">20</dfn>
     </td><td>User agents MUST use this code if the read operation was aborted, typically with a call to <a href="#dfn-abort"><code>abort()</code></a>
            
    </td></tr><tr><td><dfn id="dfn-NOT_READABLE_ERR" title="dfn-NOT_READABLE_ERR"><code>NOT_READABLE_ERR</code></dfn>
     </td><td><dfn id="dfn-fileerror-code-24" title="dfn-fileerror-code-24">24</dfn>
     </td><td>User agents MUST use this code if the File or Blob cannot be read, typically due due to permission problems that occur after a
     reference to a File or Blob has been acquired (e.g. concurrent lock with another application).
     
     
    </td></tr><tr><td><dfn id="dfn-ENCODING_ERR" title="dfn-ENCODING_ERR"><code>ENCODING_ERR</code></dfn>
     </td><td><dfn id="dfn-filerror-code-26" title="dfn-fileerror-code-26">26</dfn>

     </td><td>User agents MAY use this code if URL length limitations for Data URLs in their implementations place limits on the File or Blob data that can be
     represented as a Data URL [<a href="#DataURL">DataURL</a>].  User agents MUST NOT use this code for the asynchronous <a href="#dfn-readAsText"><code>readAsText()</code></a> call
     and MUST NOT use this code for the synchronous <a href="#dfn-readAsTextSync"><code>readAsText()</code></a> call, since encoding is determined by the
     <a href="#encoding-determination">encoding determination</a> algorithm.

    </td></tr></tbody></table>
</div>
  </div>
<div id="url" class="section">
<h2>5.7. A URL for Blob and File reference</h2>
<p>This section defines a scheme for a unique URL used to refer to Blob objects (Files or Blobs).  Whereas the file URI scheme (defined in [<a href="#RFC1630">RFC1630</a>] and
[<a href="#RFC1738">RFC1738</a>]) allows user agents to surface local file and directory structures, it cannot be used within web applications owing to origin considerations.
The introduction of a scheme to be used with individual File or Blob objects is useful for a number of reasons. The following
list is informative:
<ul>
<li><p>This scheme can be used with web APIs such as <code>XMLHttpRequest</code> [<a href="XHR2">XHR2</a>], and with elements that are designed to be used with URLs, such as the
<code>img</code> element [<a href="#HTML5">HTML5</a>].  In general, this scheme is designed to be used wherever URLs can be used on the web.  This would allow File or Blob data to be
used within web applications and accessed by URLs.</p></li>
<li><p>This scheme can be associated with a well-defined subset of HTTP response codes, so that web applications can benefit from use alongside HTTP URLs. [<a href="#HTTP">HTTP</a>].  This differs from
file URIs, which do not have an affiliated request-response behavior with status codes.  Some user agents silently fail if file URIs are requested insecurely.</p></li>
<li><p>This scheme can allow for fragment identifiers for well-defined format types.  For example, if the file selected is an SVG file, this scheme should allow for SVG fragment identifiers.  If
the file selected is an HTML file, this scheme should allow for fragment identifiers within an HTML document.</p></li>
<li><p>Whereas file URIs are subject to strict same-origin restrictions for security reasons and allow directory browsing, this scheme is applicable only to user-selected files
(and to Blob objects that web applications generate).  Along with an origin policy and a lifetime stipulation, this scheme can allow safe access to binary data from web applications.</p></li>
</ul>
</p>
<div id="ABNFForBlob" class="section">
<h3>5.7.1. Definition of blob URL Scheme</h3>
<p>This section defines a <code>blob:</code> URL scheme using a formal grammar.  A <code>blob:</code> URL consists of the blob: scheme and an opaque string, along with zero or one fragment identifiers.
In this specification an <dfn id="opaqueString">opaque string</dfn> is a unique string which can be heuristically generated upon demand such that the probability that two are alike is small, and which is hard to guess (e.g.
the Universally Unique IDentifier (UUID) as defined in [<a href="#UUID">RFC4122</a>] is an opaque string). A <dfn id="fragmentIdentifier">fragment identifier</dfn> is optional, and if used,
has a distinct interpretation depending on the media type of the Blob or File resource in question [<a href="#RFC2046">RFC2046</a>].</p>
<p>This section uses the Augmented Backus-Naur Form (ABNF), defined in [<a href="#ABNF">RFC2234</a>]. All <a href="#ABNFForBlob">blob:</a> URLs MUST follow this ABNF.
</p>


<div class="block"><div class="blockTitleDiv"><span class="blockTitle">ABNF</span></div><div class="blockContent"><pre class="code"><code class="abnf-code">
blob = scheme ":" opaqueString [fragIdentifier]

scheme = "blob"

; scheme is always "blob"

; opaqueString MAY be a UUID in its canonical form
; UUID is defined in [<a href="#UUID">RFC4122</a>]
; User agents MAY choose any other values for opaqueString
; opaqueString tokens MUST be unique

fragIdentifier = "#" fragment

; fragment is defined in [<a href="#RFC3986">RFC3986</a>]

fragment    = *( pchar / "/" / "?" )


</code></pre></div></div>
<p>User agents MAY use a UUID with <a href="#ABNFForBlob">blob:</a> URIs as <a href="#opaqueStrings">opaque strings</a>.  UUIDs are defined in [<a href="#UUID">RFC4122</a>] and are used here without the urn: scheme.
Below is an ABNF [<a href="#ABNF">RFC2234</a>] for UUID.
</p>
<div class="block"><div class="blockTitleDiv"><span class="blockTitle">ABNF</span></div><div class="blockContent"><pre class="code"><code class="abnf-code">
UUID                   = time-low "-" time-mid "-"
                         time-high-and-version "-"
                         clock-seq-and-reserved
                         clock-seq-low "-" node
time-low               = 4hexOctet
time-mid               = 2hexOctet
time-high-and-version  = 2hexOctet
clock-seq-and-reserved = hexOctet
clock-seq-low          = hexOctet
node                   = 6hexOctet
hexOctet               = hexDigit hexDigit
hexDigit =
         "0" / "1" / "2" / "3" / "4" / "5" / "6" / "7" / "8" / "9" /
         "a" / "b" / "c" / "d" / "e" / "f" /
         "A" / "B" / "C" / "D" / "E" / "F"

</code></pre></div></div>
<p>A valid blob: URL could look like: <code>blob:550e8400-e29b-41d4-a716-446655440000#aboutABBA</code></p>
</div>
<div id="originOfBlob" class="section">
<h3>5.7.2. Origin of Blob URLs</h3>
<p><dfn id="spawnBlob">Spawning a Blob object</dfn> is defined as obtaining a reference to a <a href="#dfn-File"><code>File</code></a> object or a <a href="#dfn-Blob"><code>Blob</code></a>
object within script.  This can be done by obtaining a reference to user-selected files
with the DOM or to a Blob object created programmatically. </p>
<p>The origin of <a href="#ABNFForBlob">blob:</a> URLs MUST be the  origin of the script that <a href="#spawnBlob">spawned the Blob</a> object on which the
<a href="#dfn-url"><code>url</code></a> attribute was called [<a href="#HTML5">HTML5</a>].
<a href="#ABNFForBlob">blob:</a> URLs MUST only be valid within this origin; multiple accesses of the <a href="#dfn-url"><code>url</code></a> property of a <a href="#dfn-Blob">Blob</a> object within the same origin yield the same blob: URL. Retrieving them from within any other origin results in a
<strong>403 Not Allowed</strong> with an additional affiliated message that implementations MAY use (e.g. "Origin Violation"). [<a href="#processingModel">Processing Model for blob:URLs</a>]</p>
</div>

<div id="lifeTime" class="section">
<h3>5.7.3. Lifetime of Blob URLs</h3>
<p>Implementations MUST ensure that the lifetime of <a href="#ABNFForBlob">blob:</a> URLs is the same as the lifetime of the
<code>Document</code>[<a href="#HTML5">HTML5</a>] of the origin script which <a href="#spawnBlob">spawned the Blob object</a> on which the <a href="#dfn-url"><code>url</code></a>
attribute was called.  When this <code>Document</code> is destroyed, implementations MUST treat requests for <a href="#ABNFForBlob">blob:</a> URLs created within this
<code>Document</code> as <strong>404 Not Found</strong>.[<a href="#processingModel">Processing Model for blob: URLs</a>]</p>
</div>
<div id="processingModel" class="section">
<h3>5.7.4. Processing Model for Blob URLs</h3>
<p>User agents MUST only support requests with GET [<a href="#HTTP">HTTP</a>] and MUST only support a subset of responses that are equivalent to the following from HTTP [<a href="#HTTP">HTTP</a>]:</p>

<div id="TwoHundredOK" class="section">
<h4>5.7.4.1. 200 OK</h4>
<p>This response [<a href="#HTTP">HTTP</a>] MUST be used if the request has succeeded, namely the <a href="#ABNFForBlob">blob:</a> URL has been requested with a GET,
satisfies the <a href="#originOfBlob">origin requirement</a>, and satisfies the <a href="#lifetime">lifetime requirement.</a>  If this response code is used, the user agent MUST also use
a Content-Type header [<a href="#HTTP">HTTP</a>] with a value equal to the <code><a href="#dfn-Blob">Blob</a></code> object's <code><a href="#dfn-type">type</a></code> attribute.
</p>
</div>
<div id="FourOhThreeNotAllowed" class="section">
<h4>5.7.4.2. 403 Not Allowed</h4>
<p>This response [<a href="#HTTP">HTTP</a>] MUST be used if the request violates the <a href="#origin">origin requirement</a>.  Additionally, it MUST be used if the underlying file's permission structure has changed (thus preventing access from web content).  Implementations MAY accompany this response with a message (e.g. "Origin Violation").</p>
</div>
<div id="FourOhFourNotFound" class="section">
<h4>5.7.4.3. 404 Not Found</h4>
<p>This response [<a href="#HTTP">HTTP</a>] MUST be used if the request violates the <a href="#lifeTime">lifetime</a> requirement (e.g. if a cached <a href="#ABNFForBlob">blob:</a>
URL persists after the specified lifetime of the URL has elapsed). Additionally, it MUST be used if the underlying file has moved.</p>
</div>
<div id="FiveHundredInternalServerError" class="section">
<h4>5.7.4.4. 500 Internal Server Error</h4>
<p>
  This response [<a href="#HTTP">HTTP</a>] MAY be used as a generic error condition, including for security errors or access violations (e.g if the request method is anything other than GET
  [<a href="#HTTP">HTTP</a>].  Implementations MAY accompany this response with a message (e.g. "Data Access Error"). 
</p>
</div>
</div>
</div>
<div id="security-discussion" class="section">
<h2>5.8. Security Considerations</h2>
<p>
  This section is <em>informative.</em>
</p>
<p>
  This specification allows web content to read files from the underlying file system, as well as provides a means for files to be accessed by unique identifiers,
  and as such is subject to some security considerations.  This specification also assumes that the
  primary user interaction is with the <code>&lt;input type="file"/&gt;</code> element of HTML forms [<a href="#HTML5">HTML5</a>], and that all files that are being read by
  <a href="#dfn-blobreader"><code>BlobReader</code></a> objects have first been selected by the user.  Important security considerations include preventing malicious file
  selection attacks (selection looping), preventing access to system-sensitive files, and guarding against modifications of files on disk after a selection has taken place.
</p>
<ul><li><p><dfn id="selection-looping">Preventing selection looping.</dfn>  During file selection, a user may be bombarded with the file picker associated with <code>&lt;input
type="file"/&gt;</code> (in a "must choose" loop that forces selection before the file picker is dismissed) and a user agent may prevent file
access to any selections by making the  <a href="#dfn-filelist"><code>FileList</code></a> object returned be of size 0.</p></li>
<li><p><dfn id="sensitive-files">System-sensitive files</dfn> (e.g. files in /usr/bin, password files, other native operating system executables) typically should not
be exposed to web content, and should not be accessed via <a href="#dfn-url">URNs</a>.  User agents MAY raise a <a href="#dfn-SECURITY_ERR"><code>SECURITY_ERR</code></a>
if such files are accessed or a <a href="#read-methods">read method</a>
is called on them.</p></li>
<li><p><dfn id="post-selection-file-mods">Post-selection file modifications</dfn> occur when a file changes on disk after it has been selected.  In such cases, if a
<a href="#read-methods">read method</a> is called on a file, user agents MAY raise a <code><a href="#dfn-SECURITY_ERR"><code>SECURITY_ERR</code></a></code>.</p></li>
</ul>
<div class="ednote"><div class="ednoteHeader">Editorial note</div><p>This section is provisional; more security data may supplement this in subsequent drafts.</p></div>
</div>
  <div id="requirements" class="section">
    <h2>5.9. Requirements and Use Cases</h2>
      <p>This section covers what the requirements are for this API, as well as illustrates some use cases.  This version of the API does not satisfy all use cases;
	   subsequent versions may elect to address these.</p>  
	  <ul>
	    <li><p>Once a user has given permission, user agents should provide the ability to read and parse data directly from a local file programmatically.</p>
		  <ul>
		    <li> Example: A lyrics viewer. User wants to read song lyrics from songs in his plist file.  User browses for plist file.  File is opened, 
			 read, parsed, and presented to the user as a sortable, actionable list within a web application.  User can select songs to fetch lyrics.  User uses the 
			 "browse for file" dialog.</li>		
		  </ul>		  		  
	    </li>
	    <li><p>Data should be able to be stored locally so that it is available for later use, which is useful for offline data access for web applications.</p>
		  <ul>
		    <li>Example: A Calendar App.  User's company has a calendar. User wants to sync local events to company calendar, marked
                        as "busy" slots (without leaking personal info).  User browses for file and selects it. The text/calendar file is parsed
                        in the browser, allowing the user to merge the files to one calendar view.
                        The user wants to then save the file back to his local calendar file. (using "Save As" ?).  The user can also send the
			integrated calendar file back to the server calendar store asynchronously.</li>
	          </ul>
		  
	    </li>
	    <li><p>User agents should provide the ability to save a local file programmatically given an amount of data and a file name.</p>
		  <ul>
		    <li>Example: A Spreadsheet App.  User interacts with a form, and generates some input.  The form then generates a
		        CSV (Comma Separated Variables) output for the user to import into a spreadsheet, and uses "Save...".  The generated
			output can also be directly integrated into a web-based spreadsheet, and
			uploaded asynchronously.</li>  
		  </ul>
	    </li>
	    <li><p>User agents should provide a streamlined programmatic ability to send data from a file to a remote server that works more
	           efficiently than form-based uploads today</p>
		  <ul>
		    <li>Example: A Video/Photo Upload App. User is able to select large files for upload, which can then be "chunk-transfered" to the server.</li>
		  </ul>  
	    </li>
	    <li><p>User agents should provide an API exposed to script that exposes the features above.  The user is notified by UI anytime interaction with the file
		   system takes place, giving the user full ability to cancel or abort the transaction.  The user is notified of any file selections, and can cancel these.
		   No invocations to these APIs occur silently without user intervention. </p>
	    </li>
		  
	  </ul>
  </div>
   <div id="acknowledgements-section" class="section">
    <h2>5.10. Acknowledgements</h2>
    
    <p>
      This specification was originally developed by the SVG Working Group. Many thanks to Mark Baker and Anne van Kesteren for their feedback.</p>
    <p>Thanks to Robin Berjon for editing the original specification.</p>
    <p>Special thanks to Jonas Sicking, Olli Pettay, Nikunj Mehta, Garrett Smith, Michael Nordman, Ian Hickson, Sam Weinig, Aaron Boodman, Julian Reschke</p>
    <p>Thanks to the W3C WebApps WG, and to participants on the public-webapps@w3.org listserv</p>
  </div>
  <div id="references" class="section">
    <h2>5.11. References</h2>
<div class="ednote"><div class="ednoteHeader">Editorial note</div><p>ToDo: Add author names</p></div>
      <div id="normative-references" class="section">
        <h3>5.11.1. Normative references</h3>
	<dl class="bibliography">
	<dt id="RFC2119">RFC2119</dt>
	<dd><cite><a href="http://www.ietf.org/rfc/rfc2119.txt">Key words for use in RFCs to Indicate Requirement Levels</a></cite></dd>
	<dt id="XHR2">XMLHttpRequest</dt>
	<dd><cite><a href="http://www.w3.org/TR/XMLHttpRequest2/">XMLHttpRequest Level 2</a></cite></dd>
	<dt id="HTML5">HTML5</dt>
	<dd><cite><a href="http://dev.w3.org/html5/spec/Overview.html">HTML 5: A vocabulary and associated APIs for HTML and XHTML</a></cite></dd>
        <dt id="ProgressEvents">ProgressEvents 1.0</dt>
        <dd><cite><a href="http://www.w3.org/TR/progress-events">Progress Events 1.0</a></cite></dd>
	<dt id="DataURL">RFC2397</dt>
	<dd><cite><a href="http://www.ietf.org/rfc/rfc2397.txt">The "data" URL Scheme</a></cite></dd>
	<dt id="Workers">Web Workers</dt>
	<dd><cite><a href="http://dev.w3.org/html5/workers/">Web Workers</a></cite></dd>
	<dt id="DOM3Core">DOM 3 Core</dt>
	<dd><cite><a href="http://www.w3.org/TR/DOM-Level-3-Core/core.html">DOM 3 Core</a></cite></dd>
        <dt id="DOM3Events">DOM 3 Events</dt>
        <dd><cite><a href="http://www.w3.org/TR/DOM-Level-3-Events/">DOM 3 Events</a></cite></dd>
	<dt id="DOMException">DOMException Extensions Defined in HTML5</dt>
	<dd><cite><a href="http://dev.w3.org/html5/spec/Overview.html#exceptions">DOM 3 Core DOMException Extensions Defined in HTML5</a></cite></dd>
	<dt id="Unicode">Unicode</dt>
	<dd><cite><a href="http://www.unicode.org/versions/Unicode5.2.0/">The Unicode Standard, Version 5.2.0.</a></cite></dd>  
	<dt id="UUID">RFC4122</dt>
        <dd><cite><a href="http://www.ietf.org/rfc/rfc4122.txt">A Universally Unique IDentifier (UUID) URN Namespace</a></cite></dd>
	<dt id="HTTP">RFC2616</dt>
	<dd><cite><a href="http://www.w3.org/Protocols/rfc2616/rfc2616.html">Hypertext Transfer Protocol -- HTTP/1.1</a></cite></dd>
	<dt id="RFC2046">RFC2046</dt>
	<dd><cite><a href="http://www.ietf.org/rfc/rfc2046.txt">Multipurpose Internet Mail Extensions (MIME) Part Two: Media Extensions</a></cite></dd>
	<dt id="RFC3986">RFC3986</dt>
	<dd><cite><a href="http://www.ietf.org/rfc/rfc3986.txt">Uniform Resource Identifier (URI): Generic Syntax</a></cite></dd>
	<dt id="RFC1738">RFC1738</dt>
	<dd><cite><a href="http://tools.ietf.org/html/rfc1738">Uniform Resource Locators (URL)</a></cite></dd>
        <dt id="RFC1630">RFC1630</dt>
        <dd><cite><a href="http://www.ietf.org/rfc/rfc1630.txt">Universal Resource Identifiers in WWW</a></cite></dd>
        <dt id="TypedArrays">Typed Arrays</dt>
        <dd><cite><a href="https://cvs.khronos.org/svn/repos/registry/trunk/public/webgl/doc/spec/TypedArray-spec.html">Typed Arrays</a></cite></dd>
        <dt id="ABNF">RFC2234</dt>
        <dd><cite><a href="http://www.ietf.org/rfc/rfc2234.txt">Augmented BNF for Syntax Specifications: ABNF</a></cite></dd>
        <dt id="UUID">RFC4122</dt>
        <dd><cite><a href="http://www.ietf.org/rfc/rfc4122.txt">A Universally Unique IDentifier (UUID) URN Namespace</a></cite></dd>


	</dl>
      </div>
    <div id="informative-references" class="section">
    <h3>5.11.2. Informative References</h3>
    <dl>
    <dt id="IANACHARSET">IANA Charsets</dt>
    <dd><cite><a href="http://www.iana.org/assignments/character-sets">Official Names for Character Sets on the Internet</a></cite></dd>
    <dt id="FileUpload">File Upload State of the input element</dt>
    <dd><cite><a href="http://dev.w3.org/html5/spec/Overview.html#file-upload-state">File Upload State of the HTML5 <code>input</code> Element</a></cite></dd>
    <dt id="ABNF">RFC5234</dt>
    <dd><cite><a href="http://www.ietf.org/rfc/rfc5234.txt">Augmented BNF for Syntax Specifications: ABNF</a></cite></dd>
    <dt id="RFC4648">RFC4648</dt>
    <dd><cite><a href="http://tools.ietf.org/html/rfc4648">The Base16, Base32, and Base64 Data Encodings</a></cite></dd>
    <dt id="Blob-REF">Google Gears Blob API</dt>
    <dd><cite><a href="http://code.google.com/apis/gears/api_blob.html">Google Gears Blob API</a></cite></dd>
    </dl>
    </div>
    </div>
   
    </div>
    </div>
  </body>
</html>
