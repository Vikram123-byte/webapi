<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
  <title>The progress event</title>
  <style type="text/css">
<![CDATA[

.example {border:  2px double Grey; padding-left: 2em}
.issue {background-color: #ffffbf; border:  2px dashed Red;}
]]>



  </style>
  <link rel="stylesheet" type="text/css" media="screen"
  href="http://www.w3.org/Stylesheets/TR/Base.css" />
</head>

<body>

<div class="head">
<a href="http://www.w3.org/"><img src="http://www.w3.org/Icons/w3c_home"
alt="W3C" height="48" width="72" /> </a> 

<h1 id="title">The ProgressEvent events</h1>

<h2>Editor's Draft 12 December 2006</h2>
<dl>
  <dt>This version:</dt>
    <dd><a
      href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.5">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.5</a></dd>
  <dt>Latest Editor's draft:</dt>
    <dd><a
      href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html</a></dd>
  <dt>Previous Editor's draft:</dt>
    <dd><a
      href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.4">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.4</a></dd>
  <dt>Editor:</dt>
    <dd><a href="mailto:chaals@opera.com">Charles McCathieNevile</a>, <a
      href="http://www.opera.com/">Opera Software</a></dd>
</dl>

<p class="copyright"><a
href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
© 2006-2007 <a href="http://www.w3.org/"><acronym
title="World Wide Web Consortium">W3C</acronym></a><sup>®</sup> (<a
href="http://www.csail.mit.edu/"><acronym
title="Massachusetts Institute of Technology">MIT</acronym></a>, <a
href="http://www.ercim.org/"><acronym
title="European Research Consortium for Informatics and Mathematics">ERCIM</acronym></a>,
<a href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. W3C <a
href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
<a
href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>
and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document
use</a> rules apply.</p>
<hr />
</div>

<div>
<h2 class="notoc"><a id="abstract" name="abstract">Abstract</a></h2>

<p>This document describes event types that can be used for monitoring the
progress of an operation. It is primarily intended for network operations
such as XMLHTTPRequest [<a href="#XHR">XHR</a>], but should be usable in
other relevant contexts.</p>
</div>
<hr />

<div>
<h2 id="Status">Status of this Document</h2>

<p><em>This section describes the status of this document at the time of its
publication. Other documents may supersede this document. A list of current
W3C publications and the latest revision of this technical report can be
found in the <a href="http://www.w3.org/TR/">W3C technical reports index</a>
at http://www.w3.org/TR/.</em></p>

<p>This document is an editor's draft specification of the ProgressEvent
events from the <a href="http://www.w3.org/2006/webapi/">Web API group</a>,
part of the Rich Web Client Activity. It defines events which can be used to
monitor a process and provide feedback to a user, particularly for
network-based events. This editor's draft does not imply any consensus of or
endorsement by any member of the working group, and may contain minor or
major errors.</p>

<p>This document is published following the working group's face to face
meeting of January 2007, to solicit comments from interested parties. All
comments are welcome and may be sent to <a
href="mailto:public-webapi@w3.org">public-webapi@w3.org</a>. All messages
received at this address are viewable in a <a
href="http://lists.w3.org/Archives/Public/public-webapi/">public archive</a>.
This document will hopefully be published as a first W3C Working Draft at the
beginning of February 2007, with the intention of making it a Last Call
Working draft as soon as possible, hopefully in late February 2007.</p>

<p>This document was produced by a group operating under the <a
href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004
W3C Patent Policy</a>. W3C maintains a <a rel="disclosure"
href="http://www.w3.org/2004/01/pp-impl/35495/status">public list of any
patent disclosures</a> made in connection with the deliverables of the group;
that page also includes instructions for disclosing a patent. An individual
who has actual knowledge of a patent which the individual believes contains
<a
href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
Claim(s)</a> must disclose the information in accordance with <a
href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
6 of the W3C Patent Policy</a>.</p>

<p>Publication as a Working Draft does not imply endorsement by the W3C
Membership. This is a draft document and may be updated, replaced or
obsoleted by other documents at any time. It is inappropriate to cite this
document as other than work in progress.</p>

<h2>Contents</h2>

<div class="toc">
<ul>
  <li><a href="#Conformanc">Conformance</a></li>
  <li><a href="#Progress">The <code>ProgressEvent</code> events</a></li>
  <li><a href="#Change">Change History</a></li>
  <li><a href="#References">References</a>
    <ul>
      <li><a href="#Normative">Normative references</a></li>
      <li><a href="#Informativ">Informative references</a></li>
    </ul>
  </li>
  <li><a href="#Acknowledg">Acknowledgements</a></li>
</ul>
</div>

<h2 id="Conformanc">Conformance</h2>

<p>The terms <strong>must</strong>, <strong>should</strong>,
<strong>may</strong>, <strong>must not</strong>, <strong>should not</strong>,
are used in this document in accordance with [<a
href="#RFC2119">RFC2119</a>]. A conformant implementation of this
specification meets all requirements identified by the use of these terms.</p>

<h2 id="Progress">The <code>ProgressEvent</code> events</h2>
</div>

<p>A progress event occurs when the user agent makes progress in some network
operation, such as loading a resource from the web via XMLHTTPRequest [<a
href="#XHR">XHR</a>].</p>

<p>The user agent <span class="term">may</span> dispatch a progress event
while an asynchronous network opertation such as a <code>load</code> event is
taking place. If the user agent is downloading content, the event
<em>must</em> be of type '<code>progress</code>', and if it is uploading
content the event <em>must</em> be of type '<code>uploadprogress</code>'.
These events <em>should not</em> bubble, and can be canceled.</p>

<p>These events are in the null namespace. Initialisation methods are
provided in both namespace and un-namespaced versions for use as appropriate.
This specification does not recommend one over the other.</p>

<p>Below is an example of a <code>progress</code> event being used to update
a progress bar in an SVG document. Where the size of a download is unknown
there is simply an animation (@@should reflect the actual speed, and be less
lame overall. To do...)</p>
<pre class="example"><code>&lt;svg xmlns="http://www.w3.org/2000/svg" version="1.1"
     xmlns:xlink="http://www.w3.org/1999/xlink"&gt;
   
   &lt;script type="application/ecmascript"&gt;&lt;![CDATA[
   var xlinkNS = "http://www.w3.org/1999/xlink"

   function showImage(imageHref) {
       var image = document.getElementById('myImage');
       image.setAttributeNS(xlinkNS, "href", imageHref);
       image.addEventListener("progress",imageLoadProgress,false);
       //could also use a load listener for purity and theoretical beauty
   }           

   function imageLoadProgress(evt) {  
       if !(evt.total == 0) { // we know the size and don't divide by zero
          var progressBar = document.getElementById('progressBar');
          progressBar.setAttribute("width", 100*evt.loaded/evt.total);
       } else { // evt.total zero means we don't know the size
          var progressBar = document.getElementById('progressBar');
          progressBar.setAttribute("width", 20);
       }   
   }
               
   function imageLoadComplete(evt) {
       var progressBar = document.getElementById('progressBar');  
       progressBar.setAttribute("width", 100);
        var loadAnimation = document.getElementById('loadAnimation');
       loadAnimation.endElement();
               
   }
   ]]&gt;&lt;/script&gt;

   &lt;image id="myImage" xlink:href="imageA.png" width="300" height="400"
          onload="imageLoadComplete(evt)"/&gt;

   &lt;rect onclick="showImage('imageB.png')" width="120" 
         height="30" y="400" id="button" /&gt;

   &lt;animate id="loadAnimation" attributeName="x"
     xlink:href="#progressBar" values="1,81,1"&gt;

   &lt;g id="meter" opacity="0"&gt;
     &lt;rect width="102" fill="none" height="5" x=".5" y=".5" stroke-width="1"/&gt;
     &lt;rect id="progressBar" color="#444" height="3" x="1" y="1"/&gt;
  &lt;/g&gt;
&lt;/svg&gt;</code></pre>

<p></p>
<dl>
  <dt><b>IDL Definition</b></dt>
    <dd>
      <div class="idl-code">
      <pre>interface ProgressEvent : events::Event {
     readonly attribute unsigned long   loaded;
     readonly attribute unsigned long   total;
     void               initProgressEvent(in DOMString typeArg,
                                          in boolean       canBubbleArg,
                                          in boolean       cancelableArg,
                                          in unsigned long loadedArg,
                                          in unsigned long totalArg,
     void               initProgressEventNS(in DOMString namespaceURI,
                                            in DOMString typeArg,
                                            in boolean       canBubbleArg,
                                            in boolean       cancelableArg,
                                            in unsigned long loadedArg,
                                            in unsigned long totalArg,
};</pre>
      </div>
      <br />
    </dd>
  <dt><b>Attributes</b></dt>
    <dd><dl>
        <dt><span class="dom-readonly">readonly</span> <span
        class="dom-attr-type">unsigned long</span> <span
        class="dom-attr-name">loaded</span></dt>
          <dd>Specifies the number of bytes downloaded since the beginning of
            the download. This refers to the content, excluding headers and
            overhead from the transaction <span class="issue">@@issue: do we
            need to include the headers or other overhead content?</span>,
            and where there is a content-encoding or transfer encoding refers
            to the number of bytes transferred, i.e. with the relevant
            encodings applied <span class="issue">@@issue: should it be while
            encodings are still applied?</span>.</dd>
      </dl>
    </dd>
    <dd><dl>
        <dt><span class="dom-readonly">readonly</span> <span
        class="dom-attr-type">unsigned long</span> <span
        class="dom-attr-name">total</span></dt>
          <dd>Specifies the expected total number of bytes of the content
            transferred in the operation. Where the size of the transfer is
            for some reason unknown, the value of this attribute
            <em>must</em> be zero.</dd>
      </dl>
    </dd>
  <dt><b>Methods</b></dt>
    <dd><dl>
        <dt><span class="dom-method-name">initProgressEvent</span></dt>
          <dd>The initProgressEvent method is used to initialize the value of
            a progress event created through the DocumentEvent interface.
            This method may only be called before the progress event has been
            dispatched via the dispatchEvent method, though it may be called
            multiple times during that phase if necessary. If called multiple
            times, the final invocation takes precedence. 
            <dl>
              <dt><span class="dom-parameters">Parameters</span></dt>
                <dd>
                  <table summary="method parameters" border="0">
                    <tbody>
                      <tr>
                        <td valign="top">in <span
                          class="dom-parameter-type">DOMString</span> <span
                          class="dom-parameter-name">typeArg</span></td>
                        <td></td>
                        <td>Specifies the event type.</td>
                      </tr>
                      <tr>
                        <td valign="top">in <span
                          class="dom-parameter-type">unsigned long</span>
                          <span
                        class="dom-parameter-name">loadedArg</span></td>
                        <td></td>
                        <td>Specifies the number of bytes that have been
                          retrieved. This is a positive value.</td>
                      </tr>
                      <tr>
                        <td valign="top">in <span
                          class="dom-parameter-type">unsigned long</span>
                          <span
                        class="dom-parameter-name">totalArg</span></td>
                        <td></td>
                        <td>Specifies the expected total number of bytes in
                          this load operation.</td>
                      </tr>
                      <tr>
                        <td valign="top">in <span
                          class="dom-parameter-type">boolean </span><span
                          class="dom-parameter-name">cancelableArg</span></td>
                        <td></td>
                        <td>Specifies whether the event can be canceled.</td>
                      </tr>
                    </tbody>
                  </table>
                </dd>
            </dl>
            <dl>
              <dt><span class="dom-returnvalue">No Return Value</span></dt>
            </dl>
            <dl>
              <dt><span class="dom-parameters">No Exceptions</span></dt>
            </dl>
          </dd>
      </dl>
      <dl>
        <dt><span class="dom-method-name">initProgressEventNS</span></dt>
          <dd>The initProgressEvent method is used to initialize the value of
            a namespaced progress event created through the DocumentEvent
            interface. This method may only be called before the progress
            event has been dispatched via the dispatchEvent method, though it
            may be called multiple times during that phase if necessary. If
            called multiple times, the final invocation takes precedence. 
            <dl>
              <dt><span class="dom-parameters">Parameters</span></dt>
                <dd>
                  <table summary="method parameters" border="0">
                    <tbody>
                      <tr>
                        <td valign="top">in <span
                          class="dom-parameter-type">DOMString</span> <span
                          class="dom-parameter-name">namespaceURI</span></td>
                        <td></td>
                        <td>Specifies the URI for the namespace of the
                        event.</td>
                      </tr>
                      <tr>
                        <td valign="top">in <span
                          class="dom-parameter-type">DOMString</span> <span
                          class="dom-parameter-name">typeArg</span></td>
                        <td></td>
                        <td>Specifies the event type.</td>
                      </tr>
                      <tr>
                        <td valign="top">in <span
                          class="dom-parameter-type">unsigned long</span>
                          <span
                        class="dom-parameter-name">loadedArg</span></td>
                        <td></td>
                        <td>Specifies the number of bytes that have been
                          retrieved. This is a positive value.</td>
                      </tr>
                      <tr>
                        <td valign="top">in <span
                          class="dom-parameter-type">unsigned long</span>
                          <span
                        class="dom-parameter-name">totalArg</span></td>
                        <td></td>
                        <td>Specifies the expected total number of bytes in
                          this load operation.</td>
                      </tr>
                      <tr>
                        <td valign="top">in <span
                          class="dom-parameter-type">boolean </span><span
                          class="dom-parameter-name">cancelableArg</span></td>
                        <td></td>
                        <td>Specifies whether the event can be canceled.</td>
                      </tr>
                    </tbody>
                  </table>
                </dd>
            </dl>
            <dl>
              <dt><span class="dom-returnvalue">No Return Value</span></dt>
            </dl>
            <dl>
              <dt><span class="dom-parameters">No Exceptions</span></dt>
            </dl>
          </dd>
      </dl>
    </dd>
</dl>

<h2 id="Change">Change History</h2>
<dl>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.4">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.4</a></dt>
    <dd><ul>
        <li>Specified what is and isn't counted in <code>total</code> and
          <code>loaded</code></li>
        <li>Specified that the events are in the null namespace</li>
      </ul>
    </dd>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.3">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.3</a></dt>
    <dd><ul>
        <li>Specified that events don't bubble, and can be canceled</li>
        <li>Removed the <code>preload</code> and <code>postload</code> event
          types, added <code>uploadprogress</code></li>
        <li>Removed the <code>lengthComputable</code> attribute</li>
        <li>Specified value of <code>total</code> as zero if it is
        unknown</li>
      </ul>
    </dd>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.2">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.2</a></dt>
    <dd>First real version</dd>
</dl>

<p>Various editorial changes and corrections and modifications to the
examples are made from draft to draft.</p>

<h2 id="References">References</h2>

<h3 id="Normative">Normative references</h3>
<dl>
  <dt id="ref-rfc2119">[<a name="RFC2119" id="RFC2119">RFC2119</a>]</dt>
    <dd>The specification for how to use english to specify normativity, as
      if it were a technical language. Available at <a
      href="http://rfc.net/rfc2119.html">http://rfc.net/rfc2119.html</a></dd>
</dl>

<h3 id="Informativ">Informative references</h3>
<dl>
  <dt>[<a name="IEoP" id="IEoP">IEoP</a>] onProgress event in Internet
  Explorer</dt>
    <dd>Documentation available at <a
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/com/html/07b3e629-a558-4a0e-8307-ca922f56e00c.asp">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/com/html/07b3e629-a558-4a0e-8307-ca922f56e00c.asp</a></dd>
  <dt>[<a name="SVGD" id="SVGD">SVGD</a>] The proposed progress event in SVG
  1.2</dt>
    <dd>Available at <a
      href="http://www.w3.org/TR/2006/CR-SVGMobile12-20060810/svgudom.html#events__ProgressEvent">http://www.w3.org/TR/2006/CR-SVGMobile12-20060810/svgudom.html#events__ProgressEvent</a></dd>
  <dt>[<a name="WPE" id="WPE">WPE</a>] The <code>progress</code> element
  proposed by WHAT-WG</dt>
    <dd>Ed. I Hickson. Latest version available at <a
      href="http://www.whatwg.org/specs/web-apps/current-work/#progress0">http://www.whatwg.org/specs/web-apps/current-work/#progress0</a></dd>
  <dt>[<a name="XHR" id="XHR">XHR</a>] XMLHTTPRequest</dt>
    <dd>Ed. A van Kesteren. Latest draft available at <a
      href="http://www.w3.org/TR/xmlhttprequest">http://www.w3.org/TR/xmlhttprequest</a></dd>
</dl>

<h2 id="Acknowledg">Acknowledgements</h2>

<p>The editor would like to thank the SVG working group for producing the
draft [<a href="#SVGD">SVGD</a>] that this was initially based on. The WHATWG
progress event proposal [<a href="#WPE">WPE</a>] and In addition, the
following individuals' comments have been invaluable in preparing this
draft:</p>

<p>Robin Berjon, Marcos Caceres, Alex Danilo, João Eiras, Gorm Eriksen, Ian
Hickson, Bjoern Hoehrmann, Björn Höhrmann, Bjoern Höhrmann, Anne van
Kesteren, Travis Leithead, Jim Ley, Nandini Ramani, Alan Schepers, Doug
Schepers, Ellen Siegel, Maciej Stachowiak, Boris Zbarsky</p>
</body>
</html>
