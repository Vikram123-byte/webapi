<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
      "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1">
  <title>Progress Events 1.0</title>
  <style type="text/css">
 .example {border:  2px double Grey; padding-left: 2em}
 .issue {background-color: #ffffbf; border:  2px dashed Red;}
 .todo {border: dotted thin}</style>
  <link rel="stylesheet" type="text/css" media="screen"
  href="http://www.w3.org/Stylesheets/TR/Base.css">
</head>

<body>

<div class="head">
<a href="http://www.w3.org/"><img src="http://www.w3.org/Icons/w3c_home"
alt="W3C" height="48" width="72"> </a> 

<h1 id="title">Progress events 1.0</h1>

<h2 id="Editor">Editor's Draft 5 March 2009</h2>
<dl>
  <dt>This version:</dt>
    <dd><a
      href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.30">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.30</a></dd>
  <dt>Latest Editor's version:</dt>
    <dd><a
      href="http://www.w3.org/2006/webapi/progress/Progress.html">http://dev.w3.org/2006/webapi/progress/Progress.html</a></dd>
  <dt>Previous version:</dt>
    <dd><a
      href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.29">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.29</a></dd>
  <dt>Editor:</dt>
    <dd><a href="mailto:chaals@opera.com">Charles McCathieNevile</a>, <a
      href="http://www.opera.com/">Opera Software</a></dd>
</dl>

<p class="copyright"><a
href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> ©
2006-2009 <a href="http://www.w3.org/"><acronym
title="World Wide Web Consortium">W3C</acronym></a><sup>®</sup> (<a
href="http://www.csail.mit.edu/"><acronym
title="Massachusetts Institute of Technology">MIT</acronym></a>, <a
href="http://www.ercim.org/"><acronym
title="European Research Consortium for Informatics and Mathematics">ERCIM</acronym></a>,
<a href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. W3C <a
href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
<a
href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>
and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document
use</a> rules apply.</p>
<hr>
</div>

<div>
<h2 class="notoc" id="Abstract"><a id="abstract"
name="abstract">Abstract</a></h2>

<p>This document describes event types that can be used for monitoring the
progress of an operation taking place. It is primarily intended for contexts
such as data transfer operations specified by XMLHttpRequest [<a
href="#XHR">XHR</a>], or Media Access Events [<a href="#MAE">MAE</a>].</p>
</div>
<hr>

<div>
<h2 id="Status">Status of this Document</h2>

<p><em>This section describes the status of this document at the time of its
publication. Other documents may supersede this document. A list of current W3C
publications and the latest revision of this technical report can be found in
the <a href="http://www.w3.org/TR/">W3C technical reports index</a> at
http://www.w3.org/TR/.</em></p>

<p>This document is an editor's draft specification of the ProgressEvent events
from the <a href="http://www.w3.org/2006/webapi/">Web API group</a>, part of
the Rich Web Client Activity. It defines events which can be used to monitor a
process and provide feedback to a user, particularly for network-based events.
This editor's draft does not imply any consensus of or endorsement by any
member of the working group, and may contain minor or major errors.</p>

<p>This version is published following comments on the last formal draft in
October 2008, and subsequent Editor's drafts. All comments are welcome and
should be sent to the new Working Group list at <a
href="mailto:public-webapps@w3.org">public-webapps@w3.org</a> with the marker
<kbd>[progress]</kbd> in the subject line. All messages received at this
address are viewable in a <a
href="http://lists.w3.org/Archives/Public/public-webapps/">public archive</a>
(Please note that a different list was used until mid 2008, so some old
messages are <a
href="http://lists.w3.org/Archives/Public/public-webapi/">archived there
instead</a>). If no new issues are raised by review of this draft, the
specification will be published as a Last Call Working draft. At the time of
publication the editor believes that <a
href="http://www.w3.org/2008/webapps/track/issues/79">issue-79</a> has been
resolved, and that there are <a
href="http://www.w3.org/2008/webapps/track/products/5">no other known
substantive issues</a>.</p>

<p>This document was produced by a group operating under the <a
href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 W3C
Patent Policy</a>. W3C maintains a <a rel="disclosure"
href="http://www.w3.org/2004/01/pp-impl/35495/status">public list of any patent
disclosures</a> made in connection with the deliverables of the group; that
page also includes instructions for disclosing a patent. An individual who has
actual knowledge of a patent which the individual believes contains <a
href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
Claim(s)</a> must disclose the information in accordance with <a
href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
6 of the W3C Patent Policy</a>.</p>

<p>Publication as a Working Draft does not imply endorsement by the W3C
Membership. This is a draft document and may be updated, replaced or obsoleted
by other documents at any time. It is inappropriate to cite this document as
other than work in progress.</p>

<h2 id="contents">Table of Contents</h2>

<div class="toc">
<ul>
  <li><a href="#Abstract">Abstract</a></li>
  <li><a href="#Status">Status of this Document</a></li>
  <li><a href="#Conformanc">1. Conformance</a></li>
  <li><a href="#Progress">2. The <code>ProgressEvent</code> events</a> 
    <ul>
      <li><a href="#Event">2.1 Event definitions</a></li>
      <li><a href="#Event1">2.2 Event firing order</a></li>
      <li><a href="#Interface">2.3 Interface definitions</a></li>
    </ul>
  </li>
  <li><a href="#Referring">3. Referring to progress events from other
    specifications</a> 
    <ul>
      <li><a href="#Example">Example 1: Using progress events in another
        specification:</a></li>
      <li><a href="#Firing">Firing a Progress Event</a></li>
    </ul>
  </li>
  <li><a href="#Using">4. Using progress events in Web content</a> 
    <ul>
      <li><a href="#Example1">Example 2: Using Progress events in an SVG
        document. </a></li>
      <li><a href="#Example11">Example 3: Using Progress events in an HTML
        document. </a></li>
    </ul>
  </li>
  <li><a href="#References">5. References</a> 
    <ul>
      <li><a href="#Normative">5.1 Normative references</a></li>
      <li><a href="#Informativ">5.2 Informative references</a></li>
    </ul>
  </li>
  <li><a href="#Acknowledg">6. Acknowledgements</a></li>
  <li><a href="#Change">7. Change History</a></li>
</ul>
</div>

<h2 id="Conformanc">1. Conformance</h2>

<p>The terms <em>must</em>, <em>should</em>, <em>may</em>, <em>must not</em>,
<em>should not</em>, are used in this document in accordance with [<a
href="#RFC2119">RFC2119</a>]. A conformant implementation of this specification
meets all relevant requirements identified by the use of these terms. </p>

<p>All sections of this document are normative, except examples, which are
informative, and any section that begins with a statement identifying it as
informative.</p>

<p>There are three classes of conformance to this specification:</p>
<dl>
  <dt>Specification</dt>
    <dd>A specification may describe how progress events can be dispatched for
      some operation. A conformant specification is one which includes all the
      requirements identified in the section <a href="#Referring">Referring to
      progress events from other specifications</a>, and implements all
      requirements explicitly stated for specifications in normative sections
      of this specification. A conforming specification <em>should</em> also
      implement all recommendations made for specifications.</dd>
  <dt>User agent</dt>
    <dd>A user agent <em>must</em> implement all the requirements described for
      user agents throughout this specification in order to be a conforming
      user agent. A conforming user agent <em>should</em> implement all the
      recommendations for user agents as well. </dd>
    <dd>User Agents <em>must</em> listen for and fire events as required by
      content they processes, even if that content is non-conforming.</dd>
  <dt>Content</dt>
    <dd>Conforming content <em>must</em> generate and consume progress events
      in accordance with the definitions of those events in this specification,
      and in accordance with any additional conformance requirements defined by
      a specification which describes an operation that can lead to progress
      events being dispatched. <br>
      (Note that content which meets the requirements of a specification which
      is not conformant to this specification may still be conforming content
      as defined for this specification).</dd>
</dl>

<h2 id="Progress">2. The <code>ProgressEvent</code> events</h2>

<h3 id="Event">2.1 Event definitions</h3>
</div>

<p>The following events are defined in this specification:</p>

<table border="1">
  <caption></caption>
  <tbody>
    <tr>
      <th>Name</th>
      <th>Description</th>
      <th>How often?</th>
      <th>When?</th>
    </tr>
    <tr>
      <td><code>loadstart</code></td>
      <td>The operation has begun</td>
      <td>once</td>
      <td><em>Must</em> be dispatched first</td>
    </tr>
    <tr>
      <td><code>progress</code></td>
      <td>The operation is in progress</td>
      <td>zero or more</td>
      <td><em>May</em> be dispatched zero or more times after a
        <code>loadstart</code> event, before any <code>error</code>,
        <code>abort</code> or <code>load</code> event is dispatched</td>
    </tr>
    <tr>
      <td><code>stalled</code></td>
      <td>The operation has temporarily stopped proceeding</td>
      <td>zero or more</td>
      <td><em>May</em> be dispatched zero or more times after a
        <code>loadstart</code> event, before any <code>error</code>,
        <code>abort</code> or <code>load</code> event is dispatched</td>
    </tr>
    <tr>
      <td><code>suspend</code></td>
      <td>The operation has been temporarily halted by the user agent (e.g. as
        the result of a user action)</td>
      <td>zero or more</td>
      <td><em>May</em> be dispatched zero or more times after a
        <code>loadstart</code> event, before any <code>error</code>,
        <code>abort</code> or <code>load</code> event is dispatched</td>
    </tr>
    <tr>
      <td><code>error</code></td>
      <td>The operation failed to complete, e.g. as a result of a network
      error</td>
      <td>never or once</td>
      <td rowspan="3" valign="middle">Exactly one of these <em>must</em> be
        dispatched</td>
    </tr>
    <tr>
      <td><code>abort</code></td>
      <td>The operation was cancelled, e.g. as a result of user interaction</td>
      <td>never or once</td>
    </tr>
    <tr>
      <td><code>load</code></td>
      <td>The operation successfuly completed</td>
      <td>never or once</td>
    </tr>
    <tr>
      <td><code>loadend</code></td>
      <td>The operation has finished</td>
      <td>once</td>
      <td>This must be fired after the operation has completed (i.e. following
        <code>error</code>, <code>abort</code> or <code>load</code> events)</td>
    </tr>
  </tbody>
</table>

<p>User agents <em>must</em> ensure that these events trigger event listeners
attached on <code>Element</code> nodes for the relevant event and on the
capture and target phases. </p>

<p>No default action is defined in this specification for these events.
Specifications <em>may</em> define default actions. Specifications
<em>should</em> define whether events bubble or are cancelable. User Agents
<em>must</em> implement the events as defined by any such specification. </p>

<p>For a Specification which has not defined whether these events bubble or are
cancelable, User agents <em>must</em> implement these events such that by
default the events do not bubble, and are not cancelable.</p>

<p>Specifications <em>should</em> use the events defined in this specification
in preference to other events (e.g. in a different namespace, or with a
different name) that offer the same functionality.</p>

<p>These events are in "no namespace", that is for the purposes of namespaced
systems they use the <samp>null</samp> namespace. (For further information on
namespaces, see "Namespaces in XML" [<a href="#XMLNames">XMLNames</a>]). </p>

<p>Two kinds of initialisation methods are provided: one (<code><a
href="#initProgre2">initProgressEventNS</a></code>) in which the namespace is
<em>required</em> and <em>must</em> be <samp>null</samp> (any event in another
namespace is not defined by this specification), and one (<code><a
href="#initProgressEvent">initProgressEvent</a></code>) which assigns the
<samp>null</samp> namespace automatically. This specification does not
recommend use of one method over the other, and authors may choose whichever
method suits them better for any given usage.</p>

<h3 id="Event1">2.2 Event firing order</h3>
<ul>
  <li>The user agent <em>must</em> dispatch a <code>loadstart</code> event when
    a relevant operation has begun. </li>
  <li>The user agent <span class="term"><em>may</em></span> dispatch one or
    more <code>progress</code> events while a network operation is taking
  place.</li>
  <li>The user agent <em>may</em> dispatch one or more <code>stalled</code>
    events if the operation has not proceeded. User Agents <em>should</em>
    dispatch, and applications <em>may</em> listen for, a new
    <code>progress</code> event as a notification that the operation is
    proceeding again. </li>
  <li>The user agent <em>may</em> dispatch one or more <code>suspend</code>
    events if the operation has been temporarily interrupted, e.g. due to some
    user action. User Agents <em>should</em> dispatch, and applications
    <em>may</em> listen for a new <code>progress</code> event as a notification
    that the operation is proceeding again. </li>
  <li>If the operation fails to complete the user agent <em>must</em> dispatch
    either an <code>error</code> event, if the failure to complete was due to
    an error (such as a timeout, or network error), or an <code>abort</code>
    event if the operation was deliberately cancelled (e.g. by user interaction
    or through a script call).</li>
  <li>If the operation successfully completes, the user agent <em>must</em>
    dispatch a <code>load</code> event. </li>
  <li>When the operation has terminated, the user agent <em>must</em> dispatch
    a <code>loadend</code> event.</li>
</ul>

<p>In short, there must be at least one <code>loadstart</code> event, followed
by zero or more <code>progress</code> events, followed by one event which may
be any of <code>error</code>, <code>abort</code> or <code>load</code>,
according to the outcome of the operation, and finally a <code>loadend</code>
event must be fired.</p>

<h3 id="Interface">2.3 Interface definitions</h3>

<p>Where this specification repeats information from the DOM Level 3 Events
specification [<a href="#D3E">D3E</a>], the repeated information in this
section is informative. In the case of any conflict between the specifications
the DOM Level 3 Events specification is normative.</p>

<p><strong>Note:</strong> To create an instance of the
<code>ProgressEvent</code> interface, use the
<code>DocumentEvent.createEvent("ProgressEvent")</code> method call.</p>
<dl>
  <dt><b>IDL Definition</b></dt>
    <dd>
      <div class="idl-code">
      <pre>interface ProgressEvent : events::Event {
     readonly attribute boolean         lengthComputable;
     readonly attribute unsigned long long  loaded;
     readonly attribute unsigned long long  total;
     void               initProgressEvent(in DOMString typeArg,
                                          in boolean       canBubbleArg,
                                          in boolean       cancelableArg,
                                          in boolean       lengthComputableArg,
                                          in unsigned long long loadedArg,
                                          in unsigned long long totalArg)
     void               initProgressEventNS(in DOMString namespaceURI,
                                            in DOMString typeArg,
                                            in boolean       canBubbleArg,
                                            in boolean       cancelableArg,
                                            in boolean       lengthComputableArg,
                                            in unsigned long long loadedArg,
                                            in unsigned long long totalArg)
};</pre>
      </div>
      <p><br>
      </p>
    </dd>
  <dt><b>Attributes</b></dt>
    <dd><dl>
        <dt>readonly boolean <code>lengthComputable</code></dt>
          <dd>Specifies whether the total size of the transfer is known.</dd>
        <dt><span class="dom-readonly">readonly</span> <span
        class="dom-attr-type">unsigned long long</span> <span
        class="dom-attr-name"><code>loaded</code></span></dt>
          <dd>Specifies the number of bytes currently loaded. A conformant
            specification <em>must</em> define whether headers and overhead
            from the transaction are included in calculating this value. Where
            there is a content-encoding or transfer-encoding this refers to the
            number of bytes to be transferred, i.e. with the relevant encodings
            applied. Where a specification has not defined this, conformant
            user agents <em>should</em> exclude headers and similar
          overhead.</dd>
          <dd class="example"><p>For example, an HTTP GET request
            <em>should</em> calculate the size of the body only. </p>
            <p>Because HTTP headers can include the users password, sometimes
            in clear text, a site that knows the size of the default headers
            for a given implementation can determine the size of the users
            password, which has the potential to assist in cracking it.
            Therefore the amount of content transferred <em>should not</em> be
            available from a HEAD request.For more details on HTTP see [<a
            href="#RFC2616">RFC2616</a>]. </p>
          </dd>
        <dt><span class="dom-readonly">readonly</span> <span
        class="dom-attr-type">unsigned long long</span> <span
        class="dom-attr-name"><code>total</code></span></dt>
          <dd>Specifies the expected total number of bytes of the content
            transferred in the operation. Where the size of the transfer is for
            some reason unknown, the value of this attribute <em>must</em> be
            zero. Similar to requirements for the <code>loaded</code>
            attribute, conformant specifications <em>must</em> define whether
            headers and overhead from the transaction are included in
            calculating this value. Where there is a content-encoding or
            transfer-encoding this value refers to the number of bytes to be
            transferred, i.e. with the relevant encodings applied. Where a
            specification has not defined this, conformant user agents
            <em>should</em> exclude headers and similar overhead.</dd>
      </dl>
    </dd>
  <dt><b>Methods</b></dt>
    <dd><dl>
        <dt><span id="initProgressEvent"
        class="dom-method-name">initProgressEvent</span></dt>
          <dd>This method is used to initialize the value of a ProgressEvent
            object and has the same behavior as
            <code>Event.initEventNS()</code>, where the value of the namespace
            parameter is specified as <code>null</code> [<a
            href="#D3E">D3E</a>]. 
            <dl>
              <dt><span class="dom-parameters">Parameters</span></dt>
                <dd><dl>
                    <dt><var>typeArg</var> of type DOMString</dt>
                      <dd>Unless the value of this parameter is one of
                        <samp>loadstart</samp>, <samp>progress</samp>,
                        <samp>stalled, suspend, error</samp>,
                        <samp>abort</samp>, <code>load</code> or
                        <samp>loadend</samp> this specification does not define
                        the resulting event. Refer to the
                        <code>Event.initEvent()</code> method [<a
                        href="#D3E">D3E</a>] for further description of this
                        parameter.</dd>
                    <dt><var>canBubbleArg</var> of type boolean</dt>
                      <dd>Specifies <code>Event.bubbles</code>. This parameter
                        overrides the intrinsic bubbling behavior of the event
                        and determines whether the event created will
                      bubble</dd>
                    <dt><var>cancelableArg</var> of type boolean</dt>
                      <dd>Specifies <code>Event.cancelable</code>. This
                        parameter overrides the intrinsic cancel behavior of
                        the event and determines whether the event created is
                        cancelable</dd>
                    <dt><var>lengthComputableArg</var> of type boolean</dt>
                      <dd>If the user agent has reliable information about the
                        value of total, then this <em>should</em> be true. If
                        the user agent does not have reliable information about
                        the value of total, this <em>should</em> be false</dd>
                    <dt><var>loadedArg</var> of type unsigned long long</dt>
                      <dd>This parameter specifies the total number of bytes
                        already transferred. If this value is not a
                        non-negative number, the user agent <em>must</em>
                        change it to zero.</dd>
                    <dt><var>totalArg</var> of type unsigned long long</dt>
                      <dd>This specifies the total number of bytes to be
                        transferred. If lengthComputable is <var>false</var>,
                        this <em>should</em> be zero.</dd>
                  </dl>
                </dd>
            </dl>
            <dl>
              <dt><span class="dom-returnvalue">No Return Value</span></dt>
            </dl>
            <dl>
              <dt><span class="dom-parameters">No Exceptions</span></dt>
            </dl>
          </dd>
      </dl>
      <dl>
        <dt><span class="dom-method-name"
        id="initProgre2">initProgressEventNS</span></dt>
          <dd>This method is used to initialize the value of a namespaced
            ProgressEvent object and has the same behavior as
            <code>Event.initEventNS()</code> [<a href="#D3E">D3E</a>]. Except
            as described below, parameters are the same as for <a
            href="#initProgressEvent">initProgressEvent</a>. 
            <dl>
              <dt><span class="dom-parameters">Parameters</span></dt>
                <dd><dl>
                    <dt><var>namespaceURIArg</var> of type DOMString</dt>
                      <dd>For all events defined in this specification, the
                        value of this parameter is <samp>null</samp>.</dd>
                  </dl>
                </dd>
            </dl>
            <dl>
              <dt><span class="dom-returnvalue">No Return Value</span></dt>
            </dl>
            <dl>
              <dt><span class="dom-parameters">No Exceptions</span></dt>
            </dl>
          </dd>
      </dl>
    </dd>
</dl>

<h2 id="Referring">3. Referring to progress events from other
specifications</h2>

<p>A progress event occurs when the user agent makes progress in some data
transfer operation, such as loading a resource from the web via XMLHttpRequest
[<a href="#XHR">XHR</a>]. Conforming specifications which use progress events
<em>must</em> define the targets on which progress events are dispatched.</p>

<p>Either by reference or by direct inclusion, conforming specifications
<em>must</em> maintain and <em>must not</em> contradict the requirements for
and definition of the events as described in the section <a
href="../../../../tmp/Progress.html#Progress">The <code>ProgressEvent</code>
events</a>, including such characteristics as the order of firing. As noted in
that section, specifications may define additional characteristics subject to
this restriction.</p>

<h4 id="Example">Example 1: Using progress events in another specification:</h4>

<p>This example is informative.</p>

<div class="example">
<p>FooAPI has a <code>sendAndRetrieve()</code> method, which sends some content
via a predefined SMTP server and retrieves some other content via HTTP HEAD
from a URI given as a parameter. It specifies two event targets
<code>send</code> and <code>receive</code>. Progress events as specified in the
ProgressEvent events specification may be dispatched on these targets for the
send and receive phases respectively. </p>

<p>If any progress events are dispatched, then at least one <code>start</code>
event, one <code>progress</code> or, if the rate of transfer falls below 10
bytes / second, one <code>stalled</code> event per second, one of
<code>error</code>, <code>abort</code>, or <code>load</code> and one
<code>loadend</code> event must be dispatched on each target. </p>

<p>For the send phase, the <code>total</code> attribute of the progress events
measures the size of the RFC822 message body. For the receive phase, the
<code>total</code> attribute specifies the size of the content to be returned
in the HTTP HEAD operation. If the rate of transfer falls below 1kb / second
one <code>stalled</code> event per second <em>may</em> be fired for as long as
the rate remains below 1kb/second. If no bytes are transferred for 4 seconds an
<code>error</code> event followed by a <code>loadend</code> event <em>must</em>
be fired and the transfer terminated.</p>
</div>

<h3 id="Firing">3.1 Firing a Progress Event</h3>

<p>Firing a Progress event means to dispatch an event [<a href="#D3E">D3E</a>]
described in section 2 <a href="../../../../tmp/Progress.html#Progress">The
<code>ProgressEvent</code> events</a>, with relevant further definition
provided in the host specification, at a given target.</p>

<h2 id="Using">4. Using progress events in Web content</h2>

<p>Scripts may use progress events in order to provide feedback on operations
performed by an application. </p>

<h4 id="Example1">Example 2: Using Progress events in an SVG document. </h4>

<p>This example is informative and does not necessarily illustrate best
practice.</p>

<p>In this example, the application uses the information in progress events
emitted as an image loads in order to fill a progress bar as it receives
progress events. Where the size of a download is unknown or there has been no
progress yet there is simply a block moving back and forth within the progress
bar to indicate that there is still some kind of activity.</p>
<pre class="example"><code>&lt;?xml version="1.1" ?&gt;
&lt;svg xmlns="http://www.w3.org/2000/svg"
     xmlns:xlink="http://www.w3.org/1999/xlink"
     viewBox="0 0 400 400"&gt;
   
   &lt;script type="application/ecmascript"&gt;&lt;![CDATA[
   var xlinkNS = "http://www.w3.org/1999/xlink"

   function showImage(imageHref) {
       var image = document.getElementById('myImage');
       image.setAttributeNS(xlinkNS, "href", imageHref);
       image.addEventListener("progress",imageLoadProgress,false);
       image.addEventListener("load",imageLoadComplete,false);
       image.addEventListener("error",imageLoadComplete,false);
       image.addEventListener("abort",imageLoadComplete,false);
   }           

   function imageLoadProgress(evt) {  
       if (evt.lengthComputable &amp;&amp; evt.total != 0) { <strong>// size is known, not zero</strong>
          var progressBar = document.getElementById('progressBar');
          progressBar.setAttribute("width", 100*evt.loaded/evt.total);
          var loadAnimation = document.getElementById('loadAnimation');
          loadAnimation.endElement();
       } else { <strong>// we don't know the size and we need not to divide by zero</strong>
          var progressBar = document.getElementById('progressBar');
          progressBar.setAttribute("width", 20);
          var loadAnimation = document.getElementById('loadAnimation');
          loadAnimation.beginElement();
       }   
   }
               
   function imageLoadComplete(evt) {
       var progressBar = document.getElementById('progressBar');  
       progressBar.setAttribute("width", 100);
        var loadAnimation = document.getElementById('loadAnimation');
       loadAnimation.endElement();
               
   }
   ]]&gt;&lt;/script&gt;

   &lt;image id="myImage" xlink:href="imageA.png" y="15" width="400" height="300"/&gt;

&lt;g id="button" onclick="showImage('imageB.png')"&gt;
   &lt;rect width="120" 
         height="30" y="350" id="button" fill="#aaa"/&gt;
         &lt;text x="20" y="370" font-size="15"&gt;Change Image&lt;/text&gt;
&lt;/g&gt;

   &lt;animate id="loadAnimation" xlink:href="#progressBar" attributeName="x" 
     by="80" dur="1s" begin="button.click" repeatCount="indefinite"/&gt;

   &lt;g id="meter" opacity="0"&gt;
     &lt;set attributeName="opacity" to=".7" begin="button.click" end="myImage.load"/&gt;
     &lt;rect width="101" fill="none" stroke="black" height="5"
       x="5" y="5" stroke-width="1"/&gt;
     &lt;rect id="progressBar" fill="#444" height="4" x="5.5" y="5.5"/&gt;
  &lt;/g&gt;
&lt;/svg&gt;</code></pre>

<p><a href="ex2.svg">Download example 2</a> (requires SVG support)</p>

<h4 id="Example11">Example 3: Using Progress events in an HTML document. </h4>

<p>This example is informative and does not necessarily illustrate best
practice.</p>

<p>In this example, the application creates an XMLHttpRequest [<a
href="#XHR">XHR</a>], in an HTML5 [<a href="#HTML5">HTML5</a>] document and
checks whether it makes progress. (Note that this relies on draft
specifications and may need to change)</p>
<pre class="example"><code>&lt;!DOCTYPE html&gt;
 &lt;html&gt;
  &lt;head&gt;
   &lt;title&gt;Using Progress Events&lt;/title&gt;  
   &lt;script&gt;
    var theTransfer = new XMLHttpRequest();
    <span class="todo"><strong>//start up the request properly...</strong></span>
    
    theTransfer.addEventListener("progress",updateProgress,false);
    theTransfer.addEventListener("load",worky,false);
    theTransfer.addEventListener("error",failToWorky,false);
    theTransfer.addEventListener("abort",whatForYouDoThat,false);

   theTransfer.open()

   function updateProgress(evt) {  
          var progressCount = document.getElementById('progressCount');
          progressCount.child[0].data = evt.loaded;
       if (evt.lengthComputable &amp;&amp; evt.total != 0) {        <strong>// show progress</strong>
          var totalCount = document.getElementById('total');
          totalCount.child[0].data = evt.total;
       } else {       <strong>// we don't know the size</strong>
          var totalCount = document.getElementById('totalCount');
          totalCount.setAttribute("irrelevant", "irrelevant");
       }   
   }
               
   function worky(evt) {
       alert("Yuk! Modal dialog! But the transfer completed ;) ");
   }
               
   function failToWorky(evt) {
       alert("Oh! The horror! The transfer failed!!1");
   }
               
   function whatForYouDoThat(evt) {
       alert("Hey! User control is not relevant here...");
   }
   &lt;/script&gt;

  &lt;/head&gt;
  &lt;body&gt;
    &lt;p id="theProgress"&gt;So far, I have loaded 
     &lt;span id="progressCount"&gt;0&lt;/span&gt; bytes
     &lt;span id="totalCount" irrelevant="irrelevant"&gt;of the total transfer of 
     &lt;span id="total"&gt;the total&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
  &lt;/body&gt;
 &lt;/html&gt;</code></pre>

<p></p>

<h2 id="References">5. References</h2>

<h3 id="Normative">5.1 Normative references</h3>
<dl>
  <dt>[<a name="D3E" id="D3E">D3E</a>] DOM Level 3 Events.</dt>
    <dd>Björn Höhrmann, ed. W3C Working draft, available at <a
      href="http://www.w3.org/TR/DOM-Level-3-Events/events.html#Events-interface">http://www.w3.org/TR/DOM-Level-3-Events/</a></dd>
  <dt id="ref-rfc2119">[<a name="RFC2119" id="RFC2119">RFC2119</a>] Key words
  for use in RFCs to indicate Requirement Levels</dt>
    <dd>S Bradner, 1997. The specification for how to use english to specify
      normatively, as if it were a technical language. Available at <a
      href="http://rfc.net/rfc2119.html">http://rfc.net/rfc2119.html</a></dd>
  <dt>[<a name="RFC2616" id="RFC2616">RFC2616</a>] Hypertext Transfer Protocol
  -- HTTP/1.1</dt>
    <dd>R Fielding et al., 1999. Available at <a
      href="http://rfc.net/rfc2616.html">http://rfc.net/rfc2616.html</a></dd>
</dl>

<h3 id="Informativ">5.2 Informative references</h3>
<dl>
  <dt>[<a name="HTML5" id="HTML5">HTML5</a>] HTML 5</dt>
    <dd>Ian Hickson, ed. Latest draft available at <a
      href="http://www.w3.org/TR/html5">http://www.w3.org/TR/html5</a></dd>
  <dt>[<a name="IEoP" id="IEoP">IEoP</a>] onProgress event in Internet
  Explorer</dt>
    <dd>Documentation that was available at <a
      href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/com/html/07b3e629-a558-4a0e-8307-ca922f56e00c.asp">http://msdn.microsoft.com/library/default.asp?url=/library/en-us/com/html/07b3e629-a558-4a0e-8307-ca922f56e00c.asp</a></dd>
  <dt>[<a name="MAE" id="MAE">MAE</a>] Media Access Events</dt>
    <dd>Ola Anderson, Jean-Claude Duford, Roland Lundblad, eds. W3C Working
      Draft available at <a
      href="http://www.w3.org/TR/MediaAccessEvents/">http://www.w3.org/TR/MediaAccessEvents/</a></dd>
  <dt>[<a name="SVGD" id="SVGD">SVGD</a>] The proposed progress event in SVG
  1.2</dt>
    <dd>Available at <a
      href="http://www.w3.org/TR/2006/CR-SVGMobile12-20060810/svgudom.html#events__ProgressEvent">http://www.w3.org/TR/2006/CR-SVGMobile12-20060810/svgudom.html#events__ProgressEvent</a></dd>
  <dt>[<a name="WPE" id="WPE">WPE</a>] The <code>progress</code> element
  proposed by WHAT-WG</dt>
    <dd>I Hickson, ed. Latest version available at <a
      href="http://www.whatwg.org/specs/web-apps/current-work/#progress0">http://www.whatwg.org/specs/web-apps/current-work/#progress0</a></dd>
  <dt>[<a name="XHR" id="XHR">XHR</a>] XMLHttpRequest</dt>
    <dd>A van Kesteren, ed. Latest draft available at <a
      href="http://www.w3.org/TR/xmlhttprequest">http://www.w3.org/TR/xmlhttprequest</a></dd>
  <dt>[<a name="XMLNames" id="XMLNames">XMLNames</a>] Namespaces in XML 1.0</dt>
    <dd>T Bray et al., eds. Latest draft available at <a
      href="http://www.w3.org/TR/xml-names">http://www.w3.org/TR/xml-names</a></dd>
</dl>

<h2 id="Acknowledg">6. Acknowledgements</h2>

<p>The editor would like to thank the SVG working group for producing the draft
[<a href="#SVGD">SVGD</a>] that this was initially based on. The WHATWG's
proposed <code>progress</code> element [<a href="#WPE">WPE</a>] and the
documentation for Internet Explorer's <code>onProgress</code> implementation
[<a href="#IEoP">IEoP</a>] were also useful as an initial reference for this
specification. In addition, the following individuals' comments have been
invaluable in preparing this draft:</p>

<p>Robin Berjon, Jean-Yves Bitterlich, Marcos Caceres, Suresh Chitturi, Alex
Danilo, Erik Dahlström, Jean-Claude Duford, Andrew Emmons, João Eiras, Gorm
Eriksen, Kartikaya Gupta, Ian Hickson, Bjoern Hoehrmann, Björn Hoehrmann, David
Håsäther, Björn Höhrmann, Bjoern Hï¿½hrmann, Philip Jägenstedt, Anne van
Kesteren, Travis Leithead, Aaron Leventhal, Jim Ley, Chris Lilley, Cameron
McCormack, Olli Pettay, Michael Antony Puls, Nandini Ramani, Robert Sayre, Alan
Schepers, Doug Schepers, Rich Schwerdtfeger, Lisa Seeman, Andrew Shellshear,
Ellen Siegel, Andy Sledd, Garret Smith, Maciej Stachowiak, Boris Zbarsky,
Gottfried Zimmermann</p>

<p>The editor apologises to anyone who has inadvertently been left off this
list, and welcomes corrections.</p>

<h2 id="Change">7. Change History</h2>
<dl>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.28">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.30</a>
  <strong>(Intended basis for Last Call Working Draft)</strong></dt>
    <dd><ul>
        <li>Clarified that conforming user agents still do what non-conformant
          content tells them to do.</li>
      </ul>
    </dd>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.29">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.29</a>
  <strong>(Intended basis for Last Call Working Draft)</strong></dt>
    <dd><ul>
        <li>Improving examples, editorial fixes</li>
        <li>Total no longer required to be clamped to zero when
          LengthComputable is false</li>
      </ul>
    </dd>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.27">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.27</a>
  <strong>(Intended basis for Last Call Working Draft)</strong></dt>
    <dd><ul>
        <li>Completion of changes and editorial clarifications begun in <a
          href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.26">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.26</a></li>
      </ul>
    </dd>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.26">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.26</a>
  <strong>(Interim draft of intended basis for Last Call Working
  Draft)</strong></dt>
    <dd><ul>
        <li>Added stalled and suspend events - <a
          href="http://www.w3.org/2008/webapps/track/issues/78">ISSUE-78</a></li>
      </ul>
    </dd>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.25">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.25</a></dt>
    <dd><ul>
        <li>Changed the guidance on <code>loaded</code> and <code>total</code>
          to recommend not to include HEAD in calculations - <a
          href="http://www.w3.org/2008/webapps/track/issues/4">ISSUE-4</a>
          again.</li>
        <li>Noted that you can use the DocumentEvent.createEvent() method call
          - <a
        href="http://www.w3.org/2008/webapps/track/issues/3">ISSUE-3</a></li>
        <li>Did not make any change, as the resolution of <a
          href="http://www.w3.org/2008/webapps/track/issues/38">ISSUE-38</a></li>
      </ul>
    </dd>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.24">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.24</a></dt>
    <dd><ul>
        <li>Changed the loaded and total attributes from <code>long</code> to
          <code>long long</code> where they hadn't been updated yet - <a
          href="http://www.w3.org/2008/webapps/track/issues/37">ISSUE-37</a></li>
      </ul>
    </dd>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.22">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.22</a>
  </dt>
    <dd><ul>
        <li>Added <code>loadend</code> event.</li>
        <li>Required conformant specifications to describe what parts of
          content should be counted for calculating size, and give guidance
          about what to do if this has not been done - <a
          href="http://www.w3.org/2008/webapps/track/issues/4">ISSUE-4</a></li>
        <li>Changed the loaded and total attributes from <code>long</code> to
          <code>long long</code>.</li>
      </ul>
    </dd>
  <dt><a
  href="../Progress.html?rev=1.21">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.21</a>
  (based on proposed Third Public Working Draft)</dt>
    <dd>Editorial changes designed to clarify conformance requirements for each
      type of conformance. 
      <ul>
        <li>Added ISSUE-3 (should there be eventType) - likely to be resolved
          as "yes"</li>
        <li>Clarified especially in the conformance section which setions are
          normative</li>
        <li>Added some of an HTML/XHR example</li>
        <li>Changed wording to clarify that progress events can be on any kind
          of transfer</li>
        <li>Changed feedback and archive address</li>
      </ul>
    </dd>
  <dt><a
  href="../Progress.html?rev=1.20">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.20</a></dt>
    <dd><ul>
        <li>Resolved <a
          href="http://www.w3.org/2006/webapi/track/issues/119">ISSUE-119</a>
          (the attribute names will be consistent with other progress event
          specs and implementations)</li>
        <li>Resolved <a
          href="http://www.w3.org/2006/webapi/track/issues/118">ISSUE-118</a>
          (initProgressEvent can make events cancelable / not bubble)</li>
        <li>Resolved <a
          href="http://www.w3.org/2006/webapi/track/issues/118">ISSUE-117</a>
          (there will not be a <code>stalled</code> event)</li>
      </ul>
    </dd>
  <dt><a
  href="../Progress.html?rev=1.18">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.18</a></dt>
    <dd>Copy of the <a
      href="http://www.w3.org/TR/WD-progress-event-20071023">Public Working
      Draft http://www.w3.org/TR/WD-progress-event-20071023</a></dd>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.17">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.17</a>
  (basis for <a>Second Public Workling Draft</a>)</dt>
    <dd>Only editorial tweaks</dd>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.16">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.16</a>
  (intended basis for new Public Workling Draft)</dt>
    <dd><ul>
        <li>Raised <a
          href="http://www.w3.org/2006/webapi/track/issues/119">ISSUE-119</a>
          (should the attribute names be consistent with each other?)</li>
      </ul>
    </dd>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.15">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.15</a>
  (intended basis for new Public Working Draft)</dt>
    <dd><ul>
        <li>Converted to proper HTML 4 (was XHTML pretending to be HTML)</li>
        <li>Made the prose description of <code>lengthArg</code> and
          <code>totalArg</code> unsigned long to match everything else.</li>
        <li>Raised <a
          href="http://www.w3.org/2006/webapi/track/issues/118">ISSUE-118</a>
          (should initProgressEvent be able to make events cancelable / not
          bubble?)</li>
        <li>Raised <a
          href="http://www.w3.org/2006/webapi/track/issues/118">ISSUE-117</a>
          (should there be a <code>stalled</code> event?)</li>
      </ul>
    </dd>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.12">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.12</a></dt>
    <dd><ul>
        <li>Resolved ISSUE-107. No required frequency for <code>progress</code>
          events.</li>
        <li>Resolved ISSUE-108 and ISSUE-113 Specifications must describe what
          values are issued in a progress event themselves. The event simply
          describes traffic in any one direction, and specifications using it
          must describe what the progress measures.</li>
        <li>Changed the events to not Cancelable</li>
      </ul>
    </dd>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.11">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.11</a>
  (Basis for first <a
  href="http://www.w3.org/TR/2007/WD-progress-events-20070419">Public Working
  Draft http://www.w3.org/TR/2007/WD-progress-events-20070419</a> )</dt>
    <dd><ul>
        <li><a name="Considerat" id="Considerat">Defined something for
          <code>typeArg</code></a></li>
      </ul>
    </dd>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.10">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.10</a></dt>
    <dd><ul>
        <li><a name="Considerat2" id="Considerat2">Defined various error
          conditions and handling</a></li>
        <li>Made initProgressEvent() explicitly depend on event.initEvent()</li>
        <li>The events trigger on <code>Element</code> nodes</li>
        <li>Described conformance according to what is trying to conform</li>
      </ul>
    </dd>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.9">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.9</a></dt>
    <dd><ul>
        <li><a name="Considerat1" id="Considerat1">Section 'Considerations for
          Backward Compatibility</a>' removed, since the scope and structure
          changed.</li>
        <li>Added <code>lengthComputable</code> back to IDL definitions too</li>
        <li>Names of event types changed to be more backward compatible</li>
      </ul>
    </dd>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.8">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.8</a></dt>
    <dd><ul>
        <li>Added a start and various end events back in</li>
        <li>Added <code>lengthComputable</code> back</li>
      </ul>
    </dd>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.7">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.7</a></dt>
    <dd><ul>
        <li>Tightened the restriction on bubbling and cancelable</li>
        <li>Fixed init method prototypes</li>
      </ul>
    </dd>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.4">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.4</a></dt>
    <dd><ul>
        <li>Specified what is and isn't counted in <code>total</code> and
          <code>loaded</code></li>
        <li>Specified that the events are in the null namespace</li>
      </ul>
    </dd>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.3">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.3</a></dt>
    <dd><ul>
        <li>Specified that events don't bubble, and can be canceled</li>
        <li>Removed the <code>preload</code> and <code>postload</code> event
          types, added <code>uploadprogress</code></li>
        <li>Removed the <code>lengthComputable</code> attribute</li>
        <li>Specified value of <code>total</code> as zero if it is unknown</li>
      </ul>
    </dd>
  <dt><a
  href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.2">http://dev.w3.org/cvsweb/~checkout~/2006/webapi/progress/Progress.html?rev=1.2</a></dt>
    <dd>First real version</dd>
</dl>

<p>Various editorial changes and corrections and modifications to the examples
are made from draft to draft. These are generally not noted in the change
history.</p>
</body>
</html>
