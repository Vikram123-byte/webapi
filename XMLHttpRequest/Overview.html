<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">

<html lang="en-US">
 <head>
  <title>The XMLHttpRequest Object</title>

  <link href="spec.css" rel="stylesheet">

  <link href="http://www.w3.org/StyleSheets/TR/W3C-WD" rel="stylesheet">

 <body>
  <div class="head">
   <p><a href="http://www.w3.org/"><img alt="W3C" height="48"
    src="http://www.w3.org/Icons/w3c_home" width="72"></a></p>

   <h1 class="head" id="the-xmlhttprequest">The XMLHttpRequest Object</h1>

   <h2 class="no-num no-toc" id="pagesubtitle">W3C Working Draft
    <em>[XXX]</em></h2>

   <dl>
    <dt>This version:

    <dd><a
     href="http://www.w3.org/TR/2006/WD-XMLHttpRequest-200XXXXX">http://www.w3.org/TR/2006/WD-XMLHttpRequest-200XXXXX</a>

    <dt>Latest version:

    <dd><a
     href="http://www.w3.org/TR/XMLHttpRequest/">http://www.w3.org/TR/XMLHttpRequest/</a>

    <dt>Previous version:

    <dd><a
     href="http://www.w3.org/TR/2006/WD-XMLHttpRequest-20060619/">http://www.w3.org/TR/2006/WD-XMLHttpRequest-20060619/</a>

    <dd><a
     href="http://www.w3.org/TR/2006/WD-XMLHttpRequest-20060405/">http://www.w3.org/TR/2006/WD-XMLHttpRequest-20060405/</a>

    <dt>Editor:

    <dd><a href="http://annevankesteren.nl/">Anne van Kesteren</a> (<a
     href="http://www.opera.com/">Opera Software ASA</a>) &lt;<a
     href="mailto:annevk@opera.com">annevk@opera.com</a>&gt;
   </dl>

   <p class="copyright"><a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
    ©2006 <a href="http://www.w3.org/"><abbr title="World Wide Web
    Consortium">W3C</abbr></a><sup>®</sup> (<a
    href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of
    Technology">MIT</abbr></a>, <a href="http://www.ercim.org/"><abbr
    title="European Research Consortium for Informatics and
    Mathematics">ERCIM</abbr></a>, <a
    href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. W3C <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
    <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>
    and <a
    href="http://www.w3.org/Consortium/Legal/copyright-documents">document
    use</a> rules apply.</p>
  </div>

  <hr>

  <h2 class="no-num no-toc" id="specabstract">Abstract</h2>

  <p>This specification defines the <code><a
   href="#xmlhttprequest0">XMLHttpRequest</a></code> object, an <abbr
   title="Application Programming Interface">API</abbr> that provides
   additional <abbr title="HyperText Transfer Protocol">HTTP</abbr> client
   functionality for transferring data between a client and a server.

  <h2 class="no-num no-toc" id="sotd">Status of this Document</h2>

  <p><em>This section describes the status of this document at the time of
   its publication. Other documents may supersede this document. A list of
   current W3C publications and the latest revision of this technical report
   can be found in the <a href="http://www.w3.org/TR/">W3C technical reports
   index</a> at http://www.w3.org/TR/.</em>

  <p>This is second Working Draft of the XMLHttpRequest Object. This document
   is produced by the <a href="http://www.w3.org/2006/webapi">Web API WG</a>,
   part of the <a href="http://www.w3.org/2006/rwc/Activity">Rich Web Clients
   Activity</a> in the W3C <a
   href="http://www.w3.org/Interaction/">Interaction Domain</a>.

  <p>Web content and browser developers are encouraged to review this draft.
   Please send comments to <a
   href="mailto:public-webapi@w3.org">public-webapi@w3.org</a>, the W3C's
   public email list for issues related to Web APIs. <a
   href="http://lists.w3.org/Archives/Public/public-webapi/">Archives</a> of
   the list are available.

  <p>Implementors should be aware that this specification is not stable.
   <strong>Implementors who are not taking part in the discussions are likely
   to find the specification changing out from under them in incompatible
   ways.</strong> Vendors interested in implementing this specification
   before it eventually reaches the Candidate Recommendation stage should
   join the aforementioned mailing list and take part in the discussions.

  <p>Publication as a Working Draft does not imply endorsement by the W3C
   Membership. This is a draft document and may be updated, replaced or
   obsoleted by other documents at any time. It is inappropriate to cite this
   document as other than work in progress.

  <p>This document was produced by a group operating under the <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February
   2004 W3C Patent Policy</a>. This document is informative only. W3C
   maintains a <a href="http://www.w3.org/2004/01/pp-impl/38482/status"
   rel="disclosure">public list of any patent disclosures</a> made in
   connection with the deliverables of the group; that page also includes
   instructions for disclosing a patent. An individual who has actual
   knowledge of a patent which the individual believes contains <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
   Claim(s)</a> must disclose the information in accordance with <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
   6 of the W3C Patent Policy</a>.

  <h2 class="no-num no-toc" id="toc">Table of Contents</h2>
  <!--begin-toc-->

  <ul class="toc">
   <li><a href="#introduction"><span class="secno">1. </span>Introduction</a>
    
    <ul class="toc">
     <li><a href="#history"><span class="secno">1.1. </span>History</a>

     <li><a href="#examples"><span class="secno">1.2. </span>Examples of
      Usage</a>

     <li><a href="#security"><span class="secno">1.3. </span>Security
      Considerations</a>

     <li><a href="#terminology"><span class="secno">1.4.
      </span>Terminology</a>

     <li><a href="#conformance"><span class="secno">1.5.
      </span>Conformance</a>

     <li><a href="#extensibility"><span class="secno">1.6.
      </span>Extensibility</a>

     <li><a href="#notcovered"><span class="secno">1.7. </span>Not in this
      Specification</a>
    </ul>

   <li><a href="#xmlhttprequest"><span class="secno">2. </span>The
    <code>XMLHttpRequest</code> Object</a>

   <li><a href="#events"><span class="secno">3. </span>Events</a>

   <li class="no-num"><a href="#bibref">References</a>

   <li class="no-num"><a href="#acknowledgements">Acknowledgements</a>
  </ul>
  <!--end-toc-->

  <h2 id="introduction"><span class="secno">1. </span>Introduction</h2>

  <p><em>This section is non-normative.</em>

  <p>The <code><a href="#xmlhttprequest0">XMLHttpRequest</a></code> object is
   an interface exposed by a scripting engine that allows scripts to perform
   HTTP client functionality, such as submitting form data or loading data
   from a server.

  <p>The name of the object is <code><a
   href="#xmlhttprequest0">XMLHttpRequest</a></code> for compatibility with
   the web as it doesn't make much sense otherwise. It supports the transport
   of other data formats in addition to <abbr title="Extensible Markup
   Language">XML</abbr>, some implementations support other protocols besides
   HTTP (that functionality is not covered in this specification though) and
   the API supports sending data as well.

  <h3 id="history"><span class="secno">1.1. </span>History</h3>

  <p><em>This section is non-normative.</em>

  <p>The <code><a href="#xmlhttprequest0">XMLHttpRequest</a></code> object
   has been implemented for many years as ActiveX control in the Windows
   Internet Explorer browser and has later been adopted by other popular web
   browsers. Unfortunately the current implementations are not completely
   interoperable. Based on those early implementations this specification
   defines how a common subset of <code><a
   href="#xmlhttprequest0">XMLHttpRequest</a></code> should work and this
   will probably result in changes in said implementations leading to more
   interoperable and useful implementations of the <code><a
   href="#xmlhttprequest0">XMLHttpRequest</a></code> object.

  <p>Future versions of this specification (as opposed to future drafts of
   this version) may add new features, after careful examination from browser
   developers and Web content developers.

  <p class="issue">What else do we want to say? Suggestions?

  <h3 id="examples"><span class="secno">1.2. </span>Examples of Usage</h3>

  <p><em>This section is non-normative.</em>

  <p>Various examples are listed throughout the specification.

  <p class="issue">Need to write this or get some text...

  <h3 id="security"><span class="secno">1.3. </span>Security Considerations</h3>

  <p><em>This section is non-normative.</em>

  <p>Implementations that run code originating from untrusted sources will
   probably want to place additional constraints on some of the features
   defined in this specification. This is not required and an implementation
   is free to ignore this section.

  <p>The restrictions are there to stop untrusted users of the API from using
   the implementation to retrieve sensitive data. Specifically, an
   implementation in a web browser will often want to restrict pages from a
   website <var>A</var> to retrieve data from website <var>B</var>. The
   reason for this is that website <var>B</var> could reside inside a
   corporate firewall. If data could be retrieved from website <var>B</var>
   then website <var>A</var> could use the browser effectively circumvent the
   firewall.

  <p>Another possible security attack exists if website <var>B</var> requires
   authentication, like for example a web bank. If website <var>A</var> were
   allowed to access data from website <var>B</var> and the user had recently
   visited the bank and at that time logged in, the page from website
   <var>A</var> would have access to private information like statements. If
   correctly crafted, a page from website <var>A</var> could even initiate
   transactions transferring money out of the browser-users bank account.

  <p>To stop these attacks the implementation should only allow a page loaded
   from website <var>A</var> to access other pages on the same website. Two
   websites are considered separate if they use separate DNS names, even if
   these names refer to the same IP. This is because the two websites could
   be hosted at a hosting service that place several websites on a single
   server and then use the requested hostname to choose which website to
   serve. Additionally, separate TCP port numbers or separate protocols (like
   http vs. https) are considered as separate websites.

  <p>The implementation must be careful to always restrict access to the same
   website, not just during the initial HTTP request. For example if that
   request results in a redirect the implemenation should check that the
   redirect points to the same website and otherwise deny access.

  <p>Another feature that an implementation could limit is the <code><a
   href="#dfn-setrequestheader">setRequestHeader</a></code> method. If the
   implementation allows the <code>Host</code> header to be set and two
   websites are hosted on the same server one website might be able to access
   sensitive information from the other website.

  <p class="issue">...

  <p class="issue">Has to address restrictions on methods as well, etc.

  <h3 id="terminology"><span class="secno">1.4. </span>Terminology</h3>

  <p>The term <dfn id="dfn-entity-body">entity body</dfn> is used in this
   specification as defined by RFC 2616 ([<a href="#RFC2616">RFC2616</a>],
   section 7.2.1).

  <p>The term <dfn id="dfn-reset">reset</dfn> either means that respective
   member <em class="ct">must</em> be set to its initial value or each member
   of the object, depending on how it's used.</p>
  <!--
  <p>The <dfn id="dfn-cached-base-uri">cached base URI</dfn>
   <em class="ct">must</em> be <code>window.document.baseURI</code> once an
   <code>XMLHttpRequest</code> object is initialized. Specifically, the
   <code>window</code> that the <code>XMLHttpRequest</code> constructor comes
   from, not the calling <code>window</code> [Window].</p>
  -->

  <p class="issue">Can we drop this section at some point?

  <h3 id="conformance"><span class="secno">1.5. </span>Conformance</h3>

  <p>Everying in this specification is normative except for diagrams,
   examples, notes and sections marked non-normative.

  <p>The key words <em class="ct">must</em>, <em class="ct">must not</em>,
   <em class="ct">required</em>, <em class="ct">shall</em>, <em
   class="ct">shall not</em>, <em class="ct">should</em>, <em
   class="ct">should not</em>, <em class="ct">recommended</em>, <em
   class="ct">may</em> and <em class="ct">optional</em> in this document are
   to be interpreted as described in RFC 2119 [<a
   href="#RFC2119">RFC2119</a>].

  <p>This specification defines the following classes of products:

  <dl>
   <dt><dfn id="conforming">conforming implementation</dfn>

   <dd>A UA that implements all interfaces described in this specification
    and follows all <em class="ct">must</em>-, <em class="ct">required</em>-
    and <em class="ct">shall</em>-level of critera in this specification.

   <dt><dfn id="conforming0">conforming document</dfn>

   <dd>A document that follows all <em class="ct">must</em>-, <em
    class="ct">required</em>- and <em class="ct">shall</em>-level of critera
    in this specification that apply to document authors.

   <dt><dfn id="conforming1">conforming authoring tool</dfn>

   <dd>One that produces conforming documents.
  </dl>
  <!-- XXX: Not sure if all apply. -->

  <h3 id="extensibility"><span class="secno">1.6. </span>Extensibility</h3>

  <p>Extensions to the <code><a
   href="#xmlhttprequest0">XMLHttpRequest</a></code> interface are reserved
   for future work by the Web APIs WG. WGs besides the Web APIs WG may extend
   the interface, but <em class="ct">must</em> coordinate that with the Web
   APIs WG. UAs <em class="ct">may</em> extend the interface, but <em
   class="ct">must</em> prefix the new members using a string specific to the
   vendor following the <var>Vendor</var><var>Member</var> scheme. (Normally
   members follow the <var>member</var> scheme.) Company Foo could introduce
   a <code>FooFollowRedirect(<var>boolean</var>)</code> method for example.

  <p>Authors <em class="ct">may</em> use extension mechanisms specific to the
   host language, like <code>.prototype</code> in ECMAScript.

  <p class="issue">This should really be in DOM Level 3 Core.

  <h3 id="notcovered"><span class="secno">1.7. </span>Not in this
   Specification</h3>

  <p>This specification does not include the following features that may or
   may not be implemented by UAs:

  <ul>
   <li><code>load</code> event and <code>onload</code> attribute;

   <li><code>error</code> event and <code>onerror</code> attribute;

   <li><code>progress</code> event and <code>onprogress</code> attribute;

   <li><code><a href="#dfn-abort">abort</a></code> event and
    <code>onabort</code> attribute;

   <li>Timers have been suggested, perhaps an <code>ontimeout</code>
    attribute;

   <li>Property to disable following redirects;

   <li><code><a href="#dfn-responsexml">responseXML</a></code> for
    <code>text/html</code> documents;

   <li>Cross-site <code><a href="#xmlhttprequest0">XMLHttpRequest</a></code>.
  </ul>

  <h2 id="xmlhttprequest"><span class="secno">2. </span>The <code><a
   href="#xmlhttprequest0">XMLHttpRequest</a></code> Object</h2>

  <p>The <code><a href="#xmlhttprequest0">XMLHttpRequest</a></code> interface
   may be used to allow scripts to programmatically connect to their
   originating server via HTTP.

  <p>Objects implementing the <code><a
   href="#xmlhttprequest0">XMLHttpRequest</a></code> interface <em
   class="ct">must</em> also implement the <code>EventTarget</code> interface
   [<cite><a class="bibref" href="#DOM3EV">DOM3EV</a></cite>].

  <p>In ECMAScript [ECMA262], an instance of <code><a
   href="#xmlhttprequest0">XMLHttpRequest</a></code> can be created using the
   <code><a href="#xmlhttprequest0">XMLHttpRequest()</a></code> constructor:

  <div class="example">
   <pre>var client = new XMLHttpRequest();</pre>
  </div>

  <p class="issue">What about non-ECMAScript implementations?

  <p>A more complete description of what can be done with <code><a
   href="#xmlhttprequest0">XMLHttpRequest</a></code> can be found in the
   <abbr title="Interface Definition Language">IDL</abbr> below and its
   associated details. The IDL is non-normative and does not intend to
   conform to [OMGIDL]. Only the language bindings are normative.

  <pre class="idl">interface <dfn id="xmlhttprequest0">XMLHttpRequest</dfn> {
  attribute EventListener            <span><a href="#dfn-onreadystatechange">onreadystatechange</a></span>;
  readonly attribute unsigned short  <span><a href="#dfn-readystate">readyState</a></span>;
  void               <span><a href="#dfn-open">open</a></span>(in DOMString <var>method</var>, in DOMString <var>uri</var>);<!-- XXX why not url? -->
  void               <span><a href="#dfn-open">open</a></span>(in DOMString <var>method</var>, in DOMString <var>uri</var>, in boolean <var>async</var>);
  void               <span><a href="#dfn-open">open</a></span>(in DOMString <var>method</var>, in DOMString <var>uri</var>, in boolean <var>async</var>, in DOMString <var>user</var>);
  void               <span><a href="#dfn-open">open</a></span>(in DOMString <var>method</var>, in DOMString <var>uri</var>, in boolean <var>async</var>, in DOMString <var>user</var>, in DOMString <var>password</var>);
  void               <span><a href="#dfn-setrequestheader">setRequestHeader</a></span>(in DOMString <var>header</var>, in DOMString <var>value</var>);
  void               <span><a href="#dfn-send">send</a></span>();
  void               <span><a href="#dfn-send">send</a></span>(in DOMString <var>data</var>);
  void               <span><a href="#dfn-send">send</a></span>(in Document <var>data</var>);
  void               <span><a href="#dfn-abort">abort</a></span>();
  DOMString          <span><a href="#dfn-getallresponseheaders">getAllResponseHeaders</a></span>();
  DOMString          <span><a href="#dfn-getresponseheader">getResponseHeader</a></span>(in DOMString <var>header</var>);
           attribute DOMString       <span><a href="#dfn-responsetext">responseText</a></span>;
           attribute Document        <span><a href="#dfn-responsexml">responseXML</a></span>;
           attribute unsigned short  <span><a href="#dfn-status">status</a></span>;
           attribute DOMString       <span><a href="#dfn-statustext">statusText</a></span>;
};</pre>

  <dl>
   <dt><dfn id="dfn-onreadystatechange"><code>onreadystatechange</code></dfn>
    of type <code>EventListener</code>

   <dd>
    <p>An attribute that takes an <code>EventListener</code> as value that
     <em class="ct">must</em> be invoked when <code><a
     href="#dfn-readystatechange">readystatechange</a></code> is dispatched
     on the object implementing the <code><a
     href="#xmlhttprequest0">XMLHttpRequest</a></code> interface. Its initial
     value <em class="ct">must</em> be <code>null</code>.</p>

   <dt><dfn id="dfn-readystate"><code>readyState</code></dfn> of type
    <code>unsigned short</code>, readonly

   <dd>
    <p>The state of the object. The attribute <em class="ct">must</em> be one
     of the following values:</p>

    <dl>
     <dt>0 Uninitialized

     <dd>The initial value.

     <dt>1 Open

     <dd>The <code><a href="#dfn-open">open()</a></code> method has been
      successfully called.

     <dt>2 Sent

     <dd>The UA successfully completed the request, but no data has yet been
      received.

     <dt>3 Receiving

     <dd>Immediately before receiving the message body (if any). All HTTP
      headers have been received.

     <dt>4 Loaded

     <dd>The data transfer has been completed.
    </dl>

   <dt><dfn id="dfn-open"><code>open</code></dfn>

   <dd>
    <p>Calling this method <em class="ct">must</em> initialize the object by
     remembering the <var>method</var>, <var>uri</var>, <var>async</var>
     (defaulting to <code>true</code> if omitted), <var>user</var>
     (defaulting to <code>null</code> if omitted), and <var>password</var>
     (defaulting to <code>null</code> if omitted) arguments, setting the
     <code><a href="#dfn-readystate">readyState</a></code> attribute to 1
     (Open), resetting the <code><a
     href="#dfn-responsetext">responseText</a></code>, <code><a
     href="#dfn-responsexml">responseXML</a></code>, <code><a
     href="#dfn-status">status</a></code>, and <code><a
     href="#dfn-statustext">statusText</a></code> attributes to their initial
     values, and resetting the list of request headers.</p>

    <p>Same-origin security restrictions <em class="ct">should</em> apply.</p>

    <p>If the URI given to this method contains userinfo ([RFC3986], section
     3.2.1) then the user name and password specified <em
     class="ct">must</em> be used if the <var>user</var> and
     <var>password</var> arguments are omitted. If the arguments are not
     omitted, they take precedence, even if they are <code>null</code>. The
     usage of userinfo is discouraged <em class="ct">may</em> not work in
     implementations.</p>

    <p>If <code><a href="#dfn-open">open()</a></code> is called when <code><a
     href="#dfn-readystate">readyState</a></code> is 4 (Loaded) the entire
     object <em class="ct">must</em> be <span><a
     href="#dfn-reset">reset</a></span>.</p>

    <p class="issue">Need to define which methods must be supported by
     default, how they are transformed to uppercase and whatever resolution
     we come up for with regard to blacklist/whitelist nonsense.</p>

   <dt><dfn id="dfn-setrequestheader"><code>setRequestHeader</code></dfn>

   <dd>
    <p>The nominated request header (<var>header</var>) field value <em
     class="ct">must</em> be set to <var>value</var>, with the following
     exceptions:</p>

    <ul>
     <li>If the <code><a href="#dfn-readystate">readyState</a></code>
      attribute has a value other than 1 (Open), an
      <code>INVALID_STATE_ERR</code> exception <em class="ct">must</em> be
      raised.

     <li>Nothing <em class="ct">must</em> be done if the <var>header</var> or
      <var>value</var> arguments contain any U+000A LINE FEED or U+000D
      CARRIAGE RETURN characters, or if the <var>header</var> argument
      contains any U+0020 SPACE or U+003A COLON characters.

     <li>Nothing <em class="ct">must</em> be done if the <var>header</var>
      argument matches <code>Accept-Charset</code>,
      <code>Accept-Encoding</code>, <code>Content-Length</code>,
      <code>Expect</code>, <code>Date</code>, <code>Host</code>,
      <code>Keep-Alive</code>, <code>Referer</code>, <code>TE</code>,
      <code>Trailer</code>, <code>Transfer-Encoding</code> or
      <code>Upgrade</code> case-insensitively.
    </ul>

    <div class="example">
     <pre>// The following script:
var client = new XMLHttpRequest();
client.open('GET', <code class="css">'demo.cgi'</code>);
client.setRequestHeader('X-Test', <span class="property">'one'</span>);
client.setRequestHeader('X-Test', <span class="property">'two'</span>);
client.send(null);

// ...would result in the following header being sent:
...
X-Test: one, two
...</pre>
    </div>

    <p>Implementations <em class="ct">must</em> replace any existing value if
     the nominated request header field value is one of:
     <code>Authorization</code>, <code>Content-Base</code>,
     <code>Content-Location</code>, <code>Content-MD5</code>,
     <code>Content-Range</code>, <code>Content-Type</code>,
     <code>Content-Version</code>, <code>Delta-Base</code>,
     <code>Depth</code>, <code>Destinaion</code>, <code>ETag</code>,
     <code>Expect</code>, <code>From</code>, <code>If-Modified-Since</code>,
     <code>If-Range</code>, <code>If-Unmodified-Since</code>,
     <code>Max-Forwards</code>, <code>MIME-Version</code>,
     <code>Overwrite</code>, <code>Proxy-Authorization</code>,
     <code>SOAPAction</code> or <code>Timeout</code>.</p>

    <p>Otherwise, if the nominated request header field already has a value,
     the new value <em class="ct">must</em> be combined with the existing
     value (section 4.2, [<a href="#RFC2616">RFC2616</a>]). See also the
     <code><a href="#dfn-send">send()</a></code> method regarding UA header
     handling for caching, authentication, proxies, and cookies.</p>

    <p>The list of request headers must be reset when the <code><a
     href="#dfn-open">open()</a></code> method is called.</p>

   <dt><dfn id="dfn-send"><code>send</code></dfn>

   <dd>
    <p>If the <code><a href="#dfn-readystate">readyState</a></code> attribute
     has a value other than 1 (Open), an <code>INVALID_STATE_ERR</code>
     exception <em class="ct">must</em> be raised. Otherwise, the <code><a
     href="#dfn-readystate">readyState</a></code> attribute <em
     class="ct">must</em> be set to 2 (Sent) and a request to <var>uri</var>
     using method <var>method</var> is sent. <var>uri</var>, if relative, <em
     class="ct">must</em> be resolved using
     <code>window.document.baseURI</code> of the <code>window</code> whose
     constructor is used. If the <var>async</var> flag is set to false, then
     the method <em class="ct">must</em> not return until the request has
     completed. Otherwise, it <em class="ct">must</em> return immediately.
     (See: <code><a href="#dfn-open">open()</a></code>.)</p>

    <p>If <var>data</var> passed to the <code><a
     href="#dfn-send">send()</a></code> method it <em class="ct">must</em> be
     used for the entity body following these rules:</p>

    <ul>
     <li>If <var>data</var> is a <code>DOMString</code>, it <em
      class="ct">must</em> be encoded as UTF-8 for transmission.

     <li>If the <var>data</var> is a <code>Document</code>, it <em
      class="ct">must</em> be serialized using the encoding given by
      <code><var>data</var>.xmlEncoding</code>, if specified and supported,
      or UTF-8 otherwise [<a href="#DOM3">DOM3</a>].

     <li>If <var>data</var> is not a <code>DOMString</code> or a
      <code>Document</code> the host language its stringification mechanisms
      <em class="ct">must</em> be used on the argument that was passed and
      the result <em class="ct">must</em> be encoded as UTF-8 for
      transmission.
    </ul>

    <p>Invoking <code><a href="#dfn-send">send</a></code> without the
     <var>data</var> argument <em class="ct">must</em> give the same result
     as if it was invoked with <code>null</code> as argument. Authors <em
     class="ct">should</em> specify the <code>Content-Type</code> header via
     <code><a href="#dfn-setrequestheader">setRequestHeader</a></code> before
     invoking <code><a href="#dfn-send">send</a></code> with an argument.</p>

    <p>If the response is an HTTP redirect (status code 301, 302, 303 or
     307), then it <em class="ct">must</em> be transparently followed (unless
     it violates security, infinite loop precautions or the scheme isn't
     supported). Note that HTTP [<a href="#RFC2616">RFC2616</a>] places
     requirements on UAs regarding the preservation of the request method
     during redirects, and also requires users to be notified of certain
     kinds of automatic redirections.</p>

    <p>If the UA allows the specification of a proxy it <em
     class="ct">should</em> modify the request appropriately; <abbr title="in
     other words">i.e.</abbr>, connect to the proxy host instead of the
     origin server, modify the <code>Request-Line</code> and send
     <code>Proxy-Authorization</code> headers as specified.</p>

    <p>If the UA supports HTTP Authentication [RFC2617] it <em
     class="ct">should</em> consider requests originating from this object to
     be part of the protection space that includes the accessed URIs and send
     <code>Authorization</code> headers and handle 401 Unauthorised requests
     appropriately. if authentication fails, UAs should prompt the users for
     credentials.</p>

    <p>If the UA supports HTTP State Mangement [RFC2109][RFC2965] it should
     persist, discard and send cookies (as received in the
     <code>Set-Cookie</code> and <code>Set-Cookie2</code> response headers,
     and sent in the <code>Cookie</code> header) as applicable.</p>

    <p>If the UA implements a HTTP cache [<a href="#RFC2616">RFC2616</a>] it
     should respect <code>Cache-Control</code> request headers set by the
     author (<abbr title="for example">e.g.</abbr>, <code>Cache-Control:
     no-cache</code> bypasses the cache). It <em class="ct">must not</em>
     send <code>Cache-Control</code> or <code>Pragma</code> request headers
     automatically unless the user explicitly requests such behaviour (e.g.,
     by (force-)reloading the page). 304 Not Modified responses that are a
     result of a UA-generated conditional request <em class="ct">must</em> be
     presented as 200 OK responses with the appropriate content. Such UAs <em
     class="ct">must</em> allow authors to override automatic cache
     validation by setting request headers (e.g., <code>If-None-Match</code>,
     <code>If-Modified-Since</code>), in which case 304 Not Modified
     responses <em class="ct">must</em> be passed through.</p>

    <p>If the UA implements server-driven content-negotiation [<a
     href="#RFC2616">RFC2616</a>], it <em class="ct">should</em> set
     <code>Accept-Language</code>, <code>Accept-Encoding</code> and
     <code>Accept-Charset</code> headers as appropriate; it <em
     class="ct">must not</em> automatically set the <code>Accept</code>
     header. Responses to such requests <em class="ct">must</em> have
     content-codings automatically removed.</p>

    <p>Immediately before receiving the message body (if any), the <code><a
     href="#dfn-readystate">readyState</a></code> attribute <em
     class="ct">must</em> be set to to 3 (Receiving). When the request has
     completed loading, the <code><a
     href="#dfn-readystate">readyState</a></code> attribute <em
     class="ct">must</em> be set to 4 (Loaded). In case of a
     <code>HEAD</code> request <code><a
     href="#dfn-readystate">readyState</a></code> <em class="ct">must</em> be
     set to 4 (Loaded) immediately after having gone to 3 (Receiving).

    <p>If the UA supports Expect/Continue for request bodies [<a
     href="#RFC2616">RFC2616</a>] it <em class="ct">should</em> insert
     <code>Expect</code> headers and handle 100 Continue responses
     appropriately.</p>

   <dt><dfn id="dfn-abort"><code>abort</code></dfn>

   <dd>
    <p>When invoked, this method <em class="ct">must</em> cancel any network
     activity for which the object is responsible and <span><a
     href="#dfn-reset">reset</a></span> the object.</p>

   <dt><dfn
    id="dfn-getallresponseheaders"><code>getAllResponseHeaders</code></dfn>

   <dd>
    <p>If the <code><a href="#dfn-readystate">readyState</a></code> attribute
     has a value other than 3 (Receiving) or 4 (Loaded), it <em
     class="ct">must</em> return <code>null</code>. Otherwise, it <em
     class="ct">must</em> return all the HTTP headers, as a single string,
     with each header line separated by a CR (U+000D) LF (U+000A) pair. The
     status line <em class="ct">must</em> not be included.</p>

    <div class="example">
     <pre>// The following script:
var client = new XMLHttpRequest();
client.open('GET', <code class="css">'test.txt'</code>, false);
client.send();
print(client.getAllResponseHeaders());

// ...should output something similar to the following text:
Date: Sun, 24 Oct 2004 04:58:38 GMT
Server: Apache/1.3.31 (Unix)
Keep-Alive: timeout=15, max=99
Connection: Keep-Alive
Transfer-Encoding: chunked
Content-Type: text/plain; charset=utf-8</pre>
    </div>

   <dt><dfn id="dfn-getresponseheader"><code>getResponseHeader</code></dfn>

   <dd>
    <p>If the <code><a href="#dfn-readystate">readyState</a></code> attribute
     has a value other than 3 (Receiving) or 4 (Loaded), it <em
     class="ct">must</em> return the empty string. Otherwise, it <em
     class="ct">must</em> represent the value of the given HTTP header
     (<var>header</var>) in the data received so far for the last request
     sent, as a single string. If more than one header of the given name was
     received, then the values <em class="ct">must</em> be concatenated,
     separated from each other by an U+002C COMMA followed by an U+0020
     SPACE. If no headers of that name were received, then it <em
     class="ct">must</em> return the empty string. Header names <em
     class="ct">must</em> be compared case-insensitively to the method its
     argument (<var>header</var>).</p>

    <p class="issue">Case-insensitively how?</p>

    <p class="issue">Needs to be revised largely based on Mark's comments.</p>

    <div class="example">
     <pre>// The following script:
var client = new XMLHttpRequest();
client.open('GET', <code class="css">'test.txt'</code>, false);
client.send();
print(client.getResponseHeader('Content-Type'));

// ...should output something similar to the following text:
Content-Type: text/plain; charset=utf-8</pre>
    </div>

   <dt><dfn id="dfn-responsetext"><code>responseText</code></dfn> of type
    <code>DOMString</code>

   <dd>
    <p>If the <code><a href="#dfn-readystate">readyState</a></code> attribute
     has a value other than 3 (Receiving) or 4 (Loaded), <code><a
     href="#dfn-responsetext">responseText</a></code> <em
     class="ct">must</em> be the empty string. Otherwise, it <em
     class="ct">must</em> be the fragment of the entity body received so far
     (when <code><a href="#dfn-readystate">readyState</a></code> is 3
     (Receiving)) or the complete entity body (when <code><a
     href="#dfn-readystate">readyState</a></code> is 4 (Loaded)), interpreted
     as a stream of characters.</p>

    <p>If the response includes a <code>Content-Type</code> understood by the
     UA the characters are encoded following the relevant media type
     specification, with the exception that the rule in the final paragraph
     of section 3.7.1 of [<a href="#RFC2616">RFC2616</a>], and the rules in
     section 4.1.2 of [RFC2046] <em class="ct">must</em> be treated as if
     they specified the default character encoding as being UTF-8. Invalid
     bytes <em class="ct">must</em> be converted to U+FFFD REPLACEMENT
     CHARACTER. If the UA can't derive a character stream in accord with the
     media type specification, <code>reponseText</code> <em
     class="ct">must</em> be <code>null</code>.</p>

   <dt><dfn id="dfn-responsexml"><code>responseXML</code></dfn> of type
    <code>Document</code>

   <dd>
    <p>If the <code><a href="#dfn-readystate">readyState</a></code> attribute
     has a value other than 4 (Loaded), it <em class="ct">must</em> be
     <code>null</code>. Otherwise, if the <code>Content-Type</code> header
     contains a media type (ignoring any parameters) that is either
     <code>text/xml</code>, <code>application/xml</code>, or ends in
     <code>+xml</code>, it <em class="ct">must</em> be an object that
     implements the <code>Document</code> interface representing the parsed
     document. If <code>Content-Type</code> did not contain such a media
     type, or if the document could not be parsed (due to an XML
     well-formedness error or unsupported character encoding, for instance),
     it <em class="ct">must</em> be <code>null</code>.</p>

   <dt><dfn id="dfn-status"><code>status</code></dfn> of type <code>unsigned
    short</code>

   <dd>
    <p>If the <code><a href="#dfn-status">status</a></code> attribute is not
     available an <code>INVALID_STATE_ERR</code> exception <em
     class="ct">must</em> be raised. It <em class="ct">must</em> be available
     when <code><a href="#dfn-readystate">readyState</a></code> is 3
     (Receiving) or 4 (Loaded). When available, it <em class="ct">must</em>
     represent the HTTP status code (typically <code>200</code> for a
     successful connection).</p>

   <dt><dfn id="dfn-statustext"><code>statusText</code></dfn> of type
    <code>DOMString</code>

   <dd>
    <p>If the <code><a href="#dfn-statustext">statusText</a></code> attribute
     is not available an <code>INVALID_STATE_ERR</code> exception <em
     class="ct">must</em> be raised. It <em class="ct">must</em> be available
     when <code><a href="#dfn-readystate">readyState</a></code> is 3
     (Receiving) or 4 (Loaded). When available, it <em class="ct">must</em>
     represent the HTTP status text sent by the server (appears after the
     status code).</p>
  </dl>

  <p>HTTP requests sent from multiple different <code><a
   href="#xmlhttprequest0">XMLHttpRequest</a></code> objects in succession
   <em class="ct">should</em> be pipelined into shared HTTP connections.

  <h2 id="events"><span class="secno">3. </span>Events</h2>

  <p>These sections describe the various events that can be dispatched on the
   object implementing the <code><a
   href="#xmlhttprequest0">XMLHttpRequest</a></code> interface. For this
   version of the specification only one event is defined.

  <dl>
   <dt><dfn id="dfn-readystatechange"><code>readystatechange</code></dfn>

   <dd>The <code><a href="#dfn-readystatechange">readystatechange</a></code>
    event <em class="ct">must</em> be dispatched when <code><a
    href="#dfn-readystate">readyState</a></code> changes value. It <em
    class="ct">must not</em> bubble, <em class="ct">must not</em> be
    cancelable and <em class="ct">must</em> implement the <code>Event</code>
    interface [<cite><a class="bibref" href="#DOM3EV">DOM3EV</a></cite>]. The
    event has no namespace (<code>Event.namespaceURI</code> is
    <code>null</code>).
  </dl>

  <h2 class="no-num" id="bibref">References</h2>

  <dl class="bibliography">
   <dt id="DOM3">DOM3

   <dd><cite><a href="http://www.w3.org/TR/DOM-Level-3-Core/">Document Object
    Model (DOM) Level 3 Core Specification</a></cite>, Arnaud Le Hors (IBM),
    Philippe Le Hégaret (W3C), Lauren Wood (SoftQuad, Inc.), Gavin Nicol
    (Inso EPS), Jonathan Robie (Texcel Research and Software AG), Mike
    Champion (Arbortext and Software AG), and Steve Byrne (JavaSoft).

   <dt id="DOM3EV">DOM3EV

   <dd><cite><a href="http://www.w3.org/TR/DOM-Level-3-Events/">Document
    Object Model (DOM) Level 3 Events Specification</a></cite>, Philippe Le
    Hégaret (W3C), and Tom Pixley (Netscape Communications Corporation).

   <dt id="RFC2119">RFC2119

   <dd><cite><a href="http://www.ietf.org/rfc/rfc2119.txt">Key words for use
    in RFCs to Indicate Requirement Levels</a></cite>, S. Bradner.

   <dt id="RFC2616">RFC2616

   <dd><cite><a href="http://www.ietf.org/rfc/rfc2616.txt">Hypertext Transfer
    Protocol -- HTTP/1.1</a></cite>, R. Fielding (UC Irvine), J. Gettys
    (Compaq/W3C), J. Mogul (Compaq), H. Frystyk (W3C/MIT), L. Masinter
    (Xerox), P. Leach (Microsoft), and T. Berners-Lee (W3C/MIT).
  </dl>

  <h2 class="no-num" id="acknowledgements">Acknowledgements</h2>

  <p><em>This section is non-normative</em>

  <p>Thanks to the following people who have contributed to this
   specification (ordered on first name):

  <ul>
   <li>Asbjørn Ulsberg

   <li>Boris Zbarsky

   <li>Björn Höhrmann

   <li>Cameron McCormack

   <li>Christophe Jolif

   <li>Charles McCathieNevile

   <li>Dean Jackson

   <li>Doug Schepers

   <li>Douglas Livingstone

   <li>Gorm Haug Eriksen

   <li>Hallvord R. M. Steen

   <li>Håkon Wium Lie

   <li>Ian Davis

   <li>Ian Hickson

   <li>Ivan Herman

   <li>Jens Lindström

   <li>Jim Deegan

   <li>Jim Ley

   <li>Jonas Sicking

   <li>Julian Reschke

   <li>Karl Dubost

   <li>Maciej Stachowiak

   <li>Marc Hadley

   <li>Mark Nottingham

   <li>Pawel Glowacki

   <li>Robin Berjon

   <li>Ruud Steltenpool
  </ul>

  <p>Special thanks to the Microsoft employees who first implemented the
   <code><a href="#xmlhttprequest0">XMLHttpRequest</a></code> interface,
   which was first widely deployed by the Windows Internet Explorer browser.

  <p>Special thanks also to the WHATWG for drafing a first version of this
   specification in their Web Applications 1.0 document.

  <p>Thanks also to all those who have helped to improve this specification
   by sending suggestions and corrections. (Please, keep bugging us with your
   issues!)
