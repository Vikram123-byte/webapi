<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en-US">
 <head>
  <title>The XMLHttpRequest Object</title>
  <style type="text/css">
   pre.idl { border:solid thin; background:#eee; color:#000; padding:0.5em }
   pre.idl :link, pre.idl :visited { color:inherit; background:transparent }
   div.example { margin-left:1em; padding-left:1em; border-left:double; color:#222; background:#fcfcfc }
   p.note { margin-left:2em; font-weight:bold; font-style:italic; color:#008000 }
   p.note::before { content:"Note: " }
   p.issue { padding:.5em; border:solid #f00 }
   p.issue::before { content:"Issue: " }
   em.ct { text-transform:lowercase; font-variant:small-caps; font-style:normal }
   dfn { font-weight:bold; font-style:normal }
   code { color:orangered }
   code :link, code :visited { color:inherit }
  </style>
  <link rel="stylesheet" href="http://www.w3.org/StyleSheets/TR/base">
 </head>
 <body>
  <div class="head">
   <p><a href="http://www.w3.org/"><img height="48" width="72" alt="W3C" src="http://www.w3.org/Icons/w3c_home"></a></p>

   <h1 class="head">The <code title="">XMLHttpRequest</code> Object</h1>

   <h2 class="no-num no-toc" id="pagesubtitle">Editor's Draft September 2006</h2>

   <dl>
    <dt>This Version:</dt>
    <dd><a href="http://www.w3.org/TR/2006/WD-XMLHttpRequest-200XXXXX">http://www.w3.org/TR/2006/WD-XMLHttpRequest-200XXXXX</a></dd>

    <dt>Latest Version:</dt>
    <dd><a href="http://www.w3.org/TR/XMLHttpRequest/">http://www.w3.org/TR/XMLHttpRequest/</a></dd>

    <dt>Previous Versions:</dt>
    <dd><a href="http://www.w3.org/TR/2006/WD-XMLHttpRequest-20060619/">http://www.w3.org/TR/2006/WD-XMLHttpRequest-20060619/</a></dd>
    <dd><a href="http://www.w3.org/TR/2006/WD-XMLHttpRequest-20060405/">http://www.w3.org/TR/2006/WD-XMLHttpRequest-20060405/</a></dd>

    <dt>Editor:</dt>
    <dd><a href="http://annevankesteren.nl/">Anne van Kesteren</a>
     (<a href="http://www.opera.com/">Opera Software ASA</a>)
     &lt;<a href="mailto:annevk@opera.com">annevk@opera.com</a>&gt;</dd>
   </dl>

   <p class="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
    ©2006
    <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup>
    (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>,
    <a href="http://www.ercim.org/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>,
    <a href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. W3C
    <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
    <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>
    and
    <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document
    use</a> rules apply.
   </p>
  </div>

  <hr>

  <h2 class="no-num no-toc" id="specabstract">Abstract</h2>

  <p>This specification defines the <code>XMLHttpRequest</code> object, an
   <abbr title="Application Programming Interface">API</abbr> that provides
   additional <abbr title="HyperText Transfer Protocol">HTTP</abbr> client
   functionality for transferring data between a client and a server.</p>

  <h2 class="no-num no-toc" id="sotd">Status of this Document</h2>

  <p><em>This section describes the status of this document at the time of its
   publication. Other documents may supersede this document. A list of current
   W3C publications and the latest revision of this technical report can be
   found in the <a href="http://www.w3.org/TR/">W3C technical reports index</a>
   at http://www.w3.org/TR/.</em></p>

  <p>This is the "fourth" Working Draft of The
   <code title="">XMLHttpRequest</code> Object. This document is produced by the
   <a href="http://www.w3.org/2006/webapi/">Web APIs WG</a>, part of the
   <a href="http://www.w3.org/2006/rwc/Activity">Rich Web Clients Activity</a>
   in the W3C <a href="http://www.w3.org/Interaction/">Interaction
   Domain</a>.</p>

  <p>Web content and browser developers are encouraged to review this draft.
   Please send comments to
   <a href="mailto:public-webapi@w3.org">public-webapi@w3.org</a>, the W3C's
   public email list for issues related to Web APIs.
   <a href="http://lists.w3.org/Archives/Public/public-webapi/">Archives</a> of
   the list are available.</p>

  <p>Implementors should be aware that this specification is not stable.
   <strong>Implementors who are not taking part in the discussions are likely
   to find the specification changing out from under them in incompatible
   ways.</strong> Vendors interested in implementing this specification
   before it eventually reaches the Candidate Recommendation stage should
   join the aforementioned mailing list and take part in the discussions.</p>

  <p>Publication as a Working Draft does not imply endorsement by the W3C
   Membership. This is a draft document and may be updated, replaced or
   obsoleted by other documents at any time. It is inappropriate to cite this
   document as other than work in progress.</p>

  <p>This document was produced by a group operating under the
   <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February
   2004 W3C Patent Policy</a>. This document is informative only. W3C maintains
   a
   <a rel="disclosure" href="http://www.w3.org/2004/01/pp-impl/38482/status">public
   list of any patent disclosures</a> made in connection with the deliverables
   of the group; that page also includes instructions for disclosing a patent.
   An individual who has actual knowledge of a patent which the individual
   believes contains
   <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
   Claim(s)</a> must disclose the information in accordance with
   <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
   6 of the W3C Patent Policy</a>.</p>

  <h2 class="no-num no-toc" id="toc">Table of Contents</h2>

  <!--toc-->

  <h2 id="introduction">Introduction</h2>

  <p><em>This section is non-normative.</em></p>

  <p>The <code>XMLHttpRequest</code> object is an interface exposed by a
   scripting engine that allows scripts to perform HTTP client functionality,
   such as submitting form data or loading data from a server.</p>

  <p>The name of the object is <code>XMLHttpRequest</code> for compatibility
   with the web as it doesn't make much sense otherwise. It supports the
   transport of other data formats in addition to
   <abbr title="Extensible Markup Language">XML</abbr>, some implementations
   support other protocols besides HTTP (that functionality is not covered in
   this specification though) and the API supports sending data as well.</p>

  <h3 id="history">History</h3>

  <p><em>This section is non-normative.</em></p>

  <p>The <code>XMLHttpRequest</code> object has been implemented for many years
   as ActiveX control in the Windows Internet Explorer browser and has later
   been adopted by other popular web browsers. Unfortunately the current
   implementations are not completely interoperable. Based on those early
   implementations this specification defines how a common subset of
   <code>XMLHttpRequest</code> should work and this will probably result in
   changes in said implementations leading to more interoperable and useful
   implementations of the <code>XMLHttpRequest</code> object.</p>

  <p>Future versions of this specification (as opposed to future drafts of this
   version) may add <a href="#notcovered">new features</a>, after careful
   examination from browser developers and Web content developers.</p>

  <h3 id="examples">Examples of Usage</h3>

  <p><em>This section is non-normative.</em></p>

  <p>Various [<cite><a href="#ref-ecmascript">ECMAScript</a></cite>] examples
   are listed throughout the specification. In addition, you can find some
   below.</p>

  <div class="example">
   <p>Some simple code to do something with data from an XML document fetched
    over the network:</p>

   <pre>function test(data) {
 // taking care of data
}

function handler() {
 if(this.readyState == 4 && this.status == 200) {
  // so far so good
  if(this.responseXML != null && this.responseXML.getElementById('test').firstChild.data)
   // success!
   test(this.responseXML.getElementById('test').firstChild.data);
  else
   test(null);
 } else if (this.readyState == 4 && this.status != 200) {
  // fetched the wrong page or network error...
  test(null);
 }
}

var client = new XMLHttpRequest();
client.onreadystatechange = handler;
client.open("GET", "test.xml");
client.send();</pre>

   <p>If you just want to ping the server with a message you could do something
    like:</p>

   <pre>function ping(message) {
 var client = new XMLHttpRequest();
 client.open("POST", "/ping");
 client.send(message);
}</pre>

   <p>Or if you want to check the status of a document on the server:</p>

   <pre>function fetchStatus(address) {
 var client = new XMLHttpRequest();
 client.onreadystatechange = function() {
  // in case of network errors this might not give reliable results
  if(this.readyState == 4)
   returnStatus(this.status);
 }
 client.open("HEAD", address);
 client.send();
}</pre>
  </div>

  <!-- XXX: perhaps fetch some more examples from the web... -->

  <h3 id="conformance">Conformance</h3>

  <p>Everying in this specification is normative except for diagrams, examples,
   notes and sections marked non-normative.</p>

  <p>The key words <em class="ct">must</em>, <em class="ct">must not</em>,
   <em class="ct">required</em>, <em class="ct">shall</em>,
   <em class="ct">shall not</em>, <em class="ct">should</em>,
   <em class="ct">should not</em>, <em class="ct">recommended</em>,
   <em class="ct">may</em> and <em class="ct">optional</em> in this document
   are to be interpreted as described in RFC 2119
   [<cite><a href="#RFC2119">RFC2119</a></cite>].</p>

  <p>This specification defines the following classes of products:</p>

  <dl>
   <dt><dfn>conforming implementation</dfn></dt>
   <dd>A user agent that implements all interfaces described in this
    specification and follows all <em class="ct">must</em>-,
    <em class="ct">required</em>- and <em class="ct">shall</em>-level of critera
    in this specification.</dd>
   <dt><dfn>conforming document</dfn></dt>
   <dd>A document that follows all <em class="ct">must</em>-,
    <em class="ct">required</em>- and <em class="ct">shall</em>-level of
    critera in this specification that apply to document authors.</dd>
   <dt><dfn>conforming authoring tool</dfn></dt>
   <dd>One that produces conforming documents.</dd>
  </dl>

  <h3 id="extensibility">Extensibility</h3>

  <p><em>This section is non-normative.</em></p>

  <p>Extensions of the APIs defined in this specification are <em>strongly
   discouraged</em>. User agents, Working Groups and other interested parties
   should discuss extensions on a relevant public forum, such as
   <a href="mailto:public-webapi@w3.org">public-webapi@w3.org</a>.</p>

  <h3 id="notcovered">Not in this Specification</h3>

  <p><em>This section is non normative.</em></p>

  <p>This specification does not include the following features that may or may
   not be implemented by user agents:</p>

  <ul>
   <li><code>load</code> event and <code>onload</code> attribute;</li>
   <li><code>error</code> event and <code>onerror</code> attribute;</li>
   <li><code>progress</code> event and <code>onprogress</code> attribute;</li>
   <li><code title="">abort</code> event and <code>onabort</code> attribute;</li>
   <li>Timers have been suggested, perhaps an <code>ontimeout</code>
    attribute;</li>
   <li>Property to disable following redirects;</li>
   <li><code>responseXML</code> for <code>text/html</code> documents;</li>
   <li>Cross-site <code>XMLHttpRequest</code>.</li>
  </ul>

  <h2 id="xmlhttprequest">The <code title="">XMLHttpRequest</code> Object</h2>

  <p class="issue">What if the user cancels a request by leaving the page? How
   does that work for multiple windows and what's the effect on the object? Need
   to test.</p>

  <p>The <code>XMLHttpRequest</code> interface may be used to allow scripts to
   programmatically connect to their originating server via HTTP.</p>

  <p>Objects implementing the <code>XMLHttpRequest</code> interface
   <em class="ct">must</em> also implement the <code>EventTarget</code>
   interface [<cite><a href="#DOM3EV">DOM3Events</a></cite>].</p>

  <p>In [<cite><a href="#ref-ecmascript">ECMAScript</a></cite>], an instance of
   <code>XMLHttpRequest</code> can be created using the
   <code title="">XMLHttpRequest()</code> constructor:</p>

  <div class="example">
   <pre>var client = new XMLHttpRequest();</pre>
  </div>

  <p>When the constructor is invoked the <dfn><code>XMLHttpRequest</code> base
   resource identifier reference</dfn> <em class="ct">must</em> be set to the
   value of the <code>baseURI</code> attribute of the <code>Document</code>
   object that's associated with the <code>Window</code> object which initially
   had <code title="">XMLHttpRequest</code> as an attribute of which the
   constructor was invoked. When <code>baseURI</code> is <code>null</code> there
   is no <span><code>XMLHttpRequest</code> base resource identifier
   reference</span>.</p>

  <h3 id="xmlhttprequest-members">Members of the <code>XMLHttpRequest</code>
   Object</h3>

  <p>A more complete description of what can be done with
   <code>XMLHttpRequest</code> can be found in the
   <abbr title="Interface Definition Language">IDL</abbr> below and its
   associated details. It's non-normative and does not conform to [OMGIDL].</p>

  <pre class="idl">interface <dfn>XMLHttpRequest</dfn> {
           attribute EventListener   <span>onreadystatechange</span>;
  readonly attribute unsigned short  <span>readyState</span>;
  void               <span>open</span>(in DOMString <var>method</var>, in DOMString <var>url</var>);
  void               <span>open</span>(in DOMString <var>method</var>, in DOMString <var>url</var>, in boolean <var>async</var>);
  void               <span>open</span>(in DOMString <var>method</var>, in DOMString <var>url</var>, in boolean <var>async</var>, in DOMString <var>user</var>);
  void               <span>open</span>(in DOMString <var>method</var>, in DOMString <var>url</var>, in boolean <var>async</var>, in DOMString <var>user</var>, in DOMString <var>password</var>);
  void               <span>setRequestHeader</span>(in DOMString <var>header</var>, in DOMString <var>value</var>);
  void               <span>send</span>();
  void               <span>send</span>(in DOMString <var>data</var>);
  void               <span>send</span>(in Document <var>data</var>);
  void               <span>abort</span>();
  DOMString          <span>getAllResponseHeaders</span>();
  DOMString          <span>getResponseHeader</span>(in DOMString <var>header</var>);
  readonly attribute DOMString       <span>responseText</span>;
  readonly attribute Document        <span>responseXML</span>;
  readonly attribute unsigned short  <span>status</span>;
  readonly attribute DOMString       <span>statusText</span>;
};</pre>

  <dl>

   <dt><dfn id="dfn-onreadystatechange"><code>onreadystatechange</code></dfn>
    of type <code>EventListener</code></dt>

   <dd>
    <p>An attribute that takes an <code>EventListener</code> as value that
     <em class="ct">must</em> be invoked when <code>readystatechange</code> is
     dispatched on the object implementing the <code>XMLHttpRequest</code>
     interface. Its initial value <em class="ct">must</em> be
     <code>null</code>.</p>
   </dd>

   <dt><dfn id="dfn-readystate"><code>readyState</code></dfn> of type
    <code>unsigned short</code>, readonly</dt>

   <dd>
    <p>The state of the object. The attribute <em class="ct">must</em> be one of
     the following values:</p>

    <dl>
     <dt>0 Uninitialized</dt>
     <dd>The initial value.</dd>
     <dt>1 Open</dt>
     <dd>The <code>open()</code> method has been successfully called.</dd>
     <dt>2 Sent</dt>
     <dd>The user agent successfully acknowledged the request.</dd>
     <dt>3 Receiving</dt>
     <dd>Immediately before receiving the message body (if any). All HTTP
      headers have been received.</dd>
     <dt>4 Loaded</dt>
     <dd>The data transfer has been completed.</dd>
    </dl>

    <p class="note">When <code>readyState</code> changes value a
     <code>readystatechange</code> event is to be dispatched on the
     <code>XMLHttpRequest</code> object.</p>
   </dd>

   <dt><dfn id="dfn-open" title="open"><code>open(<var>method</var>,
    <var>url</var>, <var>async</var>, <var>user</var>,
    <var>password</var>)</code></dfn>, method</dt>

   <dd>
    <p class="issue">What about multiple <code>open()</code> invocations? Like
     behind each other or one after invoking <code>send()</code>, etc.</p>

    <p>Calling this method <em class="ct">must</em> initialize the object by
     remembering the <var>method</var>, <var>url</var>, <var>async</var>
     (defaulting to <code>true</code> if omitted), <var>user</var> (defaulting
     to <code>null</code> if omitted), and <var>password</var> (defaulting to
     <code>null</code> if omitted) arguments, setting the
     <code>readyState</code> attribute to 1 (Open), resetting the
     <code>responseText</code>, <code>responseXML</code>, <code>status</code>,
     and <code>statusText</code> attributes to their initial values, and
     resetting the list of request headers.</p>

    <p>If the <var>method</var> argument doesn't match the <dfn>method
     production</dfn> defined in section 5.1.1 of
     [<cite><a href="#RFC2616">RFC2616</a></cite>] a <code>SYNTAX_ERR</code>
     <em class="ct">must</em> be raised by the user agent. If the user agent
     doesn't support the given method for security reasons a
     <code>SECURITY_ERR</code> <em class="ct">should</em> be raised.</p>

    <p>User agents <em class="ct">must</em> at least support the following list
     of methods (see [<cite><a href="#RFC2616">RFC2616</a></cite>]):</p>

    <ul>
     <li><code>GET</code></li>
     <li><code>POST</code></li>
     <li><code>HEAD</code></li>
     <li><code>PUT</code></li>
     <li><code>DELETE</code></li>
    </ul>

    <p>User agents <em class="ct">should</em> support any <var>method</var>
     argument that matches the <span>method production</span>.</p>

    <p>When <var>method</var> case-insensitively matches <code>GET</code>,
     <code>POST</code>, <code>HEAD</code>, <code>PUT</code> or
     <code>DELETE</code> the user agent <em class="ct">must</em> use the
     uppercase equivalent instead.</p>


    <p>When <var>url</var> is a relative reference, it <em class="ct">must</em>
     be resolved using <span><code>XMLHttpRequest</code> base resource
     identifier reference</span>. If that's not defined, or there's a failure in
     resolving user agents <em class="ct">must</em> throw a
     <code>SYNTAX_ERR</code>. When a non same-origin <var>url</var> argument is
     given user agents <em class="ct">should</em> throw a
     <code>SECURITY_ERR</code> exception.</p>
    
    <p class="issue">What happens with fragment identifiers? Do we need to say
     anything special about same-document references?</p>

    <p class="note">A future version or extension of this specification will
     define a way of doing cross-site requests.</p>

    <!--<p>If the <var>url</var> parameter doesn't match the syntax defined in
     section 3.2.2 of [<cite><a href="#RFC2616">RFC2616</a></cite>] a
     <code>SYNTAX_ERR</code> <em class="ct">must</em> be raised.</p>-->

    <p>User agents <em class="ct">should not</em> support the "user:password"
     format in the <code>userinfo</code> production defined in section 3.2.1 of
     [<cite><a href="#ref-rfc3986">RFC3986</a></cite>] and
     <em class="ct">must</em> throw a <code>SYNTAX_ERR</code> when doing so (not
     supporting it). When they do support it, or in case of people using the
     format "user", user agents <em class="ct">must</em> use them if the
     <var>user</var> and <var>password</var> arguments are omitted. If the
     arguments are not omitted, they take precedence, even if they are
     <code>null</code>.</p>

    <p>If the <var>user</var> argument doesn't match the
     <code>username-value</code> production defined in section 3.2.2 of
     [<cite><a href="#ref-rfc2617">RFC2617</a></cite>] user agents
     <em class="ct">must</em> throw a <code>SYNTAX_ERR</code> exception.</p>

    <p class="issue">Need to look at the <var>password</var> argument.</p>

    <p>If <code>open()</code> is invoked when <code>readyState</code> is 4
     (Loaded) all members of the object <em class="ct">must</em> be set to their
     initial values.</p>

   </dd>

   <dt><dfn id="dfn-setrequestheader" title="setrequestheader"><code>setRequestHeader(<var>header</var>,
    <var>value</var>)</code></dfn>, method</dt>

   <dd>
    <p>The nominated request header (<var>header</var>) field value
     <em class="ct">must</em> be set to <var>value</var>, with the following
     exceptions:</p>

    <ul>
     <li>If the <code>readyState</code> attribute has a value other than 1
      (Open) or the <span><code>send()</code> flag</span> is set an
      <code>INVALID_STATE_ERR</code> exception <em class="ct">must</em> be
      raised;</li>

     <li>If the <var>header</var> argument doesn't match the
      <dfn><code>field-name</code> production</dfn> as defined by section 4.2
      of [<cite><a href="#RFC2616">RFC2616</a></cite>] a <code>SYNTAX_ERR</code>
      <em class="ct">must</em> be raised;</li>

     <li>If the <var>value</var> argument doesn't match the
      <dfn><code>field-value</code> production</dfn> as defined by section 4.2
      of [<cite><a href="#RFC2616">RFC2616</a></cite>] a <code>SYNTAX_ERR</code>
      <em class="ct">must</em> be raised;</li>

     <li>For security reasons nothing <em class="ct">should</em> be done if the
      <var>header</var> argument matches <code>Accept-Charset</code>,
      <code>Accept-Encoding</code>, <code>Content-Length</code>,
      <code>Expect</code>, <code>Date</code>, <code>Host</code>,
      <code>Keep-Alive</code>, <code>Referer</code>, <code>TE</code>,
      <code>Trailer</code>, <code>Transfer-Encoding</code> or
      <code>Upgrade</code> case-insensitively.</li>
    </ul>

    <p>Implementations <em class="ct">must</em> replace any existing value if
     the nominated request header field value is one of:
     <code>Authorization</code>, <code>Content-Base</code>,
     <code>Content-Location</code>, <code>Content-MD5</code>,
     <code>Content-Range</code>, <code>Content-Type</code>,
     <code>Content-Version</code>, <code>Delta-Base</code>, <code>Depth</code>,
     <code>Destination</code>, <code>ETag</code>, <code>Expect</code>,
     <code>From</code>, <code>If-Modified-Since</code>, <code>If-Range</code>,
     <code>If-Unmodified-Since</code>, <code>Max-Forwards</code>,
     <code>MIME-Version</code>, <code>Overwrite</code>,
     <code>Proxy-Authorization</code>, <code>SOAPAction</code> or
     <code>Timeout</code>.</p>

    <p>Otherwise, if the nominated request header field already has a value, the
     new value <em class="ct">must</em> be combined with the existing value
     (section 4.2, [<cite><a href="#RFC2616">RFC2616</a></cite>]). See also the
     <code>send()</code> method regarding user agent header handling for
     caching, authentication, proxies, and cookies.</p>

    <div class="example">
     <pre>// The following script:
var client = new XMLHttpRequest();
client.open('GET', 'demo.cgi');
client.setRequestHeader('X-Test', 'one');
client.setRequestHeader('X-Test', 'two');
client.send();

// ...would result in the following header being sent:
...
X-Test: one, two
...</pre>
    </div>

    <p>The list of request headers <em class="ct">must</em> be reset when the
     <code>open()</code> method is invoked.</p>
   </dd>

   <dt><dfn id="dfn-send" title="send"><code>send(<var>data</var>)</code></dfn>,
    method</dt>

   <dd>
    <p>If the <code>readyState</code> attribute has a value other than 1 (Open)
     or the <span><code>send()</code> flag</code> is set an
     <code>INVALID_STATE_ERR</code> exception <em class="ct">must</em> be
     raised. Otherwise user agents <em class="ct">must</em> make a request to
     <var>url</var> using method <var>method</var> and set the
     <dfn><code>send()</code> flag</dfn>. If the <var>async</var> flag is set to
     <code>false</code>, then the method <em class="ct">must not</em> return
     until the request has completed. Otherwise, it <em class="ct">must</em>
     return immediately. (See: <code>open()</code>.)</p>

    <p class="note">The <span><code>send()</code> flag</span> is only relevant
     when <code>readyState</code> is 1 (Open).</p>

    <p>If <var>data</var> is passed to the <code>send()</code> method it
     <em class="ct">must</em> be used for the entity body following these rules
     (the term <dfn id="dfn-entity-body">entity body</dfn> is defined by section
     7.2.1 of [<cite><a href="#RFC2616">RFC2616</a></cite>]):</p>

    <ul>
     <li>If <var>data</var> is a <code>DOMString</code>, it
      <em class="ct">must</em> be encoded as UTF-8 for transmission.</li>
     <li>If the <var>data</var> is a <code>Document</code>, it
      <em class="ct">must</em> be serialized using the encoding given by
      <code><var>data</var>.xmlEncoding</code>, if specified and supported, or
      UTF-8 otherwise [<cite><a href="#DOM3">DOM3Core</a></cite>].</li>
     <li>If <var>data</var> is not a <code>DOMString</code> or a
      <code>Document</code> the host language its stringification mechanisms
      <em class="ct">must</em> be used on the argument that was passed and the
      result <em class="ct">must</em> be treated as if <var>data</var> is a
      <code>DOMString</code>.</li>
    </ul>

    <p>Invoking <code>send()</code> without the <var>data</var> argument
     <em class="ct">must</em> give the same result as if it was invoked with
     <code>null</code> as argument.</p>

    <p>Authors <em class="ct">should</em> specify the <code>Content-Type</code>
     header via <code>setRequestHeader</code> before invoking
     <code>send()</code> with an argument. If the argument to
     <code>send()</code> is a <code>Document</code> and no
     <code>Content-Type</code> header has been set user agents
     <em class="ct">must</em> set it to <code>application/xml</code> for XML
     documents and to the most appropriate media type for other documents (using
     intrinsic knowledge about the document).</p>

    <p>If the response is an HTTP redirect (status code <code>301</code>,
     <code>302</code>, <code>303</code> or <code>307</code>), then it
     <em class="ct">must</em> be transparently followed (unless it violates
     security, infinite loop precautions or the scheme isn't supported). Note
     that HTTP ([<cite><a href="#RFC2616">RFC2616</a></cite>]) places
     requirements on user agents regarding the preservation of the request
     method during redirects, and also requires users to be notified of certain
     kinds of automatic redirections.</p>

    <p>Once the request has been successfully acknowledged
     <code>readyState</code> <em class="ct">must</em> be set to 2 (Sent).
     Immediately before receiving the message body (if any), the
     <code>readyState</code> attribute <em class="ct">must</em> be set to to 3
     (Receiving). When the request has completed loading, the
     <code>readyState</code> attribute <em class="ct">must</em> be set to 4
     (Loaded). In case of a <code>HEAD</code> request <code>readyState</code>
     <em class="ct">must</em> be set to 4 (Loaded) immediately after having gone
     to 3 (Receiving).</p>

    <p>If something goes wrong (infinite loop, network errors) the
     <code>readyState</code> attribute <em class="ct">must</em> be set to 4
     (Loaded) and all other members of the object <em class="ct">must</em> be
     set to their initial value. Besides that, all registered event listeners
     <em class="ct">must</em> be removed.</p>

    <p class="note">In future versions of this specification user agents will be
     required to dispatch an <code>error</code> event if the above occurs.</p>

    <p>If the user agent allows the specification of a proxy it
     <em class="ct">should</em> modify the request appropriately;
     <abbr title="in other words">i.e.</abbr>, connect to the proxy host instead
     of the origin server, modify the <code>Request-Line</code> and send
     <code>Proxy-Authorization</code> headers as specified.</p>

    <p>If the user agent supports <cite>HTTP Authentication</cite>
     ([<cite><a href="#ref-rfc2617">RFC2617</a></cite>]) it
     <em class="ct">should</em> consider requests originating from this object
     to be part of the protection space that includes the accessed URIs and send
     <code>Authorization</code> headers and handle <code>401 Unauthorised</code>
     requests appropriately. if authentication fails, user agents
     <em class="ct">should</em> prompt the users for credentials.</p>

    <p>If the user agent supports <cite>HTTP State Mangement</cite>
     ([<cite><a href="#ref-rfc2109">RFC2109</a></cite>],
     [<cite><a href="#ref-rfc2965">RFC2965</a></cite>]) it
     <em class="ct">should</em> persist, discard and send cookies (as received
     in the <code>Set-Cookie</code> and <code>Set-Cookie2</code> response
     headers, and sent in the <code>Cookie</code> header) as applicable.</p>

    <p>If the user agent implements a HTTP cache
     ([<cite><a href="#RFC2616">RFC2616</a></cite>]) it
     <em class="ct">should</em> respect <code>Cache-Control</code> request
     headers set by the author (<abbr title="for example">e.g.</abbr>,
     <code>Cache-Control: no-cache</code> bypasses the cache). It
     <em class="ct">must not</em> send <code>Cache-Control</code> or
     <code>Pragma</code> request headers automatically unless the user
     explicitly requests such behaviour (e.g., by (force-)reloading the page).
     <code>304 Not Modified</code> responses that are a result of a user agent
     generated conditional request <em class="ct">must</em> be presented as
     <code>200 OK</code> responses with the appropriate content. Such user
     agents <em class="ct">must</em> allow authors to override automatic cache
     validation by setting request headers (e.g., <code>If-None-Match</code>,
     <code>If-Modified-Since</code>), in which case <code>304 Not
     Modified</code> responses <em class="ct">must</em> be passed through.</p>

    <p>If the user agent implements server-driven content-negotiation
     ([<cite><a href="#RFC2616">RFC2616</a></cite>]) it
     <em class="ct">should</em> set <code>Accept-Language</code>,
     <code>Accept-Encoding</code> and <code>Accept-Charset</code> headers as
     appropriate; it <em class="ct">must not</em> automatically set the
     <code>Accept</code> header. Responses to such requests
     <em class="ct">must</em> have content-codings automatically removed.</p>

    <p>If the user agent supports Expect/Continue for request bodies
     ([<cite><a href="#RFC2616">RFC2616</a></cite>]) it
     <em class="ct">should</em> insert <code>Expect</code> headers and handle
     <code>100 Continue</code> responses appropriately.</p>

   </dd>

   <dt><dfn id="dfn-abort"><code>abort()</code></dfn>, method</dt>

   <dd>
    <p>When invoked, this method <em class="ct">must</em> cancel any network
     activity for which the object is responsible and set all the members of the
     object to their initial values.</p>
   </dd>

   <dt><dfn id="dfn-getallresponseheaders"><code>getAllResponseHeaders()</code></dfn>,
    method</dt>

   <dd>
    <p>If the <code>readyState</code> attribute has a value other than 3
     (Receiving) or 4 (Loaded), user agents <em class="ct">must</em> raise an
     <code>INVALID_STATE_ERR</code> exception. Otherwise, it
     <em class="ct">must</em> return all the HTTP headers, as a single string,
     with each header line separated by a CR (U+000D) LF (U+000A) pair. The
     status line <em class="ct">must not</em> be included.</p>
    <div class="example">
     <pre>// The following script:
var client = new XMLHttpRequest();
client.open("GET", "test.txt", true);
client.send();
client.onreadystatechange = function() {
 if(this.readyState == 3) {
  print(this.getAllResponseHeaders());
 }
}

// ...should output something similar to the following text:
Date: Sun, 24 Oct 2004 04:58:38 GMT
Server: Apache/1.3.31 (Unix)
Keep-Alive: timeout=15, max=99
Connection: Keep-Alive
Transfer-Encoding: chunked
Content-Type: text/plain; charset=utf-8</pre>
    </div>
   </dd>

   <dt><dfn id="dfn-getresponseheader" title="getresponseheader"><code>getResponseHeader(<var>header</var>)</code></dfn>,
    method</dt>

   <dd>

    <p>If the <var>header</var> argument doesn't match the
     <span><code>field-name</code> production</span> a <code>SYNTAX_ERR</code>
     <em class="ct">must</em> be raised. Otherwise this method works as
     described below.</p>

    <p>If the <code>readyState</code> attribute has a value other than 3
     (Receiving) or 4 (Loaded), the user agent <em class="ct">must</em> raise an
     <code>INVALID_STATE_ERR</code> exception. Otherwise, it
     <em class="ct">must</em> represent the value of the given HTTP header
     (<var>header</var>) in the data received so far for the last request sent,
     as a single string. If more than one header of the given name was received,
     then the values <em class="ct">must</em> be concatenated, separated from
     each other by an U+002C COMMA followed by an U+0020 SPACE. If no headers of
     that name were received, then it <em class="ct">must</em> return
     <code>null</code>. Header names <em class="ct">must</em> be compared
     case-insensitively to the method its argument (<var>header</var>).</p>

    <div class="example">
     <pre>// The following script:
var client = new XMLHttpRequest();
client.open("GET", "test.txt", true);
client.send();
client.onreadystatechange = function() {
 if(this.readyState == 3) {
  print(client.getResponseHeader("Content-Type"));
 }
}

// ...should output something similar to the following text:
Content-Type: text/plain; charset=utf-8</pre>
    </div>
   </dd>

   <dt><dfn id="dfn-responsetext"><code>responseText</code></dfn> of type
    <code>DOMString</code>, readonly</dt>

   <dd>
    <p>If the <code>readyState</code> attribute has a value other than 3
     (Receiving) or 4 (Loaded), the user agent <em class="ct">must</em> raise an
     <code>INVALID_STATE_ERR</code> exception. Otherwise, it
     <em class="ct">must</em> be the fragment of the <span>entity body</span>
     received so far (when <code>readyState</code> is 3 (Receiving)) or the
     complete <span>entity body</span> (when <code>readyState</code> is 4
     (Loaded)), interpreted as a stream of characters.</p>

    <p>If the response includes a <code>Content-Type</code> understood by the
     user agent the characters are encoded following the relevant media type
     specification, with the exception that the rule in the final paragraph of
     section 3.7.1 of [<cite><a href="#RFC2616">RFC2616</a></cite>], and the
     rules in section 4.1.2 of [<cite><a href="#ref-rfc2046">RFC2046</a></cite>]
     <em class="ct">must</em> be treated as if they specified the default
     character encoding as being UTF-8. Invalid bytes <em class="ct">must</em>
     be converted to U+FFFD REPLACEMENT CHARACTER. If the user agent can't
     derive a character stream in accord with the media type specification,
     <code>reponseText</code> <em class="ct">must</em> be <code>null</code>.</p>

    <p>Its initial value <em class="ct">must</em> be the <code>null</code>.</p>

    <p class="note">For <code>HEAD</code> requests for example, this attribute
     will always be <code>null</code> (it remains unchanged). Similar to the
     <code>responseXML</code> attribute.</p>
   </dd>

   <dt><dfn id="dfn-responsexml"><code>responseXML</code></dfn> of type
    <code>Document</code>, readonly</dt>

   <dd>
    <p>If the <code>readyState</code> attribute has a value other than 4
     (Loaded), user agents <em class="ct">must</em> raise an
     <code>INVALID_STATE_ERR</code> exception. Otherwise, if the
     <code>Content-Type</code> header contains a media type (ignoring any
     parameters) that is either <code>text/xml</code>,
     <code>application/xml</code>, or ends in <code>+xml</code>, it
     <em class="ct">must</em> be an object that implements the
     <code>Document</code> interface representing the parsed document. If
     <code>Content-Type</code> did not contain such a media type, or if the
     document could not be parsed (due to an XML well-formedness error or
     unsupported character encoding, for instance), it <em class="ct">must</em>
     be <code>null</code>.</p>

    <p>Its initial value <em class="ct">must</em> be <code>null</code>.</p>
   </dd>

   <dt><dfn id="dfn-status"><code>status</code></dfn> of type
    <code>unsigned short</code>, readonly</dt>

   <dd>
    <p>If the <code>status</code> attribute is not available an
     <code>INVALID_STATE_ERR</code> exception <em class="ct">must</em> be
     raised. It <em class="ct">must</em> be available when
     <code>readyState</code> is 3 (Receiving) or 4 (Loaded). When available, it
     <em class="ct">must</em> represent the HTTP status code (typically
     <code>200</code> for a successful connection).</p>

    <p>Its initial value <em class="ct">must</em> be <code>0</code>.</p>
   </dd>

   <dt><dfn id="dfn-statustext"><code>statusText</code></dfn> of type
    <code>DOMString</code>, readonly</dt>

   <dd>
    <p>If the <code>statusText</code> attribute is not available an
     <code>INVALID_STATE_ERR</code> exception <em class="ct">must</em> be
     raised. It <em class="ct">must</em> be available when
     <code>readyState</code> is 3 (Receiving) or 4 (Loaded). When available, it
     <em class="ct">must</em> represent the HTTP status text sent by the server
     (appears after the status code).</p>

    <p>Its initial value <em class="ct">must</em> be the empty string.</p>
   </dd>
  </dl>

  <p>HTTP requests sent from multiple different <code>XMLHttpRequest</code>
   objects in succession <em class="ct">should</em> be pipelined into shared
   HTTP connections.</p>

  <h3 id="events">Events for the <code>XMLHttpRequest</code> Object</h3>

  <p>These sections describe the various events that can be dispatched on the
   object implementing the <code>XMLHttpRequest</code> interface. For this
   version of the specification only one event is defined.</p>

  <dl>
   <dt><dfn id="dfn-readystatechange"><code>readystatechange</code></dfn></dt>
   <dd>The <code>readystatechange</code> event <em class="ct">must</em> be
    dispatched when <code>readyState</code> changes value. It
    <em class="ct">must not</em> bubble, <em class="ct">must not</em> be
    cancelable and <em class="ct">must</em> implement the <code>Event</code>
    interface [<cite><a href="#DOM3EV">DOM3Events</a></cite>]. The event has no
    namespace (<code>Event.namespaceURI</code> is <code>null</code>).</dd>
  </dl>

  <h2 class="no-num" id="bibref">References</h2>

  <dl>

   <dt id="DOM3">[DOM3Core]</dt>
   <dd><cite><a href="http://www.w3.org/TR/DOM-Level-3-Core">Document Object
    Model (DOM) Level 3 Core Specification</a></cite>, A. Le Hors, P. Le
    Hégaret, L. Wood, G. Nicol, J. Robie, M. Champion, S. Byrne, editors.
    World Wide Web Consortium, April 2004.</dd>

   <dt id="DOM3EV">[DOM3Events]</dt>
   <dd><cite><a href="http://www.w3.org/TR/DOM-Level-3-Events/">Document Object
    Model (DOM) Level 3 Events Specification</a></cite>, Björn Höhrmann, editor.
    World Wide Web Consortium, April 2006.</dd>

   <dt id="ref-ecmascript">[ECMAScript]</dt>
   <dd><cite><a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm">ECMAScript
    Language Specification</a></cite>, Third Edition. ECMA, December 1999.</dd>

   <dt id="ref-rfc2046">[RFC2046]</dt>
   <dd><cite><a href="http://ietf.org/rfc/rfc2046">Multipurpose Internet Mail
    Extensions (MIME) Part Two: Media Types</a></cite>, N. Freed, N. Borenstein,
    editors. IETF, November 1996.</dd>

   <dt id="ref-rfc2109">[RFC2109]</dt>
   <dd><cite><a href="http://ietf.org/rfc/rfc2109">HTTP State Management
    Mechanism</a></cite>, D. Kristol, L. Montulli, editors. IETF, February
    1997.</dd>

   <dt id="RFC2119">[RFC2119]</dt>
   <dd><cite><a href="http://ietf.org/rfc/rfc2119">RFC 2119: Key words
    for use in RFCs to Indicate Requirement Levels</a></cite>, S. Bradner.
    IETF, March 1997.</dd>

   <dt id="RFC2616">[RFC2616]</dt>
   <dd><cite><a href="http://ietf.org/rfc/rfc2616">Hypertext Transfer Protocol
    -- HTTP/1.1</a></cite>, R. Fielding, J. Gettys, J. Mogul, H. Frystyk, L.
    Masinter, P. Leach, T. Berners-Lee, editors. IETF, June 1999</dd>

   <dt id="ref-rfc2617">[RFC2617]</dt>
   <dd><cite><a href="http://ietf.org/rfc/rfc2617">HTTP Authentication: Basic
    and Digest Access Authentication</a></cite>, ...</dd>

   <dt id="ref-rfc2965">[RFC2965]</dt>
   <dd><cite><a href="http://ietf.org/rfc/rfc2965">HTTP State Management
    Mechanism</a></cite>, D. Kristol, L. Montulli, editors. IETF, October
    2000.</dd>

   <dt id="ref-rfc3986">[RFC3986]</dt>
   <dd><cite><a href="http://ietf.org/rfc/rfc3986">Uniform Resource Identifier
    (URI): Generic Syntax</a></cite>, T. Berners-Lee, R. Fielding, L. Masinter,
    editors. IETF, January 2005.</dd>
  </dl>

  <h2 class="no-num" id="acknowledgements">Acknowledgements</h2>

  <p><em>This section is non-normative</em></p>

  <p>The editor would like to thank to the following people who have contributed
   to this specification (ordered on first name):</p>

  <ul>
   <li>Alex Vincent</li>
   <li>Alexey Proskuryakov</li>
   <li>Asbjørn Ulsberg</li>
   <li>Boris Zbarsky</li>
   <li>Björn Höhrmann</li>
   <li>Cameron McCormack</li>
   <li>Christophe Jolif</li>
   <li>Charles McCathieNevile</li>
   <li>Dean Jackson</li>
   <li>Doug Schepers</li>
   <li>Douglas Livingstone</li>
   <li>Gorm Haug Eriksen</li>
   <li>Hallvord R. M. Steen</li>
   <li>Håkon Wium Lie</li>
   <li>Ian Davis</li>
   <li>Ian Hickson</li>
   <li>Ivan Herman</li>
   <li>Jens Lindström</li>
   <li>Jim Deegan</li>
   <li>Jim Ley</li>
   <li>Jonas Sicking</li>
   <li>Julian Reschke</li>
   <li>Karl Dubost</li>
   <li>Maciej Stachowiak</li>
   <li>Magnus Kristiansen</li>
   <li>Marc Hadley</li>
   <li>Mark Nottingham</li>
   <li>Pawel Glowacki</li>
   <li>Robin Berjon</li>
   <li>Ruud Steltenpool</li>
  </ul>

  <p>Special thanks to the Microsoft employees who first implemented the
   <code>XMLHttpRequest</code> interface, which was first widely deployed by
   the Windows Internet Explorer browser.</p>

  <p>Special thanks also to the WHATWG for drafing a first version of this
   specification in their Web Applications 1.0 document.</p>

  <p>Thanks also to all those who have helped to improve this specification by
   sending suggestions and corrections. (Please, keep bugging us with your
   issues!)</p>

 </body>
</html>
