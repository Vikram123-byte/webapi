<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en-US">
 <head>
  <title>The XMLHttpRequest Object</title>
  <style type="text/css">
   pre.idl { border:solid thin; background:#eee; color:#000; padding:0.5em }
   pre.idl :link, pre.idl :visited { color:inherit; background:transparent }
   div.example { margin-left:1em; padding-left:1em; border-left:double; color:#222; background:#fcfcfc }
   p.note { margin-left:2em; font-weight:bold; font-style:italic; color:#008000 }
   p.note::before { content:"Note: " }
   p.issue { padding:.5em; border:solid #f00 }
   p.issue::before { content:"Issue: " }
   em.ct { text-transform:lowercase; font-variant:small-caps; font-style:normal }
   dfn { font-weight:bold; font-style:normal }
   code { color:orangered }
   code :link, code :visited { color:inherit }
  </style>
  <link rel="stylesheet" href="http://www.w3.org/StyleSheets/TR/base">
 </head>
 <body>
  <div class="head">
   <p><a href="http://www.w3.org/"><img height="48" width="72" alt="W3C" src="http://www.w3.org/Icons/w3c_home"></a></p>

   <h1 class="head">The <code title="">XMLHttpRequest</code> Object</h1>

   <h2 class="no-num no-toc" id="pagesubtitle">Editors' draft <!--W3C Working Draft--> [DATE: 3 August 2002]</h2>

   <dl>
    <dt>This Version:</dt>

    <dd><a href="[VERSION]">http://www.w3.org/TR/[YEAR]/WD-XMLHttpRequest-[CDATE]/</a></dd>

    <dt>Latest Version:</dt>

    <dd><a href="http://www.w3.org/TR/XMLHttpRequest/">http://www.w3.org/TR/XMLHttpRequest/</a></dd>

    <dt>Previous Versions:</dt>

    <dd><a href="http://www.w3.org/TR/2006/WD-XMLHttpRequest-20060927/">http://www.w3.org/TR/2006/WD-XMLHttpRequest-20060927/</a></dd>

    <dd><a href="http://www.w3.org/TR/2006/WD-XMLHttpRequest-20060619/">http://www.w3.org/TR/2006/WD-XMLHttpRequest-20060619/</a></dd>

    <dd><a href="http://www.w3.org/TR/2006/WD-XMLHttpRequest-20060405/">http://www.w3.org/TR/2006/WD-XMLHttpRequest-20060405/</a></dd>

    <dt>Editor:</dt>

    <dd><a href="http://annevankesteren.nl/">Anne van Kesteren</a>
     (<a href="http://www.opera.com/">Opera Software ASA</a>)
     &lt;<a href="mailto:annevk@opera.com">annevk@opera.com</a>&gt;</dd>
   </dl>

   <p class="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
    ©2006
    <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup>
    (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>,
    <a href="http://www.ercim.org/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>,
    <a href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. W3C
    <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
    <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>
    and
    <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document
    use</a> rules apply.
   </p>
  </div>

  <hr>

  <h2 class="no-num no-toc" id="specabstract">Abstract</h2>

  <p>The <code title="">XMLHttpRequest</code> Object specification defines an
  <abbr title="Application Programming Interface">API</abbr> that provides
  scripted client functionality for transferring data between a client and a
  server.</p>

  <h2 class="no-num no-toc" id="sotd">Status of this Document</h2>

  <p><em>This section describes the status of this document at the time of its
  publication. Other documents may supersede this document. A list of current
  W3C publications and the latest revision of this technical report can be
  found in the <a href="http://www.w3.org/TR/">W3C technical reports index</a>
  at http://www.w3.org/TR/.</em></p>

  <p>This is the [DATE: 3 August 2002] <strong>Last Call</strong> Working
  Draft of The <code title="">XMLHttpRequest</code> Object specifcation. This
  document is produced by the <a href="http://www.w3.org/2006/webapi/">Web API
  Working Group</a>, part of the
  <a href="http://www.w3.org/2006/rwc/Activity">Rich Web Clients Activity</a>
  in the W3C <a href="http://www.w3.org/Interaction/">Interaction
  Domain</a>.</p>

  <p>Please send comments to
  <a href="mailto:public-webapi@w3.org">public-webapi@w3.org</a> with either
  <samp>[XHR]</samp> or <samp title="">[XMLHttpRequest]</samp> at the start of
  the subject line.
  <a href="http://lists.w3.org/Archives/Public/public-webapi/">Archives</a> of
  this list are available.</p>

  <p>Publication as a Working Draft does not imply endorsement by the W3C
  Membership. This is a draft document and may be updated, replaced or
  obsoleted by other documents at any time. It is inappropriate to cite this
  document as other than work in progress.</p>

  <p>This document was produced by a group operating under the
  <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February
  2004 W3C Patent Policy</a>. This document is informative only. W3C maintains
  a
  <a rel="disclosure" href="http://www.w3.org/2004/01/pp-impl/38482/status">public
  list of any patent disclosures</a> made in connection with the deliverables
  of the group; that page also includes instructions for disclosing a patent.
  An individual who has actual knowledge of a patent which the individual
  believes contains
  <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
  Claim(s)</a> must disclose the information in accordance with
  <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
  6 of the W3C Patent Policy</a>.</p>

  <h2 class="no-num no-toc" id="toc">Table of Contents</h2>

  <!--toc-->

  <h2 id="introduction">Introduction</h2>

  <p><em>This section is non-normative.</em></p>

  <p>The <code>XMLHttpRequest</code> object implements an interface exposed by
  a scripting engine that allows scripts to perform HTTP client functionality,
  such as submitting form data or loading data from a server.</p>

  <p>The name of the object is <code>XMLHttpRequest</code> for compatibility
  with the web, though each component of this name is potentially misleading.
  First, the object is data transport agnostic — it supports any data format,
  including XML. Second, it can be used to make requests over both HTTP and
  HTTPS (some implementations support protocols in addition to HTTP and HTTPS,
  but that functionality is not covered by this specification). Finally, it
  supports "requests" in a broad sense of the term as it pertains to HTTP;
  namely all activity involved with HTTP requests or responses for the defined
  HTTP methods.</p>

  <h3 id="examples">Examples of Usage</h3>

  <p><em>This section is non-normative.</em></p>

  <p>Some [<cite><span>ECMAScript</span></cite>] examples
  are listed in the specification. In addition, you can find some below.</p>

  <div class="example">
   <p>Some simple code to do something with data from an XML document fetched
   over the network:</p>

   <pre>function test(data) {
 // taking care of data
}

function handler() {
 if(this.readyState == 4 && this.status == 200) {
  // so far so good
  if(this.responseXML != null && this.responseXML.getElementById('test').firstChild.data)
   // success!
   test(this.responseXML.getElementById('test').firstChild.data);
  else
   test(null);
 } else if (this.readyState == 4 && this.status != 200) {
  // fetched the wrong page or network error...
  test(null);
 }
}

var client = new XMLHttpRequest();
client.onreadystatechange = handler;
client.open("GET", "test.xml");
client.send();</pre>

   <p>If you just want to ping the server with a message you could do something
   like:</p>

   <pre>function ping(message) {
 var client = new XMLHttpRequest();
 client.open("POST", "/ping");
 client.send(message);
}</pre>

   <p>Or if you want to check the status of a document on the server:</p>

   <pre>function fetchStatus(address) {
 var client = new XMLHttpRequest();
 client.onreadystatechange = function() {
  // in case of network errors this might not give reliable results
  if(this.readyState == 4)
   returnStatus(this.status);
 }
 client.open("HEAD", address);
 client.send();
}</pre>
  </div>

  <h3 id="conformance">Conformance</h3>

  <p>Everything in this specification is normative except for diagrams,
  examples, notes and sections marked non-normative.</p>

  <p>The key words <em class="ct">must</em>, <em class="ct">must not</em>,
  <em class="ct">required</em>, <em class="ct">shall</em>, <em class="ct">shall
  not</em>, <em class="ct">should</em>, <em class="ct">should not</em>,
  <em class="ct">recommended</em>, <em class="ct">may</em> and
  <em class="ct">optional</em> in this document are to be interpreted as
  described in RFC 2119 [<cite><span>RFC2119</span></cite>].</p>

  <p>This specification defines the following classes of products:</p>

  <dl>
   <dt><dfn>conforming implementation</dfn></dt>

   <dd>A user agent that implements all interfaces described in this
   specification and follows all <em class="ct">must</em>-,
   <em class="ct">required</em>- and <em class="ct">shall</em>-level of criteria
   in this specification.</dd>

   <dt><dfn>conforming document</dfn></dt>

   <dd>A document that follows all <em class="ct">must</em>-,
   <em class="ct">required</em>- and <em class="ct">shall</em>-level of criteria
   in this specification that apply to document authors.</dd>

   <dt><dfn>conforming authoring tool</dfn></dt>

   <dd>One that produces conforming documents.</dd>
  </dl>

  <h4 id="dependencies">Dependencies</h4>

  <p>This specification relies on several underlying specifications.</p>
  <dl>
   <dt>DOM</dt>

   <dd>
    <p>Implementations <em class="ct">must</em> support some version of DOM
    Events because this specification uses some of the features defined in
    that specification. [<cite><span>DOM3Events</span></cite>]</p>
    
    <p>Implementations <em class="ct">must</em> support some version of DOM
    Core because this specification uses some of the features defined in that
    specification. [<cite><span>DOM3Core</span></cite>]</p>

    <p>Implementations <em class="ct">must</em> support some version of the
    Window Object because some of the functionality in this specification
    relies on it. [<cite><span>Window</span></cite>]</p>
   </dd>

   <dt>HTTP</dt>

   <dd>
    <p>Implementations <em class="ct">must</em> support the <code>http</code>
    scheme defined in HTTP. Other requirements regarding HTTP are made
    throughout the specification
    [<cite><span>RFC2616</span></cite>].</p>
   </dd>
  </dl>

  <h3 id="extensibility">Extensibility</h3>

  <p><em>This section is non-normative.</em></p>

  <p>Extensions of the APIs defined by this specification are <em>strongly
  discouraged</em>. User agents, Working Groups and other interested parties
  should discuss extensions on a relevant public forum, preferably
  <a href="mailto:public-webapi@w3.org">public-webapi@w3.org</a>.</p>

  <h2 id="xmlhttprequest">The <code title="">XMLHttpRequest</code> Object</h2>

  <p>The <code>XMLHttpRequest</code> interface may be used to allow scripts to
  programmatically connect to their originating server via HTTP.</p>

  <p>Objects implementing the <code>XMLHttpRequest</code> interface
  <em class="ct">must</em> also implement the <code>EventTarget</code>
  interface [<cite><span>DOM3Events</span></cite>].</p>

  <p>In [<cite><span>ECMAScript</span></cite>], an instance
  of <code>XMLHttpRequest</code> can be created using the
  <code title="">XMLHttpRequest()</code> constructor:</p>

  <div class="example">
   <pre>var client = new XMLHttpRequest();</pre>
  </div>

  <p>When the constructor is invoked a pointer to the
  <code title="">Window</code> object which initially had
  <code title="">XMLHttpRequest</code> as an attribute of which the
  constructor was invoked <em class="ct">must</em> be stored on the newly
  created object, called the
  <dfn title="Window pointer" id="window-pointer"><code>Window</code>
  pointer</dfn>. This <span title="Window pointer">pointer</span>
  <em class="ct">must</em> persist even if the browsing context in which the
  <code title="">Window</code> is located is destroyed (by removing it from a
  parent browsing context, for instance).</p>

  <p>The term browsing context is defined by the <cite>Window Object
  1.0</cite> specification. [<cite><span>Window</span></cite>]</p>

  <!-- XXX if the document object changes in the browsing context you get an
  exception in some implementations. -->

  <h3 id="xmlhttprequest-members">Members of the
  <code title="">XMLHttpRequest</code> Object</h3>

  <pre class="idl">interface <dfn>XMLHttpRequest</dfn> {
           attribute EventListener   <span>onreadystatechange</span>;
  readonly attribute unsigned short  <span>readyState</span>;
  void               <span>open</span>(in DOMString <var>method</var>, in DOMString <var>url</var>);
  void               <span>open</span>(in DOMString <var>method</var>, in DOMString <var>url</var>, in boolean <var>async</var>);
  void               <span>open</span>(in DOMString <var>method</var>, in DOMString <var>url</var>, in boolean <var>async</var>, in DOMString <var>user</var>);
  void               <span>open</span>(in DOMString <var>method</var>, in DOMString <var>url</var>, in boolean <var>async</var>, in DOMString <var>user</var>, in DOMString <var>password</var>);
  void               <span>setRequestHeader</span>(in DOMString <var>header</var>, in DOMString <var>value</var>);
  void               <span>send</span>();
  void               <span>send</span>(in DOMString <var>data</var>);
  void               <span>send</span>(in Document <var>data</var>);
  void               <span>abort</span>();
  DOMString          <span>getAllResponseHeaders</span>();
  DOMString          <span>getResponseHeader</span>(in DOMString <var>header</var>);
  readonly attribute DOMString       <span>responseText</span>;
  readonly attribute Document        <span>responseXML</span>;
  readonly attribute unsigned short  <span>status</span>;
  readonly attribute DOMString       <span>statusText</span>;
};</pre>

  <dl>

   <dt><dfn id="dfn-onreadystatechange"><code>onreadystatechange</code></dfn> of
   type <code>EventListener</code></dt>

   <dd>
    <p>An attribute that takes an <code>EventListener</code> as value that
    <em class="ct">must</em> be invoked when <code>readystatechange</code> is
    dispatched on the object implementing the <code>XMLHttpRequest</code>
    interface. Its initial value <em class="ct">must</em> be
    <code>null</code>.</p>
   </dd>

   <dt><dfn id="dfn-readystate"><code>readyState</code></dfn> of type
   <code>unsigned short</code>, readonly</dt>

   <dd>
    <p>The state of the object. The attribute <em class="ct">must</em> be one of
    the following values:</p>

    <dl>
     <dt><dfn title="uninitialized state">0 Uninitialized</dfn></dt>

     <dd>The initial value.</dd>

     <dt><dfn title="open state">1 Open</dfn></dt>

     <dd>The <code>open()</code> method has been successfully called.</dd>

     <dt><dfn title="sent state">2 Sent</dfn></dt>

     <dd>The user agent successfully acknowledged the request.</dd>

     <dt><dfn title="receiving state">3 Receiving</dfn></dt>

     <dd>Immediately before receiving the message body (if any). All HTTP
     headers have been received.</dd>

     <dt><dfn title="loaded state">4 Loaded</dfn></dt>

     <dd>The data transfer has been completed.</dd>
    </dl>

    <p class="note">When <code>readyState</code> changes value a
    <code>readystatechange</code> event is to be dispatched on the
    <code>XMLHttpRequest</code> object.</p>
   </dd>

   <dt><dfn id="dfn-open" title="open"><code>open(<var>method</var>,
   <var>url</var>, <var>async</var>, <var>user</var>,
   <var>password</var>)</code></dfn>, method</dt>

   <dd>
    <p>Invoking this method <em class="ct">must</em> initialize the object by
    remembering the <var>method</var>, <var>url</var>, <var>async</var>
    (defaulting to <code>true</code> if omitted), <var>user</var> (defaulting to
    <code>null</code> if omitted), and <var>password</var> (defaulting to
    <code>null</code> if omitted) arguments, setting the state to
    <span title="open state">open</span>, resetting the
    <code>responseText</code>, <code>responseXML</code>, <code>status</code>,
    and <code>statusText</code> attributes to their initial values, and
    resetting the list of request headers.</p>

    <p>In addition, when the state is not
    <span title="uninitialized state">uninitialized</span>, all members of the
    object with the exception of <code>onreadystate</code>
    <em class="ct">must</em> be set to their initial values and user agents
    <em class="ct">must</em> behave as if <code>abort()</code> was invoked.</p>

    <p>If the <var>method</var> argument doesn't match the <dfn>method
    production</dfn> defined in section 5.1.1 of RFC 2616 a
    <code>SYNTAX_ERR</code>
    <em class="ct">must</em> be raised by the user agent. If the user agent
    doesn't support the given method for security reasons a
    <code>SECURITY_ERR</code> <em class="ct">should</em> be raised.
    [<cite><span>RFC2616</span></cite>]</p>

    <p>User agents <em class="ct">must</em> at least support the following list
    of methods (see [<cite><span>RFC2616</span></cite>]):</p>

    <ul>
     <li><code>GET</code></li>
     <li><code>POST</code></li>
     <li><code>HEAD</code></li>
     <li><code>PUT</code></li>
     <li><code>DELETE</code></li>
    </ul>

    <p>User agents <em class="ct">should</em> support any <var>method</var>
    argument that matches the <span>method production</span>.</p>

    <p>When <var>method</var> case-insensitively matches <code>GET</code>,
    <code>POST</code>, <code>HEAD</code>, <code>PUT</code> or
    <code>DELETE</code> user agents <em class="ct">must</em> use the
    uppercase equivalent instead.</p>

    <p>When <var>url</var> is a relative reference, it
    <em class="ct">must</em> be resolved using the current value of the
    <code>baseURI</code> attribute of the <code>Document</code> object
    currently associated with the <span><code>Window</code> pointer</span> and
    the fragment identifier component, if any, <em class="ct">must</em> be
    dropped. If it can't be resolved user agents <em class="ct">must</em>
    throw a <code>SYNTAX_ERR</code>. When a non same-origin <var>url</var>
    argument is given user agents <em class="ct">should</em> throw a
    <code>SECURITY_ERR</code> exception.</p>

    <p class="note">A future version or extension of this specification will
    most likely define a way of doing cross-site requests.</p>

    <p>User agents <em class="ct">should not</em> support the
    <code>"user:password"</code> format in the <code>userinfo</code>
    production defined in section 3.2.1 of RFC 3986 and
    <em class="ct">must</em> throw a <code>SYNTAX_ERR</code> when doing so
    (not supporting it). When they do support it, or in case of people using
    the format "user", user agents <em class="ct">must</em> use them if the
    <var>user</var> and <var>password</var> arguments are omitted. If the
    arguments are not omitted, they take precedence, even if they are
    <code>null</code>. [<cite><span>RFC3986</span></cite>]</p>

    <p>The syntax for the <var>user</var> or <var>password</var> arguments
    depends on the scheme being used. If the syntax for either is incorrect
    user agents <em class="ct">must</em> throw a <code>SYNTAX_ERR</code>
    exception.</p>

    <p class="note">The relevant specification for the scheme will provide the
    exact production for <var>user</var> and <var>password</var> to match.</p>
    <!-- RFC2617 does in fact not do this for "password" ... -->

    <p>When <code>null</code> is passed for either <var>user</var> or
    <var>password</var> user agents <em class="ct">must</em> act as if the
    relevant data (the user name or password) is not provided.</p>

    <p class="note">The empty string value is not to be treated as the
    <code>null</code> value. If it's disallowed by the syntax for either
    <var>user</var> or <var>password</var> a <code>SYNTAX_ERR</code> has to be
    thrown as indicated above.</p>
   </dd>

   <dt><dfn id="dfn-setrequestheader" title="setrequestheader"><code>setRequestHeader(<var>header</var>,
   <var>value</var>)</code></dfn>, method</dt>

   <dd>
    <p>The nominated request header (<var>header</var>) field value
    <em class="ct">must</em> be set to <var>value</var>, with the following
    exceptions:</p>

    <ul>
     <li>If the state is not <span title="open state">open</span> or the
     <span><code>send()</code> flag</span> is set an
     <code>INVALID_STATE_ERR</code> exception <em class="ct">must</em> be
     raised;</li>

     <li>If the <var>header</var> argument doesn't match the
     <dfn><code>field-name</code> production</dfn> as defined by section 4.2
     of [<cite><span>RFC2616</span></cite>] a
     <code>SYNTAX_ERR</code> <em class="ct">must</em> be raised;</li>

     <li>If the <var>value</var> argument doesn't match the
     <dfn><code>field-value</code> production</dfn> as defined by section 4.2
     of [<cite><span>RFC2616</span></cite>] a
     <code>SYNTAX_ERR</code> <em class="ct">must</em> be raised;</li>

     <li>
      <p>For security reasons the invocation <em class="ct">should</em> be
      ignored if the <var>header</var> argument matches one of the following
      headers case-insensitively:</p>
      <ul>
       <li><code>Accept-Charset</code></li>
       <li><code>Accept-Encoding</code></li>
       <li><code>Content-Length</code></li>
       <li><code>Expect</code></li>
       <li><code>Date</code></li>
       <li><code>Host</code></li>
       <li><code>Keep-Alive</code></li>
       <li><code>Referer</code></li>
       <li><code>TE</code></li>
       <li><code>Trailer</code></li>
       <li><code>Transfer-Encoding</code></li>
       <li><code>Upgrade</code></li>
      </ul>
      <!-- XXX or should this throw an exception? -->
     </li>
    </ul>

    <!-- Add "Expect" back in below if we remove it above. -->
    <p>Implementations <em class="ct">must</em> replace any existing value if
    the nominated request header field value is one of:</p>

    <ul>
     <li><code>Authorization</code></li>
     <li><code>Content-Base</code></li>
     <li><code>Content-Location</code></li>
     <li><code>Content-MD5</code></li>
     <li><code>Content-Range</code></li>
     <li><code>Content-Type</code></li>
     <li><code>Content-Version</code></li>
     <li><code>Delta-Base</code></li>
     <li><code>Depth</code></li>
     <li><code>Destination</code></li>
     <li><code>ETag</code></li>
     <li><code>From</code></li>
     <li><code>If-Modified-Since</code></li>
     <li><code>If-Range</code></li>
     <li><code>If-Unmodified-Since</code></li>
     <li><code>Max-Forwards</code></li>
     <li><code>MIME-Version</code></li>
     <li><code>Overwrite</code></li>
     <li><code>Proxy-Authorization</code></li>
     <li><code>SOAPAction</code></li>
     <li><code>Timeout</code></li>
    </ul>

    <p>Otherwise, if the nominated request header field already has a value,
    the new value <em class="ct">must</em> be combined with the existing value
    (section 4.2, [<cite><span>RFC2616</span></cite>]). See also the
    <code>send()</code> method regarding user agent header handling for
    caching, authentication, proxies, and cookies.</p>

    <div class="example">
     <pre>// The following script:
var client = new XMLHttpRequest();
client.open('GET', 'demo.cgi');
client.setRequestHeader('X-Test', 'one');
client.setRequestHeader('X-Test', 'two');
client.send();

// ...would result in the following header being sent:
...
X-Test: one, two
...</pre>
    </div>

    <p>The list of request headers <em class="ct">must</em> be reset when the
    <code>open()</code> method is invoked.</p>
   </dd>

   <dt><dfn id="dfn-send" title="send"><code>send(<var>data</var>)</code></dfn>,
   method</dt>

   <dd>
    <p>If the state is not <span title="open state">open</span> or the
    <span><code>send()</code> flag</code> is set an
    <code>INVALID_STATE_ERR</code> exception <em class="ct">must</em> be raised.
    Otherwise user agents <em class="ct">must</em> make a request to
    <var>url</var> using method <var>method</var> and set the
    <dfn><code>send()</code> flag</dfn>. If the <var>async</var> flag is set to
    <code>false</code>, then the method <em class="ct">must not</em> return
    until the request has completed. Otherwise, it <em class="ct">must</em>
    return immediately. (See: <code>open()</code>.)</p>

    <p class="note">Even when <var>async</var> is set to <code>false</code> the
    <code>readystatechange</code> event will still be dispatched.</p>

    <p class="note">The <span><code>send()</code> flag</span> is only relevant
    when the state is <span title="open state">open</span>.</p>

    <p>If <var>data</var> is passed to the <code>send()</code> method it
    <em class="ct">must</em> be used for the <dfn id="dfn-entity-body">entity
    body</dfn> as defined by section 7.2.1 of
    [<cite><span>RFC2616</span></cite>]). The following rules
    apply:</p>

    <dl>
     <dt><var>data</var> is a <code>DOMString</code></dt>

     <dd><var>data</var> <em class="ct">must</em> be encoded as UTF-8 for
     transmission.</dd>

     <dt><var>data</var> is a <code>Document</code>

     <dd><var>data</var> <em class="ct">must</em> be serialized into a namespace
     well-formed XML document and encoded using the encoding given by
     <code><var>data</var>.xmlEncoding</code> (the XML declaration), if
     specified, or UTF-8 otherwise. The serialization <em class="ct">must</em>
     include an XML declaration when the final encoding is not UTF-8 or
     UTF-16.</dd>

     <dt><var>data</var> is not a <code>DOMString</code> or
     <code>Document</code></dt>

     <dd>The stringification mechanisms of the host language
     <em class="ct">must</em> be used on <var>data</var> and the result
     <em class="ct">must</em> be treated as if <var>data</var> is a
     <code>DOMString</code>.</dd>
    </dl>

    <p>Invoking <code>send()</code> without the <var>data</var> argument
    <em class="ct">must</em> give the same result as if it was invoked with
    <code>null</code> as argument.</p>

    <p>Authors <em class="ct">should</em> specify the <code>Content-Type</code>
    header via <code>setRequestHeader</code> before invoking
    <code>send()</code> with an argument. If the argument to
    <code>send()</code> is a <code>Document</code> and no
    <code>Content-Type</code> header has been set user agents
    <em class="ct">must</em> set it to <code>application/xml</code> for XML
    documents and to the most appropriate media type for other documents (using
    intrinsic knowledge about the document).</p>

    <p>If the response is an HTTP redirect (status code <code>301</code>,
    <code>302</code>, <code>303</code> or <code>307</code>), then it
    <em class="ct">must</em> be transparently followed (unless it violates
    security, infinite loop precautions or the scheme isn't supported). Note
    that HTTP ([<cite><span>RFC2616</span></cite>]) places
    requirements on user agents regarding the preservation of the request
    method during redirects, and also requires users to be notified of certain
    kinds of automatic redirections.</p>

    <p>Once the request has been successfully acknowledged the state
    <em class="ct">must</em> be set to <span title="sent state">sent</span>.
    Immediately before receiving the message body (if any), the state
    <em class="ct">must</em> be set to to
    <span title="receiving state">receiving</span>. When the request has
    completed loading, the state <em class="ct">must</em> be set to
    <span title="loaded state">loaded</span>.</p>

    <p class="note">This means that in case of a <code>HEAD</code> request the
    state is set to <span title="loaded state">loaded</span> immediately after
    having being set to <span title="receiving state">receiving</span>.</p>

    <p>If something goes wrong (infinite loop, network errors) the state
    <em class="ct">must</em> be set to <span title="loaded state">loaded</span>
    and all members (excluding <code>readyState</code>) of the object
    <em class="ct">must</em> be set to their initial value. Also, if
    <code>async</code> is set to <code>false</code>, a
    <code>NETWORK_ERR</code> exception <em class="ct">must</em> be raised. In
    addition, all registered event listeners <em class="ct">must</em> be
    removed.</p>

    <p class="note">In future versions of this specification user agents will be
    required to dispatch an <code>error</code> event if the above occurs.</p>

    <p>If the user agent allows the specification of a proxy it
    <em class="ct">should</em> modify the request appropriately;
    <abbr title="in other words">i.e.</abbr>, connect to the proxy host instead
    of the origin server, modify the <code>Request-Line</code> and send
    <code>Proxy-Authorization</code> headers as specified.</p>

    <p>If the user agent supports <cite>HTTP Authentication</cite>
    ([<cite><span>RFC2617</span></cite>]) it
    <em class="ct">should</em> consider requests originating from this object
    to be part of the protection space that includes the accessed URIs and send
    <code>Authorization</code> headers and handle <code>401 Unauthorised</code>
    requests appropriately. if authentication fails, user agents
    <em class="ct">should</em> prompt the users for credentials.</p>

    <p>If the user agent supports <cite>HTTP State Mangement</cite>
    ([<cite><span>RFC2109</span></cite>],
    [<cite><span>RFC2965</span></cite>]) it
    <em class="ct">should</em> persist, discard and send cookies (as received in
    the <code>Set-Cookie</code> and <code>Set-Cookie2</code> response headers,
    and sent in the <code>Cookie</code> header) as applicable.</p>

    <p>If the user agent implements a HTTP cache
    ([<cite><span>RFC2616</span></cite>]) it
    <em class="ct">should</em> respect <code>Cache-Control</code> request
    headers set by the author (<abbr title="for example">e.g.</abbr>,
    <code>Cache-Control: no-cache</code> bypasses the cache). It
    <em class="ct">must not</em> send <code>Cache-Control</code> or
    <code>Pragma</code> request headers automatically unless the user explicitly
    requests such behaviour (e.g., by (force-)reloading the page). <code>304 Not
    Modified</code> responses that are a result of a user agent generated
    conditional request <em class="ct">must</em> be presented as <code>200
    OK</code> responses with the appropriate content. Such user agents
    <em class="ct">must</em> allow authors to override automatic cache
    validation by setting request headers (e.g., <code>If-None-Match</code>,
    <code>If-Modified-Since</code>), in which case <code>304 Not Modified</code>
    responses <em class="ct">must</em> be passed through.</p>

    <p>If the user agent implements server-driven content-negotiation
    ([<cite><span>RFC2616</span></cite>]) it
    <em class="ct">should</em> set <code>Accept-Language</code>,
    <code>Accept-Encoding</code> and <code>Accept-Charset</code> headers as
    appropriate; it <em class="ct">must not</em> automatically set the
    <code>Accept</code> header. Responses to such requests
    <em class="ct">must</em> have content-codings automatically removed.</p>

    <p>If the user agent supports Expect/Continue for request bodies
    ([<cite><span>RFC2616</span></cite>]) it
    <em class="ct">should</em> insert <code>Expect</code> headers and handle
    <code>100 Continue</code> responses appropriately.</p>
   </dd>

   <dt><dfn id="dfn-abort"><code>abort()</code></dfn>, method</dt>

   <dd>
    <p>When invoked, this method <em class="ct">must</em> cancel any network
    activity for which the object is responsible and set all the members of the
    object to their initial values as well as removing all event listeners.</p>

    <p class="note">This means that the object <em>can</em> be used for another
    request in which case this method will work again to cancel it.</p>
   </dd>

   <dt><dfn id="dfn-getallresponseheaders"><code>getAllResponseHeaders()</code></dfn>,
   method</dt>

   <dd>
    <p>If the state is not <span title="receiving state">receiving</span> or
    <span title="loaded state">loaded</span>, user agents
    <em class="ct">must</em> raise an <code>INVALID_STATE_ERR</code> exception.
    Otherwise, it <em class="ct">must</em> return all the HTTP headers, as a
    single string, with each header line separated by a CR (U+000D) LF (U+000A)
    pair. The status line <em class="ct">must not</em> be included.</p>

    <div class="example">
     <pre>// The following script:
var client = new XMLHttpRequest();
client.open("GET", "test.txt", true);
client.send();
client.onreadystatechange = function() {
 if(this.readyState == 3) {
  print(this.getAllResponseHeaders());
 }
}

// ...should output something similar to the following text:
Date: Sun, 24 Oct 2004 04:58:38 GMT
Server: Apache/1.3.31 (Unix)
Keep-Alive: timeout=15, max=99
Connection: Keep-Alive
Transfer-Encoding: chunked
Content-Type: text/plain; charset=utf-8</pre>
    </div>
   </dd>

   <dt><dfn id="dfn-getresponseheader" title="getresponseheader"><code>getResponseHeader(<var>header</var>)</code></dfn>,
   method</dt>

   <dd>
    <p>If the <var>header</var> argument doesn't match the
    <span><code>field-name</code> production</span> a <code>SYNTAX_ERR</code>
    <em class="ct">must</em> be raised. Otherwise this method works as described
    below.</p>

    <p>If the state is not <span title="receiving state">receiving</span> or
    <span title="loaded state">loaded</span>, the user agent
    <em class="ct">must</em> raise an <code>INVALID_STATE_ERR</code> exception.
    Otherwise, it <em class="ct">must</em> represent the value of the given HTTP
    header (<var>header</var>) in the data received so far for the last request
    sent, as a single string. If more than one header of the given name was
    received, then the values <em class="ct">must</em> be concatenated,
    separated from each other by an U+002C COMMA followed by an U+0020 SPACE. If
    no headers of that name were received, then it <em class="ct">must</em>
    return <code>null</code>. Header names <em class="ct">must</em> be compared
    case-insensitively to the method its argument (<var>header</var>).</p>

    <div class="example">
     <pre>// The following script:
var client = new XMLHttpRequest();
client.open("GET", "test.txt", true);
client.send();
client.onreadystatechange = function() {
 if(this.readyState == 3) {
  print(client.getResponseHeader("Content-Type"));
 }
}

// ...should output something similar to the following text:
Content-Type: text/plain; charset=utf-8</pre>
    </div>
   </dd>

   <dt><dfn id="dfn-responsetext"><code>responseText</code></dfn> of type
   <code>DOMString</code>, readonly</dt>

   <dd>
    <p>If the state is not <span title="receiving state">receiving</span> or
    <span title="loaded state">loaded</span>, the user agent
    <em class="ct">must</em> raise an <code>INVALID_STATE_ERR</code> exception.
    Otherwise, it <em class="ct">must</em> be the fragment of the <span>entity
    body</span> received so far (when the state is
    <span title="receiving state">receiving</span>) or the complete <span>entity
    body</span> (when the state is <span title="loaded state">loaded</span>),
    interpreted as a stream of characters.</p>

    <p>If the response includes a <code>Content-Type</code> understood by the
    user agent the characters are encoded following the relevant media type
    specification, with the exception that the rule in the final paragraph of
    section 3.7.1 of [<cite><span>RFC2616</span></cite>], and the
    rules in section 4.1.2 of [<cite><span>RFC2046</span></cite>]
    <em class="ct">must</em> be treated as if they specified the default
    character encoding as being UTF-8. Invalid bytes <em class="ct">must</em> be
    converted to U+FFFD REPLACEMENT CHARACTER. If the user agent can't derive a
    character stream in accord with the media type specification,
    <code>reponseText</code> <em class="ct">must</em> be <code>null</code>.</p>

    <p>Its initial value <em class="ct">must</em> be the <code>null</code>.</p>

    <p class="note">For <code>HEAD</code> requests this attribute will always
    be <code>null</code> (it remains unchanged). Similar to the
    <code>responseXML</code> attribute.</p>
   </dd>

   <dt><dfn id="dfn-responsexml"><code>responseXML</code></dfn> of type
   <code>Document</code>, readonly</dt>

   <dd>
    <p>If the state is not <span title="loaded state">loaded</span>, user agents
    <em class="ct">must</em> raise an <code>INVALID_STATE_ERR</code> exception.
    Otherwise, if the <code>Content-Type</code> header contains a media type
    (ignoring any parameters) that is either <code>text/xml</code>,
    <code>application/xml</code>, or ends in <code>+xml</code>, it
    <em class="ct">must</em> be an object that implements the
    <code>Document</code> interface representing the parsed document. If
    <code>Content-Type</code> did not contain such a media type, or if the
    document could not be parsed (due to an XML well-formedness error or
    unsupported character encoding, for instance), it <em class="ct">must</em>
    be <code>null</code>.</p>

    <p>Its initial value <em class="ct">must</em> be <code>null</code>.</p>
   </dd>

   <dt><dfn id="dfn-status"><code>status</code></dfn> of type <code>unsigned
   short</code>, readonly</dt>

   <dd>
    <p>If the <code>status</code> attribute is not available an
    <code>INVALID_STATE_ERR</code> exception <em class="ct">must</em> be raised.
    It <em class="ct">must</em> be available when the state is
    <span title="receiving state">receiving</span> or
    <span title="loaded state">loaded</span>. When available, it
    <em class="ct">must</em> represent the HTTP status code (typically
    <code>200</code> for a successful connection).</p>

    <p>Its initial value <em class="ct">must</em> be <code>0</code>.</p>
   </dd>

   <dt><dfn id="dfn-statustext"><code>statusText</code></dfn> of type
   <code>DOMString</code>, readonly</dt>

   <dd>
    <p>If the <code>statusText</code> attribute is not available an
    <code>INVALID_STATE_ERR</code> exception <em class="ct">must</em> be raised.
    It <em class="ct">must</em> be available when the state is
    <span title="receiving state">receiving</span> or
    <span title="loaded state">loaded</span>). When available, it
    <em class="ct">must</em> represent the HTTP status text sent by the server
    (appears after the status code).</p>

    <p>Its initial value <em class="ct">must</em> be the empty string.</p>
   </dd>
  </dl>

  <p>HTTP requests sent from multiple different <code>XMLHttpRequest</code>
  objects in succession <em class="ct">should</em> be pipelined into shared HTTP
  connections.</p>

  <h3 id="events">Events for the <code title="">XMLHttpRequest</code>
  Object</h3>

  <p>These sections describe the various events that can be dispatched on the
  object implementing the <code>XMLHttpRequest</code> interface. For this
  version of the specification only one event is defined.</p>

  <dl>
   <dt><dfn id="dfn-readystatechange"><code>readystatechange</code></dfn></dt>

   <dd>The <code>readystatechange</code> event <em class="ct">must</em> be
   dispatched when <code>readyState</code> changes value. It <em class="ct">must
   not</em> bubble, <em class="ct">must not</em> be cancelable and
   <em class="ct">must</em> implement the <code>Event</code> interface
   [<cite><span>DOM3Events</span></cite>]. The event has no namespace
   (<code>Event.namespaceURI</code> is <code>null</code>).</dd>
  </dl>

  <h3 id="exceptions">Exceptions for the <code title="">XMLHttpRequest</code>
  Object</h3>

  <pre class="idl">exception <dfn>XMLHttpRequestException</dfn> {
  unsigned short     code;
};
const unsigned short <span>NETWORK_ERR</span> = 101;</pre>

  <p>The <dfn id="network-err"><code>NETWORK_ERR</code></dfn> exception is
  thrown when a network error occurs in synchronous requests. See the section
  on <code>send()</code> for more details.</p>
  <!-- Other specifications should probably be able to reuse this... -->

  <h2 class="no-num" id="notcovered">Not in this Specification</h2>

  <p><em>This section is non normative.</em></p>

  <p>This specification does not include the following features that may or may
  not be implemented by user agents:</p>

  <ul>
   <li><code>load</code> event and <code>onload</code> attribute;</li>
   <li><code>error</code> event and <code>onerror</code> attribute;</li>
   <li><code>progress</code> event and <code>onprogress</code> attribute;</li>
   <li><code title="">abort</code> event and <code>onabort</code> attribute;</li>
   <li>Timers have been suggested, perhaps an <code>ontimeout</code>
    attribute;</li>
   <li>Property to disable following redirects;</li>
   <li><code title="">responseXML</code> for <code>text/html</code>
   documents;</li>
   <li>Cross-site <code title="">XMLHttpRequest</code>.</li>
  </ul>

  <h2 class="no-num" id="bibref">References</h2>

  <dl>
   <dt>[<dfn id="DOM3">DOM3Core</dfn>]</dt>

   <dd><cite><a href="http://www.w3.org/TR/DOM-Level-3-Core">Document Object
    Model (DOM) Level 3 Core Specification</a></cite>, A. Le Hors, P. Le
    Hégaret, L. Wood, G. Nicol, J. Robie, M. Champion, S. Byrne, editors.
    World Wide Web Consortium, April 2004.</dd>

   <dt>[<dfn id="DOM3EV">DOM3Events</dfn>]</dt>

   <dd><cite><a href="http://www.w3.org/TR/DOM-Level-3-Events/">Document Object
    Model (DOM) Level 3 Events Specification</a></cite>, Björn Höhrmann, editor.
    World Wide Web Consortium, April 2006.</dd>

   <dt>[<dfn id="ref-ecmascript">ECMAScript</dfn>]</dt>

   <dd><cite><a href="http://www.ecma-international.org/publications/standards/Ecma-262.htm">ECMAScript
    Language Specification</a></cite>, Third Edition. ECMA, December 1999.</dd>

   <dt>[<dfn id="ref-rfc2046">RFC2046</dfn>]</dt>

   <dd><cite><a href="http://ietf.org/rfc/rfc2046">Multipurpose Internet Mail
    Extensions (MIME) Part Two: Media Types</a></cite>, N. Freed, N. Borenstein,
    editors. IETF, November 1996.</dd>

   <dt>[<dfn id="ref-rfc2109">RFC2109</dfn>]</dt>

   <dd><cite><a href="http://ietf.org/rfc/rfc2109">HTTP State Management
    Mechanism</a></cite>, D. Kristol, L. Montulli, editors. IETF, February
    1997.</dd>

   <dt>[<dfn id="RFC2119">RFC2119</dfn>]</dt>

   <dd><cite><a href="http://ietf.org/rfc/rfc2119">RFC 2119: Key words
    for use in RFCs to Indicate Requirement Levels</a></cite>, S. Bradner.
    IETF, March 1997.</dd>

   <dt>[<dfn id="RFC2616">RFC2616</dfn>]</dt>

   <dd><cite><a href="http://ietf.org/rfc/rfc2616">Hypertext Transfer Protocol
    -- HTTP/1.1</a></cite>, R. Fielding, J. Gettys, J. Mogul, H. Frystyk, L.
    Masinter, P. Leach, T. Berners-Lee, editors. IETF, June 1999</dd>

   <dt>[<dfn id="ref-rfc2617">RFC2617</dfn>]</dt>

   <dd><cite><a href="http://ietf.org/rfc/rfc2617">HTTP Authentication: Basic
    and Digest Access Authentication</a></cite>, ...</dd>

   <dt>[<dfn id="ref-rfc2965">RFC2965</dfn>]</dt>

   <dd><cite><a href="http://ietf.org/rfc/rfc2965">HTTP State Management
    Mechanism</a></cite>, D. Kristol, L. Montulli, editors. IETF, October
    2000.</dd>

   <dt>[<dfn id="ref-rfc3986">RFC3986</dfn>]</dt>

   <dd><cite><a href="http://ietf.org/rfc/rfc3986">Uniform Resource Identifier
    (URI): Generic Syntax</a></cite>, T. Berners-Lee, R. Fielding, L. Masinter,
    editors. IETF, January 2005.</dd>

    <dt>[<dfn id="ref-window">Window</dfn>]</dt>

    <dd><cite><a href="http://www.w3.org/TR/Window/">Window Object
    1.0</a></cite>, I. Davis, M. Stachowiak, editors. W3C, April 2006.</dd>
  </dl>

  <h2 class="no-num" id="acknowledgements">Acknowledgements</h2>

  <p><em>This section is non-normative</em></p>

  <p>The editor would like to thank to the following people who have contributed
  to this specification (ordered by first name):</p>

  <ul>
   <li>Alex Hopmann</li>
   <li>Alex Vincent</li>
   <li>Alexey Proskuryakov</li>
   <li>Asbjørn Ulsberg</li>
   <li>Boris Zbarsky</li>
   <li>Björn Höhrmann</li>
   <li>Cameron McCormack</li>
   <li>Christophe Jolif</li>
   <li>Charles McCathieNevile</li>
   <li>Dean Jackson</li>
   <li>Doug Schepers</li>
   <li>Douglas Livingstone</li>
   <li>Gorm Haug Eriksen</li>
   <li>Hallvord R. M. Steen</li>
   <li>Håkon Wium Lie</li>
   <li>Ian Davis</li>
   <li>Ian Hickson</li>
   <li>Ivan Herman</li>
   <li>Jens Lindström</li>
   <li>Jim Deegan</li>
   <li>Jim Ley</li>
   <li>Jonas Sicking</li>
   <li>Julian Reschke</li>
   <li>Karl Dubost</li>
   <li>Maciej Stachowiak</li>
   <li>Magnus Kristiansen</li>
   <li>Marc Hadley</li>
   <li>Mark Nottingham</li>
   <li>Pawel Glowacki</li>
   <li>Q42</li>
   <li>Robin Berjon</li>
   <li>Ruud Steltenpool</li>
   <li>Simon Pieters</li>
  </ul>

  <p>Special thanks to the Microsoft employees who first implemented the
  <code>XMLHttpRequest</code> interface, which was first widely deployed by the
  Windows Internet Explorer browser.</p>

  <p>Special thanks also to the WHATWG for drafing a first version of this
  specification in their Web Applications 1.0 document.</p>

  <p>Thanks also to all those who have helped to improve this specification by
  sending suggestions and corrections. (Please, keep bugging us with your
  issues!)</p>

 </body>
</html>
