<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
          ******* WARNING *********************************************************
          This document was automatically generated using the Re-Spec specification
          publishing system. Edits made here will be lost when it is regenerated
          and chances are high that the editor will do something quite unpleasant
          to you should that happen.
          ******* WARNING *********************************************************
        --><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Feature Permissions</title><link rel="stylesheet" href="respec-w3c.css" type="text/css"></link><link rel="stylesheet" href="http://www.w3.org/StyleSheets/TR/base" type="text/css"></link><meta name="revision" content="$Id: FeaturePermissions.html,v 1.1 2010-10-13 07:43:04 jgregg Exp $"></meta></head><body><div class="head"><p><a href="http://www.w3.org/"><img src="http://www.w3.org/Icons/w3c_home" width="72" height="48" alt="W3C"></img></a></p><h1 class="head">Feature Permissions</h1><h2 id="pagesubtitle">W3C Editor's Draft <em>12 October 2010</em></h2><dl><dt>Editor:</dt><dd><span class="person">John Gregg (<a href="http://www.google.com/">Google</a>) &lt;<a href="mailto:johnnyg@google.com">johnnyg@google.com</a>&gt;</span></dd></dl><p class="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> ©2006
        <a href="http://www.w3.org/"><acronym title="World Wide Web Consortium">W3C</acronym></a><sup>®</sup>
        (<a href="http://www.csail.mit.edu/"><acronym title="Massachusetts Institute of Technology">MIT</acronym></a>,
        <a href="http://www.ercim.org/"><acronym title="European Research Consortium for Informatics and Mathematics">ERCIM</acronym></a>,
        <a href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. W3C
        <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
        <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and 
        <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document  use</a> rules apply.
      </p></div><hr></hr>

  

  <h2 id="specabstract">Abstract</h2><div class="section">
    
    <p>
      This document defines APIs for web pages to request permission to use
      privileged user agent features.
    </p>
    
  </div>

  <div class="section"><h2 id="sotd">Status of this Document</h2>
    
    <p>
      This document is an Editor's Draft and is not suitable for purposes other
      than reviewing the specification being developed.
    </p>
  </div>

  <div class="section"><h2 id="contents">Table of Contents</h2>
    

    <ul class="toc"><li><a href="#definitions">1. Definitions</a></li><li><a href="#introduction">2. Introduction</a></li><li><a href="#idl-Permissions">3. The Permissions interface</a></li><li><a href="#">4. Default permission levels</a></li><li><a href="#">5. References</a></li></ul>
  </div>

  <div class="section"><h2 id="definitions">1. Definitions</h2>
    

    <ul>
      <li><em>feature id</em>: A string which uniquely identifies a privileged feature.</li>
      <li><em>privileged feature</em>: A feature of a user agent which requires the user's permission before web pages can use it.
      Examples of privileged features may include desktop notifications, geolocation, file system access, etc.</li>
      <li><em>origin</em>: In this document, "origin" or "security origin" refers to an origin as used by Cross-Origin Resource Sharing. [<cite><a href="#CORS" class="bibref">CORS</a></cite>]</li>
      <li><em>user gesture</em>: A script event is considered a user gesture if it directly resulted from the user using an input device, and the event
	is generated by the user agent, not a script. For example, the <code>onclick</code> event on an A element and the <code>onkeypress</code> event on
	an INPUT element are user gestures.  Scripts run by a timeout, or for example an <code>onload</code> event are not user gestures.</li>
    </ul>
  </div>

  <div class="section"><h2 id="introduction">2. Introduction</h2><p><strong>This section is not normative.</strong></p>
    
    <p>
      This specification provides an generic API for user agents which offer privileged
      features to web pages in order to manage permissions in a consistent manner.
    </p>
    <p>
      The purpose of the specification is to allow users to grant permission
      to use individual privileged features to only the web pages which the user selects.
    </p>
    <p>
      Permissions are granted and denied on a per-origin basis.
    </p>
  </div>

  <div class="section"><h2 id="idl-Permissions">3. The Permissions interface</h2>
    
    <p>
      The Permissions interface provides 3 pieces of functionality, which are added to the <code>Navigator</code> object.
      <ul>
	<li>
	  Identify the privileged features available in the user agent, using the <code>privilegedFeatures</code> array.
	  Each feature has a unique string identifier in the array.
	</li>
	<li>
	  Check the current permissions level of each feature for the current security origin, using the 
	  <code>permissionLevel</code> method.
	</li>
	<li>
	  Request the user's permission to use a feature, using the <code>requestPermission</code> method, and 
	  receive an asynchronous callback when the user has made a decision.
	</li>
      </ul>
    </p>
      
    <div class="boxed"><p><span class="idlTitle">Permissions</span></p><pre class="schema" title="Permissions">interface <a href="#idl-if-Permissions">Permissions</a> {
  // permission values
  const long      <a href="#idl-defs-permission values-USER_ALLOWED">USER_ALLOWED</a>         = 2;
  const long      <a href="#idl-defs-permission values-DEFAULT_ALLOWED">DEFAULT_ALLOWED</a>      = 1;
  const long      <a href="#idl-defs-permission values-DEFAULT_DENIED">DEFAULT_DENIED</a>       = -1;
  const long      <a href="#idl-defs-permission values-USER_DENIED">USER_DENIED</a>          = -2;

  long               <a href="#dfn-permissionlevel">permissionLevel</a>(in String feature)
                                        raises(Exception);
  void               <a href="#dfn-requestpermission">requestPermission</a>(in String feature, in Function callback)
                                        raises(Exception);
           attribute Array  <a href="#dfn-privilegedfeatures">privilegedFeatures</a>;
};
	Navigator implements Permissions;
      </pre></div><div class="section" id="idl-if-Permissions"><div class="section"><h4 class="idl-header" id="idl-defs-permission values">Definition Group <em>permission values</em></h4><dl class="idl-defs"><dt id="idl-defs-permission values-USER_ALLOWED"><code>USER_ALLOWED</code></dt><dd>
	      <p>
		indicates that the user has granted permission.
	      </p>
	    </dd><dt id="idl-defs-permission values-DEFAULT_ALLOWED"><code>DEFAULT_ALLOWED</code></dt><dd>
	      <p>
		indicates that the user has not made a permissions decision, but the user agent's
		default policy is to allow permission.	
	      </p>
	    </dd><dt id="idl-defs-permission values-DEFAULT_DENIED"><code>DEFAULT_DENIED</code></dt><dd>
	      <p>
		indicates that the user has not made a permissions decision, but the user agent's
		default policy is to deny permission.
	      </p>
	    </dd><dt id="idl-defs-permission values-USER_DENIED"><code>USER_DENIED</code></dt><dd>
	      <p>
		indicates that the user has denied permission.
	      </p>
	    </dd></dl></div><div class="section"><h4 class="idl-header" id="idl-meths-Permissions">Attributes</h4><dl class="idl-attr"><dt id="dfn-privilegedfeatures"><code>privilegedFeatures</code>
      of type
      Array</dt><dd><p>
	      Contains an array of strings which represent the valid feature identifiers that can be used in
	      <code>permissionLevel</code> and <code>requestPermission</code>.
	    </p></dd></dl></div><div class="section"><h4 class="idl-header" id="idl-attrs-Permissions">Methods</h4><dl class="idl-meth"><dt id="dfn-permissionlevel"><code>permissionLevel</code></dt><dd><p>Returns the permission level of a feature.</p><dl><dt>Parameters</dt><dd class="idl-params"><dl><dt><code>feature</code>
          of type
          String</dt><dd>
	      A string containing a feature id.
	    </dd></dl></dd><dt>Return Value</dt><dd><table><tr><td><code></code></td><td>
	      <p>
		Returns one of the permission values <code>USER_ALLOWED</code>, <code>DEFAULT_ALLOWED</code>,
		<code>DEFAULT_DENIED</code>, <code>USER_DENIED</code>.
	      </p>
	    </td></tr></table></dd><dt>Exceptions</dt><dd><table><tr><td><a href="#idl-if-Exception">Exception</a></td><td>
	      <p>
		If <code>feature</code> does not identify a feature known to the user agent,
		the user agent must throw an exception.
	      </p>
	    </td></tr></table></dd></dl></dd><dt id="dfn-requestpermission"><code>requestPermission</code></dt><dd><p>
	      Requests that the user agent ask the user for permission for web pages from the
	      current security origin to use the feature identified by <code>feature</code>.
	      This method should only be called while handling a user gesture; 
	      in other circumstances the user agent should take no action in response. 
	    </p><p>
	      This method is asynchronous. The function provided in the <code>callback</code> 
	      parameter will be invoked when the user has responded to the permission request.
	    </p><p>
	      If the current permission level is <code>DEFAULT_DENIED</code>, the user agent should
	      display a prompt to the user requesting permission for pages in the current security
	      origin to user the feature identified by <code>feature</code>, which allows the user
	      to allow or deny permission.

	      <blockquote>
		<p>
		  If the user allows permission, the current permission level should change to
		  <code>USER_ALLOWED</code>, and the <code>callback</code> function should be called.
		</p>
		<p>
		  If the user denies permission, the current permission level should change to
		  <code>USER_DENIED</code>, and the <code>callback</code> function should be called.
		</p>
	      </blockquote>
	    </p><p>
	      If the current permission level is <code>USER_ALLOWED</code>, <code>DEFAULT_ALLOWED</code>, 
	      or <code>USER_DENIED</code>, the user agent should not prompt the user, and 
	      call <code>callback</code> immediately.
	    </p><dl><dt>Parameters</dt><dd class="idl-params"><dl><dt><code>feature</code>
          of type
          String</dt><dd>
	      A string containing a feature id.
	    </dd><dt><code>callback</code>
          of type
          Function</dt><dd>
	      A callback function to be called when the permission level is determined, such as 
	      by the user responding to a permission dialog.
	    </dd></dl></dd><dt>No Return Value</dt><dt>Exceptions</dt><dd><table><tr><td><a href="#idl-if-Exception">Exception</a></td><td>
	      <p>
		If <code>feature</code> does not identify a feature known to the user agent,
		the user agent must throw an exception.
	      </p>
	    </td></tr></table></dd></dl></dd></dl></div></div>
  </div>

  <div class="section"><h2 id="">4. Default permission levels</h2>
    
    <p>
      The <code>Permissions</code> interface requires the user agent to indicate <code>DEFAULT_ALLOWED</code>
      and <code>DEFAULT_DENIED</code> permission levels for feature/origin combinations where the user has
      not made an explicit decision.
    </p>
    <p>
      The purpose of the distinction between user-selected and default behavior is to allow the web page
      to present appropriate user interfaces advising the user of the need for permission and what actions
      should be taken to ensure permission is granted.
    </p>
    <p>
      The user agent may select appropriate initial default settings for each feature, but must not indicate
      <code>USER_ALLOWED</code> or <code>USER_DENIED</code> until the user has made a permissions decision.
    </p>
  </div>

  <div class="section"><h2 id="">5. References</h2>
    
    <dl class="bibliography">
      
    <dt id="CORS">CORS</dt><dd><cite><a href="http://www.w3.org/TR/cors/">Cross-Origin Resource Sharing</a></cite>,
    </dd></dl>
  </div>

</body></html>
