<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--
          ******* WARNING *********************************************************
          This document was automatically generated using the Re-Spec specification
          publishing system. Edits made here will be lost when it is regenerated
          and chances are high that the editor will do something quite unpleasant
          to you should that happen.
          ******* WARNING *********************************************************
        --><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Web Notifications</title><link rel="stylesheet" href="respec-w3c.css" type="text/css"></link><link rel="stylesheet" href="http://www.w3.org/StyleSheets/TR/base" type="text/css"></link><meta name="revision" content="$Id: Overview.html,v 1.5 2010-02-10 18:11:04 jgregg Exp $"></meta></head><body><div class="head"><p><a href="http://www.w3.org/"><img src="http://www.w3.org/Icons/w3c_home" width="72" height="48" alt="W3C"></img></a></p><h1 class="head">Web Notifications</h1><h2 id="pagesubtitle">W3C Editor's Draft <em>10 February 2010</em></h2><dl><dt>Editor:</dt><dd><span class="person">John Gregg (<a href="http://www.google.com/">Google</a>) &lt;<a href="mailto:johnnyg@google.com">johnnyg@google.com</a>&gt;</span></dd></dl><p class="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> ©2006
        <a href="http://www.w3.org/"><acronym title="World Wide Web Consortium">W3C</acronym></a><sup>®</sup>
        (<a href="http://www.csail.mit.edu/"><acronym title="Massachusetts Institute of Technology">MIT</acronym></a>,
        <a href="http://www.ercim.org/"><acronym title="European Research Consortium for Informatics and Mathematics">ERCIM</acronym></a>,
        <a href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. W3C
        <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
        <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and 
        <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document  use</a> rules apply.
      </p></div><hr></hr>

  

  <h2 id="specabstract">Abstract</h2><div class="section">
    
    <p>
      This document defines APIs for alerting the user outside of a web page
      by displaying notifications. Notifications are displayed asynchronously
      and do not require user confirmation; events are specified for managing 
      user interactions with notifications. 
    </p>
    
  </div>

  <div class="section"><h2 id="sotd">Status of this Document</h2>
    
    <p>
      This document is an Editor's Draft and is not suitable for purposes other
      than reviewing the specification being developed.
    </p>
  </div>

  <div class="section"><h2 id="contents">Table of Contents</h2>
    

    <ul class="toc"><li><a href="#introduction">1. Introduction</a></li><li><ul class="toc"><li><a href="#">1.1. Security</a></li><li><a href="#">1.2. HTML and Text notifications</a></li></ul></li><li><a href="#idl-if-Notification">2. The Notification interface</a></li><li><a href="#idl-if-NotificationCenter">3. The NotificationCenter interface</a></li><li><a href="#window">4. Accessing notifications</a></li><li><ul class="toc"><li><a href="#">4.1. Accessing from pages</a></li><li><a href="#">4.2. Accessing from workers</a></li></ul></li><li><a href="#displaying">5. Queueing and displaying notifications</a></li><li><ul class="toc"><li><a href="#">5.1. Displaying notifications</a></li><li><a href="#">5.2. Queueing notifications</a></li></ul></li><li><a href="#interactions">6. Interacting with notifications</a></li><li><ul class="toc"><li><a href="#">6.1. Using events</a></li><li><a href="#">6.2. Using window.opener</a></li></ul></li></ul>
  </div>

  <div class="section"><h2 id="introduction">1. Introduction</h2><p><strong>This section is not normative.</strong></p>
    

     <p>
        Many web pages benefit from alerting the user of important events passively, 
        even when the user is not interacting with that web page.  Some such sitations include:
        <ul>
          <li>a calendar application which needs to indicate an upcoming event,</li>
          <li>a mail application indicating a new message,</li>
          <li>a photo application indicating that a large upload has completed.</li>
        </ul>
      </p>
      
      <p>
        This specification provides an API to generate <em>notifications</em> to
        alert users outside of the web page.  It does not specify exactly how a user
        agent should display these alerts; the best presentation depends on the device
        where the user agent is run.  When this specificiation refers to displaying
        notifications on the "desktop", it generally refers to some static display
        area outside the web page, but may take several forms, including:
        <ul>
          <li>a corner of the user's display,</li>
          <li>an area within the chrome of the user agent,</li>
          <li>the "home" screen of a mobile device,</li>
          <li><em>et al.</em></li>
        </ul>
        This specification does not define exactly how the user agent should display
        the notification, and the API is designed to be flexible with respect to
        presentation options.
      </p>
      <div class="section"><h3 id="">1.1. Security</h3>
	
	
	<p>
	  Notifications should only be presented when the user has indicated they are desired;
	  without this they could create a negative experience for the user.
	</p>

	<p>
	  A user agent must not show any notifications generated by script from a particular
	  origin until the user has granted permission for that origin to show notifications.
	  Furthermore a request for such permission should only be allowed when 
	  initiated by a user gesture.
	</p>
      </div>

      <div class="section"><h3 id="">1.2. HTML and Text notifications</h3>
	

	<p>
	  Several systems exist for alerting users through notifications.  Many of these systems
	  take as input a string of text and an icon to be displayed. Within the web context,
	  this specification extends the utility of notifications by using HTML content within
	  the notification itself, allowing alerts which are dynamic.
	</p>

	<p>
	  Some user agents may not be compatible with creating passive HTML windows outside of the
	  frame, such as mobile devices, which often support a text alerting system.  For these
	  user agents, the specification provides a text notification system in parallel with the
	  HTML system. 
	</p>
	  
      </div>
  </div>

  <div class="section"><h2 id="idl-if-Notification">2. The Notification interface</h2>
    
    <p>
      The Notification interface represents a single alert to be shown to the user.
    </p>
    <div class="boxed"><p><span class="idlTitle">the Notification interface</span></p><pre class="schema" title="the Notification interface">interface <a href="#idl-if-Notification">Notification</a> : EventTarget {

  void               <a href="#dfn-show">show</a>();
  void               <a href="#dfn-cancel">cancel</a>();
           attribute Function  <a href="#dfn-onclick">onclick</a>;
           attribute Function  <a href="#dfn-ondisplay">ondisplay</a>;
           attribute Function  <a href="#dfn-onerror">onerror</a>;
           attribute Function  <a href="#dfn-onclose">onclose</a>;
};</pre></div><div class="section" id="idl-if-Notification"><div class="section"><h4 class="idl-header" id="idl-meths-Notification">Attributes</h4><dl class="idl-attr"><dt id="dfn-onclick"><code>onclick</code>
      of type
      Function</dt><dd><p>
	      An event listener function corresponding to the event type "click".  This event
	      listener is must be invoked when the user clicks on a notification.
	      <em>
		This event does not apply to HTML notifications, which may have their own
		internal click handling.
	      </em>
	    </p></dd><dt id="dfn-onclose"><code>onclose</code>
      of type
      Function</dt><dd><p>
	      An event listener function corresponding to the event type "error".  This
	      event listener must be invoked after the "display" event, at the point
	      when the alert is dismissed by the user.
	    </p></dd><dt id="dfn-ondisplay"><code>ondisplay</code>
      of type
      Function</dt><dd><p>
	      An event listener function corresponding to the event type "display".  This
	      event listener must be invoked after the <code>show()</code> method is called, at the
	      point when the notification actually becomes visible to the user.
	    </p></dd><dt id="dfn-onerror"><code>onerror</code>
      of type
      Function</dt><dd><p>
	      An event listener function corresponding to the event type "error".  This
	      event listener must be invoked after the <code>show()</code> method is called, if the
	      notification cannot be displayed to the user because of an error.
	    </p></dd></dl></div><div class="section"><h4 class="idl-header" id="idl-attrs-Notification">Methods</h4><dl class="idl-meth"><dt id="dfn-cancel"><code>cancel</code></dt><dd><p>
	      Requests the user agent to not show this notification. If the notification
	      has already been displayed, the user agent must remove it from the display;
	      if it has not yet be displayed, the user agent must prevent its being
	      displayed.
	    </p><dl><dt>No Parameters</dt><dt>No Return Value</dt><dt>No Exceptions</dt></dl></dd><dt id="dfn-show"><code>show</code></dt><dd><p>
	      Requests the user agent to show the notification to the user. Depending on 
	      desktop space, user idleness, or other factors as determined by the user
	      agent, this may happen immediately or be postponed, but must eventually
	      be done.
	    </p><dl><dt>No Parameters</dt><dt>No Return Value</dt><dt>No Exceptions</dt></dl></dd></dl></div></div>
  </div>

  <div class="section"><h2 id="idl-if-NotificationCenter">3. The NotificationCenter interface</h2>
    
    <p>
      The NotificationCenter interface exposes the ability for web pages to create
      Notification objects.
    </p>
    <div class="boxed"><p><span class="idlTitle">the NotificationCenter interface</span></p><pre class="schema" title="the NotificationCenter interface">interface <a href="#idl-if-NotificationCenter">NotificationCenter</a> {
  // permission values
  const unsigned long      <a href="#idl-defs-permission values-PERMISSION_ALLOWED">PERMISSION_ALLOWED</a>      = 0;
  const unsigned long      <a href="#idl-defs-permission values-PERMISSION_UNKNOWN">PERMISSION_UNKNOWN</a>      = 1;
  const unsigned long      <a href="#idl-defs-permission values-PERMISSION_DENIED">PERMISSION_DENIED</a>       = 2;

           attribute unsigned long  <a href="#dfn-permissionlevel">permissionLevel</a>;
  <a href="#idl-if-Notification">Notification</a>       <a href="#dfn-createnotification">createNotification</a>(in DOMString iconUrl, in DOMString title, in DOMString body)
                                        raises(Exception);
  <a href="#idl-if-Notification">Notification</a>       <a href="#dfn-createhtmlnotification">createHTMLNotification</a>(in DOMString url);
  void               <a href="#dfn-requestpermission">requestPermission</a>(in Function callback)
                                        raises(Exception);
};</pre></div><div class="section" id="idl-if-NotificationCenter"><div class="section"><h4 class="idl-header" id="idl-defs-permission values">Definition Group <em>permission values</em></h4><dl class="idl-defs"><dt id="idl-defs-permission values-PERMISSION_ALLOWED"><code>PERMISSION_ALLOWED</code></dt><dd>
	      <p>
		indicates that the user has granted permission to scripts with this origin
		to show notifications.
	      </p>
	    </dd><dt id="idl-defs-permission values-PERMISSION_UNKNOWN"><code>PERMISSION_UNKNOWN</code></dt><dd>
	      <p>
		indicates that the user has not 
		taken an action regarding notifications for scripts from this origin, but
		unless otherwise specified, user agents must act as if permission has been denied.
	      </p>
	    </dd><dt id="idl-defs-permission values-PERMISSION_DENIED"><code>PERMISSION_DENIED</code></dt><dd>
	      <p>
		indicates that the user has explicitly 
		blocked scripts with this origin from showing notifications.
	      </p>
	    </dd></dl></div><div class="section"><h4 class="idl-header" id="idl-meths-NotificationCenter">Attributes</h4><dl class="idl-attr"><dt id="dfn-permissionlevel"><code>permissionLevel</code>
      of type
      unsigned long</dt><dd><p>
	      Has value either <code>PERMISSION_ALLOWED</code>, 
	      <code>PERMISSION_UNKNOWN</code>, or <code>PERMISSION_DENIED</code>, 
	      which indicates the permission level granted to the origin of the 
	      script.	    
	    </p></dd></dl></div><div class="section"><h4 class="idl-header" id="idl-attrs-NotificationCenter">Methods</h4><dl class="idl-meth"><dt id="dfn-createhtmlnotification"><code>createHTMLNotification</code></dt><dd><p>
	      Implementation of this method is optional for the <code>NotificationCenter</code>
	      interface; user agents which do not support HTML content in the presentation of 
	      notifications should leave this method undefined and implement only 
	      <code>createNotification</code>.
	    </p><dl><dt>Parameters</dt><dd class="idl-params"><dl><dt><code>url</code>
          of type
          DOMString</dt><dd>
	      The URL of a resource which contains HTML content to be shown as the 
	      content of the alert.
	    </dd></dl></dd><dt>Return Value</dt><dd><table><tr><td><code></code></td><td>
	      <p>A notification object representing the new notification.</p>
	    </td></tr></table></dd><dt>No Exceptions</dt></dl></dd><dt id="dfn-createnotification"><code>createNotification</code></dt><dd><p>
	      Returns a new text notification object with the provided content.
	    </p><dl><dt>Parameters</dt><dd class="idl-params"><dl><dt><code>iconUrl</code>
          of type
          DOMString</dt><dd>
	      URL of the icon to be shown with this notification.
	    </dd><dt><code>title</code>
          of type
          DOMString</dt><dd>
	      Primary text, or title, of the notification.
	    </dd><dt><code>body</code>
          of type
          DOMString</dt><dd>
	      Secondary text, or body, of the notification.
	    </dd></dl></dd><dt>Return Value</dt><dd><table><tr><td><code></code></td><td>
	      <p>A notification object representing the new notification.</p>
	    </td></tr></table></dd><dt>Exceptions</dt><dd><table><tr><td><a href="#idl-if-Exception">Exception</a></td><td>
	      <p>
		If the notifications permission level for the current origin is not <code>PERMISSION_ALLOWED</code>,
		this method will throw a <code>SecurityException</code>.
	      </p>
	    </td></tr></table></dd></dl></dd><dt id="dfn-requestpermission"><code>requestPermission</code></dt><dd><p>
	      Requests that the user agent ask the user for permission to show notifications 
	      from scripts.  This method should only be called while handling a user gesture; 
	      in other circumstances the user agent should take no action in response. 
	    </p><p>
	      This method is asynchronous. The function provided in the <code>callback</code> 
	      parameter will be invoked when the user has responded to the permission request.
	    </p><p>
	      If the current permission level is <code>PERMISSION_DENIED</code>, 
	      the user agent may take no action in response to <code>requestPermission</code>,
	      and must throw an exception.
	    </p><dl><dt>Parameters</dt><dd class="idl-params"><dl><dt><code>callback</code>
          of type
          Function</dt><dd>
	      A callback function to be called when the user responds to the permission request.
	    </dd></dl></dd><dt>No Return Value</dt><dt>Exceptions</dt><dd><table><tr><td><a href="#idl-if-Exception">Exception</a></td><td>
	      <p>
		If the user agent does not initiate a request for permission with the user,
		e.g., because if a permission decision has already been recently made, the 
		user agent must throw an Exception.
	      </p>
	    </td></tr></table></dd></dl></dd></dl></div></div>
  </div>

  <div class="section"><h2 id="window">4. Accessing notifications</h2>
    
    <div class="section"><h3 id="">4.1. Accessing from pages</h3>
      
      <p>
	In page context, the NotificationCenter object is accessed from DOMWindow.
      </p>
      <div class="boxed"><p><span class="idlTitle">DOMWindow</span></p><pre class="schema" title="DOMWindow">interface <a href="#idl-if-DOMWindow">DOMWindow</a> {
           attribute <a href="#idl-if-NotificationCenter">NotificationCenter</a>  <a href="#dfn-notifications">notifications</a>;
};</pre></div><div class="section" id="idl-if-DOMWindow"><div class="section"><h4 class="idl-header" id="idl-meths-DOMWindow">Attributes</h4><dl class="idl-attr"><dt id="dfn-notifications"><code>notifications</code>
      of type
      <a href="#idl-if-NotificationCenter">NotificationCenter</a></dt><dd></dd></dl></div></div>
    </div>
    <div class="section"><h3 id="">4.2. Accessing from workers</h3>
      
      <p>
	From worker context, the NotificationCenter object is accessed from the global object, WorkerGlobalScope.
      </p>
      <div class="boxed"><p><span class="idlTitle">WorkerGlobalScope</span></p><pre class="schema" title="WorkerGlobalScope">interface <a href="#idl-if-WorkerGlobalScope">WorkerGlobalScope</a> {
           attribute <a href="#idl-if-NotificationCenter">NotificationCenter</a>  <a href="#dfn-notifications">notifications</a>;
};</pre></div><div class="section" id="idl-if-WorkerGlobalScope"><div class="section"><h4 class="idl-header" id="idl-meths-WorkerGlobalScope">Attributes</h4><dl class="idl-attr"><dt id="dfn-notifications"><code>notifications</code>
      of type
      <a href="#idl-if-NotificationCenter">NotificationCenter</a></dt><dd></dd></dl></div></div>
    </div>
  </div>

  <div class="section"><h2 id="displaying">5. Queueing and displaying notifications</h2>
    
    <div class="section"><h3 id="">5.1. Displaying notifications</h3>
      
      <p>
	When a notification is displayed, the user agent should perform the following steps:
	<ul>
	  <li>
	    Load the resource given by <code>url</code> (for <code>createHTMLNotification</code>) or
	    by <code>iconUrl</code> (for <code>createNotification</code>).
	  </li>
	  <li>
	    If a resource load failure occured:
	    <ul>
	      <li>Dispatch the <code>error</code> event on the notification object.</li>
	    </ul>
	  </li>
	  <li>
	    Otherwise:
	    <ul>
	      <li>Dispatch the <code>display</code> event on the notification object.</li>
	      <li>Show the notification on the device.</li>
	    </ul>
	  </li>
	</ul>
      </p>
    </div>
    <div class="section"><h3 id="">5.2. Queueing notifications</h3>
      
      <p>
	If the device does not allow all notifications to be displayed immediately, the user agent
	should maintain a FIFO queue of pending notifications.
      </p>
      <p>
	When <code>createNotification</code> or <code>createHTMLNotification</code> are called
	by script running in an origin which has <code>PERMISSION_ALLOWED</code> level notification
	permissions, the user agent should add the notification to the queue.
      </p>
      <p>
	When the available display space changes on the device such that a new notification may be
	displayed, for example due to a previous notification being dismissed, the user agent should
	display the first notification in the queue using the procedure described above.
      </p>
    </div>
  </div>

  <div class="section"><h2 id="interactions">6. Interacting with notifications</h2>
    
    <div class="section"><h3 id="">6.1. Using events</h3>
      
      <p>
	Notification objects dispatch events during their lifecycle, which authors can use
	to generate desired behaviors.
      </p>
      <p>
	The <code>display</code> event occurs when the notification is shown to the user -- 
	this may be at some time after the <code>show()</code> method is called in the case
	of limited display space and a queue.
      </p>

      <p>
	In the following example, this event is used to guarantee that regardless of when
	the notification is shown, it is displayed for only 15 seconds.
      </p>

      <div class="boxed"><div><span class="exampleTitle">Example: </span></div><pre class="example" title="">var notification = window.notifications.createNotification("mail.png", "New Email Received");
notification.ondisplay = function() { setTimeout(notification.cancel(), 15000); }
notification.show();</pre></div>

      <p>
	The <code>close</code> events occurs when the notification is dismissed by the user.
	Authors may use this event to perform actions when alerts are acknowledged.
      </p>
      <p>
	In the following example, when a meeting reminder notification is acknowledged, the
	application suppresses other forms of reminders.
      </p>

      <div class="boxed"><div><span class="exampleTitle">Example: </span></div><pre class="example" title="">var notification = window.notifications.createHTMLNotification("/reminder.html?eventId=" + event.id);
notification.onclose = function() { cancelReminders(event); }
notification.show();</pre></div>
	
    </div>
    <div class="section"><h3 id="">6.2. Using window.opener</h3>
           
      <p>
	An HTML notification is a separate HTML window, and script running within
	that context should be able to communicate to other windows, subject to the
	rules which generally apply to cross-domain communication.
      </p>
      <p>
	Within an HTML notification, the <code>window.opener</code> property should be
	set to the window which created the notification.  If the notification was
	created by a worker script, <code>window.opener</code> should be <code>null</code>.
      </p>

      <p>
	The following example uses <code>window.opener</code> to return to the application
	which created the notification in response to a click, and then close the notification.
      </p>

      <div class="boxed"><div><span class="exampleTitle">Example: </span></div><pre class="example" title="">notification.html
---
New email arrived! 
&lt;a href="#" onclick="window.opener.focus(); window.close();"&gt;
  Go to Inbox
&lt;/a&gt;

script.js
---
var notification = window.notifications.createHTMLNotification("notification.html");
notification.show();</pre></div>
    </div>
  </div>
</body></html>
