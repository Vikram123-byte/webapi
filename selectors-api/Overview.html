<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">

<html lang="en-US">
 <head>
  <title>Selectors API</title>

  <style type="text/css">
   pre.idl { border:solid thin; background:#eee; color:#000; padding:0.5em }
   pre.idl :link, pre.idl :visited { color:inherit; background:transparent }
   dfn { font-style:normal; font-weight:bolder }
   em.ct { font-style:normal; font-weight:normal; font-variant:small-caps }
   p.note { color:green; font-style:italic; font-weight:bold }
   p.note::before { content:"Note: " }
   .issue { padding:.5em; border:solid red }
   .issue::before { content:"Issue: " }
   code { color:orangered }
   code :link, code :visited { color:inherit }
  </style>

  <link href="http://www.w3.org/StyleSheets/TR/base.css" rel="stylesheet">

 <body>
  <div class="head">
   <p><a href="http://www.w3.org/"><img alt="W3C"
    src="http://www.w3.org/Icons/w3c_home"></a></p>

   <h1 id="title">Selectors API</h1>

   <h2 class="no-num no-toc" id="W3C-doctype">Editor's Draft September 2006</h2>

   <dl>
    <dt>This Version:

    <dd>http://www.w3.org/TR/YYYY/TT-selectors-api-YYYYMMDD

    <dt>Latest Version:

    <dd><a
     href="http://www.w3.org/TR/selectors-api/">http://www.w3.org/TR/selectors-api/</a>

    <dt>Previous Version:

    <dd><a
     href="http://www.w3.org/TR/2006/WD-selectors-api-20060525/">http://www.w3.org/TR/2006/WD-selectors-api-20060525/</a>

    <dt>Editor:

    <dd><a href="http://annevankesteren.nl/">Anne van Kesteren</a> (<a
     href="http://www.opera.com/">Opera Software ASA</a>) &lt;<a
     href="mailto:annevk@opera.com">annevk@opera.com</a>&gt;
   </dl>

   <p class="copyright"><a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
    © 2006 <a href="http://www.w3.org/"><abbr title="World Wide Web
    Consortium">W3C</abbr></a><sup>®</sup> (<a
    href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of
    Technology">MIT</abbr></a>, <a href="http://www.ercim.org/"><abbr
    title="European Research Consortium for Informatics and
    Mathematics">ERCIM</abbr></a>, <a
    href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. W3C <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
    <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>
    and <a
    href="http://www.w3.org/Consortium/Legal/copyright-documents">document
    use</a> rules apply.</p>
  </div>

  <hr>

  <h2 class="no-num no-toc" id="abstract">Abstract</h2>

  <p>Selectors API defines two methods for retrieving <code>Element</code>
   nodes in the <abbr title="Document Object Model">DOM</abbr> using a group
   of selectors as defined in [<cite><a
   href="#ref-selectors">Selectors</a></cite>].

  <h2 class="no-num no-toc" id="sotd">Status of this Document</h2>

  <p><em>This section describes the status of this document at the time of
   its publication. Other documents may supersede this document. A list of
   current W3C publications and the latest revision of this technical report
   can be found in the <a href="http://www.w3.org/TR/">W3C technical reports
   index</a> at http://www.w3.org/TR/.</em>

  <p>This document is produced by the <a
   href="http://www.w3.org/2006/webapi/">Web APIs WG</a>, part of the <a
   href="http://www.w3.org/2006/rwc/Activity">Rich Web Clients Activity</a>
   in the W3C <a href="http://www.w3.org/Interaction/">Interaction
   Domain</a>.

  <p>Web content and browser developers are encouraged to review this draft.
   Please send comments to <a
   href="mailto:public-webapi@w3.org">public-webapi@w3.org</a>, the W3C's
   public email list for issues related to Web APIs. <a
   href="http://lists.w3.org/Archives/Public/public-webapi/">Archives</a> of
   the list are available. The editor's copy of this specification is <a
   href="http://dev.w3.org/cvsweb/~checkout~/2006/webapi/selectors-api/Overview.html?content-type=text/html;%20charset=utf-8">available
   in W3C CVS</a>. A detailed list of changes is also available <a
   href="http://dev.w3.org/cvsweb/2006/webapi/selectors-api/">from the CVS
   server</a>.

  <p>Implementors should be aware that this specification is not stable.
   <strong>Implementors who are not taking part in the discussions are likely
   to find the specification changing out from under them in incompatible
   ways.</strong> Vendors interested in implementing this specification
   before it eventually reaches the Candidate Recommendation stage should
   join the aforementioned mailing lists and take part in the discussions.

  <p>This document was produced by a group operating under the <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February
   2004 W3C Patent Policy</a>. W3C maintains a <a
   href="http://www.w3.org/2004/01/pp-impl/38482/status"
   rel="disclosure">public list of any patent disclosures</a> made in
   connection with the deliverables of the group; that page also includes
   instructions for disclosing a patent. An individual who has actual
   knowledge of a patent which the individual believes contains <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
   Claim(s)</a> must disclose the information in accordance with <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
   6 of the W3C Patent Policy</a>.

  <h2 class="no-num no-toc" id="toc">Table of Contents</h2>
  <!--begin-toc-->

  <ul class="toc">
   <li><a href="#introduction"><span class="secno">1. </span>Introduction</a>
    
    <ul class="toc">
     <li><a href="#examples"><span class="secno">1.1. </span>Examples</a>

     <li><a href="#conformance"><span class="secno">1.2. </span>Conformance
      Requirements</a>

     <li><a href="#extensibility"><span class="secno">1.3.
      </span>Extensibility</a>

     <li><a href="#notcovered"><span class="secno">1.4. </span>Not in this
      Specification</a>
    </ul>

   <li><a href="#documentselector"><span class="secno">2. </span>The <code
    title="">Selector</code> Interface</a>

   <li><a href="#nsresolver"><span class="secno">3. </span>The <code
    title="">NSResolver</code> Interface</a>

   <li><a href="#staticnodelist"><span class="secno">4. </span>The <code
    title="">StaticNodeList</code> Interface</a>

   <li><a href="#security"><span class="secno">5. </span>Security
    Considerations</a>

   <li class="no-num"><a href="#references">References</a>

   <li class="no-num"><a href="#acknowledgements">Acknowledgements</a>
  </ul>
  <!--end-toc-->

  <h2 id="introduction"><span class="secno">1. </span>Introduction</h2>

  <p><em>This section is non-normative.</em>

  <p>It is often desirable to perform script and or DOM operations on a
   specific set of elements in a document. Selectors [<cite><a
   href="#ref-selectors">Selectors</a></cite>], mostly used in <abbr
   title="Cascading Style Sheets">CSS</abbr> [<cite><a
   href="#ref-css21">CSS21</a></cite>] context, provides a way of matching
   such a set of elements. This specification introduces two methods which
   take a group of selectors (often simply referred to as selector) as
   argument and return the matched elements as result.

  <p>With these methods it's easier to match a set of <code>Element</code>
   nodes based on certain criteria. So instead of having to filter the result
   of a <code>getElementsByTagName()</code> call authors can directly
   "filter" in the query.

  <h3 id="examples"><span class="secno">1.1. </span>Examples</h3>

  <p><em>This section is non-normative.</em>

  <p>Some [<cite><a href="#ref-ecma262">ECMAScript</a></cite>] examples:

  <pre>function resolver(str) {
  var prefixes = {
    h:  "http://www.w3.org/1999/xhtml",
    g: "http://www.w3.org/2000/svg"}
  return prefixes[str];
}
var <var>a</var> = document.matchAll("h|div &gt; g|svg", resolver);
var <var>b</var> = document.matchSingle("div.foo.bar");</pre>

  <p><var>a</var> contains a <code><a
   href="#staticnodelist0">StaticNodeList</a></code> of all the nodes matched
   by <code>h|div &gt; g|svg</code> (namespace prefixes are resolved using
   the function in this case). <var>b</var> would contain the first
   <code>div</code> element which has the classes <code>foo</code> and
   <code>bar</code> set.

  <pre>function test(){
  var c = document.matchAll(":root"),
      d = document.documentElement;
  return c[0] === d;
}</pre>

  <p><code>test()</code> would return <code>true</code> when both <code><a
   href="#matchall">matchAll()</a></code> and <code>:root</code> are
   supported. When using <code>:root</code> like this it's probably better
   (and faster) to use <code><a href="#matchsingle">matchSingle()</a></code>
   given that there's only one possible result. This is just to illustrate
   how it works.

  <pre>var <var>e</var> = document.matchAll("p.warning, p.alert");</pre>

  <p>The above code snippet shows that besides using a single selector you
   can also pass a group of selectors (basically comma-separated selectors)
   as argument. <var>e</var> would contain a <code><a
   href="#staticnodelist0">StaticNodeList</a></code> with all <code>p</code>
   elements in the document that have a <code>warning</code> or
   <code>alert</code> class.

  <pre>var <var>f</var> = document.matchSingle("#foo, #bar");</pre>

  <p><var>f</var> would contain the first element in the document either
   having an ID of <code>foo</code> or <code>bar</code> (or both).

  <h3 id="conformance"><span class="secno">1.2. </span>Conformance
   Requirements</h3>

  <p>Everything in this specification is normative except for diagrams,
   examples, notes and sections marked non-normative.

  <p>The key words <em class="ct">must</em>, <em class="ct">must not</em>,
   <em class="ct">required</em>, <em class="ct">shall</em>, <em
   class="ct">shall not</em>, <em class="ct">should</em>, <em
   class="ct">should not</em>, <em class="ct">recommended</em>, <em
   class="ct">may</em>, and <em class="ct">optional</em> in the normative
   parts of this document are to be interpreted as described in [<cite><a
   href="#ref-rfc2119">RFC2119</a></cite>].

  <p>The following conformance classes are defined by this specification:

  <dl>
   <dt><dfn id="conforming">conforming implementation</dfn>

   <dd>A user agent that implements all interfaces described in this
    specification and follows all <em class="ct">must</em>-, <em
    class="ct">required</em>- and <em class="ct">shall</em>-level of critera
    in this specification.

   <dt><dfn id="conforming0">conforming document</dfn>

   <dd>A document that follows all <em class="ct">must</em>-, <em
    class="ct">required</em>- and <em class="ct">shall</em>-level of critera
    in this specification that apply to document authors.

   <dt><dfn id="conforming1">conforming authoring tool</dfn>

   <dd>One that produces conforming documents.
  </dl>

  <h3 id="extensibility"><span class="secno">1.3. </span>Extensibility</h3>

  <p><em>This section is non-normative.</em>

  <p>Extensions of the APIs defined in this specification are <em>strongly
   discouraged</em>. User agents, Working Groups and other interested parties
   should discuss extensions on a relevant public forum, such as <a
   href="mailto:public-webapi@w3.org">public-webapi@w3.org</a>.

  <h3 id="notcovered"><span class="secno">1.4. </span>Not in this
   Specification</h3>

  <p><em>This section is non-normative.</em>

  <p>This specification does not cover scoped selectors. In a future version
   you might be able to do <code>event.target.matchSingle("foo")</code> or
   similar.

  <h2 id="documentselector"><span class="secno">2. </span>The <code
   title="">Selector</code> Interface</h2>

  <p>Objects implementing the <code>Document</code> interface defined in
   <cite>DOM Level 3 Core</cite> <em class="ct">must</em> also implement the
   <code><a href="#selector">Selector</a></code> interface [<cite><a
   href="#ref-dom3core">DOM3Core</a></cite>].

  <pre class="idl">interface <dfn id="selector">Selector</dfn> {
  Node            <span><a href="#matchsingle">matchSingle</a></span>(in DOMString <var>selectors</var>, in <span><a href="#nsresolver0">NSResolver</a></span> <var title="">nsresolver</var>);
  <span><a href="#staticnodelist0">StaticNodeList</a></span>  <span><a href="#matchall">matchAll</a></span>(in DOMString <var>selectors</var>, in <span><a href="#nsresolver0">NSResolver</a></span> <var title="">nsresolver</var>);
};</pre>

  <p class="note">The interface is named <code><a
   href="#selector">Selector</a></code> because it might be implemented by
   <code>Element</code> nodes in the future.

  <p>The <dfn id="matchsingle"
   title="matchsingle"><code>matchSingle(<var>selectors</var>, <var
   title="">nsresolver</var>)</code></dfn> method, when invoked, <em
   class="ct">must</em> return the first <code>Element</code> node in
   document order (using depth-first pre-order traversal) that matches the
   group of selectors (<var>selectors</var>), if any. Otherwise it <em
   class="ct">must</em> return <code>null</code>.

  <p>The <dfn id="matchall"
   title="matchall"><code>matchAll(<var>selectors</var>, <var
   title="">nsresolver</var>)</code></dfn> method, when invoked, <em
   class="ct">must</em> return a <code><a
   href="#staticnodelist0">StaticNodeList</a></code> of all the
   <code>Element</code>s that match the group of selectors
   (<var>selectors</var>) in document order, if any. Otherwise it <em
   class="ct">must</em> return an empty <code><a
   href="#staticnodelist0">StaticNodeList</a></code>.

  <p>Both <code><a href="#matchsingle">matchSingle()</a></code> and <code><a
   href="#matchall">matchAll()</a></code> take a group of selectors
   (<var>selectors</var>) as defined in [<cite><a
   href="#ref-selectors">Selectors</a></cite>] as first argument and an
   <code><a href="#nsresolver0">NSResolver</a></code> (<var
   title="">nsresolver</var>) as second. User agents <em class="ct">must</em>
   use the <var title="">nsresolver</var> argument to resolve namespace
   prefixes. When the <var title="">nsresolver</var> argument is
   <code>null</code> user agents <em class="ct">must</em> ignore it.

  <p>When authors use namespace prefixes within <var>selectors</var> they <em
   class="ct">must</em> create an object implementing the <code><a
   href="#nsresolver0">NSResolver</a></code> interface (or create a
   <code>Function</code> in case of ECMAScript) and pass that as argument for
   <var title="">nsresolver</var>. If they don't use namespace prefixes
   within <var>selectors</var> authors <em class="ct">may</em> set <var
   title="">nsresolver</var> to <code>null</code> or omit the argument
   completely if the language binding allows it.

  <p>If the given group of selectors (<var>selectors</var>) is invalid, the
   user agent <em class="ct">must</em> raise a <code>SYNTAX_ERR</code>
   exception. If the given group of selectors (<var>selectors</var>) uses
   namespace prefixes and the prefix can not be resolved using the <var
   title="">nsresolver</var> argument a <code>NAMESPACE_ERR</code> exception
   <em class="ct">must</em> be raised.

  <p>In languages that support optional arguments for methods, like
   ECMAScript, omitting the <var title="">nsresolver</var> argument in either
   the <code><a href="#matchsingle">matchSingle()</a></code> or <code><a
   href="#matchall">matchAll()</a></code> method <em class="ct">must</em>
   return the same result as if the method was called with the <var
   title="">nsresolver</var> argument being <code>null</code>.

  <p class="note">Using pseudo-elements in one of the selectors could mean
   that nothing is returned for that particular selector when it doesn't
   resolve in one or more <code>Element</code> nodes.

  <h2 id="nsresolver"><span class="secno">3. </span>The <code
   title="">NSResolver</code> Interface</h2>

  <p>The <code><a href="#nsresolver0">NSResolver</a></code> interface allows
   prefixes to be bound to a namespace URI. The interface is to be
   implemented by authors.

  <p class="note">Other specifications may introduce methods that return an
   object implementing <code><a href="#nsresolver0">NSResolver</a></code> in
   which case it would be implemented by the user agent.

  <pre class="idl">interface <dfn id="nsresolver0">NSResolver</dfn> {
  DOMString          <span><a href="#lookupnamespaceuri">lookupNamespaceURI</a></span>(in DOMString <var>prefix</var>);
};</pre>

  <p>The <dfn id="lookupnamespaceuri"
   title="lookupnamespaceuri"><code>lookupNamespaceURI(<var>prefix</var>)</code></dfn>
   method <em class="ct">must</em> return the namespace belonging to the
   prefix (<var>prefix</var>) or the default namespace if the
   <var>prefix</var> argument is <code>null</code> or the empty string.

  <p>To resolve namespace prefixes user agents <em class="ct">must</em> pass
   the prefix to the <code><a
   href="#lookupnamespaceuri">lookupNamespaceURI</a></code> method. To get
   the default namespace user agents <em class="ct">must</em> invoke the
   <code><a href="#lookupnamespaceuri">lookupNamespaceURI()</a></code> method
   with the empty string. User agents <em class="ct">must</em> never invoke
   the method with <code>null</code> as argument [<cite><a
   href="#ref-selectors">Selectors</a></cite>].

  <p>In ECMAScript (and languages that allow similar constructs) user agents
   <em class="ct">must</em> support <code><a
   href="#nsresolver0">NSResolver</a></code> being implemented as a
   <code>Function</code> where the parameter of the function is identical to
   the <var>prefix</var> argument described above.

  <h2 id="staticnodelist"><span class="secno">4. </span>The <code
   title="">StaticNodeList</code> Interface</h2>

  <pre
   class="idl">typedef <dfn id="staticnodelist0">StaticNodeList</dfn> NodeList;</pre>

  <p>The <code><a href="#staticnodelist0">StaticNodeList</a></code> <em
   class="ct">must</em> be implemented identically to the
   <code>NodeList</code> interface as defined in [<cite><a
   href="#ref-dom3core">DOM3Core</a></cite>] with the exception that the
   interface, as the name suggests, is static and not live.

  <h2 id="security"><span class="secno">5. </span>Security Considerations</h2>

  <p>It is expected that implementing this specification introduces no new
   risks for users.

  <p>History theft is a potential security problem, because of the
   <code>:visited</code> pseudo-class in [<cite><a
   href="#ref-selectors">Selectors</a></cite>]. <code>:visited</code> can
   already be used to query which links are visited using [<cite><a
   href="#ref-css21">CSS21</a></cite>] and because this specification did not
   introduce the problem and it can already be exploited by other means user
   agents don't have to take action upon it.

  <p>Another problem is hostile content. User agents <em
   class="ct">should</em> ensure they remain stable when facing a hostile
   <code><a href="#nsresolver0">NSResolver</a></code> object. Potential
   hostile things such an object could do include:

  <ul>
   <li>Returning inconsistent results;

   <li>Hanging;

   <li>Changing the DOM during the operation.
  </ul>

  <h2 class="no-num" id="references">References</h2>

  <dl>
   <dt id="ref-css21">[CSS21]

   <dd>(Informative) <cite><a href="http://www.w3.org/TR/CSS21">Cascading
    Style Sheets, level 2 revision 1</a></cite>, B. Bos, T. Çelik, I.
    Hickson, H. Wium Lie, editors. World Wide Web Consortium, June 2005.

   <dt id="ref-dom3core">[DOM3Core]

   <dd><cite><a href="http://www.w3.org/TR/DOM-Level-3-Core">Document Object
    Model (DOM) Level 3 Core Specification</a></cite>, A. Le Hors, P. Le
    Hégaret, L. Wood, G. Nicol, J. Robie, M. Champion, S. Byrne, editors.
    World Wide Web Consortium, April 2004.

   <dt id="ref-ecma262">[ECMAScript]

   <dd><cite><a
    href="http://www.ecma-international.org/publications/standards/Ecma-262.htm">ECMAScript
    Language Specification</a></cite>, Third Edition. ECMA, December 1999.

   <dt id="ref-selectors">[Selectors]

   <dd><cite><a
    href="http://www.w3.org/TR/css3-selectors">Selectors</a></cite>, D.
    Glazman, T. Çelik, I. Hickson, P. Linss, J. Williams, editors. World
    Wide Web Consortium, December 2005.

   <dt id="ref-rfc2119">[RFC2119]

   <dd><cite><a href="http://ietf.org/rfc/rfc2119">RFC 2119: Key words for
    use in RFCs to Indicate Requirement Levels</a></cite>, S. Bradner. IETF,
    March 1997.
  </dl>

  <h2 class="no-num" id="acknowledgements">Acknowledgements</h2>

  <p>The editor would like to thank to the following people who have
   contributed to this specification (ordered on first name):

  <ul>
   <li>Björn Höhrmann

   <li>Cameron McCormack

   <li>Daniel Schierbeck

   <li>Dean Jackson

   <li>Ian Hickson

   <li>Jim Ley

   <li>Jonas Sicking

   <li>Karl Dubost

   <li>Lachlan Hunt

   <li>Maciej Stachowiak

   <li>Mohamed Zergaoui

   <li>Robin Berjon
  </ul>

  <p>Thanks to all those who have helped to improve this specification by
   sending suggestions and corrections. (Please, keep bugging us with your
   issues!)
