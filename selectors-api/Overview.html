<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">

<html lang=en-US>
 <head><meta content="text/html;charset=UTF-8" http-equiv=Content-Type>

  <title>Selectors API</title>

  <style type="text/css">
   pre.idl { border:solid thin; background:#eee; color:#000; padding:0.5em }

   pre.idl :link, pre.idl :visited { color:inherit; background:transparent }
   div.example { border-left:double; padding-left:1em }
   dfn { font-style:normal; font-weight:bolder }
   em.ct { font-style:normal; font-weight:normal; font-variant:small-caps }
   p.note {  margin-left:2em; color:green; font-style:italic; font-weight:bold }
   p.note::before { content:"Note: " }
   .issue { padding:.5em; border:solid red }
   .issue::before { content:"Issue: " }
   code { color:#FF4500; }
   code :link, code :visited { color:inherit }
  </style>
  <link href="http://www.w3.org/StyleSheets/TR/base.css" rel=stylesheet>
  <link href="http://www.w3.org/StyleSheets/TR/W3C-WD" rel=stylesheet
  type="text/css">

 <body>
  <div class=head>
   <p><a href="http://www.w3.org/"><img alt=W3C height=48
    src="http://www.w3.org/Icons/w3c_home" width=72></a></p>

   <h1 id=title>Selectors API</h1>
   <!-- "DOM Selectors" was not acceptable. "DOM Level 4 Selectors" and
   conforming to the DOM specification template (if there is such a thing) is
   just silly so we got stuck with this weird name. -->
   
   <h2 class="no-num no-toc" id=W3C-doctype>W3C Working Draft 06 December
    2007</h2>

   <dl>
    <dt>This Version:

    <dd><a
     href="http://www.w3.org/TR/2007/WD-selectors-api-20071206/">http://www.w3.org/TR/2007/WD-selectors-api-20071206/</a>

    <dt>Latest Version:

    <dd><a
     href="http://www.w3.org/TR/selectors-api/">http://www.w3.org/TR/selectors-api/</a>

    <dt>Previous Versions:

    <dd><a
     href="http://www.w3.org/TR/2007/WD-selectors-api-20071019/">http://www.w3.org/TR/2007/WD-selectors-api-20071019/</a>

    <dd><a
     href="http://www.w3.org/TR/2006/WD-selectors-api-20060926/">http://www.w3.org/TR/2006/WD-selectors-api-20060926/</a>

    <dd><a
     href="http://www.w3.org/TR/2006/WD-selectors-api-20060525/">http://www.w3.org/TR/2006/WD-selectors-api-20060525/</a>

    <dt>Editors:

    <dd><a href="http://lachy.id.au/">Lachlan Hunt</a> (<a
     href="http://www.opera.com/">Opera Software ASA</a>) &lt;<a
     href="mailto:lachlan.hunt@lachy.id.au">lachlan.hunt@lachy.id.au</a>&gt;

    <dd><a href="http://annevankesteren.nl/">Anne van Kesteren</a> (<a
     href="http://www.opera.com/">Opera Software ASA</a>) &lt;<a
     href="mailto:annevk@opera.com">annevk@opera.com</a>&gt;
   </dl>

   <p class=copyright><a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
    © 2006-2007 <a href="http://www.w3.org/"><acronym title="World Wide Web
    Consortium">W3C</acronym></a><sup>®</sup> (<a
    href="http://www.csail.mit.edu/"><acronym title="Massachusetts Institute
    of Technology">MIT</acronym></a>, <a
    href="http://www.ercim.org/"><acronym title="European Research Consortium
    for Informatics and Mathematics">ERCIM</acronym></a>, <a
    href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. W3C <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
    <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>
    and <a
    href="http://www.w3.org/Consortium/Legal/copyright-documents">document
    use</a> rules apply.</p>
  </div>

  <hr>

  <h2 class="no-num no-toc" id=abstract>Abstract</h2>

  <p>Selectors, which are widely used in CSS, are patterns that match against
   elements in a tree structure [<cite><a
   href="#ref-selectors">Selectors</a></cite>] [<cite><a
   href="#ref-css21">CSS21</a></cite>]. The Selectors API specification
   defines methods for retrieving <code>Element</code> nodes from the <abbr
   title="Document Object Model">DOM</abbr> by matching against a group of
   selectors. It is often desirable to perform DOM operations on a specific
   set of elements in a document. These methods simplify the process of
   aquiring specific elements, especially compared with the more verbose
   techniques defined and used in the past.

  <h2 class="no-num no-toc" id=sotd>Status of this Document</h2>

  <p><em>This section describes the status of this document at the time of
   its publication. Other documents may supersede this document. A list of
   current W3C publications and the latest revision of this technical report
   can be found in the <a href="http://www.w3.org/TR/">W3C technical reports
   index</a> at http://www.w3.org/TR/.</em>

  <p>This is a Last Call Working Draft of "Selectors API". The W3C Membership
   and other interested parties are invited to review the document and send
   comments to <a href="mailto:public-webapi@w3.org">public-webapi@w3.org</a>
   (<a href="http://lists.w3.org/Archives/Public/public-webapi/">public
   archive</a>) with <kbd>[selectors-api]</kbd> in the subject, through 06
   January 2008.

  <p><span class=notetoeditor>Web content and browser developers are
   encouraged to review this draft. This draft is considered relatively
   stable and is expected to progress to Candidate Recommendation after the
   review period.</span> The editor’s copy of this specification is <a
   href="http://dev.w3.org/2006/webapi/selectors-api/">available in W3C
   CVS</a>. A detailed list of changes is also available <a
   href="http://dev.w3.org/cvsweb/2006/webapi/selectors-api/">from the CVS
   server</a>.

  <p>This document was developed by the <a
   href="http://www.w3.org/2006/webapi">Web API Working Group</a>. The
   Working Group expects to advance this Working Draft to Recommendation
   Status.

  <p>Publication as a Working Draft does not imply endorsement by the W3C
   Membership. This is a draft document and may be updated, replaced or
   obsoleted by other documents at any time. It is inappropriate to cite this
   document as other than work in progress.

  <p>This document was produced by a group operating under the <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February
   2004 W3C Patent Policy</a>. W3C maintains a <a
   href="http://www.w3.org/2004/01/pp-impl/38482/status"
   rel=disclosure>public list of any patent disclosures</a> made in
   connection with the deliverables of the group; that page also includes
   instructions for disclosing a patent. An individual who has actual
   knowledge of a patent which the individual believes contains <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
   Claim(s)</a> must disclose the information in accordance with <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
   6 of the W3C Patent Policy</a>.

  <h2 class="no-num no-toc" id=toc>Table of Contents</h2>
  <!--begin-toc-->

  <ul class=toc>
   <li><a href="#introduction"><span class=secno>1. </span>Introduction</a>
    <ul class=toc>
     <li><a href="#examples"><span class=secno>1.1. </span>Examples</a>

     <li><a href="#conformance"><span class=secno>1.2. </span>Conformance
      Requirements</a>
      <ul class=toc>
       <li><a href="#terminology"><span class=secno>1.2.1. </span>Terminology
        and Conventions</a>

       <li><a href="#interoperability"><span class=secno>1.2.2.
        </span>Interoperability Considerations</a>

       <li><a href="#extensibility"><span class=secno>1.2.3.
        </span>Extensibility</a>
      </ul>

     <li><a href="#security"><span class=secno>1.3. </span>Security
      Considerations</a>

     <li><a href="#privacy"><span class=secno>1.4. </span>Privacy
      Considerations </a>
    </ul>

   <li><a href="#documentselector"><span class=secno>2. </span>The <code
    title="">querySelector()</code> and <code
    title="">querySelectorAll()</code> Methods</a>
    <ul class=toc>
     <li><a href="#nsresolver-interface"><span class=secno>2.1. </span>The
      <code title="">NSResolver</code> Interface</a>

     <li><a href="#staticnodelist"><span class=secno>2.2. </span>The <code
      title="">StaticNodeList</code> Interface</a>
    </ul>

   <li class=no-num><a href="#references">References</a>

   <li class=no-num><a href="#acknowledgements">Acknowledgements</a>
  </ul>
  <!--end-toc-->

  <h2 id=introduction><span class=secno>1. </span>Introduction</h2>

  <p><em>This section is non-normative.</em>

  <p>This specification introduces two methods that take a group of selectors
   (often simply referred to as a selector) as an argument and return the
   matching elements [<cite><a href="#ref-selectors">Selectors</a></cite>].
   With these methods, it is easier to match a set of <code>Element</code>
   nodes based on specific criteria. So instead of having to filter the
   result of a <code>getElementsByTagName()</code> call, authors can directly
   “filter” in the query.

  <h3 id=examples><span class=secno>1.1. </span>Examples</h3>

  <p><em>This section is non-normative.</em>

  <p>Some ECMAScript [<cite><a href="#ref-ecma262">ECMAScript</a></cite>]
   examples:

  <div class=example>
   <p>This is an example HTML table.</p>

   <pre>&lt;table id="score">
  &lt;thead>
    &lt;tr>
      &lt;th>Test
      &lt;th>Result
  &lt;tfoot>
    &lt;tr>
      &lt;th>Average
      &lt;td>82%
  &lt;tbody>
    &lt;tr>
      &lt;td>A
      &lt;td>87%
    &lt;tr>
      &lt;td>B
      &lt;td>78%
    &lt;tr>
      &lt;td>C
      &lt;td>81%
&lt;/table></pre>

   <p>In order to obtain the cells containing the results in the table, which
    might be done, for example, to plot the values on a graph, there are at
    least two approaches that may be taken. Using only the APIs from DOM
    Level 2, it requires a script like the following that iterates through
    each <code>tr</code> within each <code>tbody</code> in the
    <code>table</code> to find the second cell of each row.</p>

   <pre>var table = document.getElementById("score");
var groups = table.tBodies;
var rows = null;
var cells = [];

for (var i = 0; i &lt; groups.length; i++) {
  rows = groups[i].rows;
  for (var j = 0; j &lt; rows.length; j++) {
    cells.push(rows[j].cells[1]);
  }
}
</pre>

   <p>Alternatively, using the <code title=document-selectallelements><a
    href="#document-selectallelements">querySelectorAll()</a></code> method,
    that script becomes much more concise.</p>

   <pre>var cells = document.querySelectorAll("#score&gt;tbody&gt;td:nth-of-type(2)");</pre>
  </div>

  <h3 id=conformance><span class=secno>1.2. </span>Conformance Requirements</h3>

  <p>All diagrams, examples and notes in this specification are
   non-normative, as are all sections explicitly marked non-normative.
   Everything else in this specification is normative.

  <p>The key words <em class=ct>must</em>, <em class=ct>should</em>, and <em
   class=ct>may</em> in the normative parts of this document are to be
   interpreted as described in RFC 2119 [<cite><a
   href="#ref-rfc2119">RFC2119</a></cite>].

  <p>The following conformance classes are defined (and considered) by this
   specification:

  <dl>
   <dt><dfn id=conforming>conforming user agent</dfn>

   <dd>A user agent that implements the <code><a
    href="#dom-document-selector">DocumentSelector</a></code>, <code><a
    href="#dom-element-selector">ElementSelector</a></code> and <code><a
    href="#staticnodelist0">StaticNodeList</a></code> interfaces described in
    this specification and conforms to all <em class=ct>must</em>-level
    critera that apply to user agents.

   <dt><dfn id=conforming0>conforming namespace resolver</dfn>

   <dd>An object implementing the <code><a
    href="#nsresolver">NSResolver</a></code> interface which conforms to all
    <em class=ct>must</em>-level critera that apply to the <code><a
    href="#nsresolver">NSResolver</a></code> interface.

   <dt><dfn id=conforming1>conforming application</dfn>

   <dd>An application that uses the interfaces defined in this specification
    and conforms to all <em class=ct>must</em>-level critera that apply to
    authors.
  </dl>

  <h4 id=terminology><span class=secno>1.2.1. </span>Terminology and
   Conventions</h4>

  <p>The terminology used in this specification is that from Selectors
   [<cite><a href="#ref-selectors">Selectors</a></cite>].

  <p>Conformance requirements phrased as algorithms or specific steps may be
   implemented in any manner, so long as the end result is equivalent. In
   doing so, user agents <em class=ct>may</em> assume that the object
   implementing the <code><a href="#nsresolver">NSResolver</a></code>
   interface (or ECMAScript <code>Function</code>) returns consistent results
   when its <code><a
   href="#lookupnamespaceuri">lookupNamespaceURI()</a></code> method is
   invoked.

  <p>The construction "<code>Foo</code> object", where <code>Foo</code> is
   actually an interface, is sometimes used instead of the more accurate
   "object implementing the <code>Foo</code> interface".

  <h4 id=interoperability><span class=secno>1.2.2. </span>Interoperability
   Considerations</h4>

  <p><em>This section is non-normative.</em>

  <p>Since user agents may optimise the algorithms described in this
   specification, and because some may invoke the <code><a
   href="#nsresolver">NSResolver</a></code> object more than others,
   interoperability concerns may arise if the the <code><a
   href="#nsresolver">NSResolver</a></code> object (or ECMAScript
   <code>Function</code>) causes side effects or returns inconsistent results
   each time it is invoked.

  <div class=example>
   <p>In the following example, the <code><a
    href="#nsresolver">NSResolver</a></code> causes a side effect when
    executed.</p>

   <pre>function resolver(prefix) {
  sideEffect();
  if (prefix == "test") {
    return "http://example.org/test";
  }
}

var x = document.querySelectorAll("test|*:empty > test|p", resolver)
</pre>

   <p>Some user agents may not need to <span>resolve the namespace
    prefix</span> in order to determine that the selector cannot match any
    elements, in which case <code>sideEffect()</code> will not be invoked.</p>

   <p>The following example could return inconsistent results each time it is
    invoked, depending on the order in which namespace prefixes are resolved
    and the number of times the resolver is invoked to for the
    <code>foo</code> prefix.</p>

   <pre>var i = 0;
function resolver(prefix) {

  var ns = ["http://example.org/foo",
            "http://example.org/bar",
            "http://example.org/baz"];
  return ns[i++];
}

var x = document.querySelectorAll(&quot;foo|x, foo|y, bar|z", resolver);
</pre>

   <p>This could result in selecting <code>x</code>, <code>y</code> and
    <code>z</code> elements from almost any combination of namespaces that
    may be returned. The result is unpredictable and different results may
    occur in different user agents.</p>
  </div>

  <h4 id=extensibility><span class=secno>1.2.3. </span>Extensibility</h4>

  <p><em>This section is non-normative.</em>

  <p>Extensions of the APIs defined in this specification are <em>strongly
   discouraged</em>. User agents, Working Groups and other interested parties
   should discuss extensions on a relevant public forum, such as <a
   href="mailto:public-webapi@w3.org">public-webapi@w3.org</a>.

  <h3 id=security><span class=secno>1.3. </span>Security Considerations</h3>

  <p>It is expected that implementing this specification introduces no new
   security risks for users.

  <p>User agents <em class=ct>should</em> ensure they remain stable when
   facing a hostile <code><a href="#nsresolver">NSResolver</a></code> object.
   Potentially hostile behaviour includes:

  <ul>
   <li>Returning inconsistent results;

   <li>Hanging;

   <li>Changing the DOM during the operation.
  </ul>

  <h3 id=privacy><span class=secno>1.4. </span>Privacy Considerations</h3>

  <p>History theft is a potential privacy issue because the
   <code>:visited</code> pseudo-class in Selectors [<cite><a
   href="#ref-selectors">Selectors</a></cite>] allows authors to query which
   links have been visited.

  <p class=note>This is not a new problem, as it can already be exploited
   using existing CSS and DOM APIs, such as <code>getComputedStyle()</code>
   [<cite><a href="#ref-dom2style">DOM2Style</a></cite>].

  <div class=example>
   <p>In this example, <var>vlinks</var> will aquire a list of links that the
    user has visited. The author can then obtain the URIs and potentially
    exploit this knowledge.</p>

   <pre>var vlinks = document.querySelectorAll(":visited");
for (var i = 0; i &lt; vlinks.length; i++) {
  doSomethingEvil(vlinks[i].href);
}</pre>
  </div>

  <p>As <a href="http://www.w3.org/TR/css3-selectors/#link">defined in
   <cite>Selectors</cite></a> ([<cite><a
   href="#ref-selectors">Selectors</a></cite>], section 6.6.1), user agents
   <em class=ct>may</em> treat all links as unvisited links, or implement
   other measures to preserve the user’s privacy.

  <h2 id=documentselector><span class=secno>2. </span>The <code
   title="">querySelector()</code> and <code
   title="">querySelectorAll()</code> Methods</h2>

  <p>Objects implementing the <code>Document</code> interface <em
   class=ct>must</em> also implement the <code><a
   href="#dom-document-selector">DocumentSelector</a></code> interface.
   Likewise objects implementing the <code>Element</code> interface <em
   class=ct>must</em> also implement the <code><a
   href="#dom-element-selector">ElementSelector</a></code> interface.
   [<cite><a href="#ref-dom3core">DOM3Core</a></cite>]

  <pre
   class=idl>interface <dfn id=dom-document-selector>DocumentSelector</dfn> {
  Element         <a href="#document-selectelement" title=document-selectelement>querySelector</a>(in DOMString selectors);
  Element         <a href="#document-selectelement" title=document-selectelement>querySelector</a>(in DOMString selectors, in <a href="#nsresolver">NSResolver</a> nsresolver);
  <a href="#staticnodelist0">StaticNodeList</a>  <a href="#document-selectallelements" title=document-selectallelements>querySelectorAll</a>(in DOMString selectors);
  <a href="#staticnodelist0">StaticNodeList</a>  <a href="#document-selectallelements" title=document-selectallelements>querySelectorAll</a>(in DOMString selectors, in <a href="#nsresolver">NSResolver</a> nsresolver);
};

interface <dfn id=dom-element-selector>ElementSelector</dfn> {
  Element         <a href="#element-selectelement" title=element-selectelement>querySelector</a>(in DOMString selectors);
  Element         <a href="#element-selectelement" title=element-selectelement>querySelector</a>(in DOMString selectors, in <a href="#nsresolver">NSResolver</a> nsresolver);
  <a href="#staticnodelist0">StaticNodeList</a>  <a href="#element-selectallelements" title=element-selectallelements>querySelectorAll</a>(in DOMString selectors);
  <a href="#staticnodelist0">StaticNodeList</a>  <a href="#element-selectallelements" title=element-selectallelements>querySelectorAll</a>(in DOMString selectors, in <a href="#nsresolver">NSResolver</a> nsresolver);
}
</pre>

  <p>The <dfn id=document-selectelement
   title=document-selectelement><code>querySelector()</code></dfn> methods on
   the <code><a href="#dom-document-selector">DocumentSelector</a></code>
   interface <em class=ct>must</em>, when invoked, return the first
   <code>Element</code> node within the document, in document order (using
   depth-first pre-order traversal), that matches the group of selectors
   (<var>selectors</var>), if any. Otherwise it <em class=ct>must</em> return
   <code>null</code>.

  <p>The <dfn id=element-selectelement
   title=element-selectelement><code>querySelector()</code></dfn> methods on
   the <code><a href="#dom-element-selector">ElementSelector</a></code>
   interface <em class=ct>must</em>, when invoked, return the first
   <code>Element</code> node in document order that is a descendant of the
   element on which the method was invoked and matches the group of selectors
   (<var>selectors</var>), if any. Otherwise it <em class=ct>must</em> return
   <code>null</code>.

  <p>The <dfn id=document-selectallelements
   title=document-selectallelements><code>querySelectorAll()</code></dfn>
   methods on the <code><a
   href="#dom-document-selector">DocumentSelector</a></code> interface <em
   class=ct>must</em>, when invoked, return a <code><a
   href="#staticnodelist0">StaticNodeList</a></code> of all the
   <code>Element</code> nodes within the document, in document order, that
   match the group of selectors (<var>selectors</var>) in document order, if
   any. Otherwise it <em class=ct>must</em> return an empty <code><a
   href="#staticnodelist0">StaticNodeList</a></code>.

  <p>The <dfn id=element-selectallelements
   title=element-selectallelements><code>querySelectorAll()</code></dfn>
   methods on the <code><a
   href="#dom-element-selector">ElementSelector</a></code> interface <em
   class=ct>must</em>, when invoked, return a <code><a
   href="#staticnodelist0">StaticNodeList</a></code> of all the
   <code>Element</code> nodes, in document order, that are descendants of the
   element on which the method was invoked and matches the group of selectors
   (<var>selectors</var>), if any. Otherwise it <em class=ct>must</em> return
   an empty <code><a href="#staticnodelist0">StaticNodeList</a></code>.

  <p>Both <code title=document-selectelement><a
   href="#document-selectelement">querySelector()</a></code> and <code
   title=document-selectallelements><a
   href="#document-selectallelements">querySelectorAll()</a></code> take a
   group of selectors (<var>selectors</var>) as the first argument and
   optionally an <code><a href="#nsresolver">NSResolver</a></code> (<var
   title="">nsresolver</var>) as the second. User agents <em
   class=ct>must</em> use the <var title="">nsresolver</var> argument to <a
   href="#resolve">resolve namespace prefixes</a> to namespaces or to <a
   href="#get-default-namespace">get the default namespace</a>. When the <var
   title="">nsresolver</var> argument is <code>null</code> user agents <em
   class=ct>must</em> ignore it. [<cite><a
   href="#ref-selectors">Selectors</a></cite>]

  <p>When using namespace prefixes within <var>selectors</var> or if there
   needs to be a default namespace, authors <em class=ct>must</em> pass an
   <code><a href="#nsresolver">NSResolver</a></code> object, or a
   <code>Function</code> in the case of ECMAScript, as the argument for <var
   title="">nsresolver</var>. Otherwise, authors <em class=ct>may</em> set
   the argument to <code>null</code> or omit it if the language binding
   permits.

  <p>If the given group of selectors (<var>selectors</var>) is invalid, the
   user agent <em class=ct>must</em> <a
   href="http://www.w3.org/TR/DOM-Level-3-Core/core.html#DOMException-SYNTAX_ERR">raise
   a <code>SYNTAX_ERR</code> exception</a> ([<cite><a
   href="#ref-dom3core">DOM3Core</a></cite>], section 1.4).

  <p>An <dfn id=unresolvable>unresolvable namespace</dfn> is a namespace that
   cannot be resolved because there was no <code><a
   href="#nsresolver">NSResolver</a></code> provided or the given <code><a
   href="#nsresolver">NSResolver</a></code> does not return a namespace for
   the namespace prefix. When an <a href="#unresolvable">unresolvable
   namespace</a> is encountered, the user agent <em class=ct>must</em> <a
   href="http://www.w3.org/TR/DOM-Level-3-Core/core.html#DOMException-NAMESPACE_ERR">raise
   a <code>NAMESPACE_ERR</code> exception</a> ([<cite><a
   href="#ref-dom3core">DOM3Core</a></cite>], section 1.4).

  <p class=note>The default namespace does not need to be defined.

  <p>If an exception is raised by the <code><a
   href="#nsresolver">NSResolver</a></code> while resolving namespaces,
   processing must be aborted and the exception propagated to the caller.

  <p>In languages that support optional arguments for methods, like
   ECMAScript, if the <var title="">nsresolver</var> argument is omitted, the
   user agent <em class=ct>must</em> act as if the <var
   title="">nsresolver</var> argument was set to <code>null</code>.

  <p class=note>Using pseudo-elements in one of the selectors could mean that
   nothing is returned for that particular selector when it doesn’t resolve
   in one or more <code>Element</code> nodes.

  <div class=example>
   <p>The methods accept a group of selectors (comma separated) as the
    argument. The following example would select all <code>p</code> elements
    in the document that have a class of either
    &quot;<code>error</code>&quot; or &quot;<code>warning</code>&quot;.

   <pre>var alerts = document.querySelectorAll("p.warning, p.error");</pre>

   <p>The <code title=document-selectelement><a
    href="#document-selectelement">querySelector()</a></code> method also
    accepts a group of selectors and it will return the first element that
    matches either selector in the group (if any).</p>

   <pre>var x = document.querySelector("#foo, #bar");</pre>

   <p><var>x</var> would contain the first element in the document with an ID
    of either <code>foo</code> or <code>bar</code> (or both).</p>

   <p>The methods can also be invoked on elements. In this example, the
    method is invoked on an element that is the target of an event listener.</p>

   <pre>function handle(evt) {
  var x = evt.target.querySelector(&quot;span&quot;);
  ...
  // Do something with x
}</pre>
  </div>

  <h3 id=nsresolver-interface><span class=secno>2.1. </span>The <code
   title="">NSResolver</code> Interface</h3>

  <p>The <code><a href="#nsresolver">NSResolver</a></code> interface allows
   prefixes to be bound to a namespace URI. The object implementing this
   interface is expected to be implemented by authors.

  <p class=note>Other specifications may introduce methods that return an
   object implementing <code><a href="#nsresolver">NSResolver</a></code> in
   which case it would be implemented by the user agent.

  <pre class=idl>interface <dfn id=nsresolver>NSResolver</dfn> {
  DOMString       <a href="#lookupnamespaceuri">lookupNamespaceURI</a>(in DOMString prefix);
};</pre>

  <p>The <dfn id=lookupnamespaceuri><code>lookupNamespaceURI()</code></dfn>
   method <em class=ct>must</em>, when invoked, return the namespace
   represented by the prefix (<var>prefix</var>) or the default namespace if
   the <var>prefix</var> argument is an empty string.

  <p>When the <code><a
   href="#lookupnamespaceuri">lookupNamespaceURI()</a></code> method is
   invoked with a prefix as the argument, it <em class=ct>must</em> return
   the namespace URI for the given prefix. When the <code><a
   href="#lookupnamespaceuri">lookupNamespaceURI()</a></code> method is
   invoked with an empty string as the argument (representing the default
   namespace), it <em class=ct>must</em> do either of the following:

  <ul>
   <li>If there is a default namespace, return the default namespace URI.

   <li>If there is no default namespace, return either the empty string,
    <code>null</code>, or (if permitted by the language binding) no return
    value (<code>undefined</code>).<br>
  </ul>

  <p>The <code><a href="#lookupnamespaceuri">lookupNamespaceURI()</a></code>
   <em class=ct>must</em> return consistent results each time it is invoked.

  <p class=note>Authors are <em>strongly discouraged</em> from writing an
   <code><a href="#nsresolver">NSResolver</a></code> that returns
   inconsistent results.

  <p>In ECMAScript (and other languages that allow similar constructs), this
   object <em class=ct>may</em> be implemented as a <code>Function</code>. In
   such languages, user agents <em class=ct>must</em> support <code><a
   href="#nsresolver">NSResolver</a></code> being implemented as a
   <code>Function</code>.

  <p>To <dfn id=resolve>resolve namespace prefixes</dfn>, if there was an
   <code><a href="#nsresolver">NSResolver</a></code> object provided, user
   agents <em class=ct>must</em> pass the prefix, preserving case, to the
   <code><a href="#lookupnamespaceuri">lookupNamespaceURI()</a></code>
   method. User agents <em class=ct>must</em> handle prefixes case
   sensitively. If there was no <code><a
   href="#nsresolver">NSResolver</a></code> object provided, or if the method
   returns an empty string or does not return a <code>DOMString</code>, the
   prefix represents an <a href="#unresolvable">unresolvable namespace</a>.
   Otherwise, the return value is the namespace for the given prefix.

  <p class=note>The case sensitivity of namespace prefixes is effectively
   determined by the implementation of the <code><a
   href="#nsresolver">NSResolver</a></code> object that is used to resolve
   the namespaces.

  <p class=note>In Unicode, caseless matching requires both strings that are
   being compared, to be case folded prior to performing a binary comparison
   [<cite><a href="#ref-casemap">CaseMap</a></cite>]. However, since case
   folding is not the same as simply uppercasing or lowercasing both strings
   and because the comparison is being performed by the <code><a
   href="#nsresolver">NSResolver</a></code> object implemented by the author,
   this specification cannot require case insensitive namespace prefixes.

  <p>To <dfn id=get-default-namespace>get the default namespace</dfn>, if
   there was an <code><a href="#nsresolver">NSResolver</a></code> object
   provided, user agents <em class=ct>must</em> invoke the <code><a
   href="#lookupnamespaceuri">lookupNamespaceURI()</a></code> method with the
   empty string as the argument. If there is no <code><a
   href="#nsresolver">NSResolver</a></code> object provided, or if the method
   returns an empty string, <code>null</code>, <code>undefined</code>, or
   equivalent, then there is no default namespace. Otherwise, if the method
   does not return a <code>DOMString</code>, the default namespace is an <a
   href="#unresolvable-namespace">unresolvable namespace</a>. Otherwise, the
   return value is the default namespace.

  <p>The number of times that a user agent <em class=ct>may</em> invoke the
   <code><a href="#lookupnamespaceuri">lookupNamespaceURI()</a></code> method
   with each prefix and the order in which prefixes are resolved is not
   defined by this specification.

  <div class=example>
   <p>The follwoing examples make use of this sample document.</p>

   <pre>&lt;html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:svg="http://www.w3.org/2000/svg"
      xml:lang="en">
  &lt;head>
    &lt;title&gt;Selectors API Example&lt;/title&gt;
  &lt;/head>
  &lt;body>
    &lt;div>&lt;svg:svg … > … &lt;/svg:svg>&lt;/div&gt;
    &lt;p>&lt;svg:svg … > … &lt;/svg:svg>&lt;/p&gt;
    &lt;p>&lt;svg xmlns="http://www.w3.org/2000/svg" … > … &lt;/svg>&lt;/p>
  &lt;/body>
&lt;/html> </pre>

   <p>The <code><a href="#nsresolver">NSResolver</a></code> may be
    implemented as an object with a <code><a
    href="#lookupnamespaceuri">lookupNamespaceURI</a></code> method.</p>

   <pre>var resolver = {
  lookupNamespaceURI: function(prefix) {
    var ns = {
      "xh"  :"http://www.w3.org/1999/xhtml",
      "xbl" :"http://www.w3.org/ns/xbl",
      "svg" :"http://www.w3.org/2000/svg",
      "math":"http://www.w3.org/1998/Math/MathML"
    };
    return ns[prefix];
  }
}</pre>

   <p>For convenience, in ECMAScript, the <code><a
    href="#nsresolver">NSResolver</a></code> may also be implemented as a
    function. In the above example, namespace prefixes are resolved case
    sensitively. If case insensitve namespace prefixes are desired, it is
    possible to implement this in the resolver by altering the case of the
    prefix before comparison.</p>

   <pre>function resolver(prefix) {
  var ns = {
    "xh"  :"http://www.w3.org/1999/xhtml",
    "xbl" :"http://www.w3.org/ns/xbl",
    "svg" :"http://www.w3.org/2000/svg",
    "math":"http://www.w3.org/1998/Math/MathML"
  };
  return ns[prefix.toLowerCase()];
}

var svgImages = document.querySelectorAll(&quot;xh|p SVG|svg&quot;, resolver);</pre>

   <p>Using the case insensitive namespace resolver, the prefix
    <code>xh</code> will be resolved as
    <code>http://www.w3.org/1999/xhtml</code> and <code>SVG</code> as
    <code>http://www.w3.org/2000/svg</code>. The <var>svgImages</var>
    variable will be a <code><a
    href="#staticnodelist0">StaticNodeList</a></code> containing the two
    <code>svg</code> elements that are descendents of the <code>p</code>
    elements.</p>

   <p>The default namespace can be specified so that prefixes do not need to
    be used for selecting elements in a specific namespace. In the following
    example, the default namespace has been set to the XHTML namespace.</p>

   <pre>function resolver(prefix) {
  var ns = {
    ""    :"http://www.w3.org/1999/xhtml", // Default namespace
    "xbl" :"http://www.w3.org/ns/xbl",
    "svg" :"http://www.w3.org/2000/svg",
    "math":"http://www.w3.org/1998/Math/MathML"
  };
  return ns[prefix];
}
</pre>

   <p>Using this resolver, the previous example can be rewritten without
    explicitly declaring the XHTML namespace using the <code>xh</code>
    prefix.</p>

   <pre>var svgImages = document.querySelectorAll(&quot;p svg|svg&quot;, resolver);</pre>

   <p>In the following example, the <code>foo</code> namespace is undefined
    and will result in an unresolvable namespace. The
    <code>NAMESPACE_ERR</code> exception can be handled using a
    <code>try</code>/<code>catch</code> block.</p>

   <pre>try {
  document.querySelectorAll(&quot;foo|bar&quot;, resolver);
} catch (e) {
  switch (e.code) {
  case DOMException.NAMESPACE_ERR:
    // Namespace error
    break;
  case DOMException.SYNTAX_ERR:
    // Syntax error
    break;
  default:
    // Unknown error
  }
}</pre>
  </div>

  <h3 id=staticnodelist><span class=secno>2.2. </span>The <code
   title="">StaticNodeList</code> Interface</h3>

  <pre
   class=idl>typedef <dfn id=staticnodelist0>StaticNodeList</dfn> NodeList;</pre>

  <p>The <code><a href="#staticnodelist0">StaticNodeList</a></code> <em
   class=ct>must</em> be implemented identically to the <code>NodeList</code>
   interface as defined in DOM Level 3 Core [<cite><a
   href="#ref-dom3core">DOM3Core</a></cite>] with the exception that the
   interface, as the name suggests, is static and not live.

  <div class=example>
   <p>This example demonstrates how to iterate through the items in a
    <code><a href="#staticnodelist0">StaticNodeList</a></code>.</p>

   <pre>var lis = document.querySelectorAll(&quot;ul.nav&gt;li&quot;);
for (var i = 0; i &lt; lis.length; i++) {
  process(lis.item(i));
}</pre>

   <p>In ECMAScript, the language binding also allows <code>NodeList</code>s
    and <code><a href="#staticnodelist0">StaticNodeList</a></code>s to be
    addressed using the array notation, so that loop could be rewritten like
    this:</p>

   <pre>for (var i = 0; i &lt; lis.length; i++) {
  process(lis[i]);
}</pre>

   <p>Since a <code><a href="#staticnodelist0">StaticNodeList</a></code> is
    not live, changes to the DOM do not affect the content of the list.
    Consider the <code>process()</code> function called in the previous
    examples is defined as follows:</p>

   <pre>funtction process(elmt) {
  elmt.parentNode.removeChild(elmt);
}</pre>

   <p>This would cause each selected element to be removed from the DOM, but
    each element will remain in the <code><a
    href="#staticnodelist0">StaticNodeList</a></code>. If the list were a
    live <code>NodeList</code>, removing an item from the DOM would also
    remove the element from the list and adjust the indexes of subsequent
    elements. That would have adverse effects upon the loop because not all
    selected elements would be processed.</p>
  </div>

  <h2 class=no-num id=references>References</h2>

  <dl>
   <dt id=ref-casemap>[CaseMap]

   <dd>(Non-normative) <cite><a
    href="http://unicode.org/reports/tr21/tr21-5.html">Unicode Standard Annex
    #21 Case Mappings</a></cite>, M. Davis, editor. Unicode Consortium, March
    2001.

   <dt id=ref-css21>[CSS21]

   <dd>(Non-normative) <cite><a href="http://www.w3.org/TR/CSS21">Cascading
    Style Sheets, level 2 revision 1</a></cite>, B. Bos, T. Çelik, I.
    Hickson, H. Wium Lie, editors. World Wide Web Consortium, June 2005.

   <dt id=ref-dom2style>[DOM2Style]

   <dd>(Non-normative) <cite><a
    href="http://www.w3.org/TR/DOM-Level-2-Style/">Document Object Model
    (DOM) Level 2 Style Specification</a></cite>, C. Wilson, P. Le Hégaret,
    V. Apparao, editors. World Wide Web Consortium, November 2000.

   <dt id=ref-dom3core>[DOM3Core]

   <dd><cite><a href="http://www.w3.org/TR/DOM-Level-3-Core">Document Object
    Model (DOM) Level 3 Core Specification</a></cite>, A. Le Hors, P. Le
    Hégaret, L. Wood, G. Nicol, J. Robie, M. Champion, S. Byrne, editors.
    World Wide Web Consortium, April 2004.

   <dt id=ref-ecma262>[ECMAScript]

   <dd><cite><a
    href="http://www.ecma-international.org/publications/standards/Ecma-262.htm">ECMAScript
    Language Specification</a></cite>, Third Edition. ECMA, December 1999.

   <dt id=ref-rfc2119>[RFC2119]

   <dd><cite><a href="http://ietf.org/rfc/rfc2119">RFC 2119: Key words for
    use in RFCs to Indicate Requirement Levels</a></cite>, S. Bradner. IETF,
    March 1997.

   <dt id=ref-selectors>[Selectors]

   <dd><cite><a
    href="http://www.w3.org/TR/css3-selectors">Selectors</a></cite>, D.
    Glazman, T. Çelik, I. Hickson, P. Linss, J. Williams, editors. World
    Wide Web Consortium, December 2005.
  </dl>

  <h2 class=no-num id=acknowledgements>Acknowledgements</h2>

  <p>The editor would like to thank to the following people who have
   contributed to this specification (ordered on first name):

  <ul>
   <li>Alex Russell

   <li>Björn Höhrmann

   <li>Cameron McCormack

   <li>Charles McCathieNevile

   <li>Chris Wilson

   <li>Daniel Schierbeck

   <li>Dave Massy

   <li>Dean Jackson

   <li>Ian Hickson

   <li>Jim Ley

   <li>Jonas Sicking

   <li>Jorgen Horstink

   <li>Karl Dubost

   <li>Maciej Stachowiak

   <li>Mohamed Zergaoui

   <li>Philip Taylor

   <li>Robert Sayre

   <li>Robin Berjon

   <li>Simon Pieters

   <li>Tarquin Wilton-Jones

   <li>Travis Leithead
  </ul>

  <p>Thanks to all those who have helped to improve this specification by
   sending suggestions and corrections. (Please, keep bugging us with your
   issues!)
