<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<!-- XXXX
 * response member values in case of non same-origin
 * merging better XMLHttpRequest Level 1 definitions
 * fixing request stuff
-->

<html lang=en-US>
 <head>
  <title>XMLHttpRequest Level 2</title>

  <style type="text/css">
   pre.idl { border:solid thin; background:#eee; color:#000; padding:0.5em }
   pre.idl :link, pre.idl :visited { color:inherit; background:transparent }
   pre code { color:inherit; background:transparent }
   div.example { margin-left:1em; padding-left:1em; border-left:double; color:#222; background:#fcfcfc }
   .note { margin-left:2em; font-weight:bold; font-style:italic; color:#008000 }
   p.note::before { content:"Note: " }
   .issue { padding:.5em; border:solid #f00 }
   p.issue::before { content:"Issue: " }
   dl.switch { padding-left:2em }
   dl.switch dt { text-indent:-1.5em }
   dl.switch dt:before { content:'\21AA'; padding:0 0.5em 0 0; display:inline-block; width:1em; text-align:right; line-height:0.5em }
   em.ct { text-transform:lowercase; font-variant:small-caps; font-style:normal }
   dfn { font-weight:bold; font-style:normal }
   code { color:orangered }
   code :link, code :visited { color:inherit }
   h1 code, h2 code, h3 code { color:inherit; background:inherit; font:inherit }
  </style>
  <link href="http://www.w3.org/StyleSheets/TR/W3C-ED" rel=stylesheet>

 <body>
  <div class=head>
   <p><a href="http://www.w3.org/"><img alt=W3C height=48
    src="http://www.w3.org/Icons/w3c_home" width=72></a></p>

   <h1 class=head id=xmlhttprequest-level-2><code
    title="">XMLHttpRequest</code> Level 2</h1>

   <h2 class="no-num no-toc" id=w3c-doctype>Editor's Draft 26 September 2008</h2>

   <dl>
    <dt>This Version:

    <dd><a
     href="http://www.w3.org/TR/2008/ED-XMLHttpRequest2-20080926/">http://www.w3.org/TR/2008/ED-XMLHttpRequest2-20080926/</a>

    <dt>Latest Version:

    <dd><a
     href="http://www.w3.org/TR/XMLHttpRequest2/">http://www.w3.org/TR/XMLHttpRequest2/</a>

    <dt>Latest Editor Version:

    <dd><a
     href="http://dev.w3.org/2006/webapi/XMLHttpRequest-2/">http://dev.w3.org/2006/webapi/XMLHttpRequest-2/</a>

    <dt>Previous Version:

    <dd><a
     href="http://www.w3.org/TR/2008/WD-XMLHttpRequest2-20080225/">http://www.w3.org/TR/2008/WD-XMLHttpRequest2-20080225/</a>

    <dt>Editor:

    <dd><a href="http://annevankesteren.nl/">Anne van Kesteren</a> (<a
     href="http://www.opera.com/">Opera Software ASA</a>) &lt;<a
     href="mailto:annevk@opera.com">annevk@opera.com</a>&gt;
   </dl>

   <p class=copyright><a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
    &copy; 2007 <a href="http://www.w3.org/"><acronym title="World Wide Web
    Consortium">W3C</acronym></a><sup>&reg;</sup> (<a
    href="http://www.csail.mit.edu/"><acronym title="Massachusetts Institute
    of Technology">MIT</acronym></a>, <a
    href="http://www.ercim.org/"><acronym title="European Research Consortium
    for Informatics and Mathematics">ERCIM</acronym></a>, <a
    href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. W3C <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
    <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>
    and <a
    href="http://www.w3.org/Consortium/Legal/copyright-documents">document
    use</a> rules apply.</p>
  </div>

  <hr>

  <h2 class="no-num no-toc" id=specabstract>Abstract</h2>

  <p><code title="">XMLHttpRequest</code> Level 2 enhances <code
   title="">XMLHttpRequest</code> with new features, such as cross-site
   requests, progress events, and the handling of byte streams for both
   sending and receiving.

  <h2 class="no-num no-toc" id=sotd>Status of this Document</h2>

  <p><em>This section describes the status of this document at the time of
   its publication. Other documents may supersede this document. A list of
   current W3C publications and the latest revision of this technical report
   can be found in the <a href="http://www.w3.org/TR/">W3C technical reports
   index</a> at http://www.w3.org/TR/.</em>

  <p>This is the 26 September 2008 Working Draft of <code
   title="">XMLHttpRequest</code> Level 2. Please send comments to <a
   href="mailto:public-webapps@w3.org?subject=[XHR2]%20">public-webapps@w3.org</a>
   (<a
   href="http://lists.w3.org/Archives/Public/public-webapps/">archived</a>)
   with <samp>[XHR2]</samp> at the start of the subject line.

  <p class=issue>In case of conflict with the editor's draft of <a
   href="http://dev.w3.org/2006/webapi/XMLHttpRequest/">The
   <code>XMLHttpRequest</code> Object</a> that draft is likely to be more
   accurate. Please raise such differences on the <a
   href="mailto:public-webapps@w3.org?subject=[XHR2]%20">public-webapps@w3.org</a>
   mailing list taking into account that this draft defines a superset.

  <p>This document is produced by the <a
   href="http://www.w3.org/2008/webapps/">Web Applications</a> (WebApps)
   Working Group. The WebApps Working Group is part of the <a
   href="http://www.w3.org/2006/rwc/Activity">Rich Web Clients Activity</a>
   in the W3C <a href="http://www.w3.org/Interaction/">Interaction
   Domain</a>.

  <p>This document was produced by a group operating under the <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February
   2004 W3C Patent Policy</a>. W3C maintains a <a
   href="http://www.w3.org/2004/01/pp-impl/42538/status"
   rel=disclosure>public list of any patent disclosures</a> made in
   connection with the deliverables of the group; that page also includes
   instructions for disclosing a patent. An individual who has actual
   knowledge of a patent which the individual believes contains <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
   Claim(s)</a> must disclose the information in accordance with <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
   6 of the W3C Patent Policy</a>.

  <p>Publication as a Working Draft does not imply endorsement by the W3C
   Membership. This is a draft document and may be updated, replaced or
   obsoleted by other documents at any time. It is inappropriate to cite this
   document as other than work in progress.

  <h2 class="no-num no-toc" id=toc>Table of Contents</h2>
  <!--begin-toc-->

  <ul class=toc>
   <li><a href="#introduction"><span class=secno>1. </span>Introduction</a>

   <li><a href="#conformance"><span class=secno>2. </span>Conformance
    Criteria</a>
    <ul class=toc>
     <li><a href="#dependencies"><span class=secno>2.1
      </span>Dependencies</a>

     <li><a href="#terminology"><span class=secno>2.2 </span>Terminology</a>

     <li><a href="#extensibility"><span class=secno>2.3
      </span>Extensibility</a>
    </ul>

   <li><a href="#xmlhttprequest"><span class=secno>3. </span>The <code
    title="">XMLHttpRequest</code> Object</a>
    <ul class=toc>
     <li><a href="#constructor"><span class=secno>3.1 </span>Constructor</a>

     <li><a href="#event-handler-attributes"><span class=secno>3.2
      </span>Event Handler Attributes</a>

     <li><a href="#ready-states"><span class=secno>3.3 </span>Ready
      States</a>

     <li><a href="#request-metadata"><span class=secno>3.4 </span>Request
      Metadata</a>

     <li><a href="#request"><span class=secno>3.5 </span>Request</a>
      <ul class=toc>
       <li><a href="#tracking"><span class=secno>3.5.1 </span>Tracking Upload
        Progress</a>

       <li><a href="#request0"><span class=secno>3.5.2 </span>Request
        Variables and Algorithms</a>

       <li><a href="#initiating"><span class=secno>3.5.3 </span>Initiating a
        Request</a>

       <li><a href="#aborting"><span class=secno>3.5.4 </span>Aborting a
        Request</a>
      </ul>

     <li><a href="#response-metadata"><span class=secno>3.6 </span>Response
      Metadata</a>

     <li><a href="#response-body"><span class=secno>3.7 </span>Response
      Body</a>
      <ul class=toc>
       <li><a href="#definitions"><span class=secno>3.7.1
        </span>Definitions</a>

       <li><a href="#response"><span class=secno>3.7.2 </span>Response Body
        Members</a>
      </ul>

     <li><a href="#events"><span class=secno>3.8 </span>Events summary</a>

     <li><a href="#exceptions"><span class=secno>3.9 </span>Exceptions</a>
    </ul>

   <li class=no-num><a href="#references">References</a>

   <li class=no-num><a href="#acknowledgments">Acknowledgments</a>
  </ul>
  <!--end-toc-->

  <h2 id=introduction><span class=secno>1. </span>Introduction</h2>

  <p class=issue>To be written.

  <h2 id=conformance><span class=secno>2. </span>Conformance Criteria</h2>

  <p>Everything in this specification is normative except for diagrams,
   examples, notes and sections marked non-normative.

  <p>The key words <em class=ct>must</em>, <em class=ct>must not</em>, <em
   class=ct>should</em> and <em class=ct>may</em> in this document are to be
   interpreted as described in RFC 2119. [<cite><a
   href="#ref-rfc2119">RFC2119</a></cite>]

  <p>This specification defines a single conformance class:

  <dl>
   <dt><dfn id=conforming-user-agent>Conforming user agent</dfn>

   <dd>
    <p>A user agent <em class=ct>must</em> behave as described in this
     specification in order to be considered conformant.</p>

    <p>User agents <em class=ct>may</em> optimize any algorithm given in this
     specification, so long as the end result is indistinguishable from the
     result that would be obtained by the specification's algorithms.</p>

    <p class=note>This specification uses both the terms "conforming user
     agent(s)" and "user agent(s)" to refer to this product class.</p>
  </dl>

  <h3 id=dependencies><span class=secno>2.1 </span>Dependencies</h3>

  <p>This specification relies on several underlying specifications.

  <dl>
   <dt>Access Control for Cross-site Requests

   <dd>
    <p>A <a href="#conforming-user-agent" title="conforming user
     agent">conforming user agent</a> <em class=ct>must</em> support the
     algorithms of the Access Control for Cross-site Requests specification.
     [<cite><a href="#ref-ac">AC</a></cite>]

   <dt>DOM

   <dd>
    <p>A <a href="#conforming-user-agent" title="conforming user
     agent">conforming user agent</a> <em class=ct>must</em> support at least
     the subset of the functionality defined in DOM Events and DOM Core that
     this specification relies upon, such as various exceptions
     <code>EventTarget</code>. [<cite><a
     href="#ref-dom2events">DOM2Events</a></cite>] [<cite><a
     href="#ref-dom3core">DOM3Core</a></cite>]

   <dt>HTML&nbsp;5

   <dd>
    <p>A <a href="#conforming-user-agent">conforming user agent</a> <em
     class=ct>must</em> support at least the subset of the functionality
     defined in HTML&nbsp;5 that this specification relies upon, such as the
     <code>Window</code> object and serializing a <code>Document</code>
     object. [<cite><a href="#ref-html5">HTML5</a></cite>]</p>

    <p class=note>The <a
     href="http://www.w3.org/TR/2006/WD-Window-20060407/">Window Object
     1.0</a> draft is not referenced normatively as it appears to be no
     longer maintained and HTML&nbsp;5 defines the <code>Window</code> object
     in more detail. This specification already depends on HTML&nbsp;5 for
     other reasons so there is not much additional overhead because of this.</p>

   <dt>HTTP

   <dd>
    <p>A <a href="#conforming-user-agent" title="conforming user
     agent">conforming user agent</a> <em class=ct>must</em> support some
     version of the HTTP protocol. Requirements regarding HTTP are made
     throughout the specification. [<cite><a
     href="#rfc-rfc2616">RFC2616</a></cite>]

   <dt>Web IDL

   <dd>A <a href="#conforming-user-agent">conforming user agent</a> <em
    class=ct>must</em> also be a conforming implementation of the IDL
    fragments in this specification, as described in the Web IDL
    specification. [<cite><span>WebIDL</span></cite>]

   <dt>XML

   <dd>
    <p>A <a href="#conforming-user-agent" title="conforming user
     agent">conforming user agent</a> <em class=ct>must</em> be a conforming
     XML processor that reports violations of namespace well-formedness.
     [<cite><a href="#ref-xml">XML</a></cite>] [<cite><a
     href="#ref-xmlns">XMLNS</a></cite>]
  </dl>

  <h3 id=terminology><span class=secno>2.2 </span>Terminology</h3>

  <p>The terms and algorithms <dfn id=url-fragment>&lt;fragment></dfn>, <dfn
   id=url-scheme>&lt;scheme></dfn>, <dfn id=ascii-case-insensitive>ASCII
   case-insensitive</dfn>, <dfn id=uppercase title=uppercase>converting a
   string to uppercase</dfn>, <dfn id=event-handler-attribute>event handler
   DOM attribute</dfn>, <dfn id=url-base>base URL</dfn>, <dfn
   id=origin>origin</dfn>, <dfn id=same-origin>same origin</dfn>, and <dfn
   id=url-resolve>resolve a URL</dfn> are defined by the HTML&nbsp;5
   specification. [<cite><a href="#ref-html5">HTML5</a></cite>]

  <p>The term <dfn id=entity-body>entity body</dfn> is used as described in
   RFC 2616. <dfn id=method-token>Method token</dfn> is used as described in
   section 5.1.1 of RFC 2616. <dfn
   id=field-name><code>field-name</code></dfn> and <dfn
   id=field-value><code>field-value</code></dfn> are used as described in
   section 4.2 of RFC 2616. [<cite><a href="#rfc-rfc2616">RFC2616</a></cite>]

  <p>The terms <dfn id=status0>status return flag</dfn>, <dfn
   id=url-return>url return flag</dfn>, and <dfn id=cross-site>cross-site
   access request</dfn> are defined by the Access Control for Cross-site
   Requests specification. [<cite><a href="#ref-ac">AC</a></cite>]

  <p>To <dfn id=dispatch-readystatechange-event>dispatch a
   <code>readystatechange</code> event</dfn> means that an event with the
   name <code><a href="#readystatechange-event">readystatechange</a></code>,
   with no namespace, which does not bubble and is not cancelable, and which
   uses the <code>Event</code> interface, <em class=ct>must</em> be
   dispatched at the given object.

  <p class=issue>To <dfn id=dispatch-progress-event title="dispatch a
   progress event">dispatch a progress event called <var>e</var></dfn>
   means&hellip; [<cite><a href="#ref-pe">PE</a></cite>]

  <h3 id=extensibility><span class=secno>2.3 </span>Extensibility</h3>

  <p>Extensions of the API defined by this specification are <em>strongly
   discouraged</em>. User agents, Working Groups and other interested parties
   should discuss extensions on a relevant public forum, preferably <a
   href="mailto:public-webapi@w3.org">public-webapi@w3.org</a>.

  <h2 id=xmlhttprequest><span class=secno>3. </span>The <code
   title="">XMLHttpRequest</code> Object</h2>

  <p>The <code><a href="#xmlhttprequest-interface">XMLHttpRequest</a></code>
   object can be used by scripts to programmatically connect to their
   originating server via HTTP.

  <pre
   class=idl>interface <dfn id=xmlhttprequesteventtarget-interface>XMLHttpRequestEventTarget</dfn> : EventTarget {
  // <a href="#event-handler-attributes">event handler attributes</a>
           attribute EventListener <a href="#onabort">onabort</a>;
           attribute EventListener <a href="#onerror">onerror</a>;
           attribute EventListener <a href="#onload">onload</a>;
           attribute EventListener <a href="#onloadstart">onloadstart</a>;
           attribute EventListener <a href="#onprogress">onprogress</a>;
};

interface <dfn id=xmlhttprequestupload-interface>XMLHttpRequestUpload</dfn> : <a href="#xmlhttprequesteventtarget-interface">XMLHttpRequestEventTarget</a> {
  // for future use
};

[Constructor] interface <dfn id=xmlhttprequest-interface>XMLHttpRequest</dfn> : <a href="#xmlhttprequesteventtarget-interface">XMLHttpRequestEventTarget</a> {
  // <a href="#event-handler-attributes">event handler attributes</a>
           attribute EventListener <a href="#onreadystatechange">onreadystatechange</a>;

  // <a href="#ready-states">ready states</a>
  const unsigned short <a href="#unsent-state" title="UNSENT state">UNSENT</a> = 0;
  const unsigned short <a href="#opened-state" title="OPENED state">OPENED</a> = 1;
  const unsigned short <a href="#headers-received-state" title="HEADERS_RECEIVED state">HEADERS_RECEIVED</a> = 2;
  const unsigned short <a href="#loading-state" title="LOADING state">LOADING</a> = 3;
  const unsigned short <a href="#done-state" title="DONE state">DONE</a> = 4;
  readonly attribute unsigned short <a href="#readystate">readyState</a>;

  // <a href="#request-metadata">request metadata</a>
           attribute boolean <span>withCredentials</span>;
  void <a href="#open">open</a>(in DOMString <var>method</var>, in DOMString <var>url</var>);
  void <a href="#open">open</a>(in DOMString <var>method</var>, in DOMString <var>url</var>, in boolean <var>async</var>);
  void <a href="#open">open</a>(in DOMString <var>method</var>, in DOMString <var>url</var>, in boolean <var>async</var>, [Null=Null, Undefined=Null] in DOMString <var>user</var>);
  void <a href="#open">open</a>(in DOMString <var>method</var>, in DOMString <var>url</var>, in boolean <var>async</var>, [Null=Null, Undefined=Null] in DOMString <var>user</var>, [Null=Null, Undefined=Null] in DOMString <var>password</var>);
  void <a href="#setrequestheader">setRequestHeader</a>(in DOMString <var>header</var>, in DOMString <var>value</var>);
  
  // <a href="#request">request</a>
  readonly attribute <a href="#xmlhttprequestupload-interface">XMLHttpRequestUpload</a> <a href="#upload">upload</a>;
  void <a href="#send">send</a>();
  void <a href="#send">send</a>(in ByteArray <var>data</var>);
  void <a href="#send">send</a>([Null=Null, Undefined=Null] in DOMString <var>data</var>);
  void <a href="#send">send</a>(in Document <var>data</var>);
  void <a href="#abort">abort</a>();

  // <a href="#response-metadata">response metadata</a>
  DOMString <a href="#getallresponseheaders">getAllResponseHeaders</a>();
  DOMString <a href="#getresponseheader">getResponseHeader</a>(in DOMString <var>header</var>);
  readonly attribute unsigned short <a href="#status">status</a>;
  readonly attribute DOMString <a href="#statustext">statusText</a>;
  
  // <a href="#response-body">response body</a>
  void <a href="#overridemimetype">overrideMimeType</a>(<var>mime</var>);
  readonly attribute ByteArray <a href="#responsebody">responseBody</a>;
  readonly attribute DOMString <a href="#responsetext">responseText</a>;
  readonly attribute Document <a href="#responsexml">responseXML</a>;
};</pre>

  <p>The <code>EventTarget</code> interface is defined by the DOM Level 2
   Events specification. [<cite><a
   href="#ref-dom2events">DOM2Events</a></cite>]

  <h3 id=constructor><span class=secno>3.1 </span>Constructor</h3>
  <!-- new XMLHttpRequest(method, url, body, listener) -->

  <p>Objects implementing the <code title="">Window</code> interface <em
   class=ct>must</em> provide the following constructor: <code
   title="">XMLHttpRequest()</code>.

  <div class=example>
   <p>In ECMAScript this can be used as follows:</p>

   <pre><code>var client = new XMLHttpRequest();</code></pre>
  </div>

  <p>When the <code title="">XMLHttpRequest()</code> constructor is invoked a
   persistent pointer to the associated <code title="">Document</code> object
   is stored on the newly created object. This is the <dfn
   id=document-pointer title="Document pointer"><code>Document</code>
   pointer</dfn>. The associated <code>Document</code> object is the one
   returned by the <code>document</code> attribute from the object on which
   the <code title="">XMLHttpRequest()</code> constructor was invoked (a
   <code>Window</code> object). The pointer can become "null" if the object
   is destroyed.

  <p class=note>As per the conformance criteria implementations are free to
   implement this in any way they desire as long as the end results are
   identical to those given by the English prose.

  <div class=example>
   <p>If <var><code>iframe</code></var> is a <code title="">Window</code>
    object <var><code>client</code></var> will have a pointer to
    <var><code>iframe.document</code></var> in the following example:</p>

   <pre><code>var client = new iframe.XMLHttpRequest()</code></pre>
  </div>

  <p>The <a href="#origin">origin</a> of an <code><a
   href="#xmlhttprequest-interface">XMLHttpRequest</a></code> object is the
   <a href="#origin">origin</a> of the associated <code>Document</code>
   object returned by the <a href="#document-pointer"><code>Document</code>
   pointer</a>.

  <h3 id=event-handler-attributes><span class=secno>3.2 </span>Event Handler
   Attributes</h3>

  <p>The event handler attributes listed below <em class=ct>must</em> be
   supported on objects implementing an interface that inherits from <code><a
   href="#xmlhttprequesteventtarget-interface">XMLHttpRequestEventTarget</a></code>.
   Event handler attributes are <a href="#event-handler-attribute"
   title="event handler DOM attribute">event handler DOM attributes</a>.

  <dl>
   <dt><dfn id=onabort><code>onabort</code></dfn>

   <dd>
    <p><em class=ct>Must</em> be invoked whenever an <code
     title=abort-event><a href="#abort-event">abort</a></code> event is
     targeted at the object.

   <dt><dfn id=onerror><code>onerror</code></dfn>

   <dd>
    <p><em class=ct>Must</em> be invoked whenever an <code><a
     href="#error-event">error</a></code> event is targeted at the object.

   <dt><dfn id=onload><code>onload</code></dfn>

   <dd>
    <p><em class=ct>Must</em> be invoked whenever a <code><a
     href="#load-event">load</a></code> event is targeted at the object.

   <dt><dfn id=onloadstart><code>onloadstart</code></dfn>

   <dd>
    <p><em class=ct>Must</em> be invoked whenever a <code><a
     href="#loadstart-event">loadstart</a></code> event is targeted at the
     object.

   <dt><dfn id=onprogress><code>onprogress</code></dfn>

   <dd>
    <p><em class=ct>Must</em> be invoked whenever a <code><a
     href="#progress-event">progress</a></code> event is targeted at the
     object.
  </dl>

  <p>The following event handler attribute <em class=ct>must</em> be
   supported on objects implementing the <code><a
   href="#xmlhttprequest-interface">XMLHttpRequest</a></code> interface:

  <dl>
   <dt><dfn id=onreadystatechange><code>onreadystatechange</code></dfn>

   <dd>
    <p><em class=ct>Must</em> be invoked whenever a <code><a
     href="#readystatechange-event">readystatechange</a></code> event is
     targeted at the object.
  </dl>

  <h3 id=ready-states><span class=secno>3.3 </span>Ready States</h3>

  <p>The <code><a href="#xmlhttprequest-interface">XMLHttpRequest</a></code>
   object can be in several states. The <dfn
   id=readystate><code>readyState</code></dfn> attribute, on getting, <em
   class=ct>must</em> return the current state of the object, which <em
   class=ct>must</em> be one of the following values:

  <dl>
   <dt><dfn id=unsent-state title="UNSENT state"><code>UNSENT</code></dfn>
    (numeric value 0)

   <dd>
    <p>The object has been constructed.

   <dt><dfn id=opened-state title="OPENED state"><code>OPENED</code></dfn>
    (numeric value 1)

   <dd>
    <p>The <code><a href="#open">open()</a></code> method has been
     successfully invoked. During this state request headers can be set using
     <code><a href="#setrequestheader">setRequestHeader()</a></code> and the
     request can be made using the <code><a href="#send">send()</a></code>
     method.

   <dt><dfn id=headers-received-state title="HEADERS_RECEIVED
    state"><code>HEADERS_RECEIVED</code></dfn> (numeric value 2)

   <dd>
    <p>All HTTP headers have been received. Several response members of the
     object are now available.</p>

    <p class=note>For non same origin requests the object will never be in
     this state.</p>

   <dt><dfn id=loading-state title="LOADING state"><code>LOADING</code></dfn>
    (numeric value 3)

   <dd>
    <p>The response entity body is being received.

   <dt><dfn id=done-state title="DONE state"><code>DONE</code></dfn> (numeric
    value 4)

   <dd>
    <p>The data transfer has been completed or something went wrong during
     the transfer (such as infinite redirects).
  </dl>

  <p>The OPENED state has an associated <dfn id=send-flag><code>send()</code>
   flag</dfn> that indicates whether the <code><a
   href="#send">send()</a></code> method has been invoked. It can be either
   "true" or "false" and has an initial value of "false".

  <p>The DONE state has an associated <dfn id=error-flag>error flag</dfn>
   that indicates some type of network error or abortion. It can be either
   "true" or "false" and has an initial value of "false".

  <h3 id=request-metadata><span class=secno>3.4 </span>Request Metadata</h3>

  <p>This section defines the various members of the <code><a
   href="#xmlhttprequest-interface">XMLHttpRequest</a></code> object that can
   be used to initialize a network request.

  <p>When the <dfn id=open title=open><code>open(<var>method</var>,
   <var>url</var>, <var>async</var>, <var>user</var>,
   <var>password</var>)</code></dfn> method is invoked, the user agent <em
   class=ct>must</em> act as if it had run the following steps (unless
   otherwise indicated):

  <ol>
   <li>
    <p>Let <var>stored method</var> be the <var>method</var> argument.

   <li>
    <p>If <var>stored method</var> does not match the <a
     href="#method-token">Method token</a> raise a <code>SYNTAX_ERR</code>
     exception and terminate these steps.

   <li>
    <p>If <var>stored method</var> <a href="#ascii-case-insensitive"
     title="ASCII case-insensitive">case-insensitively matches</a>
     <code>CONNECT</code>, <code>DELETE</code>, <code>GET</code>,
     <code>HEAD</code>, <code>OPTIONS</code>, <code>POST</code>,
     <code>PUT</code>, <code>TRACE</code>, or <code>TRACK</code> <a
     href="#uppercase" title=uppercase>convert <var>stored method</var> to
     uppercase</a>.</p>

    <p class=note>If it does not match any of the above, it is passed through
     <em>literally</em>, including in the final request.</p>
   </li>
   <!-- WebKit (and supposedly Gecko) also uppercase: COPY, INDEX, LOCK,
   M-POST, MKCOL, MOVE, PROPFIND, PROPPATCH, and UNLOCK. -->

   <li>
    <p>If <var>stored method</var> is one of <code>CONNECT</code>,
     <code>TRACE</code>, or <code>TRACK</code> the user agent <em
     class=ct>should</em> raise a <code><a
     href="#security-err">SECURITY_ERR</a></code> exception and terminate
     these steps.</p>

    <p class=note>Allowing these methods would pose a security risk.
     [<cite><a href="#ref-httpverbsec">HTTPVERBSEC</a></cite>]</p>

   <li>
    <p><a href="#url-resolve" title="Resolve a URL">Resolve <var>stored
     url</var></a> with the <a href="#document-pointer"><code>Document</code>
     pointer</a> being the associated <var>document</var> and UTF-8 being the
     <var>encoding</var> of that <var>document</var>. If the <a
     href="#url-resolve">resolve a URL</a> algorithm returns an error raise a
     <code>SYNTAX_ERR</code> exception and terminate these steps.
   </li>
   <!-- Presto and Gecko override the encoding. WebKit does not. Trident
   does not support non-ASCII URLs. This matters for the <query> component,
   see HTML5. -->

   <li>
    <p>Drop <code><a href="#url-fragment">&lt;fragment></a></code> from
     <var>stored url</var>.

   <li>
    <p>If <var>stored url</var> contains an unsupported <code><a
     href="#url-scheme">&lt;scheme></a></code> raise a
     <code>NOT_SUPPORTED_ERR</code> and terminate these steps.

   <li>
    <p>If the <code>"user:password"</code> format in the
     <code>userinfo</code> production defined in section 3.2.1 of RFC 3986 is
     not supported for the relevant scheme and <var>stored url</var> contains
     this format raise a <code>SYNTAX_ERR</code> and terminate these steps.
     [<cite><a href="#ref-rfc3986">RFC3986</a></cite>]

   <li>
    <p>If <var>stored url</var> contains the <code>"user:password"</code>
     format let <var>stored user</var> be the user part and <var>stored
     password</var> be the password part.

   <li>
    <p>If <var>stored url</var> just contains the <code>"user"</code> format
     let <var>stored user</var> be the user part.

   <li class=note>
    <p>The previous level of this specification raised a <code><a
     href="#security-err">SECURITY_ERR</a></code> at this place in case of a
     non same origin <var>stored url</var>. This specification supports non
     same origin requests and therefore this exception is no longer raised
     here.

   <li>
    <p>Let <var>async</var> be the value of the <var>async</var> argument or
     <code>true</code> if it was omitted.

   <li>
    <p>If the <var>user</var> argument was not omitted, and its syntax does
     not match that specified by the relevant authentication scheme, raise a
     <code>SYNTAX_ERR</code> exception and terminate these steps.

   <li>
    <p>If the <var>user</var> argument was not omitted and is not
     <code>null</code>, let <var>stored user</var> be <var>user</var>.</p>

    <p class=note>This step overrides any user that may have been set by the
     <var>url</var> argument.</p>

   <li>
    <p>If the <var>user</var> argument was not omitted and is
     <code>null</code> remove <var>stored user</var>.

   <li>
    <p>If the <var>password</var> argument was not omitted and its syntax
     does not match that specified by the relevant authentication scheme
     raise a <code>SYNTAX_ERR</code> exception and terminate these steps.

   <li>
    <p>If the <var>password</var> argument was not omitted and is not
     <code>null</code>, let <var>stored password</var> be
     <var>password</var>.

   <li>
    <p>If the <var>password</var> argument was not omitted and is
     <code>null</code> remove <var>stored password</var>.

   <li>
    <p><a href="#abort-send-algorithm" title="abort send()">Abort the
     <code>send()</code> algorithm</a>, set <a
     href="#response-entity-body">response entity body</a> to "null" and
     empty the <a href="#author-request-headers">author request headers</a>
     list.</p>

    <p class=note>This step and the next only has effect if <code><a
     href="#send">send()</a></code> and/or <code><a
     href="#setrequestheader">setRequestHeader()</a></code> has been used.</p>

   <li>
    <p>The user agent <em class=ct>should</em> cancel any network activity
     for which the object is responsible.
   </li>
   <!-- we can hardly require it... -->

   <li>
    <p>Switch the object to the <a href="#opened-state" title="OPENED
     state">OPENED</a> state, set the <a
     href="#send-flag"><code>send()</code> flag</a> to "false" and then
     synchronously <a href="#dispatch-readystatechange-event">dispatch a
     <code>readystatechange</code> event</a> on the object and return the
     method call.
  </ol>

  <p>The object has an associated list of <dfn
   id=author-request-headers>author request headers</dfn> consisting of HTTP
   header name/value pairs. The <dfn id=setrequestheader
   title=setRequestHeader><code>setRequestHeader(<var>header</var>)</code></dfn>
   method can be used to set new request headers and append to request
   headers already in the list.

  <p>As indicated in the algorithm below certain headers cannot be set and
   are left up to the user agent. In addition there are certain other headers
   the user agent will take control of if they are not set by the author as
   indicated at the end of the <code><a href="#send">send()</a></code> method
   section.

  <p class=note>The <code><a
   href="#setrequestheader">setRequestHeader()</a></code> method appends a
   value if the header given as argument is already part of the <a
   href="#author-request-headers">author request headers</a> list.

  <p class=note>For non same origin requests using the HTTP <code>GET</code>
   method a preflight request is made when headers other than
   <code>Accept</code> and <code>Accept-Language</code> are set.

  <p>When <code><a href="#setrequestheader">setRequestHeader()</a></code> is
   invoked, the user agent <em class=ct>must</em> follow the following steps
   (unless otherwise indicated):

  <ol>
   <li>
    <p>If the state of the object is not <a href="#opened-state"
     title="OPENED state">OPENED</a> raise an <code>INVALID_STATE_ERR</code>
     exception and terminate these steps.

   <li>
    <p>If the <a href="#send-flag"><code>send()</code> flag</a> is "true"
     raise an <code>INVALID_STATE_ERR</code> exception and terminate these
     steps.

   <li>
    <p>If the <var>header</var> argument does not match the <code><a
     href="#field-name">field-name</a></code> production raise a
     <code>SYNTAX_ERR</code> exception and terminate these steps.

   <li>
    <p>If the <var>value</var> argument does not match the <code><a
     href="#field-value">field-value</a></code> production raise a
     <code>SYNTAX_ERR</code> and terminate these steps.</p>

    <p class=note>The empty string is legal and represents the empty header
     value.</p>

   <li>
    <p>For security reasons, these steps <em class=ct>should</em> be
     terminated if the <var>header</var> argument <span
     title="case-insensitive match">case-insensitively matches</span> one of
     the following headers:</p>

    <ul>
     <li><code>Accept-Charset</code>

     <li><code>Accept-Encoding</code>

     <li><code>Access-Control-Request-Headers</code></li>
     <!-- new in xhr2 -->

     <li><code>Access-Control-Request-Method</code></li>
     <!-- new in xhr2 -->

     <li><code>Authorization</code>

     <li><code>Connection</code>

     <li><code>Content-Length</code>

     <li><code>Cookie</code>

     <li><code>Cookie2</code>

     <li><code>Content-Transfer-Encoding</code>

     <li><code>Date</code>

     <li><code>Expect</code>

     <li><code>Host</code>

     <li><code>Keep-Alive</code>

     <li><code title="">Origin</code></li>
     <!-- new in xhr2 -->

     <li><code>Referer</code>

     <li><code>TE</code>

     <li><code>Trailer</code>

     <li><code>Transfer-Encoding</code>

     <li><code>Upgrade</code>

     <li><code>User-Agent</code>

     <li><code>Via</code>
    </ul>

    <p>&hellip; or if the start of the <var>header</var> argument <span
     title="case-insensitive match">case-insensitively matches</span>
     <code>Proxy-</code> or <code>Sec-</code> (including when the argument is
     just <code>Proxy-</code> or <code>Sec-</code>).</p>

    <p class=note>The above headers are not allowed to be set as they are
     better controlled by the user agent as it knows best what value they
     should have. Header names starting with <code>Sec-</code> are not
     allowed to be set to allow new headers to be minted in the future that
     are guaranteed not to come from <code><a
     href="#xmlhttprequest-interface">XMLHttpRequest</a></code>. (Older
     clients would however still be vulnerable as they allow such headers to
     be set.)</p>

   <li>
    <p>If the <var>header</var> argument is not in the <a
     href="#author-request-headers">author request headers</a> list append
     the <var>header</var> with its associated <var>value</var> to the list
     and terminate these steps.

   <li>
    <p>If the <var>header</var> argument is in the <a
     href="#author-request-headers">author request headers</a> list either
     use multiple headers, combine the values or use a combination of those
     (section 4.2, RFC 2616). [<cite><a
     href="#rfc-rfc2616">RFC2616</a></cite>]
   </li>
   <!-- XXX it seems UAs always combine the values -->
  </ol>

  <p class=note>See also the <code><a href="#send">send()</a></code> method
   regarding user agent header handling for caching, authentication, proxies,
   and cookies.

  <div class=example>
   <pre><code>// The following script:
var client = new XMLHttpRequest();
client.open('GET', 'demo.cgi');
client.setRequestHeader('X-Test', 'one');
client.setRequestHeader('X-Test', 'two');
client.send();

// ...would result in the following header being sent:
...
X-Test: one, two
...</code></pre>
  </div>

  <p>The <dfn id=credentials>credentials flag</dfn> takes the values true and
   false, true by default, and indicates whether a non <a
   href="#same-origin">same origin</a> request includes cookie and HTTP
   authentication data. It is used during the <code><a
   href="#send">send()</a></code> algorithm.

  <p>When the <code>withCredentials</code> attribute is set, the following
   algorithm <em class=ct>must</em> be followed:

  <ol>
   <li>
    <p>If the state of the object is not <a href="#opened-state"
     title="OPENED state">OPENED</a> raise an <code>INVALID_STATE_ERR</code>
     exception and terminate these steps.

   <li>
    <p>If the <a href="#send-flag"><code>send()</code> flag</a> is "true"
     raise an <code>INVALID_STATE_ERR</code> exception and terminate these
     steps.

   <li>
    <p>If the given value is <code>true</code>, set the <a
     href="#credentials">credentials flag</a> to true. Otherwise, set the <a
     href="#credentials">credentials flag</a> to false.
  </ol>

  <p>On getting, the <code>withCredentials</code> attribute <em
   class=ct>must</em> return <code>true</code> if the <a
   href="#credentials">credentials flag</a> is true, and <code>false</code>
   if the <a href="#credentials">credentials flag</a> is false.

  <h3 id=request><span class=secno>3.5 </span>Request</h3>

  <h4 id=tracking><span class=secno>3.5.1 </span>Tracking Upload Progress</h4>

  <p>To track the progress of data being uploaded through the <code><a
   href="#send">send()</a></code> method the <code
   title="">XMLHttpRequest</code> object offers an <dfn
   id=upload><code>upload</code></dfn> attribute. On getting, this attribute
   <em class=ct>must</em> return an object implementing the <code><a
   href="#xmlhttprequestupload-interface">XMLHttpRequestUpload</a></code>
   interface. This object can be used to register event listeners on which
   will be triggered during the upload process.

  <h4 id=request0><span class=secno>3.5.2 </span>Request Variables and
   Algorithms</h4>

  <p>The <dfn id=current>current request URL</dfn> is initially <var>stored
   url</var> (as set by the <code><a href="#open">open()</a></code> method)
   and is updated as described in the <code><a href="#send">send()</a></code>
   algorithm.

  <p>The <dfn id=upload-complete-flag>upload complete flag</dfn> indicates is
   used in several algorithms to determine whether or not to dispatch an
   event. The flag is either true or false (default).

  <p>The <dfn id=upload-events-flag>upload events flag</dfn> is used in the
   <code><a href="#send">send()</a></code> algorithm to determine whether
   upload progress events will be dispatched for non same origin requests.
   The flag is either true or false (default).

  <p>When the steps for the <code><a href="#send">send()</a></code> method
   say something is a <dfn id=network>network error</dfn> the user agent <em
   class=ct>must</em> act as if the following steps had been run:

  <ol>
   <li>
    <p>Set the <a href="#response-entity-body">response entity body</a> to
     "null", the <a href="#error-flag">error flag</a> to "true" and empty the
     <a href="#author-request-headers">author request headers</a> list.

   <li>
    <p>Synchronously switch the state to <a href="#done-state" title="DONE
     state">DONE</a>.

   <li>
    <p>If <var>async</var> is set to <code>false</code> raise a <code><a
     href="#network-err">NETWORK_ERR</a></code> exception and terminate the
     overall algorithm.

   <li>
    <p>Synchronously <a href="#dispatch-readystatechange-event">dispatch a
     <code>readystatechange</code> event</a> on the object.

   <li>
    <p>Synchronously <a href="#dispatch-progress-event">dispatch a progress
     event</a> called <code><a href="#error-event">error</a></code> on the
     object.

   <li>
    <p>If the <a href="#upload-complete-flag">upload complete flag</a> is
     false, set the flag to true and synchronously <a
     href="#dispatch-progress-event">dispatch a progress event</a> called
     <code><a href="#error-event">error</a></code> on the object returned by
     the <code><a href="#upload">upload</a></code> attribute.

   <li>
    <p>Terminate the overall algorithm.
  </ol>

  <p>When the steps for the <code><a href="#send">send()</a></code> method
   say something is an <dfn id=abort0>abort error</dfn> the user agent <em
   class=ct>must</em> act as if the following steps had been run:

  <ol>
   <li>
    <p>Set the <a href="#response-entity-body">response entity body</a> to
     "null", the <a href="#error-flag">error flag</a> to "true" and empty the
     <a href="#author-request-headers">author request headers</a> list.

   <li>
    <p>Synchronously switch the state to <a href="#done-state" title="DONE
     state">DONE</a>.

   <li>
    <p>If <var>async</var> is set to <code>false</code> raise an <code><a
     href="#abort-err">ABORT_ERR</a></code> exception and terminate the
     overall algorithm.

   <li>
    <p>Synchronously <a href="#dispatch-readystatechange-event">dispatch a
     <code>readystatechange</code> event</a> on the object.

   <li>
    <p>Synchronously <a href="#dispatch-progress-event">dispatch a progress
     event</a> called <code title=abort-event><a
     href="#abort-event">abort</a></code> on the object.

   <li>
    <p>If the <a href="#upload-complete-flag">upload complete flag</a> is
     false, set the flag to true and synchronously <a
     href="#dispatch-progress-event">dispatch a progress event</a> called
     <code title=abort-event><a href="#abort-event">abort</a></code> on the
     object returned by the <code><a href="#upload">upload</a></code>
     attribute.

   <li>
    <p>Terminate the overall algorithm.
  </ol>

  <p>When the steps for the <code><a href="#send">send()</a></code> method
   say to <dfn id=switch-headers-received>switch to the HEADERS_RECEIVED
   state</dfn> the user agent <em class=ct>must</em> act as if the following
   steps had been run:

  <ol>
   <li>
    <p>Synchronously switch the state to <a href="#headers-received-state"
     title="HEADERS_RECEIVED state">HEADERS_RECEIVED</a>.

   <li>
    <p>Synchronously <a href="#dispatch-readystatechange-event">dispatch a
     <code>readystatechange</code> event</a> on the object.
  </ol>

  <p>When the steps for the <code><a href="#send">send()</a></code> method
   say to <dfn id=switch-loading>switch to the LOADING state</dfn> the user
   agent <em class=ct>must</em> act as if the following steps had been run:

  <ol>
   <li>
    <p>Synchronously switch the state to <a href="#loading-state"
     title="LOADING state">LOADING</a>.

   <li>
    <p>Synchronously <a href="#dispatch-readystatechange-event">dispatch a
     <code>readystatechange</code> event</a> on the object.
  </ol>

  <p>When the steps for the <code><a href="#send">send()</a></code> method
   say to <dfn id=make->make progress notifications</dfn> user agents <em
   class=ct>must</em>, while the download is progressing and <var>async</var>
   is <code>true</code>, <a href="#dispatch-progress-event">dispatch a
   progress event</a> called <code><a
   href="#progress-event">progress</a></code> at the object every 350ms
   (&plusmn;200ms) or for every byte received, whichever is <em>least</em>
   frequent.

  <p>When the steps for the <code><a href="#send">send()</a></code> method
   say to <dfn id=make-0>make upload progress notifications</dfn> user agents
   <em class=ct>must</em>, if <var>async</var> is <code>true</code>, follow
   these rules:

  <ul>
   <li>
    <p>While the request entity body is being uploaded and the <a
     href="#upload-complete-flag">upload complete flag</a> is false, <a
     href="#dispatch-progress-event">dispatch a progress event</a> called
     <code><a href="#progress-event">progress</a></code> at the object
     returned by the <code><a href="#upload">upload</a></code> attribute
     every 350ms (&plusmn;200ms) or for every byte transmitted, whichever is
     <em>least</em> frequent.

   <li>
    <p>If the request entity body has been successfully uploaded and the <a
     href="#upload-complete-flag">upload complete flag</a> is still false,
     set the flag to true and synchronously <a
     href="#dispatch-progress-event">dispatch a progress event</a> called
     <code><a href="#load-event">load</a></code> at the object returned by
     the <code><a href="#upload">upload</a></code> attribute.
  </ul>

  <h4 id=initiating><span class=secno>3.5.3 </span>Initiating a Request</h4>

  <p>The <dfn id=send title=send><code>send(<var>data</var>)</code></dfn>
   method initiates the request and its optional argument provides the <a
   href="#entity-body">entity body</a> for the request. Authors are
   encouraged to ensure that they have specified the
   <code>Content-Type</code> header via <code><a
   href="#setrequestheader">setRequestHeader()</a></code> before invoking
   <code title="">send()</code> with a non-<code>null</code> <var>data</var>
   argument.

  <p>When invoked, the user agent <em class=ct>must</em> act as if it had run
   the following steps (unless otherwise noted). Note that this algorithm
   might get aborted if the <code><a href="#open">open()</a></code> or
   <code><a href="#abort">abort()</a></code> method is invoked. When the <dfn
   id=abort-send-algorithm title="abort send()"><code>send()</code> algorithm
   is aborted</dfn> the user agent <em class=ct>must</em> terminate the
   algorithm after finishing the step it is on.

  <p class=note>The <code title="">send()</code> algorithm can only be
   aborted when <var>async</var> is <code>true</code> (i.e., the request is
   done asynchronously) and only after the method call has returned.

  <ol>
   <li>
    <p>If the state of the object is not <a href="#opened-state"
     title="OPENED state">OPENED</a> raise an <code>INVALID_STATE_ERR</code>
     exception and terminate these steps.

   <li>
    <p>If the <a href="#send-flag"><code>send()</code> flag</a> is "true"
     raise an <code>INVALID_STATE_ERR</code> exception and terminate these
     steps.

   <li>
    <p>If <var>async</var> is <code>true</code> set the <a
     href="#send-flag"><code>send()</code> flag</a> to "true".

   <li>
    <p>If <var>async</var> is <code>true</code> and one or more event
     listeners are registered on the object returned by the <code><a
     href="#upload">upload</a></code> attribute set the <a
     href="#upload-events-flag">upload events flag</a> to true. Otherwise,
     set the <a href="#upload-events-flag">upload events flag</a> to false.

   <li>
    <p>Synchronously <a href="#dispatch-readystatechange-event">dispatch a
     <code>readystatechange</code> event</a> on the object.</p>

    <p class=note>The state of the object does not change. The event is
     dispatched for historical reasons.</p>

   <li>
    <p>If <var>stored method</var> is <code>GET</code> or <code>HEAD</code>
     act as if the <var>data</var> argument is <code>null</code>.</p>

    <p>If the <var>data</var> argument has not been omitted and is not
     <code>null</code> use it for the <a href="#entity-body">entity body</a>
     observing the following rules:</p>

    <dl class=switch>
     <dt><var>data</var> is a <code>ByteArray</code>

     <dd>
      <p>Use <var>data</var> literally for transmission.

     <dt><var>data</var> is a <code>DOMString</code>

     <dd>
      <p>Encode <var>data</var> using UTF-8 for transmission.

     <dt><var>data</var> is a <code>Document</code>

     <dd>
      <p>Let <var>data</var> be <code><var>data</var>.innerHTML</code> as
       defined by section 2.5 of HTML&nbsp;5. Encode it using
       <code><var>data</var>.inputEncoding</code> or UTF-8 if
       <code><var>data</var>.inputEncoding</code> is <code>null</code>.
       Re-raise any exceptions the <code><var>data</var>.innerHTML</code>
       getter algorithm raises. [<cite><a href="#ref-html5">HTML5</a></cite>]</p>

      <p class=note>If the document cannot be serialized the
       <code>document.innerHTML</code> algorithm raises an
       <code>INVALID_STATE_ERR</code> exception.</p>

      <p>If no <code>Content-Type</code> header has been set using <code><a
       href="#setrequestheader">setRequestHeader()</a></code> set a
       <code>Content-Type</code> request header with a value of
       <code>application/xml;charset=<var>charset</var></code> where
       <var>charset</var> is the encoding used to encode the document.</p>

      <p class=note>Subsequent changes to the <code>Document</code> have no
       effect on what is submitted.</p>

     <dt>Anything else

     <dd>
      <p>Use the stringification mechanisms of the host language on
       <var>data</var> and treat the result as if <var>data</var> is a
       <code>DOMString</code>. Or, if this fails, act as if <var>data</var>
       is <code>null</code>.
    </dl>

    <p>If the <var>data</var> argument has been omitted, or is
     <code>null</code>, no entity body is used in the request.</p>

   <li>
    <p>Set the <a href="#upload-complete-flag">upload complete flag</a> to
     true if there is no request entity body or if the request entity is
     empty. Otherwise, set the <a href="#upload-complete-flag">upload
     complete flag</a> to false.

   <li>
    <p>If <var>async</var> is <code>true</code> synchronously <a
     href="#dispatch-progress-event">dispatch a progress event</a> called
     <code><a href="#loadstart-event">loadstart</a></code> on the object.

   <li>
    <p>If <var>async</var> is <code>true</code> and the request entity body
     is not empty <a href="#dispatch-progress-event">dispatch a progress
     event</a> called <code><a href="#loadstart-event">loadstart</a></code>
     on the object returned by the <code><a href="#upload">upload</a></code>
     attribute.

   <li>
    <p>If <var>async</var> is <code>true</code> return the <code><a
     href="#send">send()</a></code> method call. (Do not terminate the steps
     in the algorithm though.)

   <li>
    <p>If the <a href="#current">current request URL</a> and the value of the
     <code>baseURI</code> attribute of the <a
     href="#document-pointer"><code>Document</code> pointer</a> are <a
     href="#same-origin">same origin</a> this is a <dfn id=same-origin0>same
     origin request</dfn>. Make a request to the <a href="#current">current
     request URL</a> using HTTP method <var>stored method</var>, user
     <var>stored user</var> (if provided), password <var>stored
     password</var> (if provided), taking into account the entity body, list
     of request headers and the rules listed directly after this set of
     steps. <a href="#make-">Make progress notifications</a>, <a
     href="#make-0">make upload progress notifications</a>, and follow the
     list of request rules:</p>

    <dl class=switch>
     <dt>If the response is an HTTP redirect

     <dd>
      <p>If the redirect violates security or infinite loop precautions or
       the scheme is not supported this is a <a href="#network">network
       error</a>.</p>

      <p>Otherwise, run the following set of steps:</p>

      <ol>
       <li>
        <p>Set the <a href="#current">current request URL</a> to the new
         location.

       <li>
        <p>If the <a href="#current">current request URL</a> and the value of
         the <code>baseURI</code> attribute of the <a
         href="#document-pointer"><code>Document</code> pointer</a> are <a
         href="#same-origin">same origin</a> follow the redirect while
         observing the request rules for <span title="same-origin
         request">same origin requests</span>.

       <li>
        <p>Otherwise, follow the steps for a <a href="#non-same">non same
         origin request</a> terminating this one.
      </ol>

      <p class=note>HTTP places requirements on the user agent regarding the
       preservation of the request method and entity body during redirects,
       and also requires users to be notified of certain kinds of automatic
       redirections.</p>
      <!-- Arguably HTTP should be fixed for the latter case. No browser
      follows that as far as I know. -->
      

     <dt>If the user cancels the download

     <dd>
      <p>This is an <a href="#abort0">abort error</a>.

     <dt>If there is a network error

     <dd>
      <p>In case of DNS errors, TLS negotiation failure, or other type of
       network errors, this is a <a href="#network">network error</a>. Do not
       request any kind of user interaction.

      <p class=note>This does not include HTTP responses that indicate some
       type of error, such as HTTP status code 410.</p>

     <dt>Once all HTTP headers have been received

     <dd>
      <p><a href="#switch-headers-received">Switch to the HEADERS_RECEIVED
       state</a>.

     <dt>Once the first byte (or more) of the response entity body has been
      received

     <dt>If there is no response entity body

     <dd>
      <p><a href="#switch-loading">Switch to the LOADING state</a> and once
       the complete resource has been downloaded go to the next step.
    </dl>

    <p>Otherwise, if it is non same origin this is a <dfn id=non-same>non
     same origin request</dfn>. Make a <a href="#cross-site">cross-site
     access request</a>, passing these as parameters:</p>

    <ul>
     <li>The <a href="#current">current request URL</a>.

     <li>The <var>stored method</var>.

     <li>The list of request headers.

     <li>The entity body.

     <li>The <a href="#origin">origin</a> of the object hold by the <a
      href="#document-pointer"><code>Document</code> pointer</a>.

     <li>The <a href="#credentials">credentials flag</a>.

     <li>The <a href="#upload-events-flag">upload events flag</a>. <span
      class=note>If this flag is true it will force a preflight
      request.</span>
    </ul>

    <p>Handle the return values as described below.</p>

    <p class=note>The <var>stored user</var> and <var>stored password</var>
     variables are always ignored as part of a non same origin request as
     including them would allow a site to perform a distributed password
     search. However, user agents will include credentials in the request (if
     the user has any) as required elsewhere.</p>

    <p>Also, <a href="#make-0">make upload progress notifications</a>, though
     only if a preflight request was made.</p>
    <!-- XXX more formal? -->
    <dl>
     <dt><a href="#status0">status return flag</a> is "same-origin"

     <dd>
      <p>Set the <a href="#current">current request URL</a> to the value of
       the <a href="#url-return">url return flag</a> and then make a <a
       href="#same-origin0">same origin request</a>.

     <dt><a href="#status0">status return flag</a> is "network"

     <dd>
      <p>This is a <a href="#network">network error</a>.

     <dt><a href="#status0">status return flag</a> is "abort"

     <dd>
      <p>This is an <a href="#abort0">abort error</a>.

     <dt><a href="#status0">status return flag</a> is "success"

     <dd>
      <p><a href="#switch-headers-received">Switch to the HEADERS_RECEIVED
       state</a>, <a href="#make-">make progress notifications</a>, and <a
       href="#switch-loading">switch to the LOADING state</a> once the first
       byte (or more) of the response entity body has been received or if
       there is no response entity body. Once the resource has been received
       completely go to the next step.
    </dl>

   <li>
    <p>When the request has successfully completed loading, run the following
     steps:</p>

    <ol>
     <li>
      <p>Synchronously switch the state to <a href="#done-state" title="DONE
       state">DONE</a>.

     <li>
      <p>Synchronously <a href="#dispatch-readystatechange-event">dispatch a
       <code>readystatechange</code> event</a> on the object.

     <li>
      <p>Synchronously <a href="#dispatch-progress-event">dispatch a progress
       event</a> called <code><a href="#load-event">load</a></code> on the
       object.
    </ol>
  </ol>

  <p>If the user agent allows the user to configure a proxy it <em
   class=ct>should</em> modify the request appropriately; i.e., connect to
   the proxy host instead of the origin server, modify the
   <code>Request-Line</code> and send <code>Proxy-Authorization</code>
   headers as specified.

  <p>If the user agent supports HTTP Authentication it <em
   class=ct>should</em> consider requests originating from this object to be
   part of the protection space that includes the accessed URIs and send
   <code>Authorization</code> headers and handle <code>401
   Unauthorized</code> requests appropriately. If authentication fails,
   <var>stored user</var> and <var>stored password</var> are not provided,
   and the request is <a href="#same-origin">same origin</a>, user agents <em
   class=ct>should</em> prompt the users for credentials. If authentication
   fails, and <var>stored user</var> and <var>stored password</var> are
   provided, user agents <em class=ct>must not</em> prompt the user for
   credentials. [<cite><a href="#ref-rfc2617">RFC2617</a></cite>]

  <p class=note>Users are not prompted if credentials are provided through
   the <code><a href="#open">open()</a></code> API so that authors can
   implement their own user interface. They are also not prompted for
   cross-site requests.

  <p>If the user agent supports HTTP State Management it <em
   class=ct>should</em> persist, discard and send cookies (as received in the
   <code>Set-Cookie</code> and <code>Set-Cookie2</code> response headers, and
   sent in the <code>Cookie</code> header) as applicable. [<cite><a
   href="#ref-rfc2965">RFC2965</a></cite>]

  <p>If the user agent implements a HTTP cache it <em class=ct>should</em>
   respect <code>Cache-Control</code> request headers set by the <code><a
   href="#setrequestheader">setRequestHeader()</a></code> (e.g.,
   <code>Cache-Control: no-cache</code> bypasses the cache). It <em
   class=ct>must not</em> send <code>Cache-Control</code> or
   <code>Pragma</code> request headers automatically unless the user
   explicitly requests such behavior (<abbr>e.g.</abbr>, by (force-)reloading
   the page).

  <p>For <code>304 Not Modified</code> responses that are a result of a user
   agent generated conditional request the user agent <em class=ct>must</em>
   act as if the server gave a <code>200 OK</code> response with the
   appropriate content. The user agent <em class=ct>must</em> allow <code><a
   href="#setrequestheader">setRequestHeader()</a></code> to override
   automatic cache validation by setting request headers (e.g.,
   <code>If-None-Match</code>, <code>If-Modified-Since</code>), in which case
   <code>304 Not Modified</code> responses <em class=ct>must</em> be passed
   through. [<cite><a href="#rfc-rfc2616">RFC2616</a></cite>]

  <p>If the user agent implements server-driven content-negotiation it <em
   class=ct>should</em> set <code>Accept-Encoding</code> and
   <code>Accept-Charset</code> headers as appropriate. Unless set through
   <code><a href="#setrequestheader">setRequestHeader()</a></code> user
   agents <em class=ct>should</em> set the <code>Accept</code> and
   <code>Accept-Language</code> headers as well. If <code>Accept</code> is
   set by the user agent it <em class=ct>must</em> have the value
   <code>*/*</code>. Responses <em class=ct>must</em> have the
   content-encodings automatically decoded. [<cite><a
   href="#rfc-rfc2616">RFC2616</a></cite>]

  <p>Besides the <a href="#author-request-headers">author request headers</a>
   user agents <em class=ct>should not</em> include additional request
   headers other than those mentioned above or other than those authors are
   not allowed to set using <code><a
   href="#setrequestheader">setRequestHeader()</a></code>. This ensures that
   authors have a reasonably predictable API.

  <h4 id=aborting><span class=secno>3.5.4 </span>Aborting a Request</h4>

  <p>When the <dfn id=abort><code>abort()</code></dfn> method is invoked, the
   user agent <em class=ct>must</em> act as if it had run the following steps
   (unless otherwise noted):

  <ol>
   <li>
    <p><a href="#abort-send-algorithm" title="abort send()">Abort the
     <code>send()</code> algorithm</a>, set the <a
     href="#response-entity-body">response entity body</a> to "null", the <a
     href="#error-flag">error flag</a> to "true" and remove any registered
     request headers.

   <li>
    <p>The user agent <em class=ct>should</em> cancel any network activity
     for which the object is responsible.

   <li>
    <p>If the state is <a href="#unsent-state" title="UNSENT
     state">UNSENT</a>, <a href="#opened-state" title="OPENED
     state">OPENED</a> and the <a href="#send-flag"><code>send()</code>
     flag</a> is "false", or <a href="#done-state" title="DONE
     state">DONE</a> go to the next step.</p>

    <p>Otherwise, switch the state to <a href="#done-state" title="DONE
     state">DONE</a>, set the <a href="#send-flag"><code>send()</code>
     flag</a> to "false" and synchronously <a
     href="#dispatch-readystatechange-event">dispatch a
     <code>readystatechange</code> event</a> on the object.</p>

   <li>
    <p>Switch the state to <a href="#unsent-state" title="UNSENT
     state">UNSENT</a>. (Do not dispatch a <code><a
     href="#readystatechange-event">readystatechange</a></code> event.)

   <li>
    <p>Synchronously <a href="#dispatch-progress-event">dispatch a progress
     event</a> called <code title=abort-event><a
     href="#abort-event">abort</a></code> on the object.

   <li>
    <p>If the <a href="#upload-complete-flag">upload complete flag</a> is
     false, set the flag to true and synchronously <a
     href="#dispatch-progress-event">dispatch a progress event</a> called
     <code title=abort-event><a href="#abort-event">abort</a></code> on the
     object returned by the <code><a href="#upload">upload</a></code>
     attribute.
  </ol>

  <h3 id=response-metadata><span class=secno>3.6 </span>Response Metadata</h3>

  <p>The <dfn
   id=getallresponseheaders><code>getAllResponseHeaders()</code></dfn> method
   provides access to all response headers as a single string. When invoked,
   the user agent <em class=ct>must</em> act as if it had run the following
   steps:

  <ol>
   <li>
    <p>If the state is <a href="#unsent-state" title="UNSENT
     state">UNSENT</a> or <a href="#opened-state" title="OPENED
     state">OPENED</a> raise an <code>INVALID_STATE_ERR</code> exception and
     terminate these steps.

   <li>
    <p>If the <a href="#error-flag">error flag</a> is "true" return the empty
     sting and terminate these steps.

   <li>
    <p>Return all the HTTP headers, as a single string, with each header line
     separated by a U+000D CR U+000A LF pair excluding the status line.
  </ol>

  <div class=example>
   <pre><code>// The following script:
var client = new XMLHttpRequest();
client.open("GET", "test.txt", true);
client.send();
client.onreadystatechange = function() {
 if(this.readyState == 2) {
  print(this.getAllResponseHeaders());
 }
}

// ...should output something similar to the following text:
Date: Sun, 24 Oct 2004 04:58:38 GMT
Server: Apache/1.3.31 (Unix)
Keep-Alive: timeout=15, max=99
Connection: Keep-Alive
Transfer-Encoding: chunked
Content-Type: text/plain; charset=utf-8</code></pre>
  </div>

  <p class=note>The Access Control for Cross-Site Requests specification
   filters the headers that are exposed by <code><a
   href="#getallresponseheaders">getAllResponseHeaders()</a></code>.
   [<cite><a href="#ref-ac">AC</a></cite>]

  <p>The <dfn id=getresponseheader
   title=getresponseheader><code>getResponseHeader(<var>header</var>)</code></dfn>
   method returns the value of a response header given by the
   <var>header</var> argument. When invoked, the user agent <em
   class=ct>must</em> act as if it had run the following steps:

  <ol>
   <li>
    <p>If the state is <a href="#unsent-state" title="UNSENT
     state">UNSENT</a> or <a href="#opened-state" title="OPENED
     state">OPENED</a> raise an <code>INVALID_STATE_ERR</code> exception and
     terminate these steps.

   <li>
    <p>If the <var>header</var> argument does not match the <span><code><a
     href="#field-name">field-name</a></code> production</span> return
     <code>null</code> and terminate these steps.

   <li>
    <p>If the <a href="#error-flag">error flag</a> is "true" return
     <code>null</code> and terminate these steps.

   <li>
    <p>If the <var>header</var> argument <span title="case-insensitive
     match">case-insensitively matches</span> multiple HTTP headers for the
     last request sent, return the values of these headers as a single
     concatenated string separated from each other by an U+002C COMMA
     followed by an U+0020 SPACE and terminate these steps.

   <li>
    <p>If the <var>header</var> argument <span title="case-insensitive
     match">case-insensitively matches</span> a single HTTP header for the
     last request sent return the value of that header and terminate these
     steps.

   <li>
    <p>Return <code>null</code>.
  </ol>

  <p class=note>The Access Control for Cross-Site Requests specification
   filters the headers that are exposed by <code><a
   href="#getresponseheader">getResponseHeader()</a></code>. [<cite><a
   href="#ref-ac">AC</a></cite>]

  <div class=example>
   <pre><code>// The following script:
var client = new XMLHttpRequest();
client.open("GET", "test.txt", true);
client.send();
client.onreadystatechange = function() {
 if(this.readyState == 2) {
  print(client.getResponseHeader("Content-Type"));
 }
}

// ...should output something similar to the following text:
Content-Type: text/plain; charset=utf-8</code></pre>
  </div>

  <p>The <dfn id=status><code>status</code></dfn> attribute, on getting and
   if available, <em class=ct>must</em> return the HTTP status code sent by
   the server (typically <code>200</code> for a successful request). If not
   available, the user agent <em class=ct>must</em> raise an
   <code>INVALID_STATE_ERR</code> exception.

  <p>The <dfn id=statustext><code>statusText</code></dfn> attribute, on
   getting and if available, <em class=ct>must</em> return the HTTP status
   text sent by the server (appears after the status code). If not available
   (request is not initiated for instance), the user agent <em
   class=ct>must</em> raise an <code>INVALID_STATE_ERR</code> exception.

  <h3 id=response-body><span class=secno>3.7 </span>Response Body</h3>

  <p>The following subsection defines various variables and algorithms
   important to the response body. The subsection after that defines the
   members of the <code><a
   href="#xmlhttprequest-interface">XMLHttpRequest</a></code> object relevant
   to the response body.

  <h4 id=definitions><span class=secno>3.7.1 </span>Definitions</h4>

  <p>The <dfn id=response-mime-type>response MIME type</dfn> is the MIME type
   the <code>Content-Type</code> header contains without any parameters or
   "null" if the header could not be parsed properly or was omitted. The <dfn
   id=override-mime-type>override MIME type</dfn> is initially "null" and can
   get a value if <code><a
   href="#overridemimetype">overrideMimeType()</a></code> is invoked. <dfn
   id=final-mime-type>Final MIME type</dfn> is the override MIME type unless
   that is "null" in which case it is the response MIME type.

  <p>The <dfn id=response-charset>response charset</dfn> is the value of the
   <code>charset</code> parameter of the <code>Content-Type</code> header or
   <code>null</code> if there was no <code>charset</code> parameter or if the
   header could not be parsed properly or was omitted. The <dfn
   id=override-charset>override charset</dfn> is initially "null" and can get
   a value if <code title="">overrideMimeType()</code> is invoked. <dfn
   id=final-charset>Final charset</dfn> is the override charset unless that
   is "null" in which case it is the response charset.

  <p>The <dfn id=response-entity-body>response entity body</dfn> is the
   fragment of the <a href="#entity-body">entity body</a> received so far
   (LOADING state) or the complete entity body (DONE state). If there is no
   entity body the response entity body is "null".

  <p>The <dfn id=text-response-entity-body>text response entity body</dfn> is
   a <code>DOMString</code> representing the <a
   href="#response-entity-body">response entity body</a>. The text response
   entity body is the return value of the following algorithm:

  <ol>
   <li>
    <p>If the response entity body is "null" return the empty string and
     terminate these steps.</p>

   <li>
    <p>Let <var>charset</var> be the <a href="#final-charset">final
     charset</a>.

   <li>
    <p>Let <var>mime</var> be the <a href="#final-mime-type">final MIME
     type</a>.

   <li>
    <p>If <var>charset</var> is "null" and <var>mime</var> is "null",
     <code>text/xml</code>, <code>application/xml</code> or ends in <code
     title="">+xml</code> use the rules set forth in the XML specifications
     to determine the character encoding. Let <var>charset</var> be the
     determined character encoding.

   <li>
    <p>If <var>charset</var> is "null" and <var>mime</var> is
     <code>text/html</code> follow the rules set forth in the HTML
     specification to determine the character encoding. Let
     <var>charset</var> be the determined character encoding. [<cite><a
     href="#ref-html5">HTML5</a></cite>]

   <li>
    <p>If <var>charset</var> is "null" then, for each of the rows in the
     following table, starting with the first one and going down, if the
     first bytes of <var>bytes</var> match the bytes given in the first
     column, then let <var>charset</var> be the encoding given in the cell in
     the second column of that row. If there is no match <var>charset</var>
     remains "null".</p>

    <table>
     <thead>
      <tr>
       <th>Bytes in Hexadecimal

       <th>Description

     <tbody><!-- UTF-32 is dead
      <tr>
       <td>00 00 FE FF
       <td>UTF-32BE BOM
      <tr>
       <td>FF FE 00 00
       <td>UTF-32LE BOM-->

      <tr>
       <td>FE FF

       <td>UTF-16BE BOM

      <tr>
       <td>FF FE

       <td>UTF-16LE BOM

      <tr>
       <td>EF BB BF

       <td>UTF-8 BOM<!-- nobody uses this
      <tr>
       <td>DD 73 66 73
       <td>UTF-EBCDIC
-->
        
    </table>

   <li>
    <p>If <var>charset</var> is "null" let <var>charset</var> be UTF-8.

   <li>
    <p>Return the result of decoding the response entity body using
     <var>charset</var>. Replace bytes or sequences of bytes that are not
     valid accordng to the <var>charset</var> with a single U+FFFD character.
  </ol>

  <p class=note>Authors are encouraged to encode their resources using UTF-8.

  <p>The <dfn id=document-response-entity-body>document response entity
   body</dfn> is either a <code>Document</code> representing the <a
   href="#response-entity-body">response entity body</a> or
   <code>null</code>. The document response entity body is the return value
   of the following algorithm:

  <ol>
   <li>
    <p>If the response entity body is "null" terminate these steps and return
     <code>null</code>.

   <li>
    <p>If <a href="#final-mime-type">final MIME type</a> is not "null",
     <code>text/html</code>, <code>text/xml</code>,
     <code>application/xml</code>, and does not end in <code
     title="">+xml</code> terminate these steps and return <code>null</code>.

   <li>
    <p>If <a href="#final-mime-type">final MIME type</a> is
     <code>text/html</code> let <var>document</var> be an object implementing
     the <code>Document</code> interface that represents the <a
     href="#response-entity-body">response entity body</a> parsed following
     the rules set forth in the HTML specification for an HTML parser with
     scripting disabled and then terminate this algorithm. [<cite><a
     href="#ref-html5">HTML5</a></cite>]</p>

   <li>
    <p>Otherwise, let <var>document</var> be an object implementing the
     <code>Document</code> interface that represents the result of parsing
     the response entity body into a document tree following the rules from
     the XML specifications. If this fails (unsupported character encoding,
     namespace well-formedness error et cetera) terminate these steps return
     <code>null</code>. [<cite><a href="#ref-xml">XML</a></cite>] [<cite><a
     href="#ref-xmlns">XMLNS</a></cite>]</p>

    <p class=note>Scripts in the resulting document tree will not be
     executed, resources referenced will not be loaded and no associated XSLT
     will be applied.</p>

   <li>
    <p>Ensure that the <code>cookie</code> attribute on <var>document</var>
     returns the empty string if the <span>same origin flag</span> is
     "false".

   <li>
    <p>Return <var>document</var>.
  </ol>

  <h4 id=response><span class=secno>3.7.2 </span>Response Body Members</h4>

  <p>When the <dfn id=overridemimetype
   title=overridemimetype><code>overrideMimeType(<var>mime</var>)</code></dfn>
   method is invoked, the user agent <em class=ct>must</em> act as if it had
   run the following steps:

  <ol>
   <li>
    <p>If parsing <var>mime</var> analogously to the value of the
     <code>Content-Type</code> headers fails raise a <code>SYNTAX_ERR</code>
     exception and abort this algorithm.

   <li>
    <p>If a MIME type (without any parameters) is successfully parsed set <a
     href="#override-mime-type">override MIME type</a> to that MIME type.

   <li>
    <p>If a <code>charset</code> parameter is successfully parsed set <a
     href="#override-charset">override charset</a> to its value.
  </ol>

  <p>The <dfn id=responsebody><code>responseBody</code></dfn> attribute, on
   getting, <em class=ct>must</em> return the result of running the following
   steps:

  <ol>
   <li>
    <p>If the state is not <a href="#loading-state" title="LOADING
     state">LOADING</a> or <a href="#done-state" title="DONE state">DONE</a>
     raise an <code>INVALID_STATE_ERR</code> exception and terminate these
     steps.

   <li>
    <p>Return a <code>ByteArray</code> object representing the <a
     href="#response-entity-body">response entity body</a> or return
     <code>null</code> if the response entity body is "null".
  </ol>

  <p>The <dfn id=responsetext><code>responseText</code></dfn> attribute, on
   getting, <em class=ct>must</em> return the result of running the following
   steps:

  <ol>
   <li>
    <p>If the state is not <a href="#loading-state" title="LOADING
     state">LOADING</a> or <a href="#done-state" title="DONE state">DONE</a>
     return the empty string and terminate these steps.

   <li>
    <p>Return the <a href="#text-response-entity-body">text response entity
     body</a>.
  </ol>

  <p>The <dfn id=responsexml><code>responseXML</code></dfn> attribute, on
   getting, <em class=ct>must</em> return the result of running the following
   steps:

  <ol>
   <li>
    <p>If the state is not <a href="#done-state" title="DONE state">DONE</a>
     return <code>null</code> and terminate these steps.

   <li>
    <p>Return the <a href="#document-response-entity-body">document response
     entity body</a>.
  </ol>

  <p class=note>The <code><a href="#responsexml">responseXML</a></code>
   attribute has XML in its name for historical reasons. It also returns
   documents created using an HTML parser.

  <h3 id=events><span class=secno>3.8 </span>Events summary</h3>

  <p>The following events are dispatched on <code><a
   href="#xmlhttprequest-interface">XMLHttpRequest</a></code> and/or <code><a
   href="#xmlhttprequestupload-interface">XMLHttpRequestUpload</a></code>
   objects:

  <table>
   <thead>
    <tr>
     <th>Event name

     <th>Interface

     <th>Dispatched when&hellip;

   <tbody>
    <tr>
     <td><dfn id=abort-event title=abort-event><code>abort</code></dfn>

     <td><code>ProgressEvent</code>

     <td>When the request has been aborted. For instance, by invoking the
      <code><a href="#abort">abort()</a></code> method.

    <tr>
     <td><dfn id=error-event><code>error</code></dfn>

     <td><code>ProgressEvent</code>

     <td>When the request has failed.

    <tr>
     <td><dfn id=load-event><code>load</code></dfn>

     <td><code>ProgressEvent</code>

     <td>When the request has successfully completed.

    <tr>
     <td><dfn id=loadstart-event><code>loadstart</code></dfn>

     <td><code>ProgressEvent</code>

     <td>When the request starts.

    <tr>
     <td><dfn id=progress-event><code>progress</code></dfn>

     <td><code>ProgressEvent</code>

     <td>While loading and sending data.

    <tr>
     <td><dfn id=readystatechange-event><code>readystatechange</code></dfn>

     <td><code>Event</code>

     <td>The <code><a href="#readystate">readyState</a></code> attribute
      changes and at some seemingly arbitrary times for historical reasons.
  </table>

  <h3 id=exceptions><span class=secno>3.9 </span>Exceptions</h3>

  <p>Several algorithms in this specification may result in an exception
   being thrown. These exceptions are all part of the group
   <code>ExceptionCode</code> and use the <code>DOMException</code> object,
   which is defined in DOM Level 3 Core. In addition this specification
   extends the <code>ExceptionCode</code> group with several new constants as
   indicated below. [<cite><a href="#ref-dom3core">DOM3Core</a></cite>]

  <p class=note>Thus, exceptions used by this specification and not defined
   in this section are defined by DOM Level 3 Core.

  <pre
   class=idl>const unsigned short <a href="#security-err">SECURITY_ERR</a> = 18;
const unsigned short <a href="#network-err">NETWORK_ERR</a> = 19;
const unsigned short <a href="#abort-err">ABORT_ERR</a> = 20;</pre>

  <p>The <dfn id=security-err><code>SECURITY_ERR</code></dfn> exception is
   raised if an attempt is made to perform an operation or access some data
   in a way that would be a security risk or a violation of the user agent's
   security policy.</p>
  <!-- http://lists.w3.org/Archives/Public/public-webapi/2006May/0027.html -->

  <p>The <dfn id=network-err><code>NETWORK_ERR</code></dfn> exception is
   raised when a network error occurs in synchronous requests.

  <p>The <dfn id=abort-err><code>ABORT_ERR</code></dfn> exception is raised
   when the user aborts a request in synchronous requests.

  <p class=note>These exceptions might be folded into an update of DOM Level
   3 Core in due course, as they are appropriate for other API specifications
   as well.

  <h2 class=no-num id=references>References</h2>
  <!--
  <p>Unless marked "Non-normative" these references are normative.
  -->

  <dl>
   <dt>[<dfn id=ref-ac>AC</dfn>]

   <dd><cite><a href="http://dev.w3.org/2006/waf/access-control/">Access
    Control for Cross-Site Requests</a></cite> (work in progress), A. van
    Kesteren, editor. W3C, 2008.

   <dt>[<dfn id=ref-dom2events>DOM2Events</dfn>]

   <dd><cite><a href="http://www.w3.org/TR/DOM-Level-2-Events/">Document
    Object Model (DOM) Level 2 Events Specification</a></cite>, T. Pixley,
    editor. W3C, November 2000.

   <dt>[<dfn id=ref-dom3core>DOM3Core</dfn>]

   <dd><cite><a href="http://www.w3.org/TR/DOM-Level-3-Core">Document Object
    Model (DOM) Level 3 Core Specification</a></cite>, A. Le Hors, P. Le
    H&eacute;garet, L. Wood, G. Nicol, J. Robie, M. Champion, S. Byrne,
    editors. W3C, April 2004.

   <dt>[<dfn id=ref-ecmascript>ECMAScript</dfn>]

   <dd><cite><a
    href="http://www.ecma-international.org/publications/standards/Ecma-262.htm">ECMAScript
    Language Specification</a></cite>, Third Edition. ECMA, December 1999.

   <dt>[<dfn id=ref-html5>HTML5</dfn>]

   <dd><cite><a
    href="http://www.w3.org/html/wg/html5/">HTML&nbsp;5</a></cite> (work in
    progress), I. Hickson, D. Hyatt, editors. W3C, 2008.

   <dd><cite><a
    href="http://www.whatwg.org/specs/web-apps/current-work/">HTML&nbsp;5</a></cite>
    (work in progress), I. Hickson, editor. WHATWG, 2008.

   <dt>[<dfn id=ref-httpverbsec>HTTPVERBSEC</dfn>]

   <dd>(Non-normative) <cite><a
    href="http://www.kb.cert.org/vuls/id/867593">Multiple vendors' web
    servers enable HTTP TRACE method by default</a></cite>, US-CERT.

   <dd>(Non-normative) <cite><a
    href="http://www.kb.cert.org/vuls/id/288308">Microsoft Internet
    Information Server (IIS) vulnerable to cross-site scripting via HTTP
    TRACK method</a></cite>, US-CERT.

   <dd>(Non-normative) <cite><a
    href="http://www.kb.cert.org/vuls/id/150227">HTTP proxy default
    configurations allow arbitrary TCP connections</a></cite>, US-CERT.

   <dt>[<dfn id=ref-pe>PE</dfn>]

   <dd><cite><a href="http://www.w3.org/TR/progress-events/">Progress Events
    1.0</a></cite> (work in progress), C. McCathieNeville, editor. W3C, 2007.

   <dt>[<dfn id=ref-rfc2046>RFC2046</dfn>]

   <dd><cite><a href="http://ietf.org/rfc/rfc2046">Multipurpose Internet Mail
    Extensions (MIME) Part Two: Media Types</a></cite>, N. Freed, N.
    Borenstein, editors. IETF, November 1996.

   <dt>[<dfn id=ref-rfc2119>RFC2119</dfn>]

   <dd><cite><a href="http://ietf.org/rfc/rfc2119">Key words for use in RFCs
    to Indicate Requirement Levels</a></cite>, S. Bradner. IETF, March 1997.

   <dt>[<dfn id=rfc-rfc2616>RFC2616</dfn>]

   <dd><cite><a href="http://ietf.org/rfc/rfc2616">Hypertext Transfer
    Protocol -- HTTP/1.1</a></cite>, R. Fielding, J. Gettys, J. Mogul, H.
    Frystyk, L. Masinter, P. Leach, T. Berners-Lee, editors. IETF, June 1999.

   <dt>[<dfn id=ref-rfc2617>RFC2617</dfn>]

   <dd><cite><a href="http://ietf.org/rfc/rfc2617">HTTP Authentication: Basic
    and Digest Access Authentication</a></cite>, P. Hallam-Baker, J.
    Hostetler, S. Lawrence, P. Leach, A. Luotonen, L. Stewart, editors. IETF,
    June 1999.

   <dt>[<dfn id=ref-rfc2965>RFC2965</dfn>]

   <dd><cite><a href="http://ietf.org/rfc/rfc2965">HTTP State Management
    Mechanism</a></cite>, D. Kristol, L. Montulli, editors. IETF, October
    2000.

   <dt>[<dfn id=ref-rfc3986>RFC3986</dfn>]

   <dd><cite><a href="http://ietf.org/rfc/rfc3986">Uniform Resource
    Identifier (URI): Generic Syntax</a></cite>, T. Berners-Lee, R. Fielding,
    L. Masinter, editors. IETF, January 2005.

   <dt>[<dfn id=ref-rfc3987>RFC3987</dfn>]

   <dd><cite><a href="http://ietf.org/rfc/rfc3987">Internationalized Resource
    Identifiers (IRIs)</a></cite>, M. Duerst, M. Suignard, editors. IETF,
    January 2005. L. Masinter, editors. IETF, January 2005.

   <dt>[<dfn id=ref-webidl>Web IDL</dfn>]

   <dd><cite><a href="http://dev.w3.org/2006/webapi/WebIDL/">Web
    IDL</a></cite> (work in progress), C. McCormack, editor. W3C, 2008.

   <dt>[<dfn id=ref-xml>XML</dfn>]

   <dd><cite><a href="http://www.w3.org/TR/xml/">Extensible Markup Language
    (XML) 1.0 (Fourth Edition)</a></cite>, T. Bray, J. Paoli, C.
    Sperberg-McQueen, E. Maler, F. Yergeau, editors. W3C, September 2006.

   <dt>[<dfn id=ref-xmlns>XMLNS</dfn>]

   <dd><cite><a href="http://www.w3.org/TR/xml-names/">Namespaces in XML
    (Second Edition)</a></cite>, T. Bray, D. Hollander, A. Layman, R. Tobin,
    editors. W3C, August 2006.
  </dl>

  <h2 class=no-num id=acknowledgments>Acknowledgments</h2>

  <p>The editor would like to thank Alexey Proskuryakov, David Andersson,
   Elliotte Harold, Lachlan Hunt, Ian Hickson, Jonas Sicking, Maciej
   Stachowiak, Martin Hassman, Mohamed Zergaoui, Olli Pettay, and Rune
   Halvorsen for their contributions to this specification.

  <p>Thanks also to all who have contributed to The <code><a
   href="#xmlhttprequest-interface">XMLHttpRequest</a></code> Object
   specification.

  <p>Thanks also to all those who have helped to improve this specification
   by sending suggestions and corrections. (Please, keep bugging us with your
   issues!)
