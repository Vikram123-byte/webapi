<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">

<html lang=en-US>
 <head>
  <title>XMLHttpRequest Level 2</title>

  <style type="text/css">
   pre.idl { border:solid thin; background:#eee; color:#000; padding:0.5em }
   pre.idl :link, pre.idl :visited { color:inherit; background:transparent }
   pre code { color:inherit; background:transparent }
   div.example { margin-left:1em; padding-left:1em; border-left:double; color:#222; background:#fcfcfc }
   .note { margin-left:2em; font-weight:bold; font-style:italic; color:#008000 }
   p.note::before { content:"Note: " }
   .XXX { padding:.5em; border:solid #f00 }
   p.XXX::before { content:"Issue: " }
   dl.switch { padding-left:2em }
   dl.switch > dt { text-indent:-1.5em }
   dl.switch > dt:before { content:'\21AA'; padding:0 0.5em 0 0; display:inline-block; width:1em; text-align:right; line-height:0.5em }
   em.ct { text-transform:lowercase; font-variant:small-caps; font-style:normal }
   dfn { font-weight:bold; font-style:normal }
   code { color:orangered }
   code :link, code :visited { color:inherit }
   hr:not(.top) { display:block; background:none; border:none; padding:0; margin:2em 0; height:auto }
   table { border-collapse:collapse; border-style:hidden hidden none hidden }
   table thead { border-bottom:solid }
   table tbody th:first-child { border-left:solid }
   table td, table th { border-left:solid; border-right:solid; border-bottom:solid thin; vertical-align:top; padding:0.2em }
  </style>
  <link href="http://www.w3.org/StyleSheets/TR/W3C-ED" rel=stylesheet>

 <body>
  <div class=head>
   <p><a href="http://www.w3.org/"><img alt=W3C height=48
    src="http://www.w3.org/Icons/w3c_home" width=72></a></p>

   <h1 class=head id=xmlhttprequest-level-2><code
    title="">XMLHttpRequest</code> Level 2</h1>

   <h2 class="no-num no-toc" id=w3c-doctype>Editor's Draft 12 August 2009</h2>

   <dl>
    <dt>This Version:

    <dd><a
     href="http://www.w3.org/TR/2009/ED-XMLHttpRequest2-20090812/">http://www.w3.org/TR/2009/ED-XMLHttpRequest2-20090812/</a>

    <dt>Latest Version:

    <dd><a
     href="http://www.w3.org/TR/XMLHttpRequest2/">http://www.w3.org/TR/XMLHttpRequest2/</a>

    <dt>Latest Editor Version:

    <dd><a
     href="http://dev.w3.org/2006/webapi/XMLHttpRequest-2/">http://dev.w3.org/2006/webapi/XMLHttpRequest-2/</a>

    <dt>Previous Version:

    <dd><a
     href="http://www.w3.org/TR/2008/WD-XMLHttpRequest2-20080225/">http://www.w3.org/TR/2008/WD-XMLHttpRequest2-20080225/</a>

    <dt>Editor:

    <dd><a href="http://annevankesteren.nl/">Anne van Kesteren</a> (<a
     href="http://www.opera.com/">Opera Software ASA</a>) &lt;<a
     href="mailto:annevk@opera.com">annevk@opera.com</a>&gt;
   </dl>

   <p class=copyright><a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
    &copy; 2007 <a href="http://www.w3.org/"><acronym title="World Wide Web
    Consortium">W3C</acronym></a><sup>&reg;</sup> (<a
    href="http://www.csail.mit.edu/"><acronym title="Massachusetts Institute
    of Technology">MIT</acronym></a>, <a
    href="http://www.ercim.org/"><acronym title="European Research Consortium
    for Informatics and Mathematics">ERCIM</acronym></a>, <a
    href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. W3C <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
    <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>
    and <a
    href="http://www.w3.org/Consortium/Legal/copyright-documents">document
    use</a> rules apply.</p>
  </div>

  <hr>

  <h2 class="no-num no-toc" id=specabstract>Abstract</h2>

  <p><code title="">XMLHttpRequest</code> Level 2 enhances <code
   title="">XMLHttpRequest</code> with new features, such as cross-site
   requests, progress events, and the handling of byte streams for both
   sending and receiving.

  <h2 class="no-num no-toc" id=sotd>Status of this Document</h2>

  <p><em>This section describes the status of this document at the time of
   its publication. Other documents may supersede this document. A list of
   current W3C publications and the latest revision of this technical report
   can be found in the <a href="http://www.w3.org/TR/">W3C technical reports
   index</a> at http://www.w3.org/TR/.</em>

  <p>This is the 12 August 2009 Working Draft of <code
   title="">XMLHttpRequest</code> Level 2. Please send comments to <a
   href="mailto:public-webapps@w3.org?subject=[XHR2]%20">public-webapps@w3.org</a>
   (<a
   href="http://lists.w3.org/Archives/Public/public-webapps/">archived</a>)
   with <samp>[XHR2]</samp> at the start of the subject line.

  <p class=issue>In case of conflict with the editor's draft of <a
   href="http://dev.w3.org/2006/webapi/XMLHttpRequest/">The
   <code>XMLHttpRequest</code> Object</a> that draft is likely to be more
   accurate. Please raise such differences on the <a
   href="mailto:public-webapps@w3.org?subject=[XHR2]%20">public-webapps@w3.org</a>
   mailing list taking into account that this draft defines a superset.

  <p>This document is produced by the <a
   href="http://www.w3.org/2008/webapps/">Web Applications</a> (WebApps)
   Working Group. The WebApps Working Group is part of the <a
   href="http://www.w3.org/2006/rwc/Activity">Rich Web Clients Activity</a>
   in the W3C <a href="http://www.w3.org/Interaction/">Interaction
   Domain</a>.

  <p>This document was produced by a group operating under the <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February
   2004 W3C Patent Policy</a>. W3C maintains a <a
   href="http://www.w3.org/2004/01/pp-impl/42538/status"
   rel=disclosure>public list of any patent disclosures</a> made in
   connection with the deliverables of the group; that page also includes
   instructions for disclosing a patent. An individual who has actual
   knowledge of a patent which the individual believes contains <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
   Claim(s)</a> must disclose the information in accordance with <a
   href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
   6 of the W3C Patent Policy</a>.

  <p>Publication as a Working Draft does not imply endorsement by the W3C
   Membership. This is a draft document and may be updated, replaced or
   obsoleted by other documents at any time. It is inappropriate to cite this
   document as other than work in progress.

  <h2 class="no-num no-toc" id=toc>Table of Contents</h2>
  <!--begin-toc-->

  <ul class=toc>
   <li><a href="#introduction"><span class=secno>1 </span>Introduction</a>

   <li><a href="#conformance"><span class=secno>2 </span>Conformance
    Criteria</a>
    <ul class=toc>
     <li><a href="#dependencies"><span class=secno>2.1
      </span>Dependencies</a>

     <li><a href="#terminology"><span class=secno>2.2 </span>Terminology</a>

     <li><a href="#extensibility"><span class=secno>2.3
      </span>Extensibility</a>
    </ul>

   <li><a href="#the-xmlhttprequest-interface"><span class=secno>3 </span>The
    <code title="">XMLHttpRequest</code> Interface</a>
    <ul class=toc>
     <li><a href="#origin-and-base-url"><span class=secno>3.1 </span>Origin
      and Base URL</a>

     <li><a href="#task-sources"><span class=secno>3.2 </span>Task
      Sources</a>

     <li><a href="#constructors"><span class=secno>3.3
      </span>Constructors</a>

     <li><a href="#event-handler-attributes"><span class=secno>3.4
      </span>Event Handler Attributes</a>

     <li><a href="#states"><span class=secno>3.5 </span>States</a>

     <li><a href="#request"><span class=secno>3.6 </span>Request</a>
      <ul class=toc>
       <li><a href="#the-open-method"><span class=secno>3.6.1 </span>The
        <code title="">open()</code> method</a>

       <li><a href="#the-setrequestheader-method"><span class=secno>3.6.2
        </span>The <code title="">setRequestHeader()</code> method</a>

       <li><a href="#the-withcredentials-attribute"><span class=secno>3.6.3
        </span>The <code title="">withCredentials</code> attribute</a>

       <li><a href="#the-upload-attribute"><span class=secno>3.6.4 </span>The
        <code title="">upload</code> attribute</a>

       <li><a href="#the-send-method"><span class=secno>3.6.5 </span>The
        <code title="">send()</code> method</a>

       <li><a href="#infrastructure-for-the-send-method"><span
        class=secno>3.6.6 </span>Infrastructure for the <code
        title="">send()</code> method</a>

       <li><a href="#the-abort-method"><span class=secno>3.6.7 </span>The
        <code title="">abort()</code> method</a>
      </ul>

     <li><a href="#response"><span class=secno>3.7 </span>Response</a>
      <ul class=toc>
       <li><a href="#the-status-attribute"><span class=secno>3.7.1 </span>The
        <code title="">status</code> attribute</a>

       <li><a href="#the-statustext-attribute"><span class=secno>3.7.2
        </span>The <code title="">statusText</code> attribute</a>

       <li><a href="#the-getresponseheader-method"><span class=secno>3.7.3
        </span>The <code title="">getResponseHeader()</code> method</a>

       <li><a href="#the-getallresponseheaders-method"><span
        class=secno>3.7.4 </span>The <code
        title="">getAllResponseHeaders()</code> method</a>

       <li><a href="#response-entity-body0"><span class=secno>3.7.5
        </span>Response Entity Body</a>

       <li><a href="#the-overridemimetype-method"><span class=secno>3.7.6
        </span>The <code title="">overrideMimeType()</code> method</a>

       <li><a href="#the-responsebody-attribute"><span class=secno>3.7.7
        </span>The <code title="">responseBody</code> attribute</a>

       <li><a href="#the-responsetext-attribute"><span class=secno>3.7.8
        </span>The <code title="">responseText</code> attribute</a>

       <li><a href="#the-responsexml-attribute"><span class=secno>3.7.9
        </span>The <code title="">responseXML</code> attribute</a>
      </ul>

     <li><a href="#events"><span class=secno>3.8 </span>Events summary</a>

     <li><a href="#exceptions"><span class=secno>3.9 </span>Exceptions</a>
    </ul>

   <li class=no-num><a href="#references">References</a>

   <li class=no-num><a href="#acknowledgments">Acknowledgments</a>
  </ul>
  <!--end-toc-->

  <h2 id=introduction><span class=secno>1 </span>Introduction</h2>

  <p class=issue>To be written.

  <h2 id=conformance><span class=secno>2 </span>Conformance Criteria</h2>

  <p>Everything in this specification is normative except for diagrams,
   examples, notes and sections marked non-normative.

  <p>The key words <em class=ct>must</em>, <em class=ct>must not</em>, <em
   class=ct>should</em> and <em class=ct>may</em> in this document are to be
   interpreted as described in RFC 2119. [<cite><a
   href="#ref-rfc2119">RFC2119</a></cite>]

  <p>This specification defines a single conformance class:

  <dl>
   <dt><dfn id=conforming-user-agent>Conforming user agent</dfn>

   <dd>
    <p>A user agent <em class=ct>must</em> behave as described in this
     specification in order to be considered conformant.</p>

    <p>User agents <em class=ct>may</em> optimize any algorithm given in this
     specification, so long as the end result is indistinguishable from the
     result that would be obtained by the specification's algorithms.</p>

    <p class=note>This specification uses both the terms "conforming user
     agent(s)" and "user agent(s)" to refer to this product class.</p>
  </dl>

  <h3 id=dependencies><span class=secno>2.1 </span>Dependencies</h3>

  <p>This specification relies on several underlying specifications.

  <dl>
   <dt>Cross-Origin Resource Sharing

   <dd>
    <p>A <a href="#conforming-user-agent" title="conforming user
     agent">conforming user agent</a> <em class=ct>must</em> support the
     algorithms of the Cross-Origin Resource Sharing specification. [<cite><a
     href="#ref-cors">CORS</a></cite>]

   <dt>Document Object Model

   <dd>
    <p>A <a href="#conforming-user-agent" title="conforming user
     agent">conforming user agent</a> <em class=ct>must</em> support at least
     the subset of the functionality defined in DOM Events and DOM Core that
     this specification relies upon, such as various exceptions
     <code>EventTarget</code>. [<cite><a
     href="#ref-dom2events">DOM2Events</a></cite>] [<cite><a
     href="#ref-dom3core">DOM3Core</a></cite>]

   <dt>HTML&nbsp;5

   <dd>
    <p>A <a href="#conforming-user-agent">conforming user agent</a> <em
     class=ct>must</em> support at least the subset of the functionality
     defined in HTML&nbsp;5 that this specification relies upon, such as the
     <code>Window</code> object and serializing a <code>Document</code>
     object. [<cite><a href="#ref-html5">HTML5</a></cite>]</p>

    <p class=note>The <a
     href="http://www.w3.org/TR/2006/WD-Window-20060407/">Window Object
     1.0</a> draft is not referenced normatively as it appears to be no
     longer maintained and HTML&nbsp;5 defines the <code>Window</code> object
     in more detail. This specification already depends on HTML&nbsp;5 for
     other reasons so there is not much additional overhead because of this.</p>

   <dt>HTTP

   <dd>
    <p>A <a href="#conforming-user-agent" title="conforming user
     agent">conforming user agent</a> <em class=ct>must</em> support some
     version of the HTTP protocol. Requirements regarding HTTP are made
     throughout the specification. [<cite><a
     href="#rfc-rfc2616">RFC2616</a></cite>]

   <dt>Web IDL

   <dd>
    <p>A <a href="#conforming-user-agent">conforming user agent</a> <em
     class=ct>must</em> also be a conforming implementation of the IDL
     fragments in this specification, as described in the Web IDL
     specification. [<cite><a href="#ref-webidl">WebIDL</a></cite>]

   <dt>XML

   <dd>
    <p>A <a href="#conforming-user-agent" title="conforming user
     agent">conforming user agent</a> <em class=ct>must</em> be a conforming
     XML processor that reports violations of namespace well-formedness.
     [<cite><a href="#ref-xml">XML</a></cite>]
  </dl>

  <h3 id=terminology><span class=secno>2.2 </span>Terminology</h3>

  <p>Comparing two strings in a <dfn id=case-sensitive>case-sensitive</dfn>
   manner means comparing them exactly, codepoint for codepoint.

  <p>Comparing two strings in an <dfn id=ascii-case-insensitive>ASCII
   case-insensitive</dfn> manner means comparing them exactly, codepoint for
   codepoint, except that the characters in the range U+0041 .. U+005A (i.e.
   LATIN CAPITAL LETTER A to LATIN CAPITAL LETTER Z) and the corresponding
   characters in the range U+0061 .. U+007A (i.e. LATIN SMALL LETTER A to
   LATIN SMALL LETTER Z) are considered to also match.

  <p><dfn id=converted-to-ascii-upercase title="converted to ASCII
   uppercase">Converting a string to ASCII uppercase</dfn> means replacing
   all characters in the range U+0061 .. U+007A (i.e. LATIN SMALL LETTER A to
   LATIN SMALL LETTER Z) with the corresponding characters in the range
   U+0041 .. U+005A (i.e. LATIN CAPITAL LETTER A to LATIN CAPITAL LETTER Z).

  <p>The terms and algorithms <dfn id=url-fragment>&lt;fragment></dfn>, <dfn
   id=url-scheme>&lt;scheme></dfn>, <dfn id=document-base-url>document base
   URL</dfn>, <dfn id=event-handler-attributes-0>event handler
   attributes</dfn>, <dfn id=event-handler-event-type>event handler event
   type</dfn>, <dfn id=fully-active>fully active</dfn>, <dfn
   id=function><code>Function</code></dfn>, <dfn id=dom-innerhtml
   title=dom-innerHTML><code>innerHTML</code></dfn>, <dfn
   id=origin>origin</dfn>, <dfn id=resolve-a-url>resolve a URL</dfn>, <dfn
   id=same-origin>same origin</dfn>, <dfn id=storage-mutex>storage
   mutex</dfn>, <dfn id=task>task</dfn>, <dfn id=task-source>task
   source</dfn>, <dfn id=url>URL</dfn>, <dfn id=url-character-encoding>URL
   character encoding</dfn>, and <dfn id=queue-a-task>queue a task</dfn> are
   defined by the HTML&nbsp;5 specification. [<cite><a
   href="#ref-html5">HTML5</a></cite>]

  <p>The term <dfn id=entity-body>entity body</dfn> is used as described in
   RFC 2616. <dfn id=method-token>Method token</dfn> is used as described in
   section 5.1.1 of RFC 2616. <dfn
   id=field-name><code>field-name</code></dfn> and <dfn
   id=field-value><code>field-value</code></dfn> are used as described in
   section 4.2 of RFC 2616. [<cite><a href="#rfc-rfc2616">RFC2616</a></cite>]

  <p><dfn id=userinfo><code>userinfo</code></dfn> is used as described in
   section 3.2.1 of RFC 3986. [<cite><a
   href="#ref-rfc3986">RFC3986</a></cite>]

  <p>The terms <dfn id=cross-origin-request>cross-origin request</dfn> and
   <dfn id=cross-origin-request-status>cross-origin request status </dfn> are
   defined by the Cross-Origin Resource Sharing specification. [<cite><a
   href="#ref-cors">CORS</a></cite>]

  <p>To <dfn id=dispatch-readystatechange-event>dispatch a
   <code>readystatechange</code> event</dfn> means that an event with the
   name <code><a href="#readystatechange-event">readystatechange</a></code>,
   with no namespace, which does not bubble and is not cancelable, and which
   uses the <code>Event</code> interface, is to be dispatched at the <code><a
   href="#xmlhttprequest">XMLHttpRequest</a></code> object.

  <p class=XXX>To <dfn id=dispatch-progress-event title="dispatch a progress
   event">dispatch a progress event called <var>e</var></dfn> means&hellip;
   [<cite><a href="#ref-pe">PE</a></cite>]

  <h3 id=extensibility><span class=secno>2.3 </span>Extensibility</h3>

  <p>Extensions of the API defined by this specification are <em>strongly
   discouraged</em>. User agents, Working Groups and other interested parties
   should discuss extensions on a relevant public forum, preferably <a
   href="mailto:public-webapps@w3.org">public-webapps@w3.org</a>.

  <h2 id=the-xmlhttprequest-interface><span class=secno>3 </span>The <code
   title="">XMLHttpRequest</code> Interface</h2>

  <p>The <code><a href="#xmlhttprequest">XMLHttpRequest</a></code> object can
   be used by scripts to programmatically connect to servers via HTTP.

  <pre class=idl>[NoInterfaceObject]
interface <dfn id=xmlhttprequesteventtarget>XMLHttpRequestEventTarget</dfn> : EventTarget {
  // <a href="#event-handler-attributes">event handler attributes</a>
           attribute <a href="#function">Function</a> <a href="#onloadstart">onloadstart</a>;
           attribute <a href="#function">Function</a> <a href="#onprogress">onprogress</a>;
           attribute <a href="#function">Function</a> <a href="#onabort">onabort</a>;
           attribute <a href="#function">Function</a> <a href="#onerror">onerror</a>;
           attribute <a href="#function">Function</a> <a href="#onload">onload</a>;
           attribute <a href="#function">Function</a> <a href="#onloadend">onloadend</a>;
};

interface <dfn id=xmlhttprequestupload>XMLHttpRequestUpload</dfn> : <a href="#xmlhttprequesteventtarget">XMLHttpRequestEventTarget</a> {
  // for future use
};

[<a href="#xmlhttprequest-constructor" title="XMLHttpRequest constructor">Constructor</a>]
interface <dfn id=xmlhttprequest>XMLHttpRequest</dfn> : <a href="#xmlhttprequesteventtarget">XMLHttpRequestEventTarget</a> {
  // <a href="#event-handler-attributes">event handler attributes</a>
           attribute <a href="#function">Function</a> <a href="#onreadystatechange">onreadystatechange</a>;

  // <a href="#states">states</a>
  const unsigned short <a href="#unsent-state" title="UNSENT state">UNSENT</a> = 0;
  const unsigned short <a href="#opened-state" title="OPENED state">OPENED</a> = 1;
  const unsigned short <a href="#headers-received-state" title="HEADERS_RECEIVED state">HEADERS_RECEIVED</a> = 2;
  const unsigned short <a href="#loading-state" title="LOADING state">LOADING</a> = 3;
  const unsigned short <a href="#done-state" title="DONE state">DONE</a> = 4;
  readonly attribute unsigned short <a href="#readystate">readyState</a>;

  // <a href="#request">request</a>
           attribute boolean <a href="#withcredentials">withCredentials</a>;
  void <a href="#open">open</a>(DOMString <var>method</var>, DOMString <var><a href="#url">url</a></var>);
  void <a href="#open">open</a>(DOMString <var>method</var>, DOMString <var><a href="#url">url</a></var>, boolean <var>async</var>);
  void <a href="#open">open</a>(DOMString <var>method</var>, DOMString <var><a href="#url">url</a></var>, boolean <var>async</var>, [Null=Null, Undefined=Null] DOMString <var>user</var>);
  void <a href="#open">open</a>(DOMString <var>method</var>, DOMString <var><a href="#url">url</a></var>, boolean <var>async</var>, [Null=Null, Undefined=Null] DOMString <var>user</var>, [Null=Null, Undefined=Null] DOMString <var>password</var>);
  void <a href="#setrequestheader">setRequestHeader</a>(DOMString <var>header</var>, DOMString <var>value</var>);
  readonly attribute <a href="#xmlhttprequestupload">XMLHttpRequestUpload</a> <a href="#upload">upload</a>;
  void <a href="#send">send</a>();
  void <a href="#send">send</a>(ByteArray <var>data</var>);
  void <a href="#send">send</a>([AllowAny, Null=Null, Undefined=Null] DOMString <var>data</var>); <!-- XXX XHR1 -->
  void <a href="#send">send</a>(Document <var>data</var>);
  void <a href="#abort">abort</a>();

  // <a href="#response">response</a>
  readonly attribute unsigned short <a href="#status">status</a>;
  readonly attribute DOMString <a href="#statustext">statusText</a>;
  DOMString <a href="#getresponseheader">getResponseHeader</a>(DOMString <var>header</var>);
  DOMString <a href="#getallresponseheaders">getAllResponseHeaders</a>();
  void <a href="#overridemimetype">overrideMimeType</a>(DOMString <var>mime</var>);
  readonly attribute ByteArray <a href="#responsebody">responseBody</a>;
  readonly attribute DOMString <a href="#responsetext">responseText</a>;
  readonly attribute Document <a href="#responsexml">responseXML</a>;
};</pre>

  <h3 id=origin-and-base-url><span class=secno>3.1 </span>Origin and Base URL</h3>

  <p>Each <code><a href="#xmlhttprequest">XMLHttpRequest</a></code> object
   has an associated <dfn
   id=xmlhttprequest-origin><code>XMLHttpRequest</code> origin</dfn> and an
   <dfn id=xmlhttprequest-base-url><code>XMLHttpRequest</code> base
   URL</dfn>.

  <p>This specification defines their values when the global object is
   represented by the <code>Window</code> object. When the <code><a
   href="#xmlhttprequest">XMLHttpRequest</a></code> object used in other
   contexts their values will have to be defined as appropriate for that
   context. That is considered to be out of scope for this specification.

  <hr>

  <p>In environments where the global object is represented by the
   <code>Window</code> object the <code><a
   href="#xmlhttprequest">XMLHttpRequest</a></code> object has an associated
   <dfn id=xmlhttprequest-document><code>XMLHttpRequest</code>
   <code>Document</code></dfn> which is the <code>Document</code> object
   associated with the <code>Window</code> object for which the <code><a
   href="#xmlhttprequest">XMLHttpRequest</a></code> interface object was
   created.

  <p class=note>The <a
   href="#xmlhttprequest-document"><code>XMLHttpRequest</code>
   <code>Document</code></a> is used to determine the <a
   href="#xmlhttprequest-origin"><code>XMLHttpRequest</code> origin</a> and
   <a href="#xmlhttprequest-base-url"><code>XMLHttpRequest</code> base
   URL</a> at a later stage.</p>
  <!-- XXX what happens if the document is not fully active?
           e.g. should the constructor throw?
  -->

  <h3 id=task-sources><span class=secno>3.2 </span>Task Sources</h3>

  <p>The following <a href="#task-source" title="task source">task
   sources</a> are used by this specification:

  <dl>
   <dt>The <dfn
    id=xmlhttprequest-event-task-source><code>XMLHttpRequest</code> event
    task source</dfn>

   <dd>This <a href="#task-source">task source</a> is used for events that
    are to be asynchronously dispatched.

   <dt>The <dfn
    id=xmlhttprequest-networking-task-source><code>XMLHttpRequest</code>
    networking task source</dfn>

   <dd>This <a href="#task-source">task source</a> is used for network
    activity.
  </dl>

  <p>Unless otherwise stated the <a href="#task-source">task source</a> used
   for all tasks <a href="#queue-a-task" title="queue a task">queued</a> in
   this specification is the <a
   href="#xmlhttprequest-event-task-source"><code>XMLHttpRequest</code> event
   task source</a>.

  <h3 id=constructors><span class=secno>3.3 </span>Constructors</h3>

  <p>When the <dfn id=xmlhttprequest-constructor title="XMLHttpRequest
   constructor"><code title="">XMLHttpRequest()</code></dfn> constructor is
   invoked, the user agent <em class=ct>must</em> return a new <code><a
   href="#xmlhttprequest">XMLHttpRequest</a></code> object.

  <h3 id=event-handler-attributes><span class=secno>3.4 </span>Event Handler
   Attributes</h3>

  <p>The following are the <a href="#event-handler-attributes-0">event
   handler attributes</a> (and their corresponding <a
   href="#event-handler-event-type" title="event handler event type">event
   handler event types</a>) that <em class=ct>must</em> be supported on
   objects implementing an interface that inherits from <code><a
   href="#xmlhttprequesteventtarget">XMLHttpRequestEventTarget</a></code> as
   DOM attributes:

  <table>
   <thead>
    <tr>
     <th><a href="#event-handler-attributes-0" title="event handler
      attributes">event handler attribute</a>

     <th><a href="#event-handler-event-type">event handler event type</a>

   <tbody>
    <tr>
     <td><dfn id=onloadstart><code>onloadstart</code></dfn>

     <td><code><a href="#loadstart-event">loadstart</a></code>

    <tr>
     <td><dfn id=onprogress><code>onprogress</code></dfn>

     <td><code><a href="#progress-event">progress</a></code>

    <tr>
     <td><dfn id=onabort><code>onabort</code></dfn>

     <td><code title=abort-event><a href="#abort-event">abort</a></code>

    <tr>
     <td><dfn id=onerror><code>onerror</code></dfn>

     <td><code><a href="#error-event">error</a></code>

    <tr>
     <td><dfn id=onload><code>onload</code></dfn>

     <td><code><a href="#load-event">load</a></code>

    <tr>
     <td><dfn id=onloadend><code>onloadend</code></dfn>

     <td><code><a href="#loadend-event">loadend</a></code>
  </table>

  <p>The following is the <a href="#event-handler-attributes-0" title="event
   handler attributes">event handler attribute</a> (and its corresponding <a
   href="#event-handler-event-type">event handler event type</a>) that <em
   class=ct>must</em> be supported as DOM attribute solely by the <code><a
   href="#xmlhttprequest">XMLHttpRequest</a></code> object:

  <table>
   <thead>
    <tr>
     <th><a href="#event-handler-attributes-0" title="event handler
      attributes">event handler attribute</a>

     <th><a href="#event-handler-event-type">event handler event type</a>

   <tbody>
    <tr>
     <td><dfn id=onreadystatechange><code>onreadystatechange</code></dfn>

     <td><code><a href="#readystatechange-event">readystatechange</a></code>
  </table>

  <h3 id=states><span class=secno>3.5 </span>States</h3>

  <p>The <code><a href="#xmlhttprequest">XMLHttpRequest</a></code> object can
   be in several states. The <dfn id=readystate><code>readyState</code></dfn>
   attribute, on getting, <em class=ct>must</em> return the current state,
   which <em class=ct>must</em> be one of the following values:

  <dl>
   <dt><dfn id=unsent-state title="UNSENT state"><code>UNSENT</code></dfn>
    (numeric value 0)

   <dd>
    <p>The object has been constructed.

   <dt><dfn id=opened-state title="OPENED state"><code>OPENED</code></dfn>
    (numeric value 1)

   <dd>
    <p>The <code><a href="#open">open()</a></code> method has been
     successfully invoked. During this state request headers can be set using
     <code><a href="#setrequestheader">setRequestHeader()</a></code> and the
     request can be made using the <code><a href="#send">send()</a></code>
     method.

   <dt><dfn id=headers-received-state title="HEADERS_RECEIVED
    state"><code>HEADERS_RECEIVED</code></dfn> (numeric value 2)

   <dd>
    <p>All HTTP headers have been received. Several response members of the
     object are now available.

   <dt><dfn id=loading-state title="LOADING state"><code>LOADING</code></dfn>
    (numeric value 3)

   <dd>
    <p>The response entity body is being received.

   <dt><dfn id=done-state title="DONE state"><code>DONE</code></dfn> (numeric
    value 4)

   <dd>
    <p>The data transfer has been completed or something went wrong during
     the transfer (e.g. infinite redirects).
  </dl>

  <p>The <a href="#opened-state" title="OPENED state">OPENED</a> state has an
   associated <dfn id=send-flag><code>send()</code> flag</dfn> that indicates
   whether the <code><a href="#send">send()</a></code> method has been
   invoked. It can be either true or false and has an initial value of false.

  <p>The <a href="#done-state" title="DONE state">DONE</a> state has an
   associated <dfn id=error-flag>error flag</dfn> that indicates some type of
   network error or abortion. It can be either true or false and has an
   initial value of false.

  <h3 id=request><span class=secno>3.6 </span>Request</h3>

  <p>The <code><a href="#xmlhttprequest">XMLHttpRequest</a></code> object
   holds the following request metadata variables:

  <dl>
   <dt>The <dfn id=asynchronous-flag>asynchronous flag</dfn>

   <dd>A flag that is either true or false that indicates whether the request
    is done asynchronously.

   <dt>The <dfn id=request-method>request method</dfn>

   <dd>The method used in the request.

   <dt>The <dfn id=request-url>request URL</dfn>

   <dd>The <a href="#url">URL</a> used in the request.

   <dt>The <dfn id=request-username>request username</dfn>

   <dd>The username used in the request or null if there is no username.

   <dt>The <dfn id=request-password>request password</dfn>

   <dd>The password used in the request or null if there is no password.

   <dt>The <dfn id=author-request-headers>author request headers</dfn>

   <dd>A list consisting of HTTP header name/value pairs to be used in the
    request.

   <dt>The <dfn id=request-entity-body>request entity body</dfn>

   <dd>The <a href="#entity-body">entity body</a> used in the request.

   <dt>The <dfn id=credentials-flag>credentials flag</dfn>

   <dd>Indicates whether a cross-origin request will include cookie and HTTP
    authentication data and whether cookies can be set. The flag is either
    true or false. The default value is false.

   <dt>The <dfn id=upload-complete-flag>upload complete flag</dfn>

   <dd>Used to determine whether to send upload progress events. The flag is
    either true or false.</dd>
   <!-- XXX default -->

   <dt>The <dfn id=upload-events-flag>upload events flag</dfn>

   <dd>Used to determine whether to send upload progress events for
    cross-origin requests. The flag is either true or false.</dd>
   <!-- XXX default -->
  </dl>

  <p>The <code><a href="#xmlhttprequest">XMLHttpRequest</a></code> object
   also has an associated <code><a
   href="#xmlhttprequestupload">XMLHttpRequestUpload</a></code> object.

  <h4 id=the-open-method><span class=secno>3.6.1 </span>The <code
   title="">open()</code> method</h4>

  <p>When the <dfn id=open title=open><code>open(<var>method</var>,
   <var>url</var>, <var>async</var>, <var>user</var>,
   <var>password</var>)</code></dfn> method is invoked, the user agent <em
   class=ct>must</em> run these steps (unless otherwise indicated):

  <ol>
   <li>
    <p>If the <code><a href="#xmlhttprequest">XMLHttpRequest</a></code>
     object has an associated <a
     href="#xmlhttprequest-document"><code>XMLHttpRequest</code>
     <code>Document</code></a> run these substeps:</p>

    <ol>
     <li>
      <p>If the <a
       href="#xmlhttprequest-document"><code>XMLHttpRequest</code>
       <code>Document</code></a> is not <a href="#fully-active">fully
       active</a> raise an <code>INVALID_STATE_ERR</code> exception and
       terminate the overall set of steps.

     <li>
      <p>Let <a href="#xmlhttprequest-base-url"><code>XMLHttpRequest</code>
       base URL</a> be the <a href="#document-base-url">document base URL</a>
       of the <a href="#xmlhttprequest-document"><code>XMLHttpRequest</code>
       <code>Document</code></a>.

     <li>
      <p>Let <a href="#xmlhttprequest-origin"><code>XMLHttpRequest</code>
       origin</a> be the <a href="#origin">origin</a> of the <a
       href="#xmlhttprequest-document"><code>XMLHttpRequest</code>
       <code>Document</code></a>.
    </ol>

   <li>
    <p>If <var>method</var> does not match the <a href="#method-token">Method
     token</a> production raise a <code>SYNTAX_ERR</code> exception and
     terminate these steps.

   <li>
    <p>If <var>method</var> is an <a href="#ascii-case-insensitive">ASCII
     case-insensitive</a> match for <code>CONNECT</code>,
     <code>DELETE</code>, <code>GET</code>, <code>HEAD</code>,
     <code>OPTIONS</code>, <code>POST</code>, <code>PUT</code>,
     <code>TRACE</code>, or <code>TRACK</code> <a
     href="#converted-to-ascii-upercase" title="converted to ASCII
     uppercase">convert <var>method</var> to ASCII uppercase</a>.</p>

    <p class=note>If it does not match any of the above, it is passed through
     <em>literally</em>, including in the final request.</p>
   </li>
   <!-- WebKit (and supposedly Gecko) also uppercase: COPY, INDEX, LOCK,
   M-POST, MKCOL, MOVE, PROPFIND, PROPPATCH, and UNLOCK. -->

   <li>
    <p>If <var>method</var> is a <a href="#case-sensitive">case-sensitive</a>
     match for <code>CONNECT</code>, <code>TRACE</code>, or
     <code>TRACK</code> the user agent <em class=ct>should</em> raise a
     <code><a href="#security-err">SECURITY_ERR</a></code> exception and
     terminate these steps.</p>

    <p class=note>Allowing these methods poses a security risk. [<cite><a
     href="#ref-httpverbsec">HTTPVERBSEC</a></cite>]</p>

   <li>
    <p>Let <var title="">url</var> be a <a href="#url">URL</a>.

   <li>
    <p>Let <a href="#url-character-encoding">URL character encoding</a> of
     <var title="">url</var> be UTF-8.

   <li>
    <p><a href="#resolve-a-url" title="Resolve a URL">Resolve <var
     title="">url</var></a> relative to the <a
     href="#xmlhttprequest-base-url"><code>XMLHttpRequest</code> base
     URL</a>. If the algorithm returns an error raise a
     <code>SYNTAX_ERR</code> exception and terminate these steps.
   </li>
   <!-- Presto and Gecko override the encoding. WebKit does not. Trident
   does not support non-ASCII URLs. This matters for the <query> component,
   see HTML5. -->

   <li>
    <p>Drop <code><a href="#url-fragment">&lt;fragment></a></code> from <var
     title="">url</var>.

   <li>
    <p>If <var title="">url</var> contains an unsupported <code><a
     href="#url-scheme">&lt;scheme></a></code> raise a
     <code>NOT_SUPPORTED_ERR</code> and terminate these steps.

   <li>
    <p>If the <code>"user:password"</code> format in the <code><a
     href="#userinfo">userinfo</a></code> production is not supported for the
     relevant scheme and <var title="">url</var> contains this format raise a
     <code>SYNTAX_ERR</code> and terminate these steps.

   <li>
    <p>If <var title="">url</var> contains the <code>"user:password"</code>
     format let <var>temp user</var> be the user part and <var>temp
     password</var> be the password part.

   <li>
    <p>If <var title="">url</var> just contains the <code>"user"</code>
     format let <var>temp user</var> be the user part.

   <li class=note>
    <p>The previous level of this specification raised a <code><a
     href="#security-err">SECURITY_ERR</a></code> at this place in case of a
     non <a href="#same-origin">same origin</a> <var>stored url</var>. This
     specification supports non <a href="#same-origin">same origin</a>
     requests and therefore this exception is no longer raised.

   <li>
    <p>Let <var>async</var> be the value of the <var>async</var> argument or
     <code>true</code> if it was omitted.

   <li>
    <p>If the <var>user</var> argument was not omitted follow these sub
     steps:</p>

    <ol>
     <li>
      <p>If the syntax of <var>user</var> does not match the syntax specified
       by the relevant authentication scheme, raise a <code>SYNTAX_ERR</code>
       exception and terminate the overall set of steps.

     <li>
      <p>If <var>user</var> is <code>null</code> let <var>temp user</var> be
       null.

     <li>
      <p>Otherwise let <var>temp user</var> be <var>user</var>.
    </ol>

    <p class=note>These steps override anything that may have been set by the
     <var title="">url</var> argument.</p>

   <li>
    <p>If the <var>password</var> argument was not omitted follow these sub
     steps:</p>

    <ol>
     <li>
      <p>If the syntax of <var>password</var> does not match the syntax
       specified by the relevant authentication scheme, raise a
       <code>SYNTAX_ERR</code> exception and terminate the overall set of
       steps.

     <li>
      <p>If <var>password</var> is <code>null</code> let <var>temp
       password</var> be null.

     <li>
      <p>Otherwise let <var>temp password</var> be <var>password</var>.
    </ol>

    <p class=note>These steps override anything that may have been set by the
     <var title="">url</var> argument.</p>

   <li>
    <p><a href="#abort-send-algorithm" title="abort send()">Abort the
     <code>send()</code> algorithm</a>.

   <li>
    <p>The user agent <em class=ct>should</em> cancel any network activity
     for which the object is responsible.
   </li>
   <!-- we can hardly require it... -->

   <li>
    <p>Set variables associated with the object as follows:</p>

    <ul>
     <li>
      <p>Set the <a href="#send-flag"><code>send()</code> flag</a> to false.

     <li>
      <p>Set <a href="#response-entity-body">response entity body</a> to
       null.

     <li>
      <p>Empty the list of <a href="#author-request-headers">author request
       headers</a>.</p>

     <li>
      <p>Set the <a href="#request-method">request method</a> to
       <var>method</var>.

     <li>
      <p>Set the <a href="#request-url">request URL</a> to <var
       title="">url</var>.

     <li>
      <p>Set the <a href="#request-username">request username</a> to
       <var>temp user</var>.

     <li>
      <p>Set the <a href="#request-password">request password</a> to
       <var>temp password</var>.

     <li>
      <p>Set the <a href="#asynchronous-flag">asynchronous flag</a> to true
       if <var>async</var> is <code>true</code>. Otherwise set it to false.
    </ul>

   <li>
    <p>Switch the the state to <a href="#opened-state" title="OPENED
     state">OPENED</a>.

   <li>
    <p><a href="#dispatch-readystatechange-event">Dispatch a
     <code>readystatechange</code> event</a>.
  </ol>

  <h4 id=the-setrequestheader-method><span class=secno>3.6.2 </span>The <code
   title="">setRequestHeader()</code> method</h4>
  <!-- XXX authors
  The <code>setRequestHeader()</code> method can be used to set new request
    headers and append to request headers already in the list.</p>
  -->

  <p>As indicated in the algorithm below certain headers cannot be set and
   are left up to the user agent. In addition there are certain other headers
   the user agent will take control of if they are not set by the author as
   indicated at the end of the <code><a href="#send">send()</a></code> method
   section.

  <p class=note>The <code><a
   href="#setrequestheader">setRequestHeader()</a></code> method appends a
   value if the HTTP header given as argument is already part of the <a
   href="#author-request-headers">author request headers</a> list.

  <p class=note>For non <a href="#same-origin">same origin</a> requests using
   the HTTP <code>GET</code> method a preflight request is made when headers
   other than <code>Accept</code> and <code>Accept-Language</code> are set.

  <p>When the <dfn id=setrequestheader
   title=setrequestheader><code>setRequestHeader(<var>header</var>,
   <var>value</var>)</code></dfn> method is invoked, the user agent <em
   class=ct>must</em> run these steps (unless otherwise indicated):

  <ol>
   <li>
    <p>If the state is not <a href="#opened-state" title="OPENED
     state">OPENED</a> raise an <code>INVALID_STATE_ERR</code> exception and
     terminate these steps.

   <li>
    <p>If the <a href="#send-flag"><code>send()</code> flag</a> is true raise
     an <code>INVALID_STATE_ERR</code> exception and terminate these steps.

   <li>
    <p>If <var>header</var> does not match the <code><a
     href="#field-name">field-name</a></code> production raise a
     <code>SYNTAX_ERR</code> exception and terminate these steps.

   <li>
    <p>If the <var>value</var> argument does not match the <code><a
     href="#field-value">field-value</a></code> production raise a
     <code>SYNTAX_ERR</code> and terminate these steps.</p>

    <p class=note>The empty string is legal and represents the empty header
     value.</p>

   <li>
    <p>For security reasons, these steps <em class=ct>should</em> be
     terminated if <var>header</var> is an <a
     href="#ascii-case-insensitive">ASCII case-insensitive</a> match for one
     of the following headers:</p>

    <ul>
     <li><code>Accept-Charset</code>

     <li><code>Accept-Encoding</code>

     <li><code>Access-Control-Request-Headers</code></li>
     <!-- new in xhr2 -->

     <li><code>Access-Control-Request-Method</code></li>
     <!-- new in xhr2 -->

     <li><code>Connection</code>

     <li><code>Content-Length</code>

     <li><code>Cookie</code>

     <li><code>Cookie2</code>

     <li><code>Content-Transfer-Encoding</code>

     <li><code>Date</code>

     <li><code>Expect</code>

     <li><code>Host</code>

     <li><code>Keep-Alive</code>

     <li><code title="">Origin</code></li>
     <!-- new in xhr2 -->

     <li><code>Referer</code>

     <li><code>TE</code>

     <li><code>Trailer</code>

     <li><code>Transfer-Encoding</code>

     <li><code>Upgrade</code>

     <li><code>User-Agent</code>

     <li><code>Via</code>
    </ul>

    <p>&hellip; or if the start of <var>header</var> is an <a
     href="#ascii-case-insensitive">ASCII case-insensitive</a> match for
     <code>Proxy-</code> or <code>Sec-</code> (including when
     <var>header</var> is just <code>Proxy-</code> or <code>Sec-</code>).</p>

    <p class=note>The above headers are not allowed to be set as they are
     better controlled by the user agent as it knows best what value they
     should have. Header names starting with <code>Sec-</code> are not
     allowed to be set to allow new headers to be minted in the future that
     are guaranteed not to come from <code><a
     href="#xmlhttprequest">XMLHttpRequest</a></code>. (Older clients would
     however still be vulnerable as they allow such headers to be set.)</p>

   <li>
    <p>If <var>header</var> is not in the <a
     href="#author-request-headers">author request headers</a> list append
     <var>header</var> with its associated <var>value</var> to the list and
     terminate these steps.

   <li>
    <p>If <var>header</var> is in the <a
     href="#author-request-headers">author request headers</a> list either
     use multiple headers, combine the values or use a combination of those
     (section 4.2, RFC 2616). [<cite><a
     href="#rfc-rfc2616">RFC2616</a></cite>]
   </li>
   <!-- XXX it seems UAs always combine the values -->
  </ol>

  <p class=note>See also the <code><a href="#send">send()</a></code> method
   regarding user agent header handling for caching, authentication, proxies,
   and cookies.

  <div class=example>
   <pre><code>// The following script:
var client = new XMLHttpRequest();
client.open('GET', 'demo.cgi');
client.setRequestHeader('X-Test', 'one');
client.setRequestHeader('X-Test', 'two');
client.send();

// ...would result in the following header being sent:
...
X-Test: one, two
...</code></pre>
  </div>

  <h4 id=the-withcredentials-attribute><span class=secno>3.6.3 </span>The
   <code title="">withCredentials</code> attribute</h4>

  <p>The <dfn id=withcredentials><code>withCredentials</code></dfn> attribute
   controls the <a href="#credentials-flag">credentials flag</a>.

  <p>When the <code><a href="#withcredentials">withCredentials</a></code>
   attribute is set, the user agent <em class=ct>must</em> run these steps:

  <ol>
   <li>
    <p>If the state is not <a href="#opened-state" title="OPENED
     state">OPENED</a> raise an <code>INVALID_STATE_ERR</code> exception and
     terminate these steps.

   <li>
    <p>If the <a href="#send-flag"><code>send()</code> flag</a> is true raise
     an <code>INVALID_STATE_ERR</code> exception and terminate these steps.

   <li>
    <p>If the given value is <code>true</code>, set the <a
     href="#credentials-flag">credentials flag</a> to true. Otherwise, set
     the <a href="#credentials-flag">credentials flag</a> to false.
  </ol>

  <p>On getting, the <code><a
   href="#withcredentials">withCredentials</a></code> attribute <em
   class=ct>must</em> return <code>true</code> if the <a
   href="#credentials-flag">credentials flag</a> is true, and
   <code>false</code> if the <a href="#credentials-flag">credentials flag</a>
   is false.

  <h4 id=the-upload-attribute><span class=secno>3.6.4 </span>The <code
   title="">upload</code> attribute</h4>

  <p>The <dfn id=upload><code>upload</code></dfn> attribute, on getting, <em
   class=ct>must</em> return the associated <code><a
   href="#xmlhttprequestupload">XMLHttpRequestUpload</a></code> object.

  <h4 id=the-send-method><span class=secno>3.6.5 </span>The <code
   title="">send()</code> method</h4>

  <p>The <dfn id=send title=send><code>send(<var>data</var>)</code></dfn>
   method initiates the request and its optional argument provides the <a
   href="#entity-body">entity body</a> for the request. Authors are
   encouraged to ensure that they have specified the
   <code>Content-Type</code> header via <code><a
   href="#setrequestheader">setRequestHeader()</a></code> before invoking
   <code title="">send()</code> with a non-<code>null</code> <var>data</var>
   argument.

  <p>When invoked, the user agent <em class=ct>must</em> run these steps
   (unless otherwise noted). This algorithm might get aborted if the <code><a
   href="#open">open()</a></code> or <code><a
   href="#abort">abort()</a></code> method is invoked. When the <dfn
   id=abort-send-algorithm title="abort send()"><code>send()</code> algorithm
   is aborted</dfn> the user agent <em class=ct>must</em> terminate the
   algorithm after finishing the step it is on.

  <p class=note>The <code title="">send()</code> algorithm can only be
   aborted when <var>async</var> is <code>true</code> (i.e., the request is
   done asynchronously) and only after the method call has returned.

  <ol>
   <li>
    <p>If the state is not <a href="#opened-state" title="OPENED
     state">OPENED</a> raise an <code>INVALID_STATE_ERR</code> exception and
     terminate these steps.

   <li>
    <p>If the <a href="#send-flag"><code>send()</code> flag</a> is true raise
     an <code>INVALID_STATE_ERR</code> exception and terminate these steps.

   <li> <!-- XXX this step does not match XHR1 -->
    <p>If <var>stored method</var> is <code>GET</code> or <code>HEAD</code>
     act as if the <var>data</var> argument is <code>null</code>.</p>

    <p>If the <var>data</var> argument has not been omitted and is not
     <code>null</code> use it for the <a href="#entity-body">entity body</a>
     observing the following rules:</p>

    <dl class=switch>
     <dt><var>data</var> is a <code>ByteArray</code>

     <dd>
      <p class=XXX>This will be done in terms of the File API in due course.</p>

      <p>Use <var>data</var> literally for transmission.</p>

     <dt><var>data</var> is a <code>DOMString</code>

     <dd>
      <p>Encode <var>data</var> using UTF-8 for transmission.

     <dt><var>data</var> is a <code>Document</code>

     <dd>
      <p>Let <var>tempdata</var> be the result of getting the <code
       title=dom-innerHTML><a href="#dom-innerhtml">innerHTML</a></code>
       attribute on the <var>data</var> object and encode it using
       <code><var>data</var>.inputEncoding</code> or UTF-8 if
       <code><var>data</var>.inputEncoding</code> is <code>null</code>.
       Re-raise any exception this raises.</p>

      <p class=note>If the document cannot be serialized an
       <code>INVALID_STATE_ERR</code> exception is raised.</p>

      <p>Let <var>data</var> be <var>tempdata</var>.</p>
      <!-- XXX1 difference -->
      <p>If no <code>Content-Type</code> header has been set using <code><a
       href="#setrequestheader">setRequestHeader()</a></code> set a
       <code>Content-Type</code> request header with a value of
       <code>application/xml;charset=<var>charset</var></code> where
       <var>charset</var> is the encoding used to encode the document.</p>

      <p class=note>Subsequent changes to the <code>Document</code> have no
       effect on what is submitted.</p>
    </dl>

    <p>If the <var>data</var> argument has been omitted, or is
     <code>null</code>, no entity body is used in the request.</p>

   <li>
    <p>If the <a href="#asynchronous-flag">asynchronous flag</a> is false
     release the <a href="#storage-mutex">storage mutex</a>.

   <li>
    <p>If the <a href="#asynchronous-flag">asynchronous flag</a> is true and
     one or more event listeners are registered on the <code><a
     href="#xmlhttprequestupload">XMLHttpRequestUpload</a></code> object set
     the <a href="#upload-events-flag">upload events flag</a> to true.
     Otherwise, set the <a href="#upload-events-flag">upload events flag</a>
     to false.

   <li>
    <p>Set the <a href="#error-flag">error flag</a> to false.

   <li>
    <p>Set the <a href="#upload-complete-flag">upload complete flag</a> to
     true if there is no <a href="#request-entity-body">request entity
     body</a> or if the <a href="#request-entity-body">request entity
     body</a> is empty. Otherwise, set the <a
     href="#upload-complete-flag">upload complete flag</a> to false.

   <li>
    <p>If the <a href="#asynchronous-flag">asynchronous flag</a> is true run
     these substeps:</p>

    <ol>
     <li>
      <p>Set the <a href="#send-flag"><code>send()</code> flag</a> to true.

     <li>
      <p><a href="#dispatch-readystatechange-event">Dispatch a
       <code>readystatechange</code> event</a>.</p>

      <p class=note>The state does not change. The event is dispatched for
       historical reasons.</p>

     <li>
      <p><a href="#dispatch-progress-event">Dispatch a progress event</a>
       called <code><a href="#loadstart-event">loadstart</a></code>.

     <li>
      <p>If the <a href="#upload-complete-flag">upload complete flag</a> is
       false <a href="#dispatch-progress-event">dispatch a progress event</a>
       called <code><a href="#loadstart-event">loadstart</a></code> on the
       <code><a href="#xmlhttprequestupload">XMLHttpRequestUpload</a></code>
       object.

     <li>
      <p>Return the <code><a href="#send">send()</a></code> method call, but
       continue running the steps in this algorithm.
    </ol>

   <li>
    <dl class=switch>
     <dt>If the <a href="#xmlhttprequest-origin"><code>XMLHttpRequest</code>
      origin</a> and the <a href="#request-url">request URL</a> are <a
      href="#same-origin">same origin</a>

     <dd>
      <p>These are the <dfn id=same-origin-request-steps>same-origin request
       steps</dfn>.</p>

      <p>Make a request to <a href="#request-url">request URL</a>, using HTTP
       method <a href="#request-method">request method</a>, user <a
       href="#request-username">request username</a> (if non-null) and
       password <a href="#request-password">request password</a> (if
       non-null), taking into account the <a
       href="#request-entity-body">request entity body</a>, list of <a
       href="#author-request-headers">author request headers</a> and the
       rules listed at the end of this section.</p>

      <p>If there are cookies to be set, run the <a
       href="#cookie-steps">cookie steps</a>.</p>

      <dl class=switch>
       <dt>If the <a href="#asynchronous-flag">asynchronous flag</a> is false

       <dd>
        <p>While making the request also follow the <a
         href="#same-origin-request-event-rules">same-origin request event
         rules</a>.</p>
        <!--
         This cannot involve any task queue whatsoever because that would
         mean other tasks on the task queue might get processed as well
         which is counter to the whole idea of doing things synchronous.
        -->
        
        <p class=note>The <code><a href="#send">send()</a></code> method call
         will now be returned by virtue of this algorithm ending.</p>

       <dt>If the <a href="#asynchronous-flag">asynchronous flag</a> is true

       <dd>
        <p><a href="#make-progress-notifications">Make progress
         notifications</a>.</p>

        <p><a href="#make-upload-progress-notifications">Make upload progress
         notifications</a>.</p>

        <p>While processing the request, as data becomes available and when
         the user interferes with the request, <a href="#queue-a-task"
         title="queue a task">queue tasks</a> to follow the <a
         href="#same-origin-request-event-rules">same-origin request event
         rules</a> using the <a
         href="#xmlhttprequest-networking-task-source"><code>XMLHttpRequest</code>
         networking task source</a> as <a href="#task-source">task
         source</a>.</p>
      </dl>

     <dt>Otherwise

     <dd>
      <p>These are the <dfn id=cross-origin-request-steps>cross-origin
       request steps</dfn>.</p>

      <p>Make a <a href="#cross-origin-request">cross-origin request</a>,
       passing these as parameters:</p>

      <dl>
       <dt>request URL

       <dd>The <a href="#request-url">request URL</a>.

       <dt>request method

       <dd>The <a href="#request-method">request method</a>.

       <dt>custom request headers

       <dd>The list of <a href="#author-request-headers">author request
        headers</a>.

       <dt>request entity body

       <dd>The <a href="#request-entity-body">request entity body</a>.

       <dt>source origin

       <dd>The <a href="#xmlhttprequest-origin"><code>XMLHttpRequest</code>
        origin</a>.

       <dt>credentials flag

       <dd>The <a href="#credentials-flag">credentials flag</a>.

       <dt>force preflight flag

       <dd>The <a href="#upload-events-flag">upload events flag</a>.
      </dl>

      <p class=note><a href="#request-username">Request username</a> and <a
       href="#request-password">request password</a> are always ignored as
       part of a <a href="#cross-origin-request">cross-origin request</a>;
       including them would allow a site to perform a distributed password
       search. However, user agents will include credentials in the request
       (if the user has any) as required elsewhere.</p>

      <p>If there are cookies to be set and the <a
       href="#credentials-flag">credentials flag</a> is true, run the <a
       href="#cookie-steps">cookie steps</a>.</p>

      <dl class=switch>
       <dt>If the <a href="#asynchronous-flag">asynchronous flag</a> is false

       <dd>
        <p>While making the request also follow the <a
         href="#cross-origin-request-event-rules">cross-origin request event
         rules</a>.</p>
        <!--
         This cannot involve any task queue whatsoever because that would
         mean other tasks on the task queue might get processed as well
         which is counter to the whole idea of doing things synchronous.
        -->
        
        <p class=note>The <code><a href="#send">send()</a></code> method call
         will now be returned by virtue of this algorithm ending.</p>

       <dt>If the <a href="#asynchronous-flag">asynchronous flag</a> is true

       <dd>
        <p>While processing the request, as data becomes available and when
         the user interferes with the request, <a href="#queue-a-task"
         title="queue a task">queue tasks</a> to follow the <a
         href="#cross-origin-request-event-rules">cross-origin request event
         rules</a> using the <a
         href="#xmlhttprequest-networking-task-source"><code>XMLHttpRequest</code>
         networking task source</a> as <a href="#task-source">task
         source</a>.</p>
      </dl>
    </dl>
  </ol>

  <hr>

  <p>If the user agent allows the user to configure a proxy it <em
   class=ct>should</em> modify the request appropriately; i.e., connect to
   the proxy host instead of the origin server, modify the
   <code>Request-Line</code> and send <code>Proxy-Authorization</code>
   headers as specified.

  <p>If the user agent supports HTTP Authentication and
   <code>Authorization</code> is not in the list of <a
   href="#author-request-headers">author request headers</a>, it <em
   class=ct>should</em> consider requests originating from the <code><a
   href="#xmlhttprequest">XMLHttpRequest</a></code> object to be part of the
   protection space that includes the accessed URIs and send
   <code>Authorization</code> headers and handle <code>401
   Unauthorized</code> requests appropriately. If authentication fails, and
   <span>request username and <a href="#request-password">request
   password</a> are both null, user agents <em class=ct>should</em> prompt
   the user for credentials. If authentication fails, and <a
   href="#request-username">request username</a> and <a
   href="#request-password">request password</a> are provided, user agents
   <em class=ct>must not</em> prompt the user for credentials. [<cite><a
   href="#ref-rfc2617">RFC2617</a></cite>]</span>

  <p class=note>Users are not prompted if credentials are provided through
   the <code><a href="#open">open()</a></code> API so that authors can
   implement their own user interface. They are also not prompted for
   cross-site requests.

  <p>If the user agent supports HTTP State Management it <em
   class=ct>should</em> persist, discard and send cookies (as received in the
   <code>Set-Cookie</code> and <code>Set-Cookie2</code> response headers, and
   sent in the <code>Cookie</code> header) as applicable. [<cite><a
   href="#ref-cookies=">COOKIES</a></cite>]

  <p>If the user agent implements a HTTP cache it <em class=ct>should</em>
   respect <code>Cache-Control</code> request headers set by the <code><a
   href="#setrequestheader">setRequestHeader()</a></code> (e.g.,
   <code>Cache-Control: no-cache</code> bypasses the cache). It <em
   class=ct>must not</em> send <code>Cache-Control</code> or
   <code>Pragma</code> request headers automatically unless the user
   explicitly requests such behavior (<abbr>e.g.</abbr>, by (force-)reloading
   the page).

  <p>For <code>304 Not Modified</code> responses that are a result of a user
   agent generated conditional request the user agent <em class=ct>must</em>
   act as if the server gave a <code>200 OK</code> response with the
   appropriate content. The user agent <em class=ct>must</em> allow <code><a
   href="#setrequestheader">setRequestHeader()</a></code> to override
   automatic cache validation by setting request headers (e.g.,
   <code>If-None-Match</code>, <code>If-Modified-Since</code>), in which case
   <code>304 Not Modified</code> responses <em class=ct>must</em> be passed
   through. [<cite><a href="#rfc-rfc2616">RFC2616</a></cite>]

  <p>If the user agent implements server-driven content-negotiation it <em
   class=ct>should</em> set <code>Accept-Encoding</code> and
   <code>Accept-Charset</code> headers as appropriate. Unless set through
   <code><a href="#setrequestheader">setRequestHeader()</a></code> user
   agents <em class=ct>should</em> set the <code>Accept</code> and
   <code>Accept-Language</code> headers as well. If <code>Accept</code> is
   set by the user agent it <em class=ct>must</em> have the value
   <code>*/*</code>. Responses <em class=ct>must</em> have the
   content-encodings automatically decoded. [<cite><a
   href="#rfc-rfc2616">RFC2616</a></cite>]

  <p>Besides the <a href="#author-request-headers">author request headers</a>
   user agents <em class=ct>should not</em> include additional request
   headers other than those mentioned above or other than those authors are
   not allowed to set using <code><a
   href="#setrequestheader">setRequestHeader()</a></code>. This ensures that
   authors have a reasonably predictable API.

  <h4 id=infrastructure-for-the-send-method><span class=secno>3.6.6
   </span>Infrastructure for the <code title="">send()</code> method</h4>

  <p>The <dfn id=cookie-steps>cookie steps</dfn> are as follows:

  <ol>
   <li>
    <p>Wait until ownership of the <a href="#storage-mutex">storage mutex</a>
     can be taken.

   <li>
    <p>Take ownership of the <a href="#storage-mutex">storage mutex</a>.

   <li>
    <p>Update the cookies. [<cite><a href="#ref-cookies=">COOKIES</a></cite>]

   <li>
    <p>Release the <a href="#storage-mutex">storage mutex</a> so that it is
     once again free.
  </ol>

  <hr>

  <p>The <dfn id=same-origin-request-event-rules>same-origin request event
   rules</dfn> are as follows:

  <dl class=switch>
   <dt>If the response is an HTTP redirect

   <dd>
    <p>If the redirect violates security or infinite loop precautions or the
     scheme is not supported this is a <a href="#network-error">network
     error</a>.</p>

    <p>Otherwise, run these steps:</p>

    <ol>
     <li>
      <p>Set the <a href="#request-url">request URL</a> to the <a
       href="#url">URL</a> conveyed by the <code>Location</code> header.

     <li>
      <p>If the <a href="#xmlhttprequest-origin"><code>XMLHttpRequest</code>
       origin</a> and <a href="#request-url">request URL</a> are <a
       href="#same-origin">same origin</a> follow the redirect while
       observing the <a href="#same-origin-request-event-rules">same-origin
       request event rules</a>.

     <li>
      <p>Otherwise, follow the <a
       href="#cross-origin-request-steps">cross-origin request steps</a> and
       terminate the steps for this algorithm.
    </ol>

    <p class=note>HTTP places requirements on the user agent regarding the
     preservation of the <a href="#request-method">request method</a> and <a
     href="#request-entity-body">request entity body</a> during redirects,
     and also requires users to be notified of certain kinds of automatic
     redirections.</p>
    <!-- XXX HTTP needs fixing here -->

   <dt>If the user cancels the download

   <dd>
    <p>This is an <a href="#abort-error">abort error</a>.

   <dt>In case of network errors

   <dd>
    <p>In case of DNS errors, TLS negotiation failure, or other type of
     network errors, this is a <a href="#network-error">network error</a>. Do
     not request any kind of user interaction.</p>

    <p class=note>This does not include HTTP responses that indicate some
     type of error, such as HTTP status code 410.</p>

   <dt>Once all HTTP headers have been received and the <a
    href="#asynchronous-flag">asynchronous flag</a> is true

   <dd>
    <p><a href="#switch-headers-received">Switch to the HEADERS_RECEIVED
     state</a>.

   <dt>Once the first byte (or more) of the <a
    href="#response-entity-body">response entity body</a> has been received
    and the <a href="#asynchronous-flag">asynchronous flag</a> is true

   <dt>If there is no <a href="#response-entity-body">response entity
    body</a> and the <a href="#asynchronous-flag">asynchronous flag</a> is
    true

   <dd>
    <p><a href="#switch-loading">Switch to the LOADING state</a>.

   <dt>Once the whole <a href="#response-entity-body">response entity
    body</a> has been received

   <dt>If there is no <a href="#response-entity-body">response entity
    body</a> and the <a href="#asynchronous-flag">asynchronous flag</a> is
    false or the state is <a href="#loading-state" title="LOADING
    state">LOADING</a>

   <dd>
    <p><a href="#switch-done">Switch to the DONE state</a>.
  </dl>

  <hr>

  <p>The <dfn id=cross-origin-request-event-rules>cross-origin request event
   rules</dfn> are as follows:

  <dl class=switch>
   <dt>If the <a href="#cross-origin-request-status">cross-origin request
    status</a> is <i>preflight complete</i>

   <dd>
    <p><a href="#make-upload-progress-notifications">Make upload progress
     notifications</a>.

   <dt>If the <a href="#cross-origin-request-status">cross-origin request
    status</a> is <i title="">network error</i>

   <dd>
    <p>This is a <a href="#network-error">network error</a>.

   <dt>If the <a href="#cross-origin-request-status">cross-origin request
    status</a> is <i title="">abort error</i>

   <dd>
    <p>This is an <a href="#abort-error">abort error</a>.

   <dt>Once all HTTP headers have been received, the <a
    href="#cross-origin-request-status">cross-origin request status</a> is
    <i>success</i>, and the <a href="#asynchronous-flag">asynchronous
    flag</a> is true

   <dd>
    <p><a href="#switch-headers-received">Switch to the HEADERS_RECEIVED
     state</a>.</p>

    <p><a href="#make-progress-notifications">Make progress
     notifications</a>.</p>

   <dt>Once the first byte (or more) of the <a
    href="#response-entity-body">response entity body</a> has been received,
    the <a href="#cross-origin-request-status">cross-origin request
    status</a> is <i>success</i>, and the <a
    href="#asynchronous-flag">asynchronous flag</a> is true

   <dt>If there is no <a href="#response-entity-body">response entity
    body</a>, the <a href="#cross-origin-request-status">cross-origin request
    status</a> is <i>success</i>, and the <a
    href="#asynchronous-flag">asynchronous flag</a> is true

   <dd>
    <p><a href="#switch-loading">Switch to the LOADING state</a>.

   <dt>Once the whole <a href="#response-entity-body">response entity
    body</a> has been received and the <a
    href="#cross-origin-request-status">cross-origin request status</a> is
    <i>success</i>

   <dt>If there is no <a href="#response-entity-body">response entity
    body</a>, the <a href="#cross-origin-request-status">cross-origin request
    status</a> is <i>success</i>, and the <a
    href="#asynchronous-flag">asynchronous flag</a> is false or the state is
    <a href="#loading-state" title="LOADING state">LOADING</a>

   <dd>
    <p><a href="#switch-done">Switch to the DONE state</a>.
  </dl>

  <hr>

  <p>When something is said to be a <dfn id=network-error>network error</dfn>
   run these steps:

  <ol>
   <li>
    <p>Set the <a href="#response-entity-body">response entity body</a> to
     null.

   <li>
    <p>Set the the <a href="#error-flag">error flag</a> to true.

   <li>
    <p>Empty the list of <a href="#author-request-headers">author request
     headers</a>.

   <li>
    <p>Switch the state to <a href="#done-state" title="DONE state">DONE</a>.

   <li>
    <p>If the <a href="#asynchronous-flag">asynchronous flag</a> is false
     raise a <code><a href="#network-err">NETWORK_ERR</a></code> exception
     and terminate the overall set of steps.

   <li>
    <p><a href="#queue-a-task">Queue a task</a> to <a
     href="#dispatch-readystatechange-event">dispatch a
     <code>readystatechange</code> event</a>.</p>

    <p class=note>At this point it is clear that the <a
     href="#asynchronous-flag">asynchronous flag</a> is true.</p>

   <li>
    <p><a href="#queue-a-task">Queue a task</a> to <a
     href="#dispatch-progress-event">dispatch a progress event</a> called
     <code><a href="#error-event">error</a></code>.

   <li>
    <p><a href="#queue-a-task">Queue a task</a> to <a
     href="#dispatch-progress-event">dispatch a progress event</a> called
     <code><a href="#loadend-event">loadend</a></code>.

   <li>
    <p>If the <a href="#upload-complete-flag">upload complete flag</a> is
     false, follow these substeps:</p>

    <ol>
     <li>
      <p>Set the <a href="#upload-complete-flag">upload complete flag</a> to
       true.

     <li>
      <p><a href="#queue-a-task">Queue a task</a> to <a
       href="#dispatch-progress-event">dispatch a progress event</a> called
       <code><a href="#error-event">error</a></code> on the <code><a
       href="#xmlhttprequestupload">XMLHttpRequestUpload</a></code> object.

     <li>
      <p><a href="#queue-a-task">Queue a task</a> to <a
       href="#dispatch-progress-event">dispatch a progress event</a> called
       <code><a href="#loadend-event">loadend</a></code> on the <code><a
       href="#xmlhttprequestupload">XMLHttpRequestUpload</a></code> object.
    </ol>

   <li>
    <p>Terminate the overall algorithm.
  </ol>

  <hr>

  <p>When something is said to be an <dfn id=abort-error>abort error</dfn>
   run these steps:

  <ol>
   <li>
    <p>Set the <a href="#response-entity-body">response entity body</a> to
     null.

   <li>
    <p>Set the the <a href="#error-flag">error flag</a> to true.

   <li>
    <p>Empty the list of <a href="#author-request-headers">author request
     headers</a>.

   <li>
    <p>Switch the state to <a href="#done-state" title="DONE state">DONE</a>.

   <li>
    <p>If the <a href="#asynchronous-flag">asynchronous flag</a> is false
     raise a <code><a href="#abort-err">ABORT_ERR</a></code> exception and
     terminate the overall set of steps.

   <li>
    <p><a href="#queue-a-task">Queue a task</a> to <a
     href="#dispatch-readystatechange-event">dispatch a
     <code>readystatechange</code> event</a>.</p>

    <p class=note>At this point it is clear that the <a
     href="#asynchronous-flag">asynchronous flag</a> is true.</p>

   <li>
    <p><a href="#queue-a-task">Queue a task</a> to <a
     href="#dispatch-progress-event">dispatch a progress event</a> called
     <code title=abort-event><a href="#abort-event">abort</a></code>.

   <li>
    <p><a href="#queue-a-task">Queue a task</a> to <a
     href="#dispatch-progress-event">dispatch a progress event</a> called
     <code><a href="#loadend-event">loadend</a></code>.

   <li>
    <p>If the <a href="#upload-complete-flag">upload complete flag</a> is
     false, follow these substeps:</p>

    <ol>
     <li>
      <p>Set the <a href="#upload-complete-flag">upload complete flag</a> to
       true.

     <li>
      <p><a href="#queue-a-task">Queue a task</a> to <a
       href="#dispatch-progress-event">dispatch a progress event</a> called
       <code title=abort-event><a href="#abort-event">abort</a></code> on the
       <code><a href="#xmlhttprequestupload">XMLHttpRequestUpload</a></code>
       object.

     <li>
      <p><a href="#queue-a-task">Queue a task</a> to <a
       href="#dispatch-progress-event">dispatch a progress event</a> called
       <code><a href="#loadend-event">loadend</a></code> on the <code><a
       href="#xmlhttprequestupload">XMLHttpRequestUpload</a></code> object.
    </ol>

   <li>
    <p>Terminate the overall algorithm.
  </ol>

  <hr>

  <p>When it is said to <dfn id=switch-headers-received>switch to the
   HEADERS_RECEIVED state</dfn> run these steps:

  <ol>
   <li>
    <p>Switch the state to <a href="#headers-received-state"
     title="HEADERS_RECEIVED state">HEADERS_RECEIVED</a>.

   <li>
    <p><a href="#queue-a-task">Queue a task</a> to <a
     href="#dispatch-readystatechange-event">dispatch a
     <code>readystatechange</code> event</a>.
  </ol>

  <hr>

  <p>When it is said to <dfn id=switch-loading>switch to the LOADING
   state</dfn> run these steps:

  <ol>
   <li>
    <p>Switch the state to <a href="#loading-state" title="LOADING
     state">LOADING</a>.

   <li>
    <p><a href="#queue-a-task">Queue a task</a> to <a
     href="#dispatch-readystatechange-event">dispatch a
     <code>readystatechange</code> event</a>.
  </ol>

  <hr>

  <p>When it is said to <dfn id=switch-done>switch to the DONE state</dfn>
   run these steps:

  <ol>
   <li>
    <p>Switch the state to <a href="#done-state" title="DONE state">DONE</a>.

   <li>
    <p>If the <a href="#asynchronous-flag">asynchronous flag</a> is false run
     these substeps:</p>

    <ol>
     <li>
      <p><a href="#dispatch-readystatechange-event">Dispatch a
       <code>readystatechange</code> event</a>.

     <li>
      <p><a href="#dispatch-progress-event">Dispatch a progress event</a>
       called <code><a href="#load-event">load</a></code>.

     <li>
      <p><a href="#dispatch-progress-event">Dispatch a progress event</a>
       called <code><a href="#loadend-event">loadend</a></code>.
    </ol>

   <li>
    <p>If the <a href="#asynchronous-flag">asynchronous flag</a> is true run
     these substeps:</p>

    <ol>
     <li>
      <p><a href="#queue-a-task">Queue a task</a> to <a
       href="#dispatch-readystatechange-event">dispatch a
       <code>readystatechange</code> event</a>.

     <li>
      <p><a href="#queue-a-task">Queue a task</a> to <a
       href="#dispatch-progress-event">dispatch a progress event</a> called
       <code><a href="#load-event">load</a></code>.

     <li>
      <p><a href="#queue-a-task">Queue a task</a> to <a
       href="#dispatch-progress-event">dispatch a progress event</a> called
       <code><a href="#loadend-event">loadend</a></code>.
    </ol>
  </ol>

  <hr>

  <p>When it is said to <dfn id=make-progress-notifications>make progress
   notifications</dfn>, while the download is progressing, <a
   href="#queue-a-task">queue a task</a> to <a
   href="#dispatch-progress-event">dispatch a progress event</a> called
   <code><a href="#progress-event">progress</a></code> about every 50ms or
   for every byte received, whichever is <em>least</em> frequent.

  <hr>

  <p>When it is said to <dfn id=make-upload-progress-notifications>make
   upload progress notifications</dfn> run these steps:

  <ul>
   <li>
    <p>While the request entity body is being uploaded and the <a
     href="#upload-complete-flag">upload complete flag</a> is false, <a
     href="#queue-a-task">queue a task</a> to <a
     href="#dispatch-progress-event">dispatch a progress event</a> called
     <code><a href="#progress-event">progress</a></code> at the <code><a
     href="#xmlhttprequestupload">XMLHttpRequestUpload</a></code> object
     about every 50ms or for every byte transmitted, whichever is
     <em>least</em> frequent.

   <li>
    <p>If the <a href="#request-entity-body">request entity body</a> has been
     successfully uploaded and the <a href="#upload-complete-flag">upload
     complete flag</a> is still false, run these substeps:</p>

    <ol>
     <li>
      <p>Set the <a href="#upload-complete-flag">upload complete flag</a> to
       true.

     <li>
      <p><a href="#queue-a-task">Queue a task</a> to <a
       href="#dispatch-progress-event">dispatch a progress event</a> called
       <code><a href="#load-event">load</a></code> at the <code><a
       href="#xmlhttprequestupload">XMLHttpRequestUpload</a></code> object.

     <li>
      <p><a href="#queue-a-task">Queue a task</a> to <a
       href="#dispatch-progress-event">dispatch a progress event</a> called
       <code><a href="#loadend-event">loadend</a></code> at the <code><a
       href="#xmlhttprequestupload">XMLHttpRequestUpload</a></code> object.
    </ol>
  </ul>
  <!-- XXX successfully uploaded? -->

  <h4 id=the-abort-method><span class=secno>3.6.7 </span>The <code
   title="">abort()</code> method</h4>

  <p>When the <dfn id=abort><code>abort()</code></dfn> method is invoked, the
   user agent <em class=ct>must</em> run these steps (unless otherwise
   noted):

  <ol>
   <li>
    <p><a href="#abort-send-algorithm" title="abort send()">Abort the
     <code>send()</code> algorithm</a>.

   <li>
    <p>The user agent <em class=ct>should</em> cancel any network activity
     for which the object is responsible.

   <li>
    <p>Set the <a href="#response-entity-body">response entity body</a> to
     null.

   <li>
    <p>Set the <a href="#error-flag">error flag</a> to true.

   <li>
    <p>Empty the list of <a href="#author-request-headers">author request
     headers</a>.

   <li>
    <p>If the state is <a href="#unsent-state" title="UNSENT
     state">UNSENT</a>, <a href="#opened-state" title="OPENED
     state">OPENED</a> with the <a href="#send-flag"><code>send()</code>
     flag</a> being false, or <a href="#done-state" title="DONE
     state">DONE</a> go to the next step.</p>

    <p>Otherwise run these substeps:</p>

    <ol>
     <li>
      <p>Switch the state to <a href="#done-state" title="DONE
       state">DONE</a>.

     <li>
      <p>Set the <a href="#send-flag"><code>send()</code> flag</a> to false.

     <li>
      <p><a href="#dispatch-readystatechange-event">Dispatch a
       <code>readystatechange</code> event</a>.

     <li>
      <p><a href="#dispatch-progress-event">Dispatch a progress event</a>
       called <code title=abort-event><a
       href="#abort-event">abort</a></code>.

     <li>
      <p><a href="#dispatch-progress-event">Dispatch a progress event</a>
       called <code><a href="#loadend-event">loadend</a></code>.

     <li>
      <p>If the <a href="#upload-complete-flag">upload complete flag</a> is
       false run these substeps:</p>

      <ol>
       <li>
        <p>Set the <a href="#upload-complete-flag">upload complete flag</a>
         to true.

       <li>
        <p><a href="#dispatch-progress-event">Dispatch a progress event</a>
         called <code title=abort-event><a
         href="#abort-event">abort</a></code> on the <code><a
         href="#xmlhttprequestupload">XMLHttpRequestUpload</a></code> object.

       <li>
        <p><a href="#dispatch-progress-event">Dispatch a progress event</a>
         called <code><a href="#loadend-event">loadend</a></code> on the
         <code><a
         href="#xmlhttprequestupload">XMLHttpRequestUpload</a></code> object.
      </ol>
    </ol>

   <li>
    <p>Switch the state to <a href="#unsent-state" title="UNSENT
     state">UNSENT</a>.</p>

    <p class=note>No <code><a
     href="#readystatechange-event">readystatechange</a></code> event is
     dispatched.</p>
  </ol>

  <h3 id=response><span class=secno>3.7 </span>Response</h3>

  <h4 id=the-status-attribute><span class=secno>3.7.1 </span>The <code
   title="">status</code> attribute</h4>

  <p>The <dfn id=status><code>status</code></dfn> attribute <em
   class=ct>must</em> return the result of running these steps:

  <ol>
   <li>
    <p>If the state is <a href="#unsent-state" title="UNSENT
     state">UNSENT</a> or <a href="#opened-state" title="OPENED
     state">OPENED</a> raise an <code>INVALID_STATE_ERR</code> exception and
     terminate these steps.

   <li>
    <p>If the <a href="#error-flag">error flag</a> is true return
     <code>0</code> and terminate these steps.

   <li>
    <p>Return the HTTP status code.
  </ol>

  <h4 id=the-statustext-attribute><span class=secno>3.7.2 </span>The <code
   title="">statusText</code> attribute</h4>

  <p>The <dfn id=statustext><code>statusText</code></dfn> attribute <em
   class=ct>must</em> return the result of running these steps:

  <ol>
   <li>
    <p>If the state is <a href="#unsent-state" title="UNSENT
     state">UNSENT</a> or <a href="#opened-state" title="OPENED
     state">OPENED</a> raise an <code>INVALID_STATE_ERR</code> exception and
     terminate these steps.

   <li>
    <p>If the <a href="#error-flag">error flag</a> is true return the empty
     string and terminate these steps.

   <li>
    <p>Return the HTTP status text.
  </ol>

  <h4 id=the-getresponseheader-method><span class=secno>3.7.3 </span>The
   <code title="">getResponseHeader()</code> method</h4>

  <p>When the <dfn id=getresponseheader
   title=getresponseheader><code>getResponseHeader(<var>header</var>)</code></dfn>
   is invoked, the user agent <em class=ct>must</em> run these steps:

  <ol>
   <li>
    <p>If the state is <a href="#unsent-state" title="UNSENT
     state">UNSENT</a> or <a href="#opened-state" title="OPENED
     state">OPENED</a> raise an <code>INVALID_STATE_ERR</code> exception and
     terminate these steps.

   <li>
    <p>If <var>header</var> does not match the <code><a
     href="#field-name">field-name</a></code> production return
     <code>null</code> and terminate these steps.

   <li>
    <p>If the <a href="#error-flag">error flag</a> is true return
     <code>null</code> and terminate these steps.

   <li>
    <p>If <var>header</var> is an <a href="#ascii-case-insensitive">ASCII
     case-insensitive</a> match for <code>Set-Cookie</code> or
     <code>Set-Cookie2</code> return <code>null</code> and terminate these
     steps.

   <li>
    <p>If <var>header</var> is an <a href="#ascii-case-insensitive">ASCII
     case-insensitive</a> match for multiple HTTP response headers, return
     the values of these headers as a single concatenated string separated
     from each other by a U+002C COMMA U+0020 SPACE character pair and
     terminate these steps.

   <li>
    <p>If <var>header</var> is an <a href="#ascii-case-insensitive">ASCII
     case-insensitive</a> match for a single HTTP response header, return the
     value of that header and terminate these steps.

   <li>
    <p>Return <code>null</code>.
  </ol>

  <p class=note>The Cross-Origin Resource Sharing specification filters the
   headers that are exposed by <code><a
   href="#getresponseheader">getResponseHeader()</a></code> for non
   <span>same-origin</span> requests. [<cite><a
   href="#ref-cors">CORS</a></cite>]

  <div class=example>
   <pre><code>// The following script:
var client = new XMLHttpRequest();
client.open("GET", "test.txt", true);
client.send();
client.onreadystatechange = function() {
 if(this.readyState == 2) {
  print(client.getResponseHeader("Content-Type"));
 }
}

// ...should output something similar to the following text:
Content-Type: text/plain; charset=utf-8</code></pre>
  </div>

  <h4 id=the-getallresponseheaders-method><span class=secno>3.7.4 </span>The
   <code title="">getAllResponseHeaders()</code> method</h4>

  <p>When the <dfn
   id=getallresponseheaders><code>getAllResponseHeaders()</code></dfn> method
   is invoked, the user agent <em class=ct>must</em> run the following steps:

  <ol>
   <li>
    <p>If the state is <a href="#unsent-state" title="UNSENT
     state">UNSENT</a> or <a href="#opened-state" title="OPENED
     state">OPENED</a> raise an <code>INVALID_STATE_ERR</code> exception and
     terminate these steps.

   <li>
    <p>If the <a href="#error-flag">error flag</a> is true return the empty
     string and terminate these steps.

   <li>
    <p>Return all the HTTP headers, excluding headers that are an <a
     href="#ascii-case-insensitive">ASCII case-insensitive</a> match for
     <code>Set-Cookie</code> or <code>Set-Cookie2</code>, as a single string,
     with each header line separated by a U+000D CR U+000A LF pair excluding
     the status line, and with each header name and header value separated by
     a U+003A COLON U+0020 SPACE pair.
  </ol>

  <div class=example>
   <pre><code>// The following script:
var client = new XMLHttpRequest();
client.open("GET", "test.txt", true);
client.send();
client.onreadystatechange = function() {
 if(this.readyState == 2) {
  print(this.getAllResponseHeaders());
 }
}

// ...should output something similar to the following text:
Date: Sun, 24 Oct 2004 04:58:38 GMT
Server: Apache/1.3.31 (Unix)
Keep-Alive: timeout=15, max=99
Connection: Keep-Alive
Transfer-Encoding: chunked
Content-Type: text/plain; charset=utf-8</code></pre>
  </div>

  <p class=note>The Cross-Origin Resource Sharing specification filters the
   headers that are exposed by <code><a
   href="#getallresponseheaders">getAllResponseHeaders()</a></code> for non
   <span>same-origin</span> requests. [<cite><a
   href="#ref-cors">CORS</a></cite>]

  <h4 id=response-entity-body0><span class=secno>3.7.5 </span>Response Entity
   Body</h4>
  <!-- XXX carefully study this -->

  <p>The <dfn id=response-mime-type>response MIME type</dfn> is the MIME type
   the <code>Content-Type</code> header contains without any parameters or
   null if the header could not be parsed properly or was omitted. The <dfn
   id=override-mime-type>override MIME type</dfn> is initially null and can
   get a value if <code><a
   href="#overridemimetype">overrideMimeType()</a></code> is invoked. <dfn
   id=final-mime-type>Final MIME type</dfn> is the override MIME type unless
   that is null in which case it is the response MIME type.

  <p>The <dfn id=response-charset>response charset</dfn> is the value of the
   <code>charset</code> parameter of the <code>Content-Type</code> header or
   <code>null</code> if there was no <code>charset</code> parameter or if the
   header could not be parsed properly or was omitted. The <dfn
   id=override-charset>override charset</dfn> is initially null and can get a
   value if <code title="">overrideMimeType()</code> is invoked. <dfn
   id=final-charset>Final charset</dfn> is the override charset unless that
   is null in which case it is the response charset.

  <p>The <dfn id=response-entity-body>response entity body</dfn> is the
   fragment of the <a href="#entity-body">entity body</a> received so far
   (LOADING state) or the complete entity body (DONE state). If there is no
   entity body the response entity body is null.

  <p>The <dfn id=text-response-entity-body>text response entity body</dfn> is
   a <code>DOMString</code> representing the <a
   href="#response-entity-body">response entity body</a>. The text response
   entity body is the return value of the following algorithm:

  <ol>
   <li>
    <p>If the response entity body is null return the empty string and
     terminate these steps.</p>

   <li>
    <p>Let <var>charset</var> be the <a href="#final-charset">final
     charset</a>.

   <li>
    <p>Let <var>mime</var> be the <a href="#final-mime-type">final MIME
     type</a>.

   <li>
    <p>If <var>charset</var> is null and <var>mime</var> is null,
     <code>text/xml</code>, <code>application/xml</code> or ends in <code
     title="">+xml</code> use the rules set forth in the XML specifications
     to determine the character encoding. Let <var>charset</var> be the
     determined character encoding.

   <li>
    <p>If <var>charset</var> is null and <var>mime</var> is
     <code>text/html</code> follow the rules set forth in the HTML
     specification to determine the character encoding. Let
     <var>charset</var> be the determined character encoding. [<cite><a
     href="#ref-html5">HTML5</a></cite>]

   <li>
    <p>If <var>charset</var> is null then, for each of the rows in the
     following table, starting with the first one and going down, if the
     first bytes of <var>bytes</var> match the bytes given in the first
     column, then let <var>charset</var> be the encoding given in the cell in
     the second column of that row. If there is no match <var>charset</var>
     remains null.</p>

    <table>
     <thead>
      <tr>
       <th>Bytes in Hexadecimal

       <th>Description

     <tbody><!-- UTF-32 is dead
      <tr>
       <td>00 00 FE FF
       <td>UTF-32BE BOM
      <tr>
       <td>FF FE 00 00
       <td>UTF-32LE BOM-->

      <tr>
       <td>FE FF

       <td>UTF-16BE BOM

      <tr>
       <td>FF FE

       <td>UTF-16LE BOM

      <tr>
       <td>EF BB BF

       <td>UTF-8 BOM<!-- nobody uses this
      <tr>
       <td>DD 73 66 73
       <td>UTF-EBCDIC
-->
        
    </table>

   <li>
    <p>If <var>charset</var> is null let <var>charset</var> be UTF-8.

   <li>
    <p>Return the result of decoding the response entity body using
     <var>charset</var>. Replace bytes or sequences of bytes that are not
     valid accordng to the <var>charset</var> with a single U+FFFD character.
  </ol>

  <p class=note>Authors are encouraged to encode their resources using UTF-8.

  <p>The <dfn id=document-response-entity-body>document response entity
   body</dfn> is either a <code>Document</code> representing the <a
   href="#response-entity-body">response entity body</a> or
   <code>null</code>. The document response entity body is the return value
   of the following algorithm:

  <ol>
   <li>
    <p>If the response entity body is null terminate these steps and return
     <code>null</code>.

   <li>
    <p>If <a href="#final-mime-type">final MIME type</a> is not null,
     <code>text/html</code>, <code>text/xml</code>,
     <code>application/xml</code>, and does not end in <code
     title="">+xml</code> terminate these steps and return <code>null</code>.

   <li>
    <p>If <a href="#final-mime-type">final MIME type</a> is
     <code>text/html</code> let <var>document</var> be an object implementing
     the <code>Document</code> interface that represents the <a
     href="#response-entity-body">response entity body</a> parsed following
     the rules set forth in the HTML specification for an HTML parser with
     scripting disabled and then terminate this algorithm. [<cite><a
     href="#ref-html5">HTML5</a></cite>]</p>

   <li>
    <p>Otherwise, let <var>document</var> be an object implementing the
     <code>Document</code> interface that represents the result of parsing
     the response entity body into a document tree following the rules from
     the XML specifications. If this fails (unsupported character encoding,
     namespace well-formedness error et cetera) terminate these steps return
     <code>null</code>. [<cite><a href="#ref-xml">XML</a></cite>]</p>

    <p class=note>Scripts in the resulting document tree will not be
     executed, resources referenced will not be loaded and no associated XSLT
     will be applied.</p>

   <li>
    <p>Ensure that the <code>cookie</code> attribute on <var>document</var>
     returns the empty string if the <span>same origin flag</span> is false.

   <li>
    <p>Return <var>document</var>.
  </ol>

  <h4 id=the-overridemimetype-method><span class=secno>3.7.6 </span>The <code
   title="">overrideMimeType()</code> method</h4>

  <p>When the <dfn id=overridemimetype
   title=overridemimetype><code>overrideMimeType(<var>mime</var>)</code></dfn>
   method is invoked, the user agent <em class=ct>must</em> run the following
   steps:

  <ol>
   <li>
    <p>If parsing <var>mime</var> analogously to the value of the
     <code>Content-Type</code> headers fails raise a <code>SYNTAX_ERR</code>
     exception and abort this algorithm.

   <li>
    <p>If a MIME type (without any parameters) is successfully parsed set <a
     href="#override-mime-type">override MIME type</a> to that MIME type.

   <li>
    <p>If a <code>charset</code> parameter is successfully parsed set <a
     href="#override-charset">override charset</a> to its value.
  </ol>

  <h4 id=the-responsebody-attribute><span class=secno>3.7.7 </span>The <code
   title="">responseBody</code> attribute</h4>

  <p class=XXX>This will be done in terms of the File API in due course.

  <p>The <dfn id=responsebody><code>responseBody</code></dfn> attribute, on
   getting, <em class=ct>must</em> return the result of running the following
   steps:

  <ol>
   <li>
    <p>If the state is not <a href="#loading-state" title="LOADING
     state">LOADING</a> or <a href="#done-state" title="DONE state">DONE</a>
     raise an <code>INVALID_STATE_ERR</code> exception and terminate these
     steps.

   <li>
    <p>Return a <code>ByteArray</code> object representing the <a
     href="#response-entity-body">response entity body</a> or return
     <code>null</code> if the response entity body is null.
  </ol>

  <h4 id=the-responsetext-attribute><span class=secno>3.7.8 </span>The <code
   title="">responseText</code> attribute</h4>

  <p>The <dfn id=responsetext><code>responseText</code></dfn> attribute, on
   getting, <em class=ct>must</em> return the result of running the following
   steps:

  <ol>
   <li>
    <p>If the state is not <a href="#loading-state" title="LOADING
     state">LOADING</a> or <a href="#done-state" title="DONE state">DONE</a>
     return the empty string and terminate these steps.

   <li>
    <p>Return the <a href="#text-response-entity-body">text response entity
     body</a>.
  </ol>

  <h4 id=the-responsexml-attribute><span class=secno>3.7.9 </span>The <code
   title="">responseXML</code> attribute</h4>

  <p>The <dfn id=responsexml><code>responseXML</code></dfn> attribute, on
   getting, <em class=ct>must</em> return the result of running the following
   steps:

  <ol>
   <li>
    <p>If the state is not <a href="#done-state" title="DONE state">DONE</a>
     return <code>null</code> and terminate these steps.

   <li>
    <p>Return the <a href="#document-response-entity-body">document response
     entity body</a>.
  </ol>

  <p class=note>The <code><a href="#responsexml">responseXML</a></code>
   attribute has XML in its name for historical reasons. It also returns
   documents created using an HTML parser.

  <h3 id=events><span class=secno>3.8 </span>Events summary</h3>

  <p>The following events are dispatched on <code><a
   href="#xmlhttprequest">XMLHttpRequest</a></code> and/or <code><a
   href="#xmlhttprequestupload">XMLHttpRequestUpload</a></code> objects:

  <table>
   <thead>
    <tr>
     <th>Event name

     <th>Interface

     <th>Dispatched when&hellip;

   <tbody>
    <tr>
     <td><dfn id=readystatechange-event><code>readystatechange</code></dfn>

     <td><code>Event</code>

     <td>The <code><a href="#readystate">readyState</a></code> attribute
      changes and at some seemingly arbitrary times for historical reasons.

    <tr>
     <td><dfn id=loadstart-event><code>loadstart</code></dfn>

     <td><code>ProgressEvent</code>

     <td>When the request starts.

    <tr>
     <td><dfn id=progress-event><code>progress</code></dfn>

     <td><code>ProgressEvent</code>

     <td>While loading and sending data.

    <tr>
     <td><dfn id=abort-event title=abort-event><code>abort</code></dfn>

     <td><code>ProgressEvent</code>

     <td>When the request has been aborted. For instance, by invoking the
      <code><a href="#abort">abort()</a></code> method.

    <tr>
     <td><dfn id=error-event><code>error</code></dfn>

     <td><code>ProgressEvent</code>

     <td>When the request has failed.

    <tr>
     <td><dfn id=load-event><code>load</code></dfn>

     <td><code>ProgressEvent</code>

     <td>When the request has successfully completed.

    <tr>
     <td><dfn id=loadend-event><code>loadend</code></dfn>

     <td><code>ProgressEvent</code>

     <td>When the request has completed (either in success or failure).
  </table>

  <h3 id=exceptions><span class=secno>3.9 </span>Exceptions</h3>

  <p>Several algorithms in this specification may result in an exception
   being thrown. These exceptions are all part of the group
   <code>ExceptionCode</code> and use the <code>DOMException</code> object,
   which is defined in DOM Level 3 Core. In addition this specification
   extends the <code>ExceptionCode</code> group with several new constants as
   indicated below. [<cite><a href="#ref-dom3core">DOM3Core</a></cite>]

  <p class=note>Thus, exceptions used by this specification and not defined
   in this section are defined by DOM Level 3 Core.

  <pre
   class=idl>const unsigned short <a href="#security-err">SECURITY_ERR</a> = 18;
const unsigned short <a href="#network-err">NETWORK_ERR</a> = 19;
const unsigned short <a href="#abort-err">ABORT_ERR</a> = 20;</pre>

  <p>The <dfn id=security-err><code>SECURITY_ERR</code></dfn> exception is
   raised if an attempt is made to perform an operation or access some data
   in a way that would be a security risk or a violation of the user agent's
   security policy.</p>
  <!-- http://lists.w3.org/Archives/Public/public-webapi/2006May/0027.html -->

  <p>The <dfn id=network-err><code>NETWORK_ERR</code></dfn> exception is
   raised when a network error occurs in synchronous requests.

  <p>The <dfn id=abort-err><code>ABORT_ERR</code></dfn> exception is raised
   when the user aborts a request in synchronous requests.

  <p class=note>These exceptions might be folded into an update of DOM Level
   3 Core in due course, as they are appropriate for other API specifications
   as well.

  <h2 class=no-num id=references>References</h2>

  <p>Unless marked "Non-normative" these references are normative.

  <dl>
   <dt>[<dfn id="ref-cookies=">COOKIES</dfn>]

   <dd><cite><a href="http://ietf.org/rfc/rfc2109">HTTP State Management
    Mechanism</a></cite>, D. Kristol, L. Montulli, editors. IETF, February
    1997.

   <dd><cite><a href="http://ietf.org/rfc/rfc2965">HTTP State Management
    Mechanism</a></cite>, D. Kristol, L. Montulli, editors. IETF, October
    2000.</dd>
   <!-- XXX These specs do not match reality. Also, the latter obsoletes the
   former -->

   <dt>[<dfn id=ref-cors>CORS</dfn>]

   <dd><cite><a
    href="http://dev.w3.org/2006/waf/access-control/">Cross-Origin Resource
    Sharing</a></cite> (work in progress), A. van Kesteren, editor. W3C,
    2009.

   <dt>[<dfn id=ref-dom2events>DOM2Events</dfn>]

   <dd><cite><a href="http://www.w3.org/TR/DOM-Level-2-Events/">Document
    Object Model (DOM) Level 2 Events Specification</a></cite>, T. Pixley,
    editor. W3C, November 2000.

   <dt>[<dfn id=ref-dom3core>DOM3Core</dfn>]

   <dd><cite><a href="http://www.w3.org/TR/DOM-Level-3-Core">Document Object
    Model (DOM) Level 3 Core Specification</a></cite>, A. Le Hors, P. Le
    H&eacute;garet, L. Wood, G. Nicol, J. Robie, M. Champion, S. Byrne,
    editors. W3C, April 2004.

   <dt>[<dfn id=ref-ecmascript>ECMAScript</dfn>]

   <dd><cite><a
    href="http://www.ecma-international.org/publications/standards/Ecma-262.htm">ECMAScript
    Language Specification</a></cite>, Third Edition. ECMA, December 1999.

   <dt>[<dfn id=ref-html5>HTML5</dfn>]

   <dd><cite><a
    href="http://www.w3.org/html/wg/html5/">HTML&nbsp;5</a></cite> (work in
    progress), I. Hickson, D. Hyatt, editors. W3C, 2008.

   <dd><cite><a
    href="http://www.whatwg.org/specs/web-apps/current-work/">HTML&nbsp;5</a></cite>
    (work in progress), I. Hickson, editor. WHATWG, 2008.

   <dt>[<dfn id=ref-httpverbsec>HTTPVERBSEC</dfn>]

   <dd>(Non-normative) <cite><a
    href="http://www.kb.cert.org/vuls/id/867593">Multiple vendors' web
    servers enable HTTP TRACE method by default</a></cite>, US-CERT.

   <dd>(Non-normative) <cite><a
    href="http://www.kb.cert.org/vuls/id/288308">Microsoft Internet
    Information Server (IIS) vulnerable to cross-site scripting via HTTP
    TRACK method</a></cite>, US-CERT.

   <dd>(Non-normative) <cite><a
    href="http://www.kb.cert.org/vuls/id/150227">HTTP proxy default
    configurations allow arbitrary TCP connections</a></cite>, US-CERT.

   <dt>[<dfn id=ref-pe>PE</dfn>]

   <dd><cite><a href="http://www.w3.org/TR/progress-events/">Progress Events
    1.0</a></cite> (work in progress), C. McCathieNeville, editor. W3C, 2007.

   <dt>[<dfn id=ref-rfc2046>RFC2046</dfn>]

   <dd><cite><a href="http://ietf.org/rfc/rfc2046">Multipurpose Internet Mail
    Extensions (MIME) Part Two: Media Types</a></cite>, N. Freed, N.
    Borenstein, editors. IETF, November 1996.

   <dt>[<dfn id=ref-rfc2119>RFC2119</dfn>]

   <dd><cite><a href="http://ietf.org/rfc/rfc2119">Key words for use in RFCs
    to Indicate Requirement Levels</a></cite>, S. Bradner. IETF, March 1997.

   <dt>[<dfn id=rfc-rfc2616>RFC2616</dfn>]

   <dd><cite><a href="http://ietf.org/rfc/rfc2616">Hypertext Transfer
    Protocol -- HTTP/1.1</a></cite>, R. Fielding, J. Gettys, J. Mogul, H.
    Frystyk, L. Masinter, P. Leach, T. Berners-Lee, editors. IETF, June 1999.

   <dt>[<dfn id=ref-rfc2617>RFC2617</dfn>]

   <dd><cite><a href="http://ietf.org/rfc/rfc2617">HTTP Authentication: Basic
    and Digest Access Authentication</a></cite>, P. Hallam-Baker, J.
    Hostetler, S. Lawrence, P. Leach, A. Luotonen, L. Stewart, editors. IETF,
    June 1999.

   <dt>[<dfn id=ref-rfc3986>RFC3986</dfn>]

   <dd><cite><a href="http://ietf.org/rfc/rfc3986">Uniform Resource
    Identifier (URI): Generic Syntax</a></cite>, T. Berners-Lee, R. Fielding,
    L. Masinter, editors. IETF, January 2005.

   <dt>[<dfn id=ref-rfc3987>RFC3987</dfn>]

   <dd><cite><a href="http://ietf.org/rfc/rfc3987">Internationalized Resource
    Identifiers (IRIs)</a></cite>, M. Duerst, M. Suignard, editors. IETF,
    January 2005. L. Masinter, editors. IETF, January 2005.

   <dt>[<dfn id=ref-webidl>WebIDL</dfn>]

   <dd><cite><a href="http://dev.w3.org/2006/webapi/WebIDL/">Web
    IDL</a></cite> (work in progress), C. McCormack, editor. W3C, 2008.

   <dt>[<dfn id=ref-xml>XML</dfn>]

   <dd><cite><a href="http://www.w3.org/TR/xml/">Extensible Markup Language
    (XML) 1.0 (Fifth Edition)</a></cite>, T. Bray, J. Paoli, C.
    Sperberg-McQueen, E. Maler, F. Yergeau, editors. W3C, November 2008.

   <dd><cite><a href="http://www.w3.org/TR/xml-names/">Namespaces in XML
    (Second Edition)</a></cite>, T. Bray, D. Hollander, A. Layman, R. Tobin,
    editors. W3C, August 2006.
  </dl>

  <h2 class=no-num id=acknowledgments>Acknowledgments</h2>

  <p>The editor would like to thank Alexey Proskuryakov, David Andersson,
   David Levin, Elliotte Harold, Lachlan Hunt, Ian Hickson, Jonas Sicking,
   Maciej Stachowiak, Martin Hassman, Mohamed Zergaoui, Olli Pettay, and Rune
   Halvorsen for their contributions to this specification.

  <p>Thanks also to all who have contributed to the <code
   title="">XMLHttpRequest</code> specification.

  <p>Thanks also to all those who have helped to improve this specification
   by sending suggestions and corrections. (Please, keep bugging us with your
   issues!)
